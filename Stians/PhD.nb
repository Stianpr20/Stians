(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    636667,      13520]
NotebookOptionsPosition[    618331,      13193]
NotebookOutlinePosition[    618777,      13212]
CellTagsIndexPosition[    618734,      13209]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[TextData[{
 "Stian\[CloseCurlyQuote]s ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " package \[Dash] ",
 StyleBox["PhD",
  FontFamily->"Courier"],
 " functions"
}], "Title",
 CellChangeTimes->{{3.6325088204434223`*^9, 3.632508823522456*^9}, {
   3.655742119951337*^9, 3.655742125247018*^9}, {3.657176107171741*^9, 
   3.657176113595751*^9}, {3.6571965175177727`*^9, 3.657196518139456*^9}, {
   3.667811374858439*^9, 3.667811377601095*^9}, {3.667900351656826*^9, 
   3.667900356531871*^9}, {3.67575821153409*^9, 3.675758245630015*^9}, {
   3.675758564815556*^9, 3.6757585720063353`*^9}, 3.6757716010874443`*^9, {
   3.730105251464036*^9, 3.73010525348969*^9}, {3.730105417118586*^9, 
   3.7301054247346497`*^9}},ExpressionUUID->"7833b4d3-d836-4f05-931e-\
e692c3034217"],

Cell[CellGroupData[{

Cell["Setup", "Chapter",
 CellChangeTimes->{{3.667809710340659*^9, 3.667809727338533*^9}, {
  3.6678099238942623`*^9, 
  3.667809924822213*^9}},ExpressionUUID->"a80d2db1-a19a-4f58-b5af-\
934bf34d38b3"],

Cell[CellGroupData[{

Cell["Export usage messages", "Subchapter",
 CellChangeTimes->{{3.667899335139988*^9, 
  3.667899339699316*^9}},ExpressionUUID->"699430f8-a558-459a-b93a-\
a9d9aa0ef8b8"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"packagename", "=", 
   RowBox[{"FileNameTake", "@", 
    RowBox[{"NotebookDirectory", "[", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sectionname", "=", 
    RowBox[{"First", "@", 
     RowBox[{"Flatten", "@", 
      RowBox[{"StringCases", "[", 
       RowBox[{
        RowBox[{"NotebookImport", "[", 
         RowBox[{
          RowBox[{"NotebookFileName", "[", "]"}], ",", "\"\<Title\>\""}], 
         "]"}], ",", 
        RowBox[{
         RowBox[{"\"\<\\\\[Dash] \>\"", "~~", 
          RowBox[{"x", ":", 
           RowBox[{"LetterCharacter", ".."}]}]}], "\[RuleDelayed]", "x"}]}], 
       "]"}]}]}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"<<", "Stians`"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"messagefile", "=", 
    RowBox[{"FileNameJoin", "[", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"NotebookDirectory", "[", "]"}], ",", "\[IndentingNewLine]", 
       "\"\<Messages\>\"", ",", "\[IndentingNewLine]", 
       RowBox[{"packagename", "<>", "sectionname", "<>", "\"\<.txt\>\""}]}], 
      "\[IndentingNewLine]", "}"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"functions", "=", 
    RowBox[{
     RowBox[{"NotebookImport", "[", 
      RowBox[{
       RowBox[{"NotebookFileName", "[", "]"}], ",", "\"\<Subchapter\>\""}], 
      "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"3", ";;"}], "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"notebooks", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"NotebookDirectory", "[", "]"}], ",", "\[IndentingNewLine]", 
         "\"\<Documentation\>\"", ",", "\[IndentingNewLine]", 
         "\"\<English\>\"", ",", "\[IndentingNewLine]", 
         "\"\<ReferencePages\>\"", ",", "\[IndentingNewLine]", 
         "\"\<Symbols\>\"", ",", "\[IndentingNewLine]", 
         RowBox[{"#", "<>", "\"\<.nb\>\""}]}], "}"}], "]"}], "&"}], "/@", 
     "functions"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"found", "=", 
    RowBox[{"Select", "[", 
     RowBox[{"notebooks", ",", "FileExistsQ"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Complement", "[", 
       RowBox[{"notebooks", ",", "found"}], "]"}], "\[NotEqual]", 
      RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Print", "[", "\"\<Missing documentation pages:\>\"", "]"}], 
      ";", 
      RowBox[{"Print", "[", 
       RowBox[{"Column", "[", 
        RowBox[{"FileNameTake", "/@", 
         RowBox[{"Complement", "[", 
          RowBox[{"notebooks", ",", "found"}], "]"}]}], "]"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"NeatUsage", "[", 
     RowBox[{"#", ",", "messagefile"}], "]"}], "&"}], "/@", "found"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.660662612972769*^9, 3.660662615331635*^9}, {
   3.6678996421176853`*^9, 3.66789969462072*^9}, {3.667899845913467*^9, 
   3.667899850423938*^9}, {3.667899984372815*^9, 3.6678999940522842`*^9}, {
   3.667900034828264*^9, 3.667900089209947*^9}, {3.667900334078722*^9, 
   3.6679003638145247`*^9}, {3.667903245172576*^9, 3.6679032454925957`*^9}, {
   3.667903509806757*^9, 3.6679035140052967`*^9}, {3.675758442867031*^9, 
   3.675758481993051*^9}, {3.6757585443694277`*^9, 3.6757585456885557`*^9}, {
   3.6757585983182087`*^9, 3.675758704140443*^9}, {3.675758754211491*^9, 
   3.675758772678719*^9}, {3.675759204709443*^9, 3.6757592307473087`*^9}, {
   3.675759379117465*^9, 3.6757594378723717`*^9}, {3.675759500854343*^9, 
   3.675759530220367*^9}, {3.675759709648603*^9, 3.675759710360009*^9}, {
   3.675759767239332*^9, 3.675759808110104*^9}, {3.675760218477907*^9, 
   3.6757602205561533`*^9}, {3.675762009516317*^9, 3.675762010034891*^9}, {
   3.675762172552596*^9, 3.675762176643489*^9}, {3.6757694543401737`*^9, 
   3.675769455794608*^9}, {3.67576953993613*^9, 3.6757695580553617`*^9}, {
   3.6757710214550257`*^9, 3.6757710272949677`*^9}, 3.675771150291032*^9, {
   3.675856100530809*^9, 3.675856100753621*^9}, {3.675856527195032*^9, 
   3.675856540089183*^9}, 3.679727001698728*^9, 3.679727049088442*^9, 
   3.679727711425622*^9, {3.7148472092728043`*^9, 
   3.714847210486568*^9}},ExpressionUUID->"447b0ba7-3aae-41ff-9aad-\
7f478a73a42b"],

Cell[CellGroupData[{

Cell[BoxData["\<\"Missing documentation pages:\"\>"], "Print",
 CellChangeTimes->{{3.675856150820507*^9, 3.6758561514869347`*^9}, {
   3.6758561845770283`*^9, 3.675856185194291*^9}, {3.675856236988235*^9, 
   3.675856237585203*^9}, {3.675856497565666*^9, 3.675856498152535*^9}, {
   3.6758565728394938`*^9, 3.6758565734443827`*^9}, 3.675857467020989*^9, 
   3.675857548746808*^9, {3.675857772995242*^9, 3.675857798970192*^9}, 
   3.675857971114163*^9},ExpressionUUID->"f5e7f633-f702-4411-88b2-\
49aad8585388"],

Cell[BoxData[
 TagBox[GridBox[{
    {"\<\"NewFunction1.nb\"\>"},
    {"\<\"NewFunction2.nb\"\>"}
   },
   DefaultBaseStyle->"Column",
   GridBoxAlignment->{"Columns" -> {{Left}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
  "Column"]], "Print",
 CellChangeTimes->{{3.675856150820507*^9, 3.6758561514869347`*^9}, {
   3.6758561845770283`*^9, 3.675856185194291*^9}, {3.675856236988235*^9, 
   3.675856237585203*^9}, {3.675856497565666*^9, 3.675856498152535*^9}, {
   3.6758565728394938`*^9, 3.6758565734443827`*^9}, 3.675857467020989*^9, 
   3.675857548746808*^9, {3.675857772995242*^9, 3.675857798970192*^9}, 
   3.67585797112043*^9},ExpressionUUID->"46427cd1-84cd-44d4-a39f-\
1793136a5bd6"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Start package", "Subchapter",
 CellChangeTimes->{{3.6678994075374317`*^9, 3.667899407889496*^9}, {
  3.667899743835251*^9, 
  3.6678997459540863`*^9}},ExpressionUUID->"32227193-03df-4a4b-85c7-\
dc316a7eec5a"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{"1.", " ", "Automatically", " ", "detected", " ", "package"}], "-",
    " ", 
   RowBox[{"and", " ", "section", " ", "names"}]}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.667819463432852*^9, 3.667819469852543*^9}, {
  3.667891181663424*^9, 3.667891186174388*^9}, {3.667891302645341*^9, 
  3.667891318523108*^9}, {3.667894792436206*^9, 3.66789479714669*^9}, {
  3.6758561234256287`*^9, 3.675856132776348*^9}, {3.714847221278653*^9, 
  3.7148472214932337`*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"64acf6b3-dd9d-44fb-95ca-24cddbfadd0f"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Print", "[", 
  RowBox[{
  "packagename", "<>", "\"\<`\>\"", "<>", "sectionname", "<>", "\"\<`\>\""}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.675856135230393*^9, 
  3.67585617188929*^9}},ExpressionUUID->"55484cff-afb4-41b2-8291-\
1416d7ff9d78"],

Cell[BoxData["\<\"Stians`SpecificTheme`\"\>"], "Print",
 CellChangeTimes->{{3.675856151568821*^9, 3.675856185278205*^9}, 
   3.675856240102826*^9, 3.6758564982340517`*^9, 3.6758565735238657`*^9, 
   3.6758574671563187`*^9, 3.675857548898489*^9, {3.675857773109282*^9, 
   3.675857799113914*^9}, 
   3.675857971211151*^9},ExpressionUUID->"9019ffaf-f258-4806-b474-\
f0b927fa9690"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
  "2.", " ", "Automatically", " ", "suggested", " ", "file", " ", "with", " ",
    "usage", " ", "messages"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.667819463432852*^9, 3.667819469852543*^9}, {
  3.667891181663424*^9, 3.667891186174388*^9}, {3.667891302645341*^9, 
  3.667891318523108*^9}, {3.667894792436206*^9, 3.66789479714669*^9}, {
  3.6758561234256287`*^9, 3.675856132776348*^9}, {3.675857439792679*^9, 
  3.675857441783497*^9}, {3.6758575074480057`*^9, 3.675857526070496*^9}, {
  3.675857836347898*^9, 3.675857837090664*^9}, {3.714847223701399*^9, 
  3.714847223901187*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"700ab601-d89f-4271-abd0-1931c03daf94"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\"\<<< \>\"", "<>", "packagename", "<>", "\"\</Messages/\>\"", "<>", 
  RowBox[{"FileNameTake", "@", "messagefile"}]}]], "Input",
 CellChangeTimes->{{3.675856135230393*^9, 3.67585617188929*^9}, {
   3.675857447799584*^9, 3.67585744908737*^9}, 3.675857543400454*^9, {
   3.675857758461503*^9, 3.6758578491467648`*^9}, {3.675857931171277*^9, 
   3.675857968137019*^9}},ExpressionUUID->"119401f3-e4a6-4425-9e86-\
bc36eaf9252c"],

Cell[BoxData["\<\"<< Stians/Messages/StiansSpecificTheme.txt\"\>"], "Output",
 CellChangeTimes->{{3.6758577731765547`*^9, 3.675857849472341*^9}, 
   3.67585793260028*^9, 
   3.675857971281651*^9},ExpressionUUID->"6aa1b066-6d8a-44d8-8425-\
7a410ed863eb"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"End", " ", "of", " ", "preamble"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.667819463432852*^9, 3.667819469852543*^9}, {
  3.667891181663424*^9, 3.667891186174388*^9}, {3.667891302645341*^9, 
  3.667891318523108*^9}, {3.667894792436206*^9, 3.66789479714669*^9}, {
  3.675855644779607*^9, 3.675855646786475*^9}, {3.675856105809746*^9, 
  3.675856106032909*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"882f3f3c-d8c3-44b6-b61e-f4173879dee1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.6758565494205027`*^9, 
  3.675856551144558*^9}},ExpressionUUID->"403fb481-ef66-47e5-8f08-\
02b9df619e3a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<Stians`SpecificTheme`\>\"", "]"}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650291995903159*^9, 3.650291999656385*^9}, {
   3.655794914392253*^9, 3.655794915028521*^9}, {3.6570168680070057`*^9, 
   3.657016910052175*^9}, {3.657182226988536*^9, 3.657182262339521*^9}, {
   3.6571965249075317`*^9, 3.657196529083351*^9}, {3.657222486965454*^9, 
   3.6572224883724937`*^9}, {3.6572225935629787`*^9, 3.657222623281169*^9}, {
   3.667732206857939*^9, 3.667732209689768*^9}, {3.667899881152515*^9, 
   3.6678998857748203`*^9}, {3.667899972645935*^9, 3.667899975156528*^9}, {
   3.667900338764357*^9, 3.6679003473080177`*^9}, {3.675759543603879*^9, 
   3.6757595670369987`*^9}, 3.675856191993038*^9},
 Background->RGBColor[
  1, 0.9, 1],ExpressionUUID->"4b6824f9-decc-42c4-a041-234ae1541977"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Import", " ", "usage", " ", "messages", " ", "from", " ", "file"}],
   " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667819463432852*^9, 3.667819469852543*^9}, {
  3.667891181663424*^9, 3.667891186174388*^9}, {3.667891302645341*^9, 
  3.667891318523108*^9}, {3.667894792436206*^9, 3.66789479714669*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"47ffcf2f-1fb3-4028-a526-f0b3e269caea"],

Cell[BoxData[
 RowBox[{"<<", " ", 
  "\"\<Stians/Messages/StiansSpecificTheme.txt\>\""}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6758578586034203`*^9, 3.675857858866438*^9}, {
   3.675857915843672*^9, 3.6758579164176292`*^9}, 3.675857952946909*^9},
 Background->RGBColor[
  1, 0.9, 1],ExpressionUUID->"b1b8a3aa-6a45-48d2-b8fe-ca071f76c209"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Definitions", "Chapter",
 CellChangeTimes->{{3.657263896281269*^9, 3.6572639010563383`*^9}, {
  3.667809853233161*^9, 
  3.667809863671739*^9}},ExpressionUUID->"adf79a8e-15dd-4de1-b651-\
fedf1848d189"],

Cell[CellGroupData[{

Cell["AlignUB", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, 3.667818523109948*^9, {3.7137889504855537`*^9, 
   3.7137889515556917`*^9}},ExpressionUUID->"a1caeef5-9fed-42bd-93a0-\
e0ab75b98add"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"8408cda0-4957-419c-9347-2a0e3a1cc75d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"AlignUB", "::", "ambiguous"}], "=", 
   "\"\<`1` possible matrices found. Use a smaller tolerance.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AlignUB", "::", "none"}], "=", "\"\<No matrices found.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AlignUB", "::", "notfound"}], "=", 
   "\"\<The `1` data file was not found.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AlignUB", "::", "invalid"}], "=", 
   "\"\<\[LeftGuillemet]`1`\[RightGuillemet] is not a valid input.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AlignUB", "::", "delta"}], "=", 
    "\"\<Invalid setting for \[Delta].\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "@", "AlignUB"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<Delta\>\"", "\[Rule]", "\"\<Auto\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<ReturnDelta\>\"", "\[Rule]", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<ReturnMatrices\>\"", "\[Rule]", "False"}]}], 
    "\[IndentingNewLine]", "}"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.667811591227736*^9, 3.667818529468916*^9, {3.69053608199729*^9, 
   3.6905360823248963`*^9}, {3.712561785146146*^9, 3.7125617925355453`*^9}, {
   3.7125659740199213`*^9, 3.712566032391958*^9}, {3.713787723313532*^9, 
   3.713787731591707*^9}},ExpressionUUID->"5d16eb0a-beea-45f5-918b-\
5b26ca6bf27d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"273b815f-12b0-4039-8924-f7ae26ff86c3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AlignUB", "[", "input_String", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "input2", ",", "temp1", ",", "temp2", ",", "temp3", ",", "temp4", ",", 
      "temp5"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Import", " ", "if", " ", "input", " ", "is", " ", "a", " ", "file"}], 
     " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"FileExistsQ", "@", "input"}], ",", "\[IndentingNewLine]", 
       RowBox[{"input2", "=", 
        RowBox[{"StringJoin", "@", 
         RowBox[{"Riffle", "[", 
          RowBox[{
           RowBox[{"ToString", "/@", 
            RowBox[{
             RowBox[{"Import", "[", "input", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ",", "\"\< \>\""}], "]"}]}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"input2", "=", "input"}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"temp1", "=", 
      RowBox[{"StringCases", "[", 
       RowBox[{"input2", ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<-\>\"", ",", "DigitCharacter"}], "}"}], "~~", "__"}]}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"temp2", "=", 
      RowBox[{"First", "@", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"temp1", ",", "\"\< \>\""}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"temp3", "=", 
      RowBox[{"StringReplace", "[", 
       RowBox[{"temp2", ",", 
        RowBox[{"\"\<E\>\"", "\[Rule]", "\"\<*10^\>\""}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"temp4", "=", 
      RowBox[{"ToExpression", "/@", "temp3"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"temp5", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{"temp4", ",", "3"}], "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.6678115931321983`*^9, 3.667818496199253*^9, 
  3.713786049229826*^9, 3.71378646588659*^9, 3.713787733697793*^9},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"14d0f2a8-58eb-416c-85a4-49b2ed886f44"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AlignUB", "[", 
   RowBox[{"class_String", ",", "ref_", ",", "input_", ",", 
    RowBox[{"OptionsPattern", "@", "AlignUB"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "M", ",", "m", ",", "ubref", ",", "ubinput", ",", "delta", ",", 
      "\[IndentingNewLine]", "temp", ",", "temp1", ",", "temp2", ",", "temp3",
       ",", "temp4", ",", "temp5", ",", "temp6", ",", "temp7", ",", 
      "\[IndentingNewLine]", "tempA", ",", "tempB", ",", "tempC", ",", 
      "tempD", ",", "tempE", ",", "tempF", ",", "tempG"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
       RowBox[{"--", 
        RowBox[{"-", " ", "Preparing"}]}], " ", 
       RowBox[{"input", " ", "--"}]}], "-"}], "*)"}], "\[IndentingNewLine]", 
    "\t", 
    RowBox[{"(*", " ", 
     RowBox[{"Reference", " ", "and", " ", "input", " ", "matrices"}], " ", 
     "*)"}], "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{"M", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Which", "[", "\[IndentingNewLine]", "\t", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"Import", " ", ".", "dat"}], " ", "file"}], " ", "*)"}], 
         "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"TrueQ", "[", 
           RowBox[{
            RowBox[{"FileFormat", "[", "M", "]"}], "\[Equal]", 
            "\"\<Table\>\""}], "]"}], ",", "\[IndentingNewLine]", "\t\t", 
          RowBox[{
           RowBox[{"temp", "=", 
            RowBox[{"Check", "[", 
             RowBox[{
              RowBox[{"Import", "[", "M", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{
               RowBox[{"Message", "[", 
                RowBox[{
                 RowBox[{"AlignUB", "::", "notfound"}], ",", 
                 "\"\<reference\>\""}], "]"}], ";", "\[IndentingNewLine]", 
               "\t\t", 
               RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t\t", 
           RowBox[{"m", "=", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"temp", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", 
                 RowBox[{"3", ";;", "11"}]}], "]"}], "]"}], ",", "3"}], 
             "]"}]}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          "\t", 
          RowBox[{"(*", " ", 
           RowBox[{"Matrix", " ", "given", " ", "as", " ", "string"}], " ", 
           "*)"}], "\[IndentingNewLine]", "\t", 
          RowBox[{"StringQ", "@", "m"}], ",", 
          RowBox[{"m", "=", 
           RowBox[{"AlignUB", "@", "m"}]}], ",", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"(*", " ", 
           RowBox[{"Matrix", " ", "given", " ", "directly"}], " ", "*)"}], 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"MatrixQ", "@", "m"}], ",", "Null", ",", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
          RowBox[{"(*", " ", 
           RowBox[{"None", " ", "of", " ", "the", " ", "above"}], " ", "*)"}],
           "\[IndentingNewLine]", "\t", "True", ",", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"AlignUB", "::", "invalid"}], ",", "m"}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", "\t", 
         "]"}], ";", "\[IndentingNewLine]", "\t", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"M", ",", "m"}], "]"}]}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"{", 
        RowBox[{"m", ",", 
         RowBox[{"{", 
          RowBox[{"ref", ",", "input"}], "}"}]}], "}"}]}], 
      "\[IndentingNewLine]", "\t", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ubref", ",", "ubinput"}], "}"}], "=", "M"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{"--", 
         RowBox[{"-", " ", "Finding"}]}], " ", "correct", " ", 
        RowBox[{"matrix", " ", "--"}]}], "-"}], "*)"}], "\[IndentingNewLine]",
      "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Multiplying", " ", "input", " ", "matrix", " ", "by", " ", "all", " ", 
       "symmetry", " ", "operations"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"temp1", "=", 
      RowBox[{"Check", "[", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"SymmetryOperations", "[", "class", "]"}], ",", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"Goto", "[", "\"\<End\>\"", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp2", "=", 
      RowBox[{"Transpose", "/@", "temp1"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"temp3", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Dot", "[", 
         RowBox[{"ubinput", ",", "#"}], "]"}], "&"}], "/@", "temp2"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", " ", "Determining"}], " ", "the", " ", "value", " ", 
       RowBox[{"of", " ", "'"}], 
       RowBox[{
        RowBox[{"delta", "'"}], " ", "--"}]}], "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"delta", "=", 
      RowBox[{"OptionValue", "[", "\"\<Delta\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{"(*", " ", 
       RowBox[{"Automatic", " ", "method"}], " ", "*)"}], 
      "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"TrueQ", "[", 
        RowBox[{"delta", "===", "\"\<Auto\>\""}], "]"}], ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Subtracting", " ", "reference", " ", "matrix", " ", "with", 
         "\[IndentingNewLine]", "\t\t", "every", " ", "Laue", " ", 
         "equivalent"}], " ", "*)"}], "\[IndentingNewLine]", "\t\t\t", 
       RowBox[{
        RowBox[{"tempA", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Subtract", "[", 
            RowBox[{"ubref", ",", "#"}], "]"}], "&"}], "/@", "temp3"}]}], ";",
         "\[IndentingNewLine]", "\t\t", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Find", " ", "the", " ", "matrix", " ", "with", " ", "the", " ", 
          "smallest", "\[IndentingNewLine]", "\t\t", "total", " ", "squared", 
          " ", "deviation"}], " ", "*)"}], "\[IndentingNewLine]", "\t\t\t", 
        RowBox[{"tempB", "=", 
         RowBox[{"Total", "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Flatten", "/@", "tempA"}], "^", "2"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Find", " ", "the", " ", "largest", " ", "element", " ", "of", " ", 
          "that", " ", "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
        "\t\t\t", 
        RowBox[{"tempC", "=", 
         RowBox[{"First", "@", 
          RowBox[{"TakeSmallest", "[", 
           RowBox[{"tempB", ",", "1"}], "]"}]}]}], ";", "\[IndentingNewLine]",
         "\t\t\t", 
        RowBox[{"tempD", "=", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"tempB", ",", "tempC"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\t\t\t", 
        RowBox[{"tempE", "=", 
         RowBox[{"First", "@", 
          RowBox[{"TakeLargestBy", "[", "\[IndentingNewLine]", "\t\t\t", 
           RowBox[{
            RowBox[{"Flatten", "@", 
             RowBox[{"tempA", "[", 
              RowBox[{"[", "tempD", "]"}], "]"}]}], ",", "Abs", ",", "1"}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", "\t\t\t", 
        RowBox[{"tempF", "=", 
         RowBox[{"RealDigits", "@", "tempE"}]}], ";", "\[IndentingNewLine]", 
        "\t\t\t", 
        RowBox[{"tempG", "=", 
         RowBox[{
          RowBox[{"Length", "@", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"First", "@", "tempF"}], ",", 
             RowBox[{
              RowBox[{"#", ">", "0"}], "&"}]}], "]"}]}], "-", 
          RowBox[{"Last", "@", "tempF"}]}]}], ";", "\[IndentingNewLine]", 
        "\t\t\t", 
        RowBox[{"delta", "=", 
         RowBox[{
          RowBox[{"Abs", "[", "tempE", "]"}], "+", 
          RowBox[{"10", "^", 
           RowBox[{"(", 
            RowBox[{"-", "tempG"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
        "\t\t\t", 
        RowBox[{"(*", " ", 
         RowBox[{"Optional", ":", " ", 
          RowBox[{"Return", " ", "the", " ", "found", " ", "value"}]}], " ", 
         "*)"}], "\[IndentingNewLine]", "\t\t\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<ReturnDelta\>\"", "]"}], ",", 
          RowBox[{"Return", "@", "delta"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"Use", " ", "value", " ", "set", " ", "by", " ", 
         RowBox[{"user", " ", "--"}], " ", "check", " ", "if", " ", 
         "numeric"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
       RowBox[{"NumericQ", "@", "delta"}], ",", "Null", ",", 
       "\[IndentingNewLine]", "\t", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"None", " ", "of", " ", "the", " ", "above"}], " ", "*)"}], 
       "\[IndentingNewLine]", "\t", "True", ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"AlignUB", "::", "delta"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", "\t", "]"}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Finding", " ", "matrices", " ", "within", " ", "threshold"}], 
      " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"temp4", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"temp3", ",", "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{
          RowBox[{"Chop", "[", 
           RowBox[{
            RowBox[{"#", "-", "ubref"}], ",", "delta"}], "]"}], "\[Equal]", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"3", ",", "3"}], "}"}]}], "]"}]}], "&"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", "\t", 
     RowBox[{"temp5", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"temp3", ",", "#"}], "]"}], "&"}], "/@", "temp4"}], "]"}]}],
      ";", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Abort", " ", "if", " ", "there", " ", "are", " ", "more", " ", "than", 
       " ", "one", " ", "possibility"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", "temp5"}], ">", "1"}], ",", 
       "\[IndentingNewLine]", "\t\t\t", 
       RowBox[{"(*", " ", "Option", " ", "*)"}], "\[IndentingNewLine]", 
       "\t\t\t\t", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<ReturnMatrices\>\"", "]"}], ",", 
          RowBox[{"Return", "@", "temp4"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"AlignUB", "::", "ambiguous"}], ",", 
          RowBox[{"Length", "@", "temp5"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"Goto", "[", "\"\<End\>\"", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Warning", " ", "if", " ", "no", " ", "matrices", " ", "were", " ", 
       "found"}], " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"temp5", "\[Equal]", 
        RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"AlignUB", "::", "none"}], "]"}], ";", "\[IndentingNewLine]",
         "\t\t", 
        RowBox[{"Goto", "[", "\"\<End\>\"", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{"--", 
         RowBox[{"-", " ", "Formatting"}]}], " ", 
        RowBox[{"output", " ", "--"}]}], "-"}], "*)"}], "\[IndentingNewLine]",
      "\t", 
     RowBox[{"temp6", "=", 
      RowBox[{"temp1", "[", 
       RowBox[{"[", 
        RowBox[{"First", "@", "temp5"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp7", "=", 
      RowBox[{"StringDelete", "[", 
       RowBox[{
        RowBox[{"ToString", "@", "temp6"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<{\>\"", ",", "\"\<}\>\"", ",", "\"\<,\>\""}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"Return", "[", 
      RowBox[{"\"\<um crec \>\"", "<>", "temp7"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Label", "[", "\"\<End\>\"", "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, 3.667818543440028*^9, 3.681669132470278*^9, {
   3.690535325954748*^9, 3.690535359276989*^9}, {3.6905355534591265`*^9, 
   3.6905355583576202`*^9}, {3.6905358551377277`*^9, 
   3.6905358771809516`*^9}, {3.6905360779880133`*^9, 
   3.6905360951639433`*^9}, {3.7125631148433237`*^9, 3.712563117665346*^9}, {
   3.712563169431756*^9, 3.712563169579771*^9}, {3.712563894334762*^9, 
   3.712563913869672*^9}, {3.712564211792872*^9, 3.712564245748274*^9}, {
   3.71256430505355*^9, 3.7125643374304113`*^9}, {3.71256438526989*^9, 
   3.712564394767991*^9}, {3.7125645483791523`*^9, 3.7125646307850933`*^9}, {
   3.712564696952684*^9, 3.7125647015962667`*^9}, {3.7125647665501337`*^9, 
   3.712564871739029*^9}, {3.712564905543867*^9, 3.71256505404323*^9}, {
   3.71256509777337*^9, 3.71256513138198*^9}, {3.7125652935855207`*^9, 
   3.7125656812419863`*^9}, {3.71256572207304*^9, 3.712565738769511*^9}, {
   3.712565862476458*^9, 3.712565895287305*^9}, {3.7125660445699263`*^9, 
   3.7125660486977386`*^9}, {3.712566135141488*^9, 3.712566209768283*^9}, {
   3.712566268371656*^9, 3.7125662860687523`*^9}, {3.712566318481862*^9, 
   3.712566449414094*^9}, {3.71256649017102*^9, 3.7125667100633907`*^9}, {
   3.712566748454239*^9, 3.712566749919161*^9}, {3.71256680770293*^9, 
   3.712566845015143*^9}, {3.7137877378848667`*^9, 3.713787762916152*^9}, {
   3.713787795987237*^9, 3.713787804579011*^9}, {3.7137879256968937`*^9, 
   3.713787926223703*^9}, {3.7137883230311117`*^9, 3.713788326405159*^9}, 
   3.717740897017721*^9, {3.72750489344874*^9, 3.727504893714706*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"2f80f240-73b1-4762-bcee-5b8b2499c18b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"0a2d65ae-5fb3-4bd8-9ebd-c8ff4c69704c"]
}, Closed]],

Cell[CellGroupData[{

Cell["ErrorPropagation", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, 3.667900125753806*^9, {3.684646660758275*^9, 
   3.684646660811885*^9}, {3.684679409191053*^9, 3.684679411222722*^9}, {
   3.6846811176191063`*^9, 3.684681119497213*^9}, {3.6846813101581917`*^9, 
   3.6846813119644547`*^9}, {3.684735312111738*^9, 
   3.684735315961302*^9}},ExpressionUUID->"b2f7cc32-c8e4-4b2d-8cde-\
ebd8dcac7cd5"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"69128417-021e-4d23-8763-6029adc8ed61"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "ErrorPropagation", "]"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{"\"\<RoundSignificantFigures\>\"", "\[Rule]", "True"}], 
    "\[IndentingNewLine]", "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.7616532044789143`*^9},ExpressionUUID->"9460cd00-5df4-48f0-bc51-\
73c46ee35dc7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"ce813654-42aa-415f-a40d-51ffea14f503"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ErrorPropagation", "[", 
   RowBox[{"function_", ",", "values__List", ",", "\[IndentingNewLine]", 
    RowBox[{"OptionsPattern", "@", "ErrorPropagation"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "n", ",", "X", ",", "\[Delta]X", ",", "f", ",", "\[Delta]f", ",", "u", 
      ",", "x", ",", "pd", ",", "calc"}], "}"}], ",", " ", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"--", "-"}], "*", " ", "Preparations", " ", "*", 
      RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{"n", "=", 
      RowBox[{"Length", "@", 
       RowBox[{"{", "values", "}"}]}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"X", ",", "\[Delta]X"}], "}"}], "=", 
      RowBox[{"Transpose", "@", 
       RowBox[{"{", "values", "}"}]}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"f", "=", 
      RowBox[{"function", "@@", "X"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Partial", " ", "derivatives", " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Dummy", " ", "variables"}], " ", "*)"}], "\[IndentingNewLine]",
      "\t", 
     RowBox[{"u", "=", 
      RowBox[{"IntegerString", "[", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"1", ",", "n"}], "]"}], ",", "10", ",", "2"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"x", "=", 
      RowBox[{"ToExpression", "@", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"StringJoin", "[", 
           RowBox[{"\"\<x\>\"", ",", "#"}], "]"}], "&"}], ",", "u"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Partial", " ", "derivatives", " ", "for", " ", "each", " ", 
       "variable"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"pd", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"AppendTo", "[", 
        RowBox[{"pd", ",", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{
            RowBox[{"function", "@@", "x"}], ",", 
            RowBox[{"x", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "*", 
          RowBox[{"\[Delta]X", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"{", 
        RowBox[{"i", ",", "n"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Inserting", " ", "values", " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"calc", "=", 
      RowBox[{"ReplaceAll", "[", 
       RowBox[{"pd", ",", 
        RowBox[{"Thread", "[", 
         RowBox[{"x", "\[Rule]", "X"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"\[Delta]f", "=", 
      RowBox[{"Sqrt", "@", 
       RowBox[{"Total", "[", 
        RowBox[{"calc", "^", "2"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Optional", ":", " ", 
       RowBox[{"'", 
        RowBox[{"RoundSignificantFigures", "'"}]}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<RoundSignificantFigures\>\"", "]"}], 
       ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"RoundSignificantFigures", "[", 
        RowBox[{"{", 
         RowBox[{"f", ",", "\[Delta]f"}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"{", 
        RowBox[{"f", ",", "\[Delta]f"}], "}"}]}], "\[IndentingNewLine]", "\t",
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.713096547089555*^9, 3.713096849976799*^9}, {
   3.71309688502486*^9, 3.71309689343155*^9}, 3.713096988838799*^9, {
   3.713097031765951*^9, 3.7130971367709627`*^9}, {3.713097193383993*^9, 
   3.7130972607906857`*^9}, {3.7130973179989653`*^9, 3.713097564214031*^9}, {
   3.713097641589403*^9, 3.713097649827558*^9}, {3.761653204484763*^9, 
   3.7616532044961777`*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"a7b25da5-07b4-4378-bf30-7a8f3929fbda"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"6c497642-3a44-41ca-8cc5-1c63241fccc2"]
}, Closed]],

Cell[CellGroupData[{

Cell["ExportCrystalData", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, {3.667900125753806*^9, 3.667900130001958*^9}, 
   3.668105575055373*^9, {3.681669216072617*^9, 3.6816692308311157`*^9}, {
   3.682134073518475*^9, 3.682134077310957*^9}, {3.6821351637913322`*^9, 
   3.682135164412662*^9}, {3.682138013029172*^9, 3.682138014016361*^9}, {
   3.717851081489071*^9, 3.7178510849035378`*^9}, {3.717851178791065*^9, 
   3.7178511845893507`*^9}},ExpressionUUID->"f17bd351-2c38-4cb7-b6a8-\
689f9b80aec2"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"fcfa87a2-f589-419b-a19c-9a9b5bf918ae"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "@", "ExportCrystalData"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{"\"\<IncludeSymmetryOperations\>\"", "\[Rule]", "True"}], 
    "\[IndentingNewLine]", "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.667811591227736*^9, 3.66810571214802*^9, {3.6681867516522207`*^9, 
   3.668186778354513*^9}, {3.6681868394172163`*^9, 3.6681868614325943`*^9}, {
   3.668187374101748*^9, 3.6681874104278383`*^9}, {3.668187695125526*^9, 
   3.668187730468417*^9}, {3.668188056044814*^9, 3.668188056876872*^9}, {
   3.6681926250344687`*^9, 3.668192625250432*^9}, 3.68166923708845*^9, {
   3.6817064191712627`*^9, 3.68170642414537*^9}, {3.6817239114596*^9, 
   3.681723955601696*^9}, {3.681724223652172*^9, 3.681724224172266*^9}, {
   3.6818128705108147`*^9, 3.681812886108671*^9}, {3.681819874858591*^9, 
   3.681819895264824*^9}, {3.681835709479094*^9, 3.681835743293057*^9}, {
   3.682100938006762*^9, 3.682100938717538*^9}, 3.682134103684627*^9, {
   3.682142891293942*^9, 3.6821428951259127`*^9}, {3.682144298513987*^9, 
   3.682144308993547*^9}, {3.682144403478119*^9, 3.682144406579885*^9}, {
   3.682144581637662*^9, 3.6821446292028418`*^9}, {3.6821529895283422`*^9, 
   3.68215300977632*^9}, 3.717851096640901*^9, {3.71791774343513*^9, 
   3.717917764277873*^9}, {3.717929010200309*^9, 3.71792902616625*^9}, 
   3.717929121448449*^9, {3.726834592349515*^9, 
   3.7268345928495283`*^9}},ExpressionUUID->"6868daab-8d21-4341-ad52-\
b145fc9fc377"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"91248770-8752-41e1-89c7-44308304482b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ExportCrystalData", "[", 
   RowBox[{"crystal_String", ",", "output_String", ",", 
    RowBox[{"OptionsPattern", "@", "ExportCrystalData"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "data", ",", "compound", ",", "c", ",", "ltc", ",", "sg", ",", 
      "csmatrix", ",", "\[IndentingNewLine]", "cell", ",", "atoms", ",", 
      "siteM", ",", "type", ",", "flag", ",", "X", ",", "\[IndentingNewLine]",
       "$f0", ",", "sccoeff", ",", "asf", ",", "fp", ",", "fpp", ",", "write",
       ",", "end", ",", "endTab", ",", "\[IndentingNewLine]", "temp"}], "}"}],
     ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Input", " ", "check"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"InputCheck", "[", 
      RowBox[{"crystal", ",", "\"\<CrystalQ\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Preparing", " ", "data", " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Input", " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"data", "=", 
      RowBox[{"$CrystalData", "[", "crystal", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Compounds", " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"compound", "=", "crystal"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Centring", " ", "vectors"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"c", "=", 
      RowBox[{"SymmetryData", "[", 
       RowBox[{"crystal", ",", "\"\<Centring\>\""}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"ltc", "=", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"c", "\[Equal]", "\"\<P\>\""}], ",", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "0"}], "}"}], "}"}], ",", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"c", "\[Equal]", "\"\<A\>\""}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"1", "/", "2"}], ",", 
            RowBox[{"1", "/", "2"}]}], "}"}]}], "}"}], ",", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"c", "\[Equal]", "\"\<B\>\""}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1", "/", "2"}], ",", "0", ",", 
            RowBox[{"1", "/", "2"}]}], "}"}]}], "}"}], ",", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"c", "\[Equal]", "\"\<C\>\""}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1", "/", "2"}], ",", 
            RowBox[{"1", "/", "2"}], ",", "0"}], "}"}]}], "}"}], ",", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"c", "\[Equal]", "\"\<I\>\""}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1", "/", "2"}], ",", 
            RowBox[{"1", "/", "2"}], ",", 
            RowBox[{"1", "/", "2"}]}], "}"}]}], "}"}], ",", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"c", "\[Equal]", "\"\<F\>\""}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1", "/", "2"}], ",", 
            RowBox[{"1", "/", "2"}], ",", "0"}], "}"}], ",", 
          "\[IndentingNewLine]", "\t\t\t\t", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"1", "/", "2"}], ",", 
            RowBox[{"1", "/", "2"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1", "/", "2"}], ",", "0", ",", 
            RowBox[{"1", "/", "2"}]}], "}"}]}], "}"}], ",", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"c", "\[Equal]", "\"\<R\>\""}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"2", "/", "3"}], ",", 
            RowBox[{"1", "/", "3"}], ",", 
            RowBox[{"1", "/", "3"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1", "/", "3"}], ",", 
            RowBox[{"2", "/", "3"}], ",", 
            RowBox[{"2", "/", "3"}]}], "}"}]}], "}"}]}], 
       "\[IndentingNewLine]", "\t", "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Space", " ", "group"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"sg", "=", 
      RowBox[{"SymmetryData", "[", 
       RowBox[{"crystal", ",", "\"\<HermannMauguinShort\>\""}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Symmetry", " ", "operations"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<IncludeSymmetryOperations\>\"", "]"}],
        ",", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"csmatrix", "=", 
         RowBox[{"SymmetryOperations", "[", "crystal", "]"}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"csmatrix", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{"#", ",", "InputForm"}], "]"}], "&"}], "/@", 
          "csmatrix"}]}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]",
        "\t", 
       RowBox[{"csmatrix", "=", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "}"}], "}"}]}]}], 
      "\[IndentingNewLine]", "\t", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Lattice", " ", "parameters"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"cell", "=", 
      RowBox[{"N", "@", 
       RowBox[{"LatticeParameters", "[", 
        RowBox[{"crystal", ",", 
         RowBox[{"\"\<Units\>\"", "\[Rule]", "False"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Atom", " ", "data"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"atoms", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"data", "[", "\"\<AtomData\>\"", "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "#"}], "]"}], "]"}], "&"}], "/@", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{"{", 
          RowBox[{
          "\"\<Element\>\"", ",", "\"\<OccupationFactor\>\"", ",", 
           "\"\<FractionalCoordinates\>\"", ",", "\[IndentingNewLine]", "\t", 
           "\"\<DisplacementParameters\>\""}], "}"}]}], ",", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", 
           RowBox[{"$CrystalData", "[", 
            RowBox[{"crystal", ",", "\"\<AtomData\>\""}], "]"}]}]}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"atoms", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}], "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"atoms", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", 
             RowBox[{"-", "1"}]}], "]"}], "]"}], "}"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "@", "atoms"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"atoms", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}], "=", 
      RowBox[{"StringDelete", "[", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"atoms", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"DigitCharacter", ",", "\"\<+\>\"", ",", "\"\<-\>\""}], 
         "}"}]}], "]"}]}], ";", "\t", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Multiplicity", " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"r", "=", 
      RowBox[{"atoms", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "3"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]",
      "\t", 
     RowBox[{"siteM", "=", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"N", "@", 
          RowBox[{"Length", "@", "\[IndentingNewLine]", "\t", 
           RowBox[{
           "SymmetryEquivalentPositions", "[", "\[IndentingNewLine]", "\t", 
            RowBox[{"crystal", ",", 
             RowBox[{"r", "[", 
              RowBox[{"[", "a", "]"}], "]"}]}], "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", 
           RowBox[{"Length", "@", "r"}]}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", "\t", "/", 
       RowBox[{"Length", "@", 
        RowBox[{"SymmetryOperations", "@", "crystal"}]}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"atoms", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "2"}], "]"}], "]"}], "=", 
      RowBox[{
       RowBox[{"atoms", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}], "*", "siteM"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "ToString", " ", "*)"}], "\[IndentingNewLine]", "\t", 
     
     RowBox[{"atoms", "=", 
      RowBox[{"atoms", "/.", 
       RowBox[{"x_String", "\[RuleDelayed]", 
        RowBox[{"\"\<\\\"\>\"", "<>", "x", "<>", "\"\<\\\"\>\""}]}]}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"atoms", "=", 
      RowBox[{"atoms", "/.", 
       RowBox[{
        RowBox[{"x_", "?", "NumericQ"}], "\[RuleDelayed]", 
        RowBox[{"ToString", "[", 
         RowBox[{"x", ",", "InputForm"}], "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Flag", " ", 
       RowBox[{"(", 
        RowBox[{"ADP", " ", "type"}], ")"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"type", "=", 
      RowBox[{"data", "[", 
       RowBox[{"[", 
        RowBox[{"\"\<AtomData\>\"", ",", "1", ",", "\"\<Type\>\""}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"flag", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"type", "\[Equal]", "\"\<Biso\>\""}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<B\>\"", ",", "\"\<B\>\""}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<U\>\"", ",", "\"\<U\>\""}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Scattering", " ", "coefficients"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"X", "=", 
      RowBox[{"DeleteDuplicates", "@", 
       RowBox[{"data", "[", 
        RowBox[{"[", 
         RowBox[{"\"\<AtomData\>\"", ",", "All", ",", "\"\<Element\>\""}], 
         "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"X", "=", 
      RowBox[{"StringDelete", "[", 
       RowBox[{"X", ",", 
        RowBox[{"{", 
         RowBox[{"DigitCharacter", ",", "\"\<+\>\"", ",", "\"\<-\>\""}], 
         "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"$f0", "=", 
      RowBox[{"Import", "@", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", "\[IndentingNewLine]", "\t", 
         RowBox[{
         "$XrayPath", ",", "\"\<Core\>\"", ",", "\"\<Data\>\"", ",", 
          "\[IndentingNewLine]", "\t", "\"\<AtomicScatteringFactor\>\"", ",", 
          "\"\<WaasmaierKirfel.m\>\""}], "}"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", 
        RowBox[{"$f0", "/@", "X"}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"Values", "@", 
       RowBox[{"temp", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
           "\"\<a1\>\"", ",", "\"\<a2\>\"", ",", "\"\<a3\>\"", ",", 
            "\"\<a4\>\"", ",", "\"\<a5\>\"", ",", "\[IndentingNewLine]", 
            "\"\<b1\>\"", ",", "\"\<b2\>\"", ",", "\"\<b3\>\"", ",", 
            "\"\<b4\>\"", ",", "\"\<b5\>\"", ",", "\[IndentingNewLine]", 
            "\"\<c\>\""}], "}"}]}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"sccoeff", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Append", "[", 
         RowBox[{
          RowBox[{"Partition", "[", 
           RowBox[{"#", ",", "5"}], "]"}], ",", 
          RowBox[{"Last", "@", "#"}]}], "]"}], "&"}], "/@", "temp"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"PrependTo", "[", 
        RowBox[{
         RowBox[{"sccoeff", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ",", 
         RowBox[{"X", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "@", "X"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"sccoeff", "=", 
      RowBox[{"sccoeff", "/.", 
       RowBox[{"x_String", "\[RuleDelayed]", 
        RowBox[{"\"\<\\\"\>\"", "<>", "x", "<>", "\"\<\\\"\>\""}]}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Anomalous", " ", "corrections"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"asf", "=", "\[IndentingNewLine]", 
      RowBox[{"\[LeftAssociation]", 
       RowBox[{
        RowBox[{"\"\<H\>\"", "\[Rule]", "\"\<{0.,0.}\>\""}], ",", 
        RowBox[{"\"\<He\>\"", "\[Rule]", "\"\<{0.,0.}\>\""}], ",", 
        RowBox[{"\"\<Li\>\"", "\[Rule]", "\"\<{0.,0.}\>\""}], ",", 
        RowBox[{
        "\"\<Be\>\"", "\[Rule]", 
         "\"\<{fpBe[Global`lambda],fppBe[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<B\>\"", "\[Rule]", 
         "\"\<{fpB[Global`lambda],fppB[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<C\>\"", "\[Rule]", 
         "\"\<{fpC[Global`lambda],fppC[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<N\>\"", "\[Rule]", 
         "\"\<{fpN[Global`lambda],fppN[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<O\>\"", "\[Rule]", 
         "\"\<{fpO[Global`lambda],fppO[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<F\>\"", "\[Rule]", 
         "\"\<{fpF[Global`lambda],fppF[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<Ne\>\"", "\[Rule]", 
         "\"\<{fpNe[Global`lambda],fppNe[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<Na\>\"", "\[Rule]", 
         "\"\<{fpNa[Global`lambda],fppNa[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<Mg\>\"", "\[Rule]", 
         "\"\<{fpMg[Global`lambda],fppMg[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<Al\>\"", "\[Rule]", 
         "\"\<{fpAl[Global`lambda],fppAl[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<Si\>\"", "\[Rule]", 
         "\"\<{fpSi[Global`lambda],fppSi[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<P\>\"", "\[Rule]", 
         "\"\<{fpP[Global`lambda],fppP[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<S\>\"", "\[Rule]", 
         "\"\<{fpS[Global`lambda],fppS[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<Cl\>\"", "\[Rule]", 
         "\"\<{fpCl[Global`lambda],fppCl[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<Ar\>\"", "\[Rule]", 
         "\"\<{fpAr[Global`lambda],fppAr[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<K\>\"", "\[Rule]", 
         "\"\<{fpK[Global`lambda],fppK[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<Ca\>\"", "\[Rule]", 
         "\"\<{fpCa[Global`lambda],fppCa[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<Sc\>\"", "\[Rule]", 
         "\"\<{fpSc[Global`lambda],fppSc[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<Ti\>\"", "\[Rule]", 
         "\"\<{fpTi[Global`lambda],fppTi[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<V\>\"", "\[Rule]", 
         "\"\<{fpV[Global`lambda],fppV[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<Cr\>\"", "\[Rule]", 
         "\"\<{fpCr[Global`lambda],fppCr[Global`lambda]}\>\""}], ",", 
        RowBox[{
        "\"\<Mn\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=1.895,{fpMn1[Global`lambda],fppMn1[Global`\
lambda]},\\n                   \
{fpMn2[Global`lambda],fppMn2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Fe\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=1.743,{fpFe1[Global`lambda],fppFe1[Global`\
lambda]},\\n                   \
{fpFe2[Global`lambda],fppFe2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Co\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=1.608,{fpCo1[Global`lambda],fppCo1[Global`\
lambda]},\\n                   \
{fpCo2[Global`lambda],fppCo2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Ni\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=1.487,{fpNi1[Global`lambda],fppNi1[Global`\
lambda]},\\n                   \
{fpNi2[Global`lambda],fppNi2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Cu\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=1.380,{fpCu1[Global`lambda],fppCu1[Global`\
lambda]},\\n                   \
{fpCu2[Global`lambda],fppCu2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Zn\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=1.283,{fpZn1[Global`lambda],fppZn1[Global`\
lambda]},\\n                   \
{fpZn2[Global`lambda],fppZn2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Ga\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=1.195,{fpGa1[Global`lambda],fppGa1[Global`\
lambda]},\\n                   \
{fpGa2[Global`lambda],fppGa2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Ge\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=1.11659,{fpGe1[Global`lambda],fppGe1[\
Global`lambda]},\\n                          \
{fpGe2[Global`lambda],fppGe2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<As\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=1.044,{fpAs1[Global`lambda],fppAs1[Global`\
lambda]},\\n                   \
{fpAs2[Global`lambda],fppAs2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Se\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.979,{fpSe1[Global`lambda],fppSe1[Global`\
lambda]},\\n                   \
{fpSe2[Global`lambda],fppSe2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Br\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.920,{fpBr1[Global`lambda],fppBr1[Global`\
lambda]},\\n                   \
{fpBr2[Global`lambda],fppBr2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Kr\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.865,{fpKr1[Global`lambda],fppKr1[Global`\
lambda]},\\n                   \
{fpKr2[Global`lambda],fppKr2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Rb\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.815,{fpRb1[Global`lambda],fppRb1[Global`\
lambda]},\\n                   \
{fpRb2[Global`lambda],fppRb2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Sr\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.769,{fpSr1[Global`lambda],fppSr1[Global`\
lambda]},\\n                   \
{fpSr2[Global`lambda],fppSr2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Y\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.727,{fpY1[Global`lambda],fppY1[Global`\
lambda]},\\n                   \
{fpY2[Global`lambda],fppY2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Zr\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.688,{fpZr1[Global`lambda],fppZr1[Global`\
lambda]},\\n                   \
{fpZr2[Global`lambda],fppZr2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Nb\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.653,{fpNb1[Global`lambda],fppNb1[Global`\
lambda]},\\n                   \
{fpNb2[Global`lambda],fppNb2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Mo\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.619,{fpMo1[Global`lambda],fppMo1[Global`\
lambda]},\\n                   \
{fpMo2[Global`lambda],fppMo2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Tc\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.589,{fpTc1[Global`lambda],fppTc1[Global`\
lambda]},\\n                   \
{fpTc2[Global`lambda],fppTc2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Ru\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.560,{fpRu1[Global`lambda],fppRu1[Global`\
lambda]},\\n                   \
{fpRu2[Global`lambda],fppRu2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Rh\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.533,{fpRh1[Global`lambda],fppRh1[Global`\
lambda]},\\n                   \
{fpRh2[Global`lambda],fppRh2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Pd\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.509,{fpPd1[Global`lambda],fppPd1[Global`\
lambda]},\\n                   \
{fpPd2[Global`lambda],fppPd2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Ag\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.485,{fpAg1[Global`lambda],fppAg1[Global`\
lambda]},\\n                   \
{fpAg2[Global`lambda],fppAg2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Cd\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.464,{fpCd1[Global`lambda],fppCd1[Global`\
lambda]},\\n                   \
{fpCd2[Global`lambda],fppCd2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<In\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.443,{fpIn1[Global`lambda],fppIn1[Global`\
lambda]},\\n                   \
{fpIn2[Global`lambda],fppIn2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Sn\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.424,{fpSn1[Global`lambda],fppSn1[Global`\
lambda]},\\n                   \
{fpSn2[Global`lambda],fppSn2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Sb\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.406,{fpSb1[Global`lambda],fppSb1[Global`\
lambda]},\\n                   \
{fpSb2[Global`lambda],fppSb2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Te\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.389,{fpTe1[Global`lambda],fppTe1[Global`\
lambda]},\\n                   \
{fpTe2[Global`lambda],fppTe2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<I\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.373,{fpI1[Global`lambda],fppI1[Global`\
lambda]},\\n                   \
{fpI2[Global`lambda],fppI2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Xe\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.358,{fpXe1[Global`lambda],fppXe1[Global`\
lambda]},\\n                   \
{fpXe2[Global`lambda],fppXe2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Cs\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.344,{fpCs1[Global`lambda],fppCs1[Global`\
lambda]},\\n                   \
{fpCs2[Global`lambda],fppCs2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<Ba\>\"", "\[Rule]", 
         "\"\<\\nIf[Global`lambda<=0.331,{fpBa1[Global`lambda],fppBa1[Global`\
lambda]},\\n                   \
{fpBa2[Global`lambda],fppBa2[Global`lambda]}]\>\""}], ",", 
        RowBox[{
        "\"\<La\>\"", "\[Rule]", 
         "\"\<\\nLahich[Global`lambda<=0.318,{fpLa1[Global`lambda],fppLa1[\
Global`lambda]},\\n      \
0.319<=Global`lambda<=1.978,{fpLa2[Global`lambda],fppLa2[Global`lambda]},\\n  \
    Global`lambda>=1.979,{fpLa3[Global`lambda],fppLa3[Global`lambda]}]\>\""}],
         ",", 
        RowBox[{
        "\"\<Ce\>\"", "\[Rule]", 
         "\"\<\\nCehich[Global`lambda<=0.306,{fpCe1[Global`lambda],fppCe1[\
Global`lambda]},\\n      \
0.307<=Global`lambda<=1.893,{fpCe2[Global`lambda],fppCe2[Global`lambda]},\\n  \
    Global`lambda>=1.894,{fpCe3[Global`lambda],fppCe3[Global`lambda]}]\>\""}],
         ",", 
        RowBox[{
        "\"\<Pr\>\"", "\[Rule]", 
         "\"\<\\nPrhich[Global`lambda<=0.295,{fpPr1[Global`lambda],fppPr1[\
Global`lambda]},\\n      \
0.296<=Global`lambda<=1.813,{fpPr2[Global`lambda],fppPr2[Global`lambda]},\\n  \
    1.814<=Global`lambda<=1.924,{fpPr3[Global`lambda],fppPr3[Global`lambda]},\
\\n      Global`lambda>=1.925,{fpPr4[Global`lambda],fppPr4[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Nd\>\"", "\[Rule]", 
         "\"\<\\nNdhich[Global`lambda<=0.284,{fpNd1[Global`lambda],fppNd1[\
Global`lambda]},\\n      \
0.285<=Global`lambda<=1.739,{fpNd2[Global`lambda],fppNd2[Global`lambda]},\\n  \
    1.740<=Global`lambda<=1.844,{fpNd3[Global`lambda],fppNd3[Global`lambda]},\
\\n      1.845<=Global`lambda<=1.997,{fpNd4[Global`lambda],fppNd4[Global`\
lambda]},\\n      \
Global`lambda>=1.998,{fpNd5[Global`lambda],fppNd5[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<Sm\>\"", "\[Rule]", 
         "\"\<\\nSmhich[Global`lambda<=0.264,{fpSm1[Global`lambda],fppSm1[\
Global`lambda]},\\n      \
0.265<=Global`lambda<=1.602,{fpSm2[Global`lambda],fppSm2[Global`lambda]},\\n  \
    1.603<=Global`lambda<=1.695,{fpSm3[Global`lambda],fppSm3[Global`lambda]},\
\\n      1.696<=Global`lambda<=1.845,{fpSm4[Global`lambda],fppSm4[Global`\
lambda]},\\n      \
Global`lambda>=1.846,{fpSm5[Global`lambda],fppSm5[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<Eu\>\"", "\[Rule]", 
         "\"\<\\nEuhich[Global`lambda<=0.255,{fpEu1[Global`lambda],fppEu1[\
Global`lambda]},\\n      \
0.256<=Global`lambda<=1.539,{fpEu2[Global`lambda],fppEu2[Global`lambda]},\\n  \
    1.540<=Global`lambda<=1.627,{fpEu3[Global`lambda],fppEu3[Global`lambda]},\
\\n      1.628<=Global`lambda<=1.776,{fpEu4[Global`lambda],fppEu4[Global`\
lambda]},\\n      \
Global`lambda>=1.777,{fpEu5[Global`lambda],fppEu5[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<Gd\>\"", "\[Rule]", 
         "\"\<\\nGdhich[Global`lambda<=0.246,{fpGd1[Global`lambda],fppGd1[\
Global`lambda]},\\n      \
0.247<=Global`lambda<=1.480,{fpGd2[Global`lambda],fppGd2[Global`lambda]},\\n  \
    1.481<=Global`lambda<=1.563,{fpGd3[Global`lambda],fppGd3[Global`lambda]},\
\\n      1.564<=Global`lambda<=1.711,{fpGd4[Global`lambda],fppGd4[Global`\
lambda]},\\n      \
Global`lambda>=1.712,{fpGd5[Global`lambda],fppGd5[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<Tb\>\"", "\[Rule]", 
         "\"\<\\nTbhich[Global`lambda<=0.238,{fpTb1[Global`lambda],fppTb1[\
Global`lambda]},\\n      \
0.239<=Global`lambda<=1.423,{fpTb2[Global`lambda],fppTb2[Global`lambda]},\\n  \
    1.424<=Global`lambda<=1.502,{fpTb3[Global`lambda],fppTb3[Global`lambda]},\
\\n      1.503<=Global`lambda<=1.649,{fpTb4[Global`lambda],fppTb4[Global`\
lambda]},\\n      \
Global`lambda>=1.650,{fpTb5[Global`lambda],fppTb5[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<Yb\>\"", "\[Rule]", 
         "\"\<\\nYbhich[Global`lambda<=0.202,{fpYb1[Global`lambda],fppYb1[\
Global`lambda]},\\n      \
0.203<=Global`lambda<=1.182,{fpYb2[Global`lambda],fppYb2[Global`lambda]},\\n  \
    1.183<=Global`lambda<=1.242,{fpYb3[Global`lambda],fppYb3[Global`lambda]},\
\\n      1.243<=Global`lambda<=1.386,{fpYb4[Global`lambda],fppYb4[Global`\
lambda]},\\n      \
Global`lambda>=1.387,{fpYb5[Global`lambda],fppYb5[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<Lu\>\"", "\[Rule]", 
         "\"\<\\nLuhich[Global`lambda<=0.195,{fpLu1[Global`lambda],fppLu1[\
Global`lambda]},\\n      \
0.196<=Global`lambda<=1.140,{fpLu2[Global`lambda],fppLu2[Global`lambda]},\\n  \
    1.141<=Global`lambda<=1.198,{fpLu3[Global`lambda],fppLu3[Global`lambda]},\
\\n      1.199<=Global`lambda<=1.341,{fpLu4[Global`lambda],fppLu4[Global`\
lambda]},\\n      \
Global`lambda>=1.342,{fpLu5[Global`lambda],fppLu5[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<Hf\>\"", "\[Rule]", 
         "\"\<\\nHfhich[Global`lambda<=0.189,{fpHf1[Global`lambda],fppHf1[\
Global`lambda]},\\n      \
0.190<=Global`lambda<=1.099,{fpHf2[Global`lambda],fppHf2[Global`lambda]},\\n  \
    1.100<=Global`lambda<=1.154,{fpHf3[Global`lambda],fppHf3[Global`lambda]},\
\\n      1.155<=Global`lambda<=1.296,{fpHf4[Global`lambda],fppHf4[Global`\
lambda]},\\n      \
Global`lambda>=1.297,{fpHf5[Global`lambda],fppHf5[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<Ta\>\"", "\[Rule]", 
         "\"\<\\nTahich[Global`lambda<=0.183,{fpTa1[Global`lambda],fppTa1[\
Global`lambda]},\\n      \
0.184<=Global`lambda<=1.061,{fpTa2[Global`lambda],fppTa2[Global`lambda]},\\n  \
    1.062<=Global`lambda<=1.113,{fpTa3[Global`lambda],fppTa3[Global`lambda]},\
\\n      1.114<=Global`lambda<=1.254,{fpTa4[Global`lambda],fppTa4[Global`\
lambda]},\\n      \
Global`lambda>=1.255,{fpTa5[Global`lambda],fppTa5[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<W\>\"", "\[Rule]", 
         "\"\<\\nWhich[Global`lambda<=0.178,{fpW1[Global`lambda],fppW1[Global`\
lambda]},\\n      \
0.179<=Global`lambda<=1.024,{fpW2[Global`lambda],fppW2[Global`lambda]},\\n    \
  1.025<=Global`lambda<=1.073,{fpW3[Global`lambda],fppW3[Global`lambda]},\\n  \
    1.074<=Global`lambda<=1.214,{fpW4[Global`lambda],fppW4[Global`lambda]},\\\
n      Global`lambda>=1.215,{fpW5[Global`lambda],fppW5[Global`lambda]}]\>\""}]\
, ",", 
        RowBox[{
        "\"\<Re\>\"", "\[Rule]", 
         "\"\<\\nRehich[Global`lambda<=0.172,{fpRe1[Global`lambda],fppRe1[\
Global`lambda]},\\n      \
0.173<=Global`lambda<=0.989,{fpRe2[Global`lambda],fppRe2[Global`lambda]},\\n  \
    0.990<=Global`lambda<=1.036,{fpRe3[Global`lambda],fppRe3[Global`lambda]},\
\\n      1.037<=Global`lambda<=1.176,{fpRe4[Global`lambda],fppRe4[Global`\
lambda]},\\n      \
Global`lambda>=1.177,{fpRe5[Global`lambda],fppRe5[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<Os\>\"", "\[Rule]", 
         "\"\<\\nOshich[Global`lambda<=0.167,{fpOs1[Global`lambda],fppOs1[\
Global`lambda]},\\n      \
0.168<=Global`lambda<=0.956,{fpOs2[Global`lambda],fppOs2[Global`lambda]},\\n  \
    0.957<=Global`lambda<=1.001,{fpOs3[Global`lambda],fppOs3[Global`lambda]},\
\\n      1.002<=Global`lambda<=1.140,{fpOs4[Global`lambda],fppOs4[Global`\
lambda]},\\n      \
Global`lambda>=1.141,{fpOs5[Global`lambda],fppOs5[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<Ir\>\"", "\[Rule]", 
         "\"\<\\nIrhich[Global`lambda<=0.162,{fpIr1[Global`lambda],fppIr1[\
Global`lambda]},\\n      \
0.163<=Global`lambda<=0.923,{fpIr2[Global`lambda],fppIr2[Global`lambda]},\\n  \
    0.924<=Global`lambda<=0.966,{fpIr3[Global`lambda],fppIr3[Global`lambda]},\
\\n      0.967<=Global`lambda<=1.105,{fpIr4[Global`lambda],fppIr4[Global`\
lambda]},\\n      \
Global`lambda>=1.106,{fpIr5[Global`lambda],fppIr5[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<Pt\>\"", "\[Rule]", 
         "\"\<\\nPthich[Global`lambda<=0.158,{fpPt1[Global`lambda],fppPt1[\
Global`lambda]},\\n      \
0.159<=Global`lambda<=0.893,{fpPt2[Global`lambda],fppPt2[Global`lambda]},\\n  \
    0.894<=Global`lambda<=0.934,{fpPt3[Global`lambda],fppPt3[Global`lambda]},\
\\n      0.935<=Global`lambda<=1.072,{fpPt4[Global`lambda],fppPt4[Global`\
lambda]},\\n      \
Global`lambda>=1.073,{fpPt5[Global`lambda],fppPt5[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<Au\>\"", "\[Rule]", 
         "\"\<\\nAuhich[Global`lambda<=0.153,{-0.9007,fppAu1[Global`lambda]},\
\\n      0.154<=Global`lambda<=0.863,{fpAu2[Global`lambda],fppAu2[Global`\
lambda]},\\n      \
0.864<=Global`lambda<=0.902,{fpAu3[Global`lambda],fppAu3[Global`lambda]},\\n  \
    0.903<=Global`lambda<=1.040,{fpAu4[Global`lambda],fppAu4[Global`lambda]},\
\\n      Global`lambda>=1.041,{fpAu5[Global`lambda],fppAu5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Hg\>\"", "\[Rule]", 
         "\"\<\\nHghich[Global`lambda<=0.149,{-0.9287,fppHg1[Global`lambda]},\
\\n      0.150<=Global`lambda<=0.835,{fpHg2[Global`lambda],fppHg2[Global`\
lambda]},\\n      \
0.836<=Global`lambda<=0.872,{fpHg3[Global`lambda],fppHg3[Global`lambda]},\\n  \
    0.873<=Global`lambda<=1.009,{fpHg4[Global`lambda],fppHg4[Global`lambda]},\
\\n      Global`lambda>=1.010,{fpHg5[Global`lambda],fppHg5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Tl\>\"", "\[Rule]", 
         "\"\<\\nTlhich[Global`lambda<=0.144,{-0.9566,fppTl1[Global`lambda]},\
\\n      0.145<=Global`lambda<=0.807,{fpTl2[Global`lambda],fppTl2[Global`\
lambda]},\\n      \
0.808<=Global`lambda<=0.843,{fpTl3[Global`lambda],fppTl3[Global`lambda]},\\n  \
    0.844<=Global`lambda<=0.979,{fpTl4[Global`lambda],fppTl4[Global`lambda]},\
\\n      Global`lambda>=0.980,{fpTl5[Global`lambda],fppTl5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Pb\>\"", "\[Rule]", 
         "\"\<\\nPbhich[Global`lambda<=0.140,{-0.9856,fppPb1[Global`lambda]},\
\\n      0.141<=Global`lambda<=0.781,{fpPb2[Global`lambda],fppPb2[Global`\
lambda]},\\n      \
0.782<=Global`lambda<=0.815,{fpPb3[Global`lambda],fppPb3[Global`lambda]},\\n  \
    0.816<=Global`lambda<=0.951,{fpPb4[Global`lambda],fppPb4[Global`lambda]},\
\\n      Global`lambda>=0.952,{fpPb5[Global`lambda],fppPb5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Bi\>\"", "\[Rule]", 
         "\"\<\\nBihich[Global`lambda<=0.136,{-1.015,fppBi1[Global`lambda]},\\\
n      0.137<=Global`lambda<=0.756,{fpBi2[Global`lambda],fppBi2[Global`lambda]\
},\\n      \
0.757<=Global`lambda<=0.789,{fpBi3[Global`lambda],fppBi3[Global`lambda]},\\n  \
    0.790<=Global`lambda<=0.923,{fpBi4[Global`lambda],fppBi4[Global`lambda]},\
\\n      Global`lambda>=0.924,{fpBi5[Global`lambda],fppBi5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Po\>\"", "\[Rule]", 
         "\"\<\\nPohich[Global`lambda<=0.133,{-1.045,fppPo1[Global`lambda]},\\\
n      0.134<=Global`lambda<=0.731,{fpPo2[Global`lambda],fppPo2[Global`lambda]\
},\\n      \
0.732<=Global`lambda<=0.763,{fpPo3[Global`lambda],fppPo3[Global`lambda]},\\n  \
    0.764<=Global`lambda<=0.897,{fpPo4[Global`lambda],fppPo4[Global`lambda]},\
\\n      Global`lambda>=0.898,{fpPo5[Global`lambda],fppPo5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<At\>\"", "\[Rule]", 
         "\"\<\\nAthich[Global`lambda<=0.129,{-1.076,fppAt1[Global`lambda]},\\\
n      0.130<=Global`lambda<=0.708,{fpAt2[Global`lambda],fppAt2[Global`lambda]\
},\\n      \
0.709<=Global`lambda<=0.738,{fpAt3[Global`lambda],fppAt3[Global`lambda]},\\n  \
    0.739<=Global`lambda<=0.872,{fpAt4[Global`lambda],fppAt4[Global`lambda]},\
\\n      Global`lambda>=0.873,{fpAt5[Global`lambda],fppAt5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Rn\>\"", "\[Rule]", 
         "\"\<\\nRnhich[Global`lambda<=0.125,{-1.107,fppRn1[Global`lambda]},\\\
n      0.126<=Global`lambda<=0.686,{fpRn2[Global`lambda],fppRn2[Global`lambda]\
},\\n      \
0.687<=Global`lambda<=0.715,{fpRn3[Global`lambda],fppRn3[Global`lambda]},\\n  \
    0.716<=Global`lambda<=0.848,{fpRn4[Global`lambda],fppRn4[Global`lambda]},\
\\n      Global`lambda>=0.849,{fpRn5[Global`lambda],fppRn5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Fr\>\"", "\[Rule]", 
         "\"\<\\nFrhich[Global`lambda<=0.122,{-1.138,fppFr1[Global`lambda]},\\\
n      0.123<=Global`lambda<=0.665,{fpFr2[Global`lambda],fppFr2[Global`lambda]\
},\\n      \
0.666<=Global`lambda<=0.692,{fpFr3[Global`lambda],fppFr3[Global`lambda]},\\n  \
    0.693<=Global`lambda<=0.824,{fpFr4[Global`lambda],fppFr4[Global`lambda]},\
\\n      Global`lambda>=0.825,{fpFr5[Global`lambda],fppFr5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Ra\>\"", "\[Rule]", 
         "\"\<\\nRahich[Global`lambda<=0.119,{-1.170,fppRa1[Global`lambda]},\\\
n      0.120<=Global`lambda<=0.644,{fpRa2[Global`lambda],fppRa2[Global`lambda]\
},\\n      \
0.645<=Global`lambda<=0.670,{fpRa3[Global`lambda],fppRa3[Global`lambda]},\\n  \
    0.671<=Global`lambda<=0.802,{fpRa4[Global`lambda],fppRa4[Global`lambda]},\
\\n      Global`lambda>=0.803,{fpRa5[Global`lambda],fppRa5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Ac\>\"", "\[Rule]", 
         "\"\<\\nAchich[Global`lambda<=0.116,{-1.203,fppAc1[Global`lambda]},\\\
n      0.117<=Global`lambda<=0.624,{fpAc2[Global`lambda],fppAc2[Global`lambda]\
},\\n      \
0.625<=Global`lambda<=0.649,{fpAc3[Global`lambda],fppAc3[Global`lambda]},\\n  \
    0.650<=Global`lambda<=0.781,{fpAc4[Global`lambda],fppAc4[Global`lambda]},\
\\n      Global`lambda>=0.782,{fpAc5[Global`lambda],fppAc5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Th\>\"", "\[Rule]", 
         "\"\<\\nThhich[Global`lambda<=0.113,{-1.237,fppTh1[Global`lambda]},\\\
n      0.114<=Global`lambda<=0.605,{fpTh2[Global`lambda],fppTh2[Global`lambda]\
},\\n      \
0.606<=Global`lambda<=0.629,{fpTh3[Global`lambda],fppTh3[Global`lambda]},\\n  \
    0.630<=Global`lambda<=0.760,{fpTh4[Global`lambda],fppTh4[Global`lambda]},\
\\n      Global`lambda>=0.761,{fpTh5[Global`lambda],fppTh5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Pa\>\"", "\[Rule]", 
         "\"\<\\nPahich[Global`lambda<=0.110,{-1.271,fppPa1[Global`lambda]},\\\
n      0.111<=Global`lambda<=0.587,{fpPa2[Global`lambda],fppPa2[Global`lambda]\
},\\n      \
0.588<=Global`lambda<=0.610,{fpPa3[Global`lambda],fppPa3[Global`lambda]},\\n  \
    0.611<=Global`lambda<=0.740,{fpPa4[Global`lambda],fppPa4[Global`lambda]},\
\\n      Global`lambda>=0.741,{fpPa5[Global`lambda],fppPa5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<U\>\"", "\[Rule]", 
         "\"\<\\nUhich[Global`lambda<=0.107,{-1.305,fppU1[Global`lambda]},\\n \
     0.108<=Global`lambda<=0.569,{fpU2[Global`lambda],fppU2[Global`lambda]},\\\
n      0.570<=Global`lambda<=0.591,{fpU3[Global`lambda],fppU3[Global`lambda]},\
\\n      0.592<=Global`lambda<=0.722,{fpU4[Global`lambda],fppU4[Global`lambda]\
},\\n      Global`lambda>=0.723,{fpU5[Global`lambda],fppU5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Np\>\"", "\[Rule]", 
         "\"\<\\nNphich[Global`lambda<=0.104,{-1.341,fppNp1[Global`lambda]},\\\
n      0.105<=Global`lambda<=0.552,{fpNp2[Global`lambda],fppNp2[Global`lambda]\
},\\n      \
0.553<=Global`lambda<=0.573,{fpNp3[Global`lambda],fppNp3[Global`lambda]},\\n  \
    0.574<=Global`lambda<=0.704,{fpNp4[Global`lambda],fppNp4[Global`lambda]},\
\\n      Global`lambda>=0.705,{fpNp5[Global`lambda],fppNp5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Pu\>\"", "\[Rule]", 
         "\"\<\\nPuhich[Global`lambda<=0.101,{-1.377,fppPu1[Global`lambda]},\\\
n      0.102<=Global`lambda<=0.539,{fpPu2[Global`lambda],fppPu2[Global`lambda]\
},\\n      \
0.540<=Global`lambda<=0.559,{fpPu3[Global`lambda],fppPu3[Global`lambda]},\\n  \
    0.560<=Global`lambda<=0.692,{fpPu4[Global`lambda],fppPu4[Global`lambda]},\
\\n      Global`lambda>=0.693,{fpPu5[Global`lambda],fppPu5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Am\>\"", "\[Rule]", 
         "\"\<\\nAmhich[Global`lambda<=0.099,{-1.414,fppAm1[Global`lambda]},\\\
n      0.100<=Global`lambda<=0.521,{fpAm2[Global`lambda],fppAm2[Global`lambda]\
},\\n      \
0.522<=Global`lambda<=0.540,{fpAm3[Global`lambda],fppAm3[Global`lambda]},\\n  \
    0.541<=Global`lambda<=0.669,{fpAm4[Global`lambda],fppAm4[Global`lambda]},\
\\n      Global`lambda>=0.670,{fpAm5[Global`lambda],fppAm5[Global`lambda]}]\>\
\""}], ",", 
        RowBox[{
        "\"\<Cm\>\"", "\[Rule]", 
         "\"\<\\nCmhich[Global`lambda<=0.096,{-1.451,fppCm1[Global`lambda]},\\\
n      0.097<=Global`lambda<=0.506,{fpCm2[Global`lambda],fppCm2[Global`lambda]\
},\\n      \
0.507<=Global`lambda<=0.521,{fpCm3[Global`lambda],fppCm3[Global`lambda]},\\n  \
    0.522<=Global`lambda<=0.654,{fpCm4[Global`lambda],fppCm4[Global`lambda]},\
\\n      0.655<=Global`lambda<=1.971,{fpCm5[Global`lambda],fppCm5[Global`\
lambda]},      \\n      \
Global`lambda>=1.972,{fpCm6[Global`lambda],fppCm6[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<Bk\>\"", "\[Rule]", 
         "\"\<\\nBkhich[Global`lambda<=0.094,{-1.489,fppBk1[Global`lambda]},\\\
n      0.095<=Global`lambda<=0.490,{fpBk2[Global`lambda],fppBk2[Global`lambda]\
},\\n      \
0.491<=Global`lambda<=0.508,{fpBk3[Global`lambda],fppBk3[Global`lambda]},\\n  \
    0.509<=Global`lambda<=0.637,{fpBk4[Global`lambda],fppBk4[Global`lambda]},\
\\n      0.638<=Global`lambda<=1.891,{fpBk5[Global`lambda],fppBk5[Global`\
lambda]}      \\n      \
Global`lambda>=1.892,{fpBk6[Global`lambda],fppBk6[Global`lambda]}]\>\""}], 
        ",", 
        RowBox[{
        "\"\<Cf\>\"", "\[Rule]", 
         "\"\<\\nCfhich[Global`lambda<=0.091,{-1.528,fppCf1[Global`lambda]},\\\
n      0.092<=Global`lambda<=0.478,{fpCf2[Global`lambda],fppCf2[Global`lambda]\
},\\n      \
0.479<=Global`lambda<=0.495,{fpCf3[Global`lambda],fppCf3[Global`lambda]},\\n  \
    0.496<=Global`lambda<=0.627,{fpCf4[Global`lambda],fppCf4[Global`lambda]},\
\\n      0.628<=Global`lambda<=1.859,{fpCf5[Global`lambda],fppCf5[Global`\
lambda]},\\n      \
1.860<=Global`lambda<=1.978,{fpCf6[Global`lambda],fppCf6[Global`lambda]},     \
 \\n      \
Global`lambda>=1.979,{fpCf7[Global`lambda],fppCf7[Global`lambda]}]\>\""}]}], 
       "\[RightAssociation]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"fp", "=", 
      RowBox[{"StringTrim", "/@", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"\"\<\\\"\>\"", "<>", "#", "<>", "\"\<\\\"\>\""}], "&"}], 
           "/@", "X"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"asf", "[", "#", "]"}], "&"}], "/@", "X"}]}], "}"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"fp", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "2"}], "]"}], "]"}], "=", 
      RowBox[{"StringReplace", "[", 
       RowBox[{
        RowBox[{"fp", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "\[IndentingNewLine]",
         "\t", 
        RowBox[{
         RowBox[{"Shortest", "[", 
          RowBox[{
           RowBox[{"f", ":", 
            RowBox[{"(", 
             RowBox[{"\"\<f\>\"", "~~", "__"}], ")"}]}], "~~", "c_", "~~", 
           "\"\<[\>\""}], "]"}], "\[RuleDelayed]", "\[IndentingNewLine]", 
         "\t", 
         RowBox[{"f", "<>", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"NumericQ", "@", 
              RowBox[{"ToExpression", "@", "c"}]}]}], ",", 
            RowBox[{"c", "<>", "\"\<1\>\""}], ",", "c"}], "]"}], "<>", 
          "\"\<[\>\""}]}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"fp", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "2"}], "]"}], "]"}], "=", 
      RowBox[{"StringDelete", "[", 
       RowBox[{
        RowBox[{"fp", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "\"\<\\n\>\""}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"fpp", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
        "\"\<Get[\\\"inpol-\>\"", "<>", "#", "<>", "\[IndentingNewLine]", 
         "\"\<.dat\\\",Path->\\\"D:\\\\\\\\X-Ray-Diffraction\\\\\\\\Anomal\\\\\
\\\\Data\\\"];\>\""}], "&"}], "/@", "X"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Prepare", " ", "file"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"end", "[", "x_", "]"}], ":=", 
      RowBox[{
       RowBox[{"ToString", "[", 
        RowBox[{"x", ",", "InputForm"}], "]"}], "<>", "\"\<;\\n\>\""}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"endTab", "[", "x_", "]"}], ":=", 
      RowBox[{"\"\<{\>\"", "<>", 
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"Riffle", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ToString", "/@", 
           RowBox[{"Riffle", "[", 
            RowBox[{"x", ",", "\"\<\\n\\t\>\"", ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", 
               RowBox[{"-", "1"}], ",", "2"}], "}"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", "\"\<,\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", 
            RowBox[{"-", "3"}], ",", "3"}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ")"}], "<>", "\"\<};\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"write", "=", 
      RowBox[{"Flatten", "@", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
         "\"\<compound = \\\"\>\"", "<>", "crystal", "<>", 
          "\"\<\\\";\\n\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{
         "\"\<spacegroup = \\\"\>\"", "<>", "sg", "<>", "\"\<\\\";\\n\>\""}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"\"\<ltc=\>\"", "<>", 
          RowBox[{"end", "@", "ltc"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"\"\<csmatrix=\>\"", "<>", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "@", "csmatrix"}], "===", "1"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"end", "@", "csmatrix"}], ",", 
            RowBox[{"endTab", "@", "csmatrix"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"\"\<cell=\>\"", "<>", 
          RowBox[{"end", "@", "cell"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"\"\<atoms=\>\"", "<>", 
          RowBox[{"endTab", "@", "atoms"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"\"\<flag=\>\"", "<>", 
          RowBox[{"end", "@", "flag"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"\"\<sccoeff=\>\"", "<>", 
          RowBox[{"endTab", "@", "sccoeff"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"\"\<fp=\>\"", "<>", 
          RowBox[{"endTab", "[", 
           RowBox[{"DeleteDuplicates", "@", "fp"}], "]"}], "<>", 
          "\"\<\\n\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{"DeleteDuplicates", "@", "fpp"}]}], "\[IndentingNewLine]", 
        "}"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Write", " ", "file"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Export", "[", 
      RowBox[{"output", ",", "write", ",", "\"\<Text\>\""}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, 3.668106086235696*^9, {3.6681847250202436`*^9, 
   3.668184763578227*^9}, {3.668184859415769*^9, 3.6681848958952827`*^9}, {
   3.6681849656538982`*^9, 3.668184966557592*^9}, {3.668186746700986*^9, 
   3.668186748499941*^9}, {3.668186887833519*^9, 3.668186915465481*^9}, 
   3.668187179635866*^9, {3.6681873567029552`*^9, 3.668187367461336*^9}, {
   3.6681874297574987`*^9, 3.668187481442852*^9}, {3.6681875159231033`*^9, 
   3.66818751647386*^9}, {3.668187676247175*^9, 3.66818768715088*^9}, {
   3.668187807957081*^9, 3.668187810156796*^9}, 3.6681878677945766`*^9, {
   3.668192637722664*^9, 3.6681926384504833`*^9}, {3.668192682042522*^9, 
   3.668192705296905*^9}, {3.68166924518751*^9, 3.681669257401746*^9}, 
   3.681706490571958*^9, {3.681706560665007*^9, 3.681706560808091*^9}, {
   3.681706701190172*^9, 3.6817067089323483`*^9}, {3.681706888369705*^9, 
   3.68170694343121*^9}, {3.681707009919237*^9, 3.681707054877233*^9}, 
   3.681707094253208*^9, {3.681707298537107*^9, 3.681707301151917*^9}, {
   3.681710383837879*^9, 3.681710517243684*^9}, {3.681710549236743*^9, 
   3.681710591906762*^9}, 3.68171076139857*^9, 3.681710814623724*^9, {
   3.6817109067478313`*^9, 3.6817110010439167`*^9}, {3.681711080522023*^9, 
   3.6817111039844112`*^9}, 3.681711207870273*^9, {3.6817112607821617`*^9, 
   3.681711305188384*^9}, {3.681711445370324*^9, 3.681711513296112*^9}, {
   3.6817115774404993`*^9, 3.681711650636854*^9}, {3.68171500692944*^9, 
   3.681715026767819*^9}, {3.681715181501337*^9, 3.681715181739588*^9}, {
   3.681715678282447*^9, 3.6817156946895933`*^9}, {3.681715923758252*^9, 
   3.6817159597723722`*^9}, {3.68171782238949*^9, 3.681717946865253*^9}, {
   3.681718348825375*^9, 3.681718349067914*^9}, {3.681718672178816*^9, 
   3.68171869694698*^9}, {3.681718727898713*^9, 3.681718795793612*^9}, {
   3.681719297392269*^9, 3.681719364987854*^9}, {3.681719424875423*^9, 
   3.681719476273019*^9}, {3.681719564217062*^9, 3.6817195753909283`*^9}, {
   3.681719696949328*^9, 3.681719703508996*^9}, {3.681720146779862*^9, 
   3.681720188282736*^9}, {3.681720357048739*^9, 3.681720404007724*^9}, {
   3.681720538565111*^9, 3.68172054257139*^9}, {3.681720713993903*^9, 
   3.681720714144103*^9}, {3.6817209858918037`*^9, 3.681721182870202*^9}, {
   3.681721229493627*^9, 3.6817212759562902`*^9}, {3.681721318685071*^9, 
   3.681721337315277*^9}, {3.681721411035223*^9, 3.681721483737514*^9}, {
   3.6817215519766006`*^9, 3.6817216024457273`*^9}, {3.681721640646819*^9, 
   3.681721648839014*^9}, {3.681721731125741*^9, 3.681721732668375*^9}, {
   3.681721789833881*^9, 3.681721806418096*^9}, {3.6817219185830507`*^9, 
   3.6817219344066553`*^9}, {3.681722442266707*^9, 3.6817224444361963`*^9}, {
   3.6817227023431807`*^9, 3.681722723774548*^9}, {3.6817228369801702`*^9, 
   3.681722870587195*^9}, 3.6817229070837173`*^9, {3.681723229228771*^9, 
   3.681723316371806*^9}, 3.681723352394136*^9, {3.681723491110834*^9, 
   3.6817234976219*^9}, {3.681723533046878*^9, 3.681723549182931*^9}, {
   3.681723690723069*^9, 3.681723710538261*^9}, {3.681723746168332*^9, 
   3.681723764431592*^9}, {3.6817239634608393`*^9, 3.681724024526379*^9}, {
   3.681724085449534*^9, 3.6817242176903954`*^9}, {3.6817242696057167`*^9, 
   3.681724295774458*^9}, 3.681724327237109*^9, {3.681724474011566*^9, 
   3.681724476993256*^9}, 3.681724828780448*^9, {3.6818125091048193`*^9, 
   3.6818125114155693`*^9}, {3.6818368257106333`*^9, 3.68183686908536*^9}, {
   3.681836932372287*^9, 3.6818369624101877`*^9}, 3.681837110530672*^9, {
   3.681837208341257*^9, 3.681837224397664*^9}, {3.6818373595787363`*^9, 
   3.6818374537754908`*^9}, {3.681837562221323*^9, 3.6818375769428663`*^9}, {
   3.681910108411652*^9, 3.681910109523672*^9}, {3.681914019772044*^9, 
   3.6819140660350637`*^9}, {3.681914192192573*^9, 3.681914197016157*^9}, {
   3.6819143018703423`*^9, 3.6819143025663137`*^9}, {3.681915201163806*^9, 
   3.681915204987383*^9}, {3.681915310962316*^9, 3.681915331517808*^9}, {
   3.681915405175632*^9, 3.6819154062625723`*^9}, {3.681915499756755*^9, 
   3.681915499981236*^9}, {3.682073936912169*^9, 3.6820739483816547`*^9}, {
   3.6820743306881447`*^9, 3.682074335621664*^9}, {3.682074407370736*^9, 
   3.682074414704529*^9}, {3.6820745276580267`*^9, 3.6820745282934628`*^9}, {
   3.6820746925334578`*^9, 3.682074694860141*^9}, {3.682074732983082*^9, 
   3.682074765426908*^9}, {3.6820749940801067`*^9, 3.682075014622149*^9}, {
   3.682075051439227*^9, 3.6820750769809523`*^9}, {3.682080559474235*^9, 
   3.682080571064229*^9}, {3.682081192052569*^9, 3.682081198850922*^9}, {
   3.6820825372652617`*^9, 3.682082587828931*^9}, {3.682083882451795*^9, 
   3.682083906361766*^9}, {3.682084834510179*^9, 3.682084909148551*^9}, {
   3.682085355867062*^9, 3.6820853570730352`*^9}, {3.682085387352064*^9, 
   3.682085468590469*^9}, {3.6820954917674417`*^9, 3.682095491933237*^9}, {
   3.6820955359818773`*^9, 3.6820955368911743`*^9}, {3.6820955810166683`*^9, 
   3.682095702639804*^9}, {3.6820958051670427`*^9, 3.682095833859441*^9}, {
   3.6820959556190987`*^9, 3.682095960147934*^9}, {3.682096089911231*^9, 
   3.682096098702631*^9}, {3.6820961601906853`*^9, 3.682096164437451*^9}, {
   3.6820962600043573`*^9, 3.682096261183568*^9}, 3.6820964289853363`*^9, {
   3.682101172972685*^9, 3.682101186499799*^9}, {3.682102756494223*^9, 
   3.6821027720587893`*^9}, {3.682102815514278*^9, 3.682102843539885*^9}, {
   3.682102913889373*^9, 3.6821029181999683`*^9}, {3.682134119475279*^9, 
   3.68213414049387*^9}, {3.682134230034416*^9, 3.682134358353902*^9}, {
   3.682134389202623*^9, 3.682134415753475*^9}, {3.68213471223449*^9, 
   3.682134738680016*^9}, {3.682135167917287*^9, 3.6821351692739058`*^9}, {
   3.682138062911598*^9, 3.682138063720244*^9}, {3.6821381082904797`*^9, 
   3.682138208115355*^9}, {3.682138260558123*^9, 3.682138470630207*^9}, {
   3.682142430328573*^9, 3.682142561470036*^9}, {3.6821426027834806`*^9, 
   3.682142633588481*^9}, {3.682142673674217*^9, 3.682142683054764*^9}, {
   3.682142831982066*^9, 3.6821428879204903`*^9}, {3.6821443136719933`*^9, 
   3.682144398215694*^9}, {3.682144667707994*^9, 3.682144722485908*^9}, {
   3.682146073210956*^9, 3.68214608362833*^9}, {3.6821461172637672`*^9, 
   3.6821461630666447`*^9}, {3.6821463016789713`*^9, 3.682146327282445*^9}, {
   3.682151620835616*^9, 3.682151624741599*^9}, {3.682151684939176*^9, 
   3.6821516924478617`*^9}, {3.6821521411767*^9, 3.682152149634416*^9}, {
   3.682152264995434*^9, 3.682152328608294*^9}, {3.682152441457012*^9, 
   3.68215245878516*^9}, {3.682152762344564*^9, 3.682152791810916*^9}, {
   3.6821528601618853`*^9, 3.682152860391903*^9}, {3.6821529539507027`*^9, 
   3.682152984540741*^9}, {3.68215302321913*^9, 3.682153129482265*^9}, {
   3.682153280259882*^9, 3.682153321673149*^9}, {3.7178511036483183`*^9, 
   3.717851122327134*^9}, {3.717851189821681*^9, 3.717851193253324*^9}, {
   3.717916603383876*^9, 3.717916615900518*^9}, {3.71791678533737*^9, 
   3.717916822693717*^9}, {3.717916865814321*^9, 3.717916885343642*^9}, {
   3.717916986983926*^9, 3.7179169979292173`*^9}, {3.717917037830962*^9, 
   3.717917045659477*^9}, {3.7179170793062963`*^9, 3.717917109267124*^9}, {
   3.717917204811631*^9, 3.717917207139429*^9}, {3.717917254969499*^9, 
   3.7179173374214897`*^9}, {3.7179175864193707`*^9, 3.717917659226503*^9}, {
   3.717917850307029*^9, 3.717917873292598*^9}, {3.7179179215268784`*^9, 
   3.7179179586127367`*^9}, {3.717917989152759*^9, 3.717918193378786*^9}, {
   3.717918252260969*^9, 3.7179182894439898`*^9}, {3.7179183263544292`*^9, 
   3.717918373884111*^9}, {3.7179184443231*^9, 3.71791859116503*^9}, {
   3.71791863140095*^9, 3.717918661157935*^9}, {3.717918691759494*^9, 
   3.717918904234448*^9}, {3.71791893752807*^9, 3.717918958132572*^9}, {
   3.717919047866308*^9, 3.7179190794148827`*^9}, {3.717919125850175*^9, 
   3.717919126585883*^9}, {3.71791915693224*^9, 3.717919157047124*^9}, {
   3.717919315192214*^9, 3.7179194745363817`*^9}, {3.717919527579845*^9, 
   3.7179195993661537`*^9}, {3.717919702041493*^9, 3.7179198892134333`*^9}, {
   3.717919925010474*^9, 3.717919942575781*^9}, {3.7179208770459547`*^9, 
   3.717920877264462*^9}, {3.717920975077087*^9, 3.717921089727352*^9}, {
   3.717921281105476*^9, 3.717921283024523*^9}, {3.7179213442689238`*^9, 
   3.717921352072809*^9}, {3.717921402759777*^9, 3.7179214269416113`*^9}, 
   3.7179290589818077`*^9, 3.7179291196754827`*^9, {3.717932870553046*^9, 
   3.717932908637034*^9}, {3.717933068586175*^9, 3.717933074090494*^9}, {
   3.717934434205607*^9, 3.7179344354333572`*^9}, {3.7179346495613947`*^9, 
   3.717934741706024*^9}, {3.7179347968659983`*^9, 3.7179349004449472`*^9}, {
   3.717937216065546*^9, 3.717937235401092*^9}, {3.717937326455368*^9, 
   3.717937334638166*^9}, 3.7179373723916473`*^9, {3.71793747073635*^9, 
   3.7179374716832323`*^9}, 3.719062284377136*^9, {3.7192054216113234`*^9, 
   3.7192054240424347`*^9}, {3.719205581771082*^9, 3.719205619497569*^9}, {
   3.719205652787191*^9, 3.719205669461669*^9}, {3.71920595658852*^9, 
   3.719206051455226*^9}, {3.7192061068391457`*^9, 3.719206108509877*^9}, {
   3.719206507760811*^9, 3.719206511952664*^9}, {3.7192066150919456`*^9, 
   3.719206624644392*^9}, {3.719206654760507*^9, 3.71920665515414*^9}, {
   3.719206737370376*^9, 3.719206742894656*^9}, {3.719206818338148*^9, 
   3.7192068751165533`*^9}, {3.719206919296289*^9, 3.7192069197159157`*^9}, {
   3.719206969300866*^9, 3.7192069773219337`*^9}, {3.71920703171224*^9, 
   3.719207044057707*^9}, {3.7192071164759483`*^9, 3.7192071256838293`*^9}, {
   3.7192071653824263`*^9, 3.7192071968875*^9}, {3.719207269656448*^9, 
   3.719207282268661*^9}, {3.719207312610282*^9, 3.719207459803895*^9}, {
   3.719207523660273*^9, 3.719207655407179*^9}, {3.719207687340831*^9, 
   3.719207929747686*^9}, {3.719207976375491*^9, 3.719207980620072*^9}, {
   3.71920802928226*^9, 3.719208062291397*^9}, {3.719208703456603*^9, 
   3.719208707744376*^9}, {3.719208809157524*^9, 3.7192088395220337`*^9}, {
   3.719208903683654*^9, 3.719208907235894*^9}, {3.7192091032061567`*^9, 
   3.719209148266526*^9}, {3.719209266954831*^9, 3.719209269814912*^9}, {
   3.7192093001737547`*^9, 3.719209348673376*^9}, {3.719209382179757*^9, 
   3.719209402604899*^9}, {3.7192094632378483`*^9, 3.719209547642548*^9}, {
   3.71920958107302*^9, 3.719209596166226*^9}, {3.719209663481758*^9, 
   3.719209696225484*^9}, {3.719209728301947*^9, 3.719209744245853*^9}, {
   3.719209786896216*^9, 3.719209898539953*^9}, {3.7192099448038588`*^9, 
   3.7192099474504337`*^9}, {3.719210028290267*^9, 3.719210054427005*^9}, {
   3.719210085840733*^9, 3.71921008729804*^9}, {3.719210145915444*^9, 
   3.719210196276587*^9}, {3.7192103986362257`*^9, 3.71921041896262*^9}, 
   3.719210925778717*^9, {3.719211586851451*^9, 3.719211590668058*^9}, 
   3.71921168111728*^9, {3.7192117624557543`*^9, 3.719211772466675*^9}, {
   3.719211952313706*^9, 3.719211979406364*^9}, {3.719212017030777*^9, 
   3.7192120794281263`*^9}, {3.719212127835136*^9, 3.719212179558937*^9}, {
   3.719212256971817*^9, 3.719212262909226*^9}, {3.7196860964591827`*^9, 
   3.7196860973077917`*^9}, {3.7196861829094067`*^9, 
   3.7196862166208687`*^9}, {3.719686333122931*^9, 3.7196863438428373`*^9}, {
   3.719686549364262*^9, 3.71968656060751*^9}, {3.719686702771332*^9, 
   3.719686744724094*^9}, {3.719812480214345*^9, 3.719812487210722*^9}, {
   3.7220630514752903`*^9, 3.722063051548852*^9}, {3.7268346752955427`*^9, 
   3.726834778252481*^9}, {3.726834822906386*^9, 3.726834842427602*^9}, {
   3.726834981665464*^9, 3.726834989809967*^9}, {3.7268355943625307`*^9, 
   3.726835625193077*^9}, 3.726835691512577*^9, {3.726835913472745*^9, 
   3.726835925871607*^9}, {3.726836338134117*^9, 3.726836402572958*^9}, {
   3.7268365508242826`*^9, 3.726836705125986*^9}, {3.726836790194151*^9, 
   3.726836844419907*^9}, {3.7268369029042187`*^9, 3.7268369417014627`*^9}, {
   3.726841173881588*^9, 3.726841182893406*^9}, {3.72684142097085*^9, 
   3.72684142129825*^9}, {3.726843653636404*^9, 3.7268436552265673`*^9}, {
   3.726843771872473*^9, 3.726843774760372*^9}, 3.7276767840329514`*^9},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"a2845ce7-71e0-4d6a-a6dc-87d3577e009d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"8c5c0c83-bc7b-4dfc-ab79-86a1bcf78685"]
}, Closed]],

Cell[CellGroupData[{

Cell["ExportReflectionFile", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, {3.667900125753806*^9, 3.667900130001958*^9}, 
   3.668105575055373*^9, {3.681669216072617*^9, 3.6816692308311157`*^9}, {
   3.682134073518475*^9, 3.682134077310957*^9}, {3.6821351637913322`*^9, 
   3.682135164412662*^9}, {3.682138013029172*^9, 
   3.682138014016361*^9}},ExpressionUUID->"0c51ab41-fc34-4902-a0de-\
0408fceda32b"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"8108a53c-dfdc-4d3a-89a7-8c21a781684e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ExportReflectionFile", "::", "dir"}], "=", 
   "\"\<Invalid directory.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExportReflectionFile", "::", "format"}], "=", 
   "\"\<Invalid format of the reflection data.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExportReflectionFile", "::", "hkl"}], "=", 
   "\"\<Output must end with \!\(\*StyleBox[\".\", \
\"Program\"]\)\!\(\*StyleBox[\"hkl\", \"Program\"]\).\>\""}], ";"}]}], "Input",\

 InitializationCell->True,
 CellChangeTimes->{
  3.667811591227736*^9, 3.66810571214802*^9, {3.6681867516522207`*^9, 
   3.668186778354513*^9}, {3.6681868394172163`*^9, 3.6681868614325943`*^9}, {
   3.668187374101748*^9, 3.6681874104278383`*^9}, {3.668187695125526*^9, 
   3.668187730468417*^9}, {3.668188056044814*^9, 3.668188056876872*^9}, {
   3.6681926250344687`*^9, 3.668192625250432*^9}, 3.68166923708845*^9, {
   3.6817064191712627`*^9, 3.68170642414537*^9}, {3.6817239114596*^9, 
   3.681723955601696*^9}, {3.681724223652172*^9, 3.681724224172266*^9}, {
   3.6818128705108147`*^9, 3.681812886108671*^9}, {3.681819874858591*^9, 
   3.681819895264824*^9}, {3.681835709479094*^9, 3.681835743293057*^9}, {
   3.682100938006762*^9, 3.682100938717538*^9}, 3.682134103684627*^9, {
   3.682142891293942*^9, 3.6821428951259127`*^9}, {3.682144298513987*^9, 
   3.682144308993547*^9}, {3.682144403478119*^9, 3.682144406579885*^9}, {
   3.682144581637662*^9, 3.6821446292028418`*^9}, {3.6821529895283422`*^9, 
   3.68215300977632*^9}},ExpressionUUID->"1bc27315-87d8-4633-a3b6-\
3c18a1916dce"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"312c650b-6095-4009-969c-f4a73e2c6005"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ExportReflectionFile", "[", 
   RowBox[{"output_String", ",", "hkl_List"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "dir", ",", "list", ",", "spacing", ",", "input", ",", "temp1", ",", 
      "temp2", ",", "temp3", ",", "temp4"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Checking", " ", "input"}], " ", "*)"}], "\[IndentingNewLine]", 
    "\t", 
    RowBox[{
     RowBox[{"dir", "=", 
      RowBox[{"DirectoryName", "@", "output"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"dir", "\[Equal]", "\"\<\>\""}], "||", 
        RowBox[{"dir", "\[Equal]", "\"\</\>\""}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"ExportReflectionFile", "::", "dir"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"DirectoryQ", "@", "dir"}]}], ",", "\[IndentingNewLine]", 
       "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"ExportReflectionFile", "::", "dir"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{
         RowBox[{"StringTake", "[", 
          RowBox[{"output", ",", 
           RowBox[{"-", "3"}]}], "]"}], "\[Equal]", "\"\<hkl\>\""}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"ExportReflectionFile", "::", "hkl"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"!", 
         RowBox[{
          RowBox[{"Depth", "@", "hkl"}], "\[Equal]", "3"}]}], 
        "\[IndentingNewLine]", "\t", "&&", 
        RowBox[{"!", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"5", ",", "6"}], "}"}], ",", 
           RowBox[{"Length", "@", 
            RowBox[{"RandomChoice", "@", "hkl"}]}]}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"ExportReflectionFile", "::", "format"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Handling", " ", "the", " ", "format", " ", "of", " ", "each", " ", 
       "reflection"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"list", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"spacing", "=", 
      RowBox[{"{", 
       RowBox[{"4", ",", "4", ",", "4", ",", "8", ",", "8", ",", "4"}], 
       "}"}]}], ";", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", 
         RowBox[{"First", "@", "hkl"}]}], "\[Equal]", "5"}], ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"spacing", "=", 
        RowBox[{"spacing", "[", 
         RowBox[{"[", 
          RowBox[{";;", "5"}], "]"}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Adjusting", " ", "spacing", " ", "for", " ", "each", " ", "line"}], 
      " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"input", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"ToString", ",", "hkl", ",", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"temp1", "=", 
         RowBox[{"input", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
        
        RowBox[{"temp2", "=", 
         RowBox[{"spacing", "-", 
          RowBox[{"StringLength", "/@", "temp1"}]}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"temp3", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"StringJoin", "@", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{"\"\< \>\"", ",", "#"}], "]"}]}], "&"}], "/@", 
          "temp2"}]}], ";", "\[IndentingNewLine]", "\t", 
        RowBox[{"temp4", "=", 
         RowBox[{"StringJoin", "@", 
          RowBox[{"Riffle", "[", 
           RowBox[{"temp3", ",", "temp1"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"list", ",", "temp4"}], "]"}]}], ",", "\[IndentingNewLine]", 
       "\t\t", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "@", "input"}]}], "}"}]}], "\[IndentingNewLine]", 
      "\t", "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"Export", "[", 
      RowBox[{"output", ",", "list", ",", "\"\<Table\>\""}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, 3.668106086235696*^9, {3.6681847250202436`*^9, 
   3.668184763578227*^9}, {3.668184859415769*^9, 3.6681848958952827`*^9}, {
   3.6681849656538982`*^9, 3.668184966557592*^9}, {3.668186746700986*^9, 
   3.668186748499941*^9}, {3.668186887833519*^9, 3.668186915465481*^9}, 
   3.668187179635866*^9, {3.6681873567029552`*^9, 3.668187367461336*^9}, {
   3.6681874297574987`*^9, 3.668187481442852*^9}, {3.6681875159231033`*^9, 
   3.66818751647386*^9}, {3.668187676247175*^9, 3.66818768715088*^9}, {
   3.668187807957081*^9, 3.668187810156796*^9}, 3.6681878677945766`*^9, {
   3.668192637722664*^9, 3.6681926384504833`*^9}, {3.668192682042522*^9, 
   3.668192705296905*^9}, {3.68166924518751*^9, 3.681669257401746*^9}, 
   3.681706490571958*^9, {3.681706560665007*^9, 3.681706560808091*^9}, {
   3.681706701190172*^9, 3.6817067089323483`*^9}, {3.681706888369705*^9, 
   3.68170694343121*^9}, {3.681707009919237*^9, 3.681707054877233*^9}, 
   3.681707094253208*^9, {3.681707298537107*^9, 3.681707301151917*^9}, {
   3.681710383837879*^9, 3.681710517243684*^9}, {3.681710549236743*^9, 
   3.681710591906762*^9}, 3.68171076139857*^9, 3.681710814623724*^9, {
   3.6817109067478313`*^9, 3.6817110010439167`*^9}, {3.681711080522023*^9, 
   3.6817111039844112`*^9}, 3.681711207870273*^9, {3.6817112607821617`*^9, 
   3.681711305188384*^9}, {3.681711445370324*^9, 3.681711513296112*^9}, {
   3.6817115774404993`*^9, 3.681711650636854*^9}, {3.68171500692944*^9, 
   3.681715026767819*^9}, {3.681715181501337*^9, 3.681715181739588*^9}, {
   3.681715678282447*^9, 3.6817156946895933`*^9}, {3.681715923758252*^9, 
   3.6817159597723722`*^9}, {3.68171782238949*^9, 3.681717946865253*^9}, {
   3.681718348825375*^9, 3.681718349067914*^9}, {3.681718672178816*^9, 
   3.68171869694698*^9}, {3.681718727898713*^9, 3.681718795793612*^9}, {
   3.681719297392269*^9, 3.681719364987854*^9}, {3.681719424875423*^9, 
   3.681719476273019*^9}, {3.681719564217062*^9, 3.6817195753909283`*^9}, {
   3.681719696949328*^9, 3.681719703508996*^9}, {3.681720146779862*^9, 
   3.681720188282736*^9}, {3.681720357048739*^9, 3.681720404007724*^9}, {
   3.681720538565111*^9, 3.68172054257139*^9}, {3.681720713993903*^9, 
   3.681720714144103*^9}, {3.6817209858918037`*^9, 3.681721182870202*^9}, {
   3.681721229493627*^9, 3.6817212759562902`*^9}, {3.681721318685071*^9, 
   3.681721337315277*^9}, {3.681721411035223*^9, 3.681721483737514*^9}, {
   3.6817215519766006`*^9, 3.6817216024457273`*^9}, {3.681721640646819*^9, 
   3.681721648839014*^9}, {3.681721731125741*^9, 3.681721732668375*^9}, {
   3.681721789833881*^9, 3.681721806418096*^9}, {3.6817219185830507`*^9, 
   3.6817219344066553`*^9}, {3.681722442266707*^9, 3.6817224444361963`*^9}, {
   3.6817227023431807`*^9, 3.681722723774548*^9}, {3.6817228369801702`*^9, 
   3.681722870587195*^9}, 3.6817229070837173`*^9, {3.681723229228771*^9, 
   3.681723316371806*^9}, 3.681723352394136*^9, {3.681723491110834*^9, 
   3.6817234976219*^9}, {3.681723533046878*^9, 3.681723549182931*^9}, {
   3.681723690723069*^9, 3.681723710538261*^9}, {3.681723746168332*^9, 
   3.681723764431592*^9}, {3.6817239634608393`*^9, 3.681724024526379*^9}, {
   3.681724085449534*^9, 3.6817242176903954`*^9}, {3.6817242696057167`*^9, 
   3.681724295774458*^9}, 3.681724327237109*^9, {3.681724474011566*^9, 
   3.681724476993256*^9}, 3.681724828780448*^9, {3.6818125091048193`*^9, 
   3.6818125114155693`*^9}, {3.6818368257106333`*^9, 3.68183686908536*^9}, {
   3.681836932372287*^9, 3.6818369624101877`*^9}, 3.681837110530672*^9, {
   3.681837208341257*^9, 3.681837224397664*^9}, {3.6818373595787363`*^9, 
   3.6818374537754908`*^9}, {3.681837562221323*^9, 3.6818375769428663`*^9}, {
   3.681910108411652*^9, 3.681910109523672*^9}, {3.681914019772044*^9, 
   3.6819140660350637`*^9}, {3.681914192192573*^9, 3.681914197016157*^9}, {
   3.6819143018703423`*^9, 3.6819143025663137`*^9}, {3.681915201163806*^9, 
   3.681915204987383*^9}, {3.681915310962316*^9, 3.681915331517808*^9}, {
   3.681915405175632*^9, 3.6819154062625723`*^9}, {3.681915499756755*^9, 
   3.681915499981236*^9}, {3.682073936912169*^9, 3.6820739483816547`*^9}, {
   3.6820743306881447`*^9, 3.682074335621664*^9}, {3.682074407370736*^9, 
   3.682074414704529*^9}, {3.6820745276580267`*^9, 3.6820745282934628`*^9}, {
   3.6820746925334578`*^9, 3.682074694860141*^9}, {3.682074732983082*^9, 
   3.682074765426908*^9}, {3.6820749940801067`*^9, 3.682075014622149*^9}, {
   3.682075051439227*^9, 3.6820750769809523`*^9}, {3.682080559474235*^9, 
   3.682080571064229*^9}, {3.682081192052569*^9, 3.682081198850922*^9}, {
   3.6820825372652617`*^9, 3.682082587828931*^9}, {3.682083882451795*^9, 
   3.682083906361766*^9}, {3.682084834510179*^9, 3.682084909148551*^9}, {
   3.682085355867062*^9, 3.6820853570730352`*^9}, {3.682085387352064*^9, 
   3.682085468590469*^9}, {3.6820954917674417`*^9, 3.682095491933237*^9}, {
   3.6820955359818773`*^9, 3.6820955368911743`*^9}, {3.6820955810166683`*^9, 
   3.682095702639804*^9}, {3.6820958051670427`*^9, 3.682095833859441*^9}, {
   3.6820959556190987`*^9, 3.682095960147934*^9}, {3.682096089911231*^9, 
   3.682096098702631*^9}, {3.6820961601906853`*^9, 3.682096164437451*^9}, {
   3.6820962600043573`*^9, 3.682096261183568*^9}, 3.6820964289853363`*^9, {
   3.682101172972685*^9, 3.682101186499799*^9}, {3.682102756494223*^9, 
   3.6821027720587893`*^9}, {3.682102815514278*^9, 3.682102843539885*^9}, {
   3.682102913889373*^9, 3.6821029181999683`*^9}, {3.682134119475279*^9, 
   3.68213414049387*^9}, {3.682134230034416*^9, 3.682134358353902*^9}, {
   3.682134389202623*^9, 3.682134415753475*^9}, {3.68213471223449*^9, 
   3.682134738680016*^9}, {3.682135167917287*^9, 3.6821351692739058`*^9}, {
   3.682138062911598*^9, 3.682138063720244*^9}, {3.6821381082904797`*^9, 
   3.682138208115355*^9}, {3.682138260558123*^9, 3.682138470630207*^9}, {
   3.682142430328573*^9, 3.682142561470036*^9}, {3.6821426027834806`*^9, 
   3.682142633588481*^9}, {3.682142673674217*^9, 3.682142683054764*^9}, {
   3.682142831982066*^9, 3.6821428879204903`*^9}, {3.6821443136719933`*^9, 
   3.682144398215694*^9}, {3.682144667707994*^9, 3.682144722485908*^9}, {
   3.682146073210956*^9, 3.68214608362833*^9}, {3.6821461172637672`*^9, 
   3.6821461630666447`*^9}, {3.6821463016789713`*^9, 3.682146327282445*^9}, {
   3.682151620835616*^9, 3.682151624741599*^9}, {3.682151684939176*^9, 
   3.6821516924478617`*^9}, {3.6821521411767*^9, 3.682152149634416*^9}, {
   3.682152264995434*^9, 3.682152328608294*^9}, {3.682152441457012*^9, 
   3.68215245878516*^9}, {3.682152762344564*^9, 3.682152791810916*^9}, {
   3.6821528601618853`*^9, 3.682152860391903*^9}, {3.6821529539507027`*^9, 
   3.682152984540741*^9}, {3.68215302321913*^9, 3.682153129482265*^9}, {
   3.682153280259882*^9, 3.682153321673149*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"48fe546b-6ac5-45ff-8ad0-dac7d2155695"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"34740895-68e3-4d82-b51a-f67934b58b39"]
}, Closed]],

Cell[CellGroupData[{

Cell["FindPixelClusters", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, {3.6678188399987793`*^9, 3.667818878319042*^9}, 
   3.667973368548716*^9},ExpressionUUID->"14bf3578-8d9c-4cb7-b4c3-\
cebe0abb7317"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"701f1b16-4878-4a62-af13-9c2b7e66fa44"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FindPixelClusters", "::", "method"}], "=", 
   "\"\<The method \[LeftGuillemet]`1`\[RightGuillemet] was not recognised.\>\
\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindPixelClusters", "::", "pixels"}], "=", 
   "\"\<Pixels in the binarised image: `1`.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindPixelClusters", "::", "files"}], "=", 
   "\"\<All images must be file paths.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FindPixelClusters", "::", "dir"}], "=", 
    "\"\<Invalid directory.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "@", "FindPixelClusters"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Method", "\[Rule]", "\"\<Auto\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<ReturnBinaryImage\>\"", "\[Rule]", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<ClusterRange\>\"", "\[Rule]", "3"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<ClearStatus\>\"", "\[Rule]", "False"}]}], "}"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.667811591227736*^9, {3.667926883433126*^9, 3.667926892913142*^9}, {
   3.6679303915678787`*^9, 3.667930397064508*^9}, {3.667930504515873*^9, 
   3.6679305119877663`*^9}, {3.667930552979792*^9, 3.6679305587145452`*^9}, {
   3.6679305964269743`*^9, 3.667930598585484*^9}, {3.66793271531362*^9, 
   3.667932721040504*^9}, {3.667972261358046*^9, 3.6679722648457327`*^9}, {
   3.6679723098927813`*^9, 3.667972310700526*^9}, {3.667973385739415*^9, 
   3.667973388827128*^9}, {3.667977543043991*^9, 3.667977558082513*^9}, {
   3.667995016616452*^9, 3.667995022446369*^9}, {3.6679950722772903`*^9, 
   3.6679950740452623`*^9}, {3.6679957762713337`*^9, 3.667995776453274*^9}, {
   3.667996475790578*^9, 3.6679964973333187`*^9}, {3.668230520096628*^9, 
   3.668230520296247*^9}, {3.668231248823513*^9, 3.668231266470131*^9}, {
   3.668231934350088*^9, 3.6682319425497923`*^9}, {3.6682320393165903`*^9, 
   3.668232046291453*^9}, {3.668232248143578*^9, 3.668232275009239*^9}, {
   3.6682338783511744`*^9, 3.668233902814499*^9}, {3.6682341617838697`*^9, 
   3.66823416263997*^9}, 3.668234334356662*^9, {3.668234369772044*^9, 
   3.6682343712508717`*^9}, {3.668234441121419*^9, 3.668234442249284*^9}, {
   3.668234474145546*^9, 3.668234476228924*^9}, {3.668234888878497*^9, 
   3.668234889678135*^9}, {3.668234943421139*^9, 3.6682349550848227`*^9}, {
   3.6682352736460247`*^9, 3.66823528523668*^9}, {3.668235379331465*^9, 
   3.668235382934746*^9}, {3.6682354313782387`*^9, 3.6682354331850758`*^9}, {
   3.68751217918044*^9, 3.687512181304822*^9}, 3.7138583598504868`*^9, {
   3.714207623856532*^9, 3.7142076294786367`*^9}, {3.7142085710706787`*^9, 
   3.7142085726870623`*^9}},ExpressionUUID->"ca60526b-6186-4e3c-aeb5-\
3bdef76773b7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"0b6ccb59-b1ec-4444-96c8-1b1f9ddff73c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FindPixelClusters", "[", 
   RowBox[{"image_Image", ",", 
    RowBox[{"OptionsPattern", "@", "FindPixelClusters"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "bin", ",", "data", ",", "L", ",", "method", ",", "fraction", ",", 
      "check", ",", "\[IndentingNewLine]", "P", ",", "update", ",", "start", 
      ",", "near", ",", "r", ",", "progress", ",", "status", ",", "total", 
      ",", "p", ",", "i", ",", "j", ",", "neighbours", ",", "new", ",", "n", 
      ",", "new2", ",", "\[IndentingNewLine]", "clusters", ",", "k"}], "}"}], 
    ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"--", "-"}], "*", " ", "Preparing", " ", "image", " ", "*", 
      RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"Otsu", "'"}], "s", " ", "cluster", " ", "variance", " ", 
      "maximization", " ", "method"}], " ", "*)"}], "\[IndentingNewLine]", 
    "\t", 
    RowBox[{
     RowBox[{"bin", "=", 
      RowBox[{"Binarize", "@", "image"}]}], ";", "\[IndentingNewLine]", "\t", 
     
     RowBox[{"data", "=", 
      RowBox[{"PixelValuePositions", "[", 
       RowBox[{"bin", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"L", "=", 
      RowBox[{"Length", "@", "data"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Option", ":", " ", 
       RowBox[{"Choose", " ", "method"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"method", "=", 
      RowBox[{"OptionValue", "[", "Method", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"method", "\[Equal]", "\"\<Auto\>\""}], ",", 
       RowBox[{"method", "=", "\"\<Median\>\""}], ",", "\[IndentingNewLine]", 
       "\t", 
       RowBox[{"method", "\[Equal]", "\"\<Median\>\""}], ",", 
       RowBox[{"L", "=", "50000"}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"method", "\[Equal]", "\"\<Mean\>\""}], ",", 
       RowBox[{"L", "=", "50000"}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"method", "\[Equal]", "\"\<Cluster\>\""}], ",", 
       RowBox[{"L", "=", "50000"}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"method", "\[Equal]", "\"\<HighestFraction\>\""}], ",", 
       RowBox[{"L", "=", "50001"}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"method", "\[Equal]", "\"\<BinariseOnly\>\""}], ",", 
       RowBox[{"Goto", "[", "\"\<BinarisationDone\>\"", "]"}], ",", 
       "\[IndentingNewLine]", "\t", "True", ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"FindPixelClusters", "::", "method"}], ",", "method"}], 
         "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Check", " ", "if", " ", "further", " ", "refinement", " ", "is", " ", 
       "necessary"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"L", "\[LessEqual]", "20000"}], ",", "Null", ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"L", "\[LessEqual]", "50000"}], ",", 
       RowBox[{"bin", "=", 
        RowBox[{"DeleteSmallComponents", "[", 
         RowBox[{"bin", ",", 
          RowBox[{"Method", "\[Rule]", "method"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\t", "True", ",", "\[IndentingNewLine]", "\t", 
       
       RowBox[{"(*", " ", 
        RowBox[{
        "Special", " ", "procedure", " ", "for", " ", "very", " ", "noisy", 
         " ", "images"}], " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"fraction", "=", "1.00"}], ";", "\[IndentingNewLine]", "\t\t", 
        RowBox[{"check", "=", "True"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"While", "[", 
         RowBox[{"check", ",", "\[IndentingNewLine]", "\t\t", 
          RowBox[{
           RowBox[{"fraction", "=", 
            RowBox[{"fraction", "-", "0.005"}]}], ";", "\[IndentingNewLine]", 
           "\t\t", 
           RowBox[{"bin", "=", 
            RowBox[{"Binarize", "[", 
             RowBox[{"image", ",", 
              RowBox[{"Method", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<BlackFraction\>\"", ",", " ", "fraction"}], 
                "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"check", "=", 
            RowBox[{
             RowBox[{"PixelValuePositions", "[", 
              RowBox[{"bin", ",", "1"}], "]"}], "\[Equal]", 
             RowBox[{"{", "}"}]}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"bin", "=", 
         RowBox[{"DeleteSmallComponents", "[", 
          RowBox[{"bin", ",", 
           RowBox[{"Method", "\[Rule]", "\"\<Mean\>\""}]}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "\t", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"data", "=", 
      RowBox[{"PixelValuePositions", "[", 
       RowBox[{"bin", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Option", ":", " ", 
       RowBox[{
       "Return", " ", "binary", " ", "image", " ", "and", " ", "data", " ", 
        "length", " ", "for", " ", "inspection"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"Label", "[", "\"\<BinarisationDone\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<ReturnBinaryImage\>\"", "]"}], ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"FindPixelClusters", "::", "pixels"}], ",", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{"ToString", "@", 
           RowBox[{"NumberForm", "[", 
            RowBox[{
             RowBox[{"Length", "@", "data"}], ",", 
             RowBox[{"DigitBlock", "\[Rule]", "3"}]}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"Return", "@", "bin"}]}]}], "]"}], ";", "\[IndentingNewLine]",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Cluster", " ", "determination", " ", 
       "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"List", " ", "of", " ", "all", " ", "pixels"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"P", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"update", "=", 
      RowBox[{"N", "@", "data"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"start", "=", 
      RowBox[{"First", "@", "update"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"r", "=", 
      RowBox[{"N", "@", 
       RowBox[{"OptionValue", "[", "\"\<ClusterRange\>\"", "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"near", "=", 
      RowBox[{"N", "@", 
       RowBox[{"DeleteCases", "[", "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i", ",", "j"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"-", "r"}], ",", "r"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", 
               RowBox[{"-", "r"}], ",", "r"}], "}"}]}], "]"}], ",", "1"}], 
          "]"}], ",", "\[IndentingNewLine]", "\t", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"total", "=", 
      RowBox[{"Length", "@", "data"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"progress", "=", "total"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Dynamic", " ", "status"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"status", "=", 
      RowBox[{"PrintTemporary", "[", "\[IndentingNewLine]", "\t", 
       RowBox[{"Row", "[", "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Text", "[", 
            RowBox[{"Style", "[", 
             RowBox[{"\"\<Determining pixel clusters:\>\"", ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Avenir Next\>\""}], ",", 
              "14"}], "]"}], "]"}], ",", "\[IndentingNewLine]", "\t", 
           RowBox[{"Spacer", "[", "20", "]"}], ",", "\[IndentingNewLine]", 
           "\t", 
           RowBox[{"Dynamic", "@", 
            RowBox[{"ProgressIndicator", "[", 
             RowBox[{"1", "-", 
              RowBox[{"progress", "/", "total"}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "\t", "}"}], ",", "\[IndentingNewLine]", 
         "\t", 
         RowBox[{"Alignment", "\[Rule]", "Center"}]}], "\[IndentingNewLine]", 
        "\t", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Single", " ", "pixel"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"P", "=", 
      RowBox[{"Reap", "@", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"update", "\[NotEqual]", 
          RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"First", " ", "iteration"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"p", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"neighbours", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"start", "+", "#"}], "&"}], "/@", "near"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"new", "=", 
           RowBox[{"Intersection", "[", 
            RowBox[{"update", ",", "neighbours"}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Avoid", " ", "looping", " ", "over", " ", "the", " ", "same", " ",
             "single", " ", "pixel"}], " ", "*)"}], "\[IndentingNewLine]", 
          "\t", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"new", "\[Equal]", 
             RowBox[{"{", "}"}]}], ",", 
            RowBox[{"update", "=", 
             RowBox[{"Rest", "@", "update"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"p", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"p", ",", "new"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"update", "=", 
           RowBox[{"Complement", "[", 
            RowBox[{"update", ",", "p"}], "]"}]}], ";", "\[IndentingNewLine]",
           "\[IndentingNewLine]", "\t", 
          RowBox[{"(*", " ", 
           RowBox[{"The", " ", "next", " ", "iterations"}], " ", "*)"}], 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{"new", "\[NotEqual]", 
             RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", "\t", 
            "\[IndentingNewLine]", "\t", 
            RowBox[{"(*", " ", 
             RowBox[{"Current", " ", "and", " ", "rest"}], " ", "*)"}], 
            "\[IndentingNewLine]", "\t", 
            RowBox[{
             RowBox[{"n", "=", 
              RowBox[{"First", "@", "new"}]}], ";", "\[IndentingNewLine]", 
             "\t", 
             RowBox[{"new", "=", 
              RowBox[{"Rest", "@", "new"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", "\t\t", 
             RowBox[{"neighbours", "=", 
              RowBox[{
               RowBox[{
                RowBox[{"n", "+", "#"}], "&"}], "/@", "near"}]}], ";", 
             "\[IndentingNewLine]", "\t", "\[IndentingNewLine]", "\t", 
             RowBox[{"(*", " ", 
              RowBox[{"Actual", " ", "new", " ", "elements"}], " ", "*)"}], 
             "\[IndentingNewLine]", "\t", 
             RowBox[{"new2", "=", 
              RowBox[{"Intersection", "[", 
               RowBox[{"update", ",", "neighbours"}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{"p", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"p", ",", "new2"}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
             RowBox[{"update", "=", 
              RowBox[{"Complement", "[", 
               RowBox[{"update", ",", "p"}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{"new", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"new", ",", "new2"}], "]"}]}], ";"}]}], 
           "\[IndentingNewLine]", "\t", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"(*", " ", 
           RowBox[{"One", " ", "pixel", " ", "done"}], " ", "*)"}], 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"Sow", "[", "p", "]"}], ";", "\[IndentingNewLine]", "\t", 
          RowBox[{"progress", "=", 
           RowBox[{"Length", "@", "update"}]}], ";", "\[IndentingNewLine]", 
          "\t", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"update", "\[NotEqual]", 
             RowBox[{"{", "}"}]}], ",", 
            RowBox[{"start", "=", 
             RowBox[{"First", "@", "update"}]}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}]}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<ClearStatus\>\"", "]"}], ",", 
       RowBox[{"NotebookDelete", "@", "status"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"P", "=", 
      RowBox[{"P", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"clusters", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{"P", ",", 
        RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Merge", " ", "pixel", " ", "clusters", 
       " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"P", "=", 
      RowBox[{"Reap", "@", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{
          RowBox[{"k", "=", 
           RowBox[{"Round", "[", "\[IndentingNewLine]", "\t", 
            RowBox[{
             RowBox[{"{", "\[IndentingNewLine]", "\t", 
              RowBox[{
               RowBox[{"Total", "@", 
                RowBox[{"clusters", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "All", ",", "1"}], "]"}], "]"}]}], ",", 
               "\[IndentingNewLine]", "\t", 
               RowBox[{"Total", "@", 
                RowBox[{"clusters", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "All", ",", "2"}], "]"}], "]"}]}]}], 
              "\[IndentingNewLine]", "\t", "}"}], "\[IndentingNewLine]", "\t",
              "/", 
             RowBox[{"Length", "@", 
              RowBox[{"clusters", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}], "\[IndentingNewLine]", 
            "\t", "]"}]}], ";", "\[IndentingNewLine]", "\t", 
          RowBox[{"Sow", "[", "k", "]"}]}], ",", "\[IndentingNewLine]", "\t", 
         
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "clusters"}]}], "}"}]}], 
        "\[IndentingNewLine]", "\t", "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\t", "\[IndentingNewLine]", "\t", 
     RowBox[{"P", "[", 
      RowBox[{"[", 
       RowBox[{"2", ",", "1"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, 3.667819015852723*^9, {3.667926743191167*^9, 
   3.667926756485921*^9}, {3.6679268065659847`*^9, 3.6679268096604767`*^9}, {
   3.667926962553701*^9, 3.6679269943921003`*^9}, 3.6679277909347057`*^9, {
   3.6679278215421352`*^9, 3.6679278447888317`*^9}, {3.667927921354144*^9, 
   3.66792792396218*^9}, {3.667927998418087*^9, 3.667927998617405*^9}, {
   3.6679280547365437`*^9, 3.667928057183651*^9}, {3.667928585451659*^9, 
   3.667928696849235*^9}, {3.667930404905075*^9, 3.6679304216077147`*^9}, {
   3.6679304533630323`*^9, 3.667930454063971*^9}, {3.6679310019224863`*^9, 
   3.667931184397665*^9}, {3.667931227245723*^9, 3.667931371281341*^9}, {
   3.667931420882256*^9, 3.667931517142481*^9}, 3.667931552079372*^9, {
   3.667931592230816*^9, 3.6679315953351383`*^9}, {3.66793164158883*^9, 
   3.667931735041656*^9}, {3.667931797945294*^9, 3.667931835823868*^9}, {
   3.667931870240131*^9, 3.667931910901052*^9}, {3.6679320411065617`*^9, 
   3.667932042282494*^9}, {3.6679321631039057`*^9, 3.667932185255023*^9}, {
   3.6679322367038527`*^9, 3.6679322536777477`*^9}, 3.667939889308084*^9, {
   3.667969769378148*^9, 3.667969771378113*^9}, 3.667970090993989*^9, {
   3.667973390326392*^9, 3.6679733948223467`*^9}, {3.667976913750659*^9, 
   3.667976916404254*^9}, {3.6679769619491863`*^9, 3.667976962373781*^9}, 
   3.66797708246696*^9, 3.667977633341072*^9, {3.667977678626876*^9, 
   3.667977952564095*^9}, {3.667982385812993*^9, 3.6679823891230717`*^9}, {
   3.667982552768587*^9, 3.6679825768232183`*^9}, {3.667982617631548*^9, 
   3.667982618230095*^9}, 3.667982783740485*^9, 3.667982978648044*^9, {
   3.667987233443955*^9, 3.6679872350670633`*^9}, 3.667987319881976*^9, {
   3.667995025393314*^9, 3.667995077673361*^9}, {3.667995795417122*^9, 
   3.6679958330065393`*^9}, 3.66799604865274*^9, {3.667996211983923*^9, 
   3.667996238685172*^9}, {3.667996325731824*^9, 3.6679963500750713`*^9}, 
   3.6679964246118183`*^9, {3.6679964925539827`*^9, 3.6679965140880003`*^9}, {
   3.6679966308453293`*^9, 3.667996631124778*^9}, {3.667996667541781*^9, 
   3.667996679667149*^9}, {3.6682298967733393`*^9, 3.668230154667777*^9}, {
   3.6682302282495613`*^9, 3.668230337862431*^9}, {3.66823037439754*^9, 
   3.6682304210040913`*^9}, {3.668230470966654*^9, 3.668230509026909*^9}, {
   3.6682305945216846`*^9, 3.668230608294874*^9}, {3.668230649418269*^9, 
   3.6682306552087507`*^9}, {3.668230777855473*^9, 3.668230779342372*^9}, {
   3.668230827027471*^9, 3.668230869589425*^9}, {3.6682309020436172`*^9, 
   3.6682309032099752`*^9}, {3.668230964088015*^9, 3.6682309837305403`*^9}, {
   3.668231043206236*^9, 3.668231198625996*^9}, {3.6682312793778677`*^9, 
   3.668231309239684*^9}, {3.668231360770649*^9, 3.668231478579686*^9}, {
   3.6682315182903957`*^9, 3.6682316606075783`*^9}, {3.668231853738429*^9, 
   3.6682319097544107`*^9}, 3.6682320481299458`*^9, {3.66823231198499*^9, 
   3.668232340966546*^9}, {3.668232413221817*^9, 3.6682324555084667`*^9}, {
   3.668232593908114*^9, 3.6682326569589863`*^9}, {3.668232694967547*^9, 
   3.6682327934677343`*^9}, {3.668233168339756*^9, 3.668233211018368*^9}, {
   3.668233911929123*^9, 3.668233912673284*^9}, {3.668234165475075*^9, 
   3.668234166434887*^9}, 3.668234335726321*^9, {3.668234375925832*^9, 
   3.668234383685205*^9}, {3.6682344192284307`*^9, 3.668234420445109*^9}, {
   3.6682344814285107`*^9, 3.668234482946336*^9}, {3.668234565665369*^9, 
   3.6682345756405*^9}, {3.668234658311418*^9, 3.668234660936935*^9}, {
   3.668234729151449*^9, 3.668234734437337*^9}, {3.668234775292177*^9, 
   3.668234776492208*^9}, {3.6682348149806547`*^9, 3.6682348872015553`*^9}, {
   3.668234957471792*^9, 3.668234962599025*^9}, {3.66823500756784*^9, 
   3.668235010638788*^9}, {3.668235386702396*^9, 3.6682353879562407`*^9}, {
   3.668235436429007*^9, 3.668235463195363*^9}, {3.668235513409904*^9, 
   3.668235551480637*^9}, 3.668235614055798*^9, {3.668235690567173*^9, 
   3.668235719044767*^9}, {3.6695562972398148`*^9, 3.669556297373962*^9}, {
   3.687512196806978*^9, 3.6875121973395967`*^9}, {3.713802902597312*^9, 
   3.713802915932815*^9}, {3.713803320942219*^9, 3.713803345450964*^9}, {
   3.7138034257374067`*^9, 3.713803460759953*^9}, 3.713803519649189*^9, {
   3.713803604382509*^9, 3.713803680578794*^9}, {3.7138037681305428`*^9, 
   3.713803775505362*^9}, {3.713803860977088*^9, 3.713803917581181*^9}, {
   3.713803974310575*^9, 3.713803976182168*^9}, 3.7138040436679573`*^9, {
   3.7138063486627274`*^9, 3.713806350942552*^9}, {3.713807462694106*^9, 
   3.713807489203656*^9}, {3.7138075517857037`*^9, 3.713807559617502*^9}, {
   3.713807618953618*^9, 3.713807903852294*^9}, {3.713808001585246*^9, 
   3.7138080016781054`*^9}, 3.71380855458074*^9, {3.71380863487689*^9, 
   3.7138087192939777`*^9}, {3.713808846860177*^9, 3.713808857421461*^9}, {
   3.713808897778977*^9, 3.713808912465152*^9}, {3.713808955217936*^9, 
   3.7138089628015137`*^9}, {3.713808995906348*^9, 3.713809022295484*^9}, {
   3.713809073335235*^9, 3.713809100565136*^9}, {3.713809177854271*^9, 
   3.7138093132746353`*^9}, {3.7138093441213913`*^9, 
   3.7138093456793613`*^9}, {3.713809453317717*^9, 3.713809513685094*^9}, {
   3.7138095931785507`*^9, 3.713809626242549*^9}, {3.713809658033081*^9, 
   3.713809664135953*^9}, 3.713809740064288*^9, {3.713809808472837*^9, 
   3.7138099121534863`*^9}, {3.713844685073086*^9, 3.7138446872542553`*^9}, {
   3.71384588184228*^9, 3.7138458833230133`*^9}, {3.713846292992717*^9, 
   3.713846349611416*^9}, 3.713846695574162*^9, {3.7138467278378*^9, 
   3.713846731171411*^9}, {3.713846806808646*^9, 3.713846913776025*^9}, {
   3.7138469529141293`*^9, 3.713846953470827*^9}, {3.713847032551959*^9, 
   3.7138470334900837`*^9}, {3.713847168612919*^9, 3.713847198830091*^9}, {
   3.713847280190546*^9, 3.713847327524582*^9}, {3.713847407284361*^9, 
   3.713847407599958*^9}, {3.7138474475624743`*^9, 3.713847471334959*^9}, {
   3.713847502755796*^9, 3.713847510323131*^9}, {3.7138476002010098`*^9, 
   3.713847681785532*^9}, {3.7138477189303513`*^9, 3.713847720783132*^9}, {
   3.713848047572956*^9, 3.713848050312454*^9}, {3.713848196591464*^9, 
   3.713848212251227*^9}, {3.713848276669099*^9, 3.713848283663631*^9}, {
   3.713855305653678*^9, 3.713855338332179*^9}, {3.713855626443754*^9, 
   3.713855628890686*^9}, 3.713855941830909*^9, {3.713856433219384*^9, 
   3.713856437634218*^9}, {3.713862011147923*^9, 3.713862014225955*^9}, {
   3.713865700953743*^9, 3.7138657011938753`*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"881eb084-ebad-421e-8706-db485fe279f4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FindPixelClusters", "[", 
   RowBox[{"images_List", ",", "output_String", ",", 
    RowBox[{"OptionsPattern", "@", "FindPixelClusters"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "progress", ",", "L", ",", "outputfile", ",", "step1", ",", "step2"}], 
     "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Check", " ", "and", " ", "prepare", " ", "input"}], " ", "*)"}],
     "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"AnyTrue", "[", 
        RowBox[{"images", ",", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"FileExistsQ", "[", "#", "]"}]}], "&"}]}], "]"}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"FindPixelClusters", "::", "files"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"DirectoryQ", "@", 
         RowBox[{"DirectoryName", "@", "output"}]}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"FindPixelClusters", "::", "dir"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\t", "\[IndentingNewLine]", "\t", 
     RowBox[{"progress", "=", "0"}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"L", "=", 
      RowBox[{"Length", "@", "images"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Clear", " ", "current", " ", "$PixelData"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"$PixelData", "=", 
      RowBox[{"<|", "|>"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Dynamic", " ", "status"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"PrintTemporary", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{"Row", "[", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Text", "[", 
           RowBox[{"Style", "[", 
            RowBox[{"\"\<Progress:\>\"", ",", 
             RowBox[{"FontFamily", "\[Rule]", "\"\<Avenir Next\>\""}], ",", 
             "16"}], "]"}], "]"}], ",", "\[IndentingNewLine]", "\t", 
          RowBox[{"Spacer", "[", "20", "]"}], ",", "\[IndentingNewLine]", 
          "\t", 
          RowBox[{"Dynamic", "@", 
           RowBox[{"ProgressIndicator", "[", 
            RowBox[{"progress", "/", "L"}], "]"}]}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"Spacer", "[", "20", "]"}], ",", "\[IndentingNewLine]", 
          "\t", 
          RowBox[{"Dynamic", "[", 
           RowBox[{"Text", "[", 
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"\"\<Images done: \>\"", "<>", 
               RowBox[{"ToString", "[", "progress", "]"}], "<>", 
               "\"\< of \>\"", "<>", 
               RowBox[{"ToString", "@", "L"}]}], ",", 
              RowBox[{"FontFamily", "\[Rule]", "\"\<Avenir Next\>\""}], ",", 
              "12"}], "]"}], "]"}], "]"}]}], "\[IndentingNewLine]", "\t", 
         "}"}], ",", "\[IndentingNewLine]", "\t", 
        RowBox[{"Alignment", "\[Rule]", "Center"}]}], "\[IndentingNewLine]", 
       "\t", "]"}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{"Preparing", " ", "output", " ", "file"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"outputfile", "=", "output"}], ";", "\[IndentingNewLine]", "\t", 
     
     RowBox[{"Quiet", "@", 
      RowBox[{"Close", "@", "outputfile"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"WriteString", "[", 
      RowBox[{"outputfile", ",", "\"\<<|\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "Loop", " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"step1", "=", 
         RowBox[{"IntegerString", "[", 
          RowBox[{
           RowBox[{"FileHash", "[", 
            RowBox[{
             RowBox[{"images", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "\"\<MD5\>\""}], "]"}], 
           ",", "16", ",", "32"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
        
        RowBox[{"step2", "=", 
         RowBox[{"FindPixelClusters", "[", 
          RowBox[{
           RowBox[{"Import", "@", 
            RowBox[{"images", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           "\t", 
           RowBox[{"Method", "\[Rule]", 
            RowBox[{"OptionValue", "[", "Method", "]"}]}], ",", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"\"\<ClearStatus\>\"", "\[Rule]", "True"}]}], "]"}]}], ";",
         "\[IndentingNewLine]", "\t", 
        RowBox[{"WriteString", "[", 
         RowBox[{"outputfile", ",", 
          RowBox[{
           RowBox[{"\"\<\\\"\>\"", "<>", "step1", "<>", "\"\<\\\"\>\""}], 
           "\[Rule]", "step2"}]}], "]"}], ";", "\[IndentingNewLine]", "\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"i", "\[NotEqual]", 
           RowBox[{"Length", "@", "images"}]}], ",", 
          RowBox[{"WriteString", "[", 
           RowBox[{"outputfile", ",", "\"\<,\>\""}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"progress", "++"}]}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "@", "images"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "End", " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"WriteString", "[", 
      RowBox[{"outputfile", ",", "\"\<|>\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Close", "@", "outputfile"}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"AbsoluteFileName", "@", "outputfile"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, 3.667819176600494*^9, {3.667971802914857*^9, 
   3.667971859080471*^9}, {3.667971920120824*^9, 3.667971948479953*^9}, {
   3.667972005909231*^9, 3.667972006581135*^9}, 3.667990375472611*^9, {
   3.668102913573119*^9, 3.668102916285203*^9}, {3.668103301333783*^9, 
   3.6681033022141*^9}, {3.668104231931918*^9, 3.6681042368437233`*^9}, {
   3.66810427800709*^9, 3.668104281171877*^9}, {3.6681432560752687`*^9, 
   3.668143261920676*^9}, 3.668143368784114*^9, 3.668143565638023*^9, {
   3.668143603138604*^9, 3.6681436262097673`*^9}, {3.6682424356421633`*^9, 
   3.668242445129506*^9}, {3.7142085599143867`*^9, 3.7142085890345488`*^9}, 
   3.7142087250019093`*^9},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"6d5a08ba-f159-42c7-8316-e106aa2f1781"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"41e844d4-8203-469f-a72c-bf026506bbdb"]
}, Closed]],

Cell[CellGroupData[{

Cell["ImgScript", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, 3.6678187105381413`*^9, {3.668848030801978*^9, 
   3.668848031166407*^9}},ExpressionUUID->"2acb6343-d992-441d-871b-\
f419ef3f6357"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"ae1046d8-2e52-4402-ae77-d4474b528773"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ImgScript", "::", "None"}], "=", 
   "\"\<No \!\(\*StyleBox[\".\", \"Program\"]\)\!\(\*StyleBox[\"img\", \
\"Program\"]\) files were found.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ImgScript", "::", "InvalidFormat"}], "=", 
   "\"\<\[LeftGuillemet]`1`\[RightGuillemet] is not a valid output \
format.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ImgScript", "::", "String"}], "=", 
   "\"\<\!\(\*StyleBox[\".\", \"Program\"]\)\!\(\*StyleBox[\"img\", \"Program\
\"]\) file paths must be strings.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ImgScript", "::", "span"}], "=", 
   "\"\<The setting of \\\"SelectAdjust\\\" must be a Span.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ImgScript", "::", "integers"}], "=", 
   "\"\<The span in \\\"SelectAdjust\\\" must be comprised of \
integers.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ImgScript", "::", "InvalidRange"}], "=", 
   "\"\<Range for \\\"SelectAdjust\\\" is not compatible with the number of \
\!\(\*StyleBox[\".\", \"Program\"]\)\!\(\*StyleBox[\"img\", \"Program\"]\) \
files.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ImgScript", "::", "na"}], "=", 
    "\"\<\\\"SelectAdjust\\\" cannot be used without a brightness \
factor.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "ImgScript", "]"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<WriteDirectory\>\"", "\[Rule]", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<OutputFormat\>\"", "\[Rule]", "\"\<bmp\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<SelectAdjust\>\"", "\[Rule]", "All"}]}], "}"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.667811591227736*^9, 3.6678187237378197`*^9, {3.668848288618224*^9, 
   3.668848322223003*^9}, {3.668848530395031*^9, 3.668848533381481*^9}, {
   3.6688497155811567`*^9, 3.6688497270532312`*^9}, {3.668849885708955*^9, 
   3.668849886505486*^9}, {3.6688503391546297`*^9, 3.6688503570195227`*^9}, 
   3.674074162948956*^9, {3.712570751498494*^9, 3.712570784698996*^9}, {
   3.712571222891932*^9, 3.712571251218502*^9}, {3.712571379979851*^9, 
   3.712571405771557*^9}, {3.712571561879644*^9, 3.7125716370634108`*^9}, {
   3.712571916757163*^9, 
   3.712571977918076*^9}},ExpressionUUID->"7aea4502-3660-4d26-9d7c-\
94fcde59e7d9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"414a1848-111c-4586-accb-b5005825f0aa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ImgScript", "[", 
   RowBox[{"input_", ",", 
    RowBox[{"Optional", "[", 
     RowBox[{
      RowBox[{"m_", "?", "NumericQ"}], ",", "1"}], "]"}], ",", 
    RowBox[{"OptionsPattern", "@", "ImgScript"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "type", ",", "outdir", ",", "\[IndentingNewLine]", "imgfiles", ",", 
      "name", ",", "ext", ",", "end", ",", "i", ",", "writedir", ",", 
      "adjust", ",", "\[IndentingNewLine]", "fcode", ",", "entry"}], "}"}], 
    ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Analysing", " ", "input"}], " ", "*)"}], "\[IndentingNewLine]", 
    "\t", 
    RowBox[{
     RowBox[{"type", "=", 
      RowBox[{"ToString", "[", 
       RowBox[{"Head", "@", "input"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"type", "\[Equal]", "\"\<String\>\""}], ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"Finding", " ", ".", "img"}], " ", "files", " ", "in", " ", 
         "the", " ", "given", " ", "directory"}], " ", "*)"}], 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"imgfiles", "=", 
         RowBox[{"FileNames", "[", 
          RowBox[{"\"\<*.img\>\"", ",", "input"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"outdir", "=", "input"}], ";", "\[IndentingNewLine]", "\t\t", 
        
        RowBox[{"(*", " ", "Check", " ", "*)"}], "\[IndentingNewLine]", 
        "\t\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"imgfiles", "\[Equal]", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{"ImgScript", "::", "None"}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"type", "\[Equal]", "\"\<List\>\""}], ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"imgfiles", "=", "input"}], ";", "\[IndentingNewLine]", 
        "\t\t", 
        RowBox[{"outdir", "=", 
         RowBox[{"DirectoryName", "@", 
          RowBox[{"First", "@", "input"}]}]}], ";", "\[IndentingNewLine]", 
        "\t\t", 
        RowBox[{"(*", " ", 
         RowBox[{"Check", " ", "if", " ", "empty"}], " ", "*)"}], 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"imgfiles", "\[Equal]", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{"ImgScript", "::", "None"}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]",
         "\t\t", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Check", " ", "if", " ", "list", " ", "contains", " ", "strings", 
          " ", "only"}], " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"AllTrue", "[", 
            RowBox[{"imgfiles", ",", "StringQ"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{"ImgScript", "::", "String"}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}]}]}], "\[IndentingNewLine]", 
      "\t", "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Determining", " ", ".", "mac"}], " ", "file", " ", "name"}], 
      " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"StringContainsQ", "[", 
        RowBox[{
         RowBox[{"FileNameTake", "@", 
          RowBox[{"First", "@", "imgfiles"}]}], ",", "\"\<_\>\""}], "]"}], 
       ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"Truncated", " ", "name"}], " ", "*)"}], 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"name", "=", 
        RowBox[{"StringDrop", "[", 
         RowBox[{
          RowBox[{"First", "@", 
           RowBox[{"StringCases", "[", 
            RowBox[{
             RowBox[{"FileNameTake", "@", 
              RowBox[{"First", "@", "imgfiles"}]}], ",", 
             RowBox[{"__", "~~", "\"\<_\>\""}]}], "]"}]}], ",", 
          RowBox[{"-", "1"}]}], "]"}]}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"Base", " ", "name"}], " ", "*)"}], "\[IndentingNewLine]", 
       "\t", 
       RowBox[{"name", "=", 
        RowBox[{"StringDrop", "[", 
         RowBox[{
          RowBox[{"First", "@", 
           RowBox[{"StringCases", "[", 
            RowBox[{
             RowBox[{"FileNameTake", "@", "\[IndentingNewLine]", 
              RowBox[{"First", "@", "imgfiles"}]}], ",", 
             RowBox[{"Shortest", "[", 
              RowBox[{"__", "~~", "DigitCharacter"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"-", "1"}]}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Function", " ", "that", " ", "sets", " ", "new", " ", "extension"}], 
      " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"ext", "=", 
      RowBox[{"OptionValue", "[", "\"\<OutputFormat\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"end", "[", "i_", "]"}], ":=", 
      RowBox[{
       RowBox[{"StringDrop", "[", 
        RowBox[{
         RowBox[{"imgfiles", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ",", 
         RowBox[{"-", "3"}]}], "]"}], "<>", "ext"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Optional", ":", " ", 
       RowBox[{"Write", " ", "a", " ", "different", " ", "directory"}]}], " ",
       "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"writedir", "=", 
      RowBox[{"OptionValue", "[", "\"\<WriteDirectory\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"StringQ", "@", "writedir"}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"imgfiles", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{"writedir", ",", "#"}], "}"}], "]"}], "&"}], "/@", 
         RowBox[{"(", 
          RowBox[{"FileNameTake", "/@", "imgfiles"}], ")"}]}]}]}], "]"}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Optional", ":", " ", 
       RowBox[{"Output", " ", "format"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"ext", "\[Equal]", "\"\<bmp\>\""}], ",", 
       RowBox[{"fcode", "=", "\"\<bitmap \>\""}], ",", "\[IndentingNewLine]", 
       "\t", 
       RowBox[{"ext", "\[Equal]", "\"\<jpg\>\""}], ",", 
       RowBox[{"fcode", "=", "\"\<jpgbmp \>\""}], ",", "\[IndentingNewLine]", 
       "\t", "True", ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"ImgScript", "::", "InvalidFormat"}], ",", "ext"}], "]"}], 
        ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Optional", ":", " ", 
       RowBox[{"Adjust", " ", "brightness"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"adjust", "=", 
      RowBox[{"OptionValue", "[", "\"\<SelectAdjust\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"(*", " ", "Checks", " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
     
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"(", 
         RowBox[{"adjust", "===", "All"}], ")"}]}], ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ToString", "@", 
            RowBox[{"Head", "@", "adjust"}]}], "\[NotEqual]", 
           "\"\<Span\>\""}], ",", "\[IndentingNewLine]", "\t\t", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{"ImgScript", "::", "span"}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]",
         "\t\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"AllTrue", "[", 
            RowBox[{"adjust", ",", "IntegerQ"}], "]"}]}], ",", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{"ImgScript", "::", "integers"}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]",
         "\t\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"!", 
            RowBox[{
             RowBox[{"adjust", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "\[GreaterEqual]", "1"}]}], "||", 
           RowBox[{
            RowBox[{"adjust", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ">", 
            RowBox[{"Length", "@", "imgfiles"}]}]}], ",", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{"ImgScript", "::", "InvalidRange"}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]",
         "\t\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"m", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", "\t\t", 
          
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{"ImgScript", "::", "na"}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}]}]}], "\[IndentingNewLine]", 
      "\t\t", "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"m", "\[NotEqual]", "1"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"adjust", "\[Equal]", "All"}], ",", "\[IndentingNewLine]", 
         "\t", 
         RowBox[{"adjust", "=", 
          RowBox[{"Range", "@", 
           RowBox[{"Length", "@", "imgfiles"}]}]}], ",", "Null", ",", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{"adjust", "=", 
          RowBox[{"Part", "[", 
           RowBox[{
            RowBox[{"Range", "@", 
             RowBox[{"Length", "@", "imgfiles"}]}], ",", "adjust"}], 
           "]"}]}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Function", " ", "that", " ", "writes", " ", "code", " ", "for", " ", 
       "each", " ", "case"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"entry", "[", "i_", "]"}], ":=", "\[IndentingNewLine]", "\t", 
      RowBox[{"\"\<rd i \\\"\>\"", "<>", 
       RowBox[{"imgfiles", "[", 
        RowBox[{"[", "i", "]"}], "]"}], "<>", "\"\<\\\"\\n\>\"", "<>", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{"adjust", ",", "i"}], "]"}], ",", "\[IndentingNewLine]", 
         "\t", 
         RowBox[{"\"\<ip multiplydouble i1 i1 \>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"N", "[", "m", "]"}], "]"}], "<>", "\"\<\\n\>\""}], ",", 
         "\[IndentingNewLine]", "\t", "\"\<\>\""}], "]"}], "<>", 
       "\[IndentingNewLine]", "\t", "\"\<wd \>\"", "<>", "fcode", "<>", 
       "\"\<\\\"\>\"", "<>", 
       RowBox[{"end", "[", "i", "]"}], "<>", "\"\<\\\"\>\""}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Generating", " ", "and", " ", "exporting", " ", "table"}], " ",
       "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"outdir", ",", 
          RowBox[{"name", "<>", "\"\<.mac\>\""}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"entry", "[", "i", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "imgfiles"}]}], "}"}]}], "]"}], ",", 
       "\"\<Table\>\""}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, 3.667818718091518*^9, {3.668843227216737*^9, 
   3.668843260623933*^9}, {3.668843800356245*^9, 3.668843859685425*^9}, {
   3.6688485350589647`*^9, 3.668848542811091*^9}, 3.668848640505588*^9, {
   3.6688487133639917`*^9, 3.668848741790744*^9}, {3.668848785584115*^9, 
   3.66884878833679*^9}, {3.6688490369025507`*^9, 3.6688490408015003`*^9}, {
   3.6688494283086033`*^9, 3.668849443936469*^9}, {3.668849502587039*^9, 
   3.668849505233816*^9}, {3.668849602307579*^9, 3.6688496096107407`*^9}, {
   3.6688496553249607`*^9, 3.668849684559898*^9}, {3.6688498057208433`*^9, 
   3.668849816647071*^9}, {3.668849854052587*^9, 3.66884990391476*^9}, {
   3.668849949676675*^9, 3.668849958799165*^9}, {3.6688499909252577`*^9, 
   3.668850017824744*^9}, {3.668850064073255*^9, 3.668850194002316*^9}, {
   3.668850226589102*^9, 3.668850322211541*^9}, 3.668850363896997*^9, {
   3.6688504485662117`*^9, 3.668850480990592*^9}, {3.6688505147957897`*^9, 
   3.668850553881968*^9}, {3.668850586916111*^9, 3.668850590223164*^9}, {
   3.668850648044367*^9, 3.668850649675537*^9}, {3.668850705498735*^9, 
   3.6688507289847927`*^9}, {3.668850766122506*^9, 3.668850840956725*^9}, {
   3.668851068760067*^9, 3.6688510957854223`*^9}, 3.6740740543208313`*^9, {
   3.674074168023467*^9, 3.674074175975074*^9}, {3.712570554671812*^9, 
   3.7125705604817667`*^9}, {3.7125706716467*^9, 3.7125707289881287`*^9}, {
   3.712570792351226*^9, 3.712570812097787*^9}, {3.7125708766421413`*^9, 
   3.712570881238154*^9}, {3.712571203693883*^9, 3.71257121373002*^9}, {
   3.712571259807963*^9, 3.712571368115559*^9}, 3.7125714133318653`*^9, {
   3.712571674956291*^9, 3.712571675228469*^9}, {3.712571740063588*^9, 
   3.71257177061097*^9}, {3.7125718800827417`*^9, 3.712571911708654*^9}, {
   3.712571982422608*^9, 3.712572021855831*^9}, {3.7125720580663567`*^9, 
   3.712572093677559*^9}, {3.712572148360096*^9, 3.712572151574245*^9}, {
   3.712572204885757*^9, 3.712572329555284*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"7cae0bb2-b056-4d96-8f9b-c61777a95838"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"d69a9006-8db9-468b-be40-d6c7883c9970"]
}, Closed]],

Cell[CellGroupData[{

Cell["ImportReflectionFile", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, {3.667900125753806*^9, 3.667900130001958*^9}, 
   3.668105575055373*^9, {3.681669216072617*^9, 3.6816692308311157`*^9}, {
   3.682134073518475*^9, 3.682134077310957*^9}, {3.6821351637913322`*^9, 
   3.682135164412662*^9}},ExpressionUUID->"e964329e-9607-409f-b03e-\
c8db084f23da"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"8924a8bf-a09f-4b86-9997-4f75e74b2e97"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"7bbfa8ea-ec5e-4b48-b633-9a42cce8327e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ImportReflectionFile", "[", 
   RowBox[{"file_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"StringTake", "[", 
        RowBox[{"#", ",", 
         RowBox[{"-", "3"}]}], "]"}], "\[Equal]", "\"\<hkl\>\""}], "&"}], 
     ")"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "import", ",", "end", ",", "temp", ",", "need0", ",", "l", ",", "zero"}],
      "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Importing", " ", "and", " ", 
      RowBox[{"trimming", " ", ".", "hkl"}], " ", "file"}], " ", "*)"}], 
    "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{"import", "=", 
      RowBox[{"Check", "[", 
       RowBox[{
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", "\"\<Table\>\""}], "]"}], ",", 
        RowBox[{"Abort", "[", "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"import", "=", 
      RowBox[{"ToString", "/@", "import"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"end", "=", 
      RowBox[{"Position", "[", 
       RowBox[{
        RowBox[{"StringCases", "[", 
         RowBox[{"import", ",", "\"\<0, 0, 0\>\""}], "]"}], ",", 
        RowBox[{"{", "\"\<0, 0, 0\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Not", " ", "ending", " ", "with", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"end", "\[Equal]", 
        RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"end", "=", 
         RowBox[{"Length", "@", "import"}]}], ";", 
        RowBox[{"need0", "=", "True"}]}], ",", "\[IndentingNewLine]", "\t\t", 
       
       RowBox[{
        RowBox[{"end", "=", 
         RowBox[{"First", "@", 
          RowBox[{"Flatten", "@", "end"}]}]}], ";", 
        RowBox[{"need0", "=", "False"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"import", "[", 
       RowBox[{"[", 
        RowBox[{";;", "end"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Fixing", " ", "clustered", " ", "entries"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"StringReplace", "[", 
       RowBox[{"temp", ",", "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{
          RowBox[{"a", ":", "DigitCharacter"}], "~~", "\"\<-\>\"", "~~", 
          RowBox[{"b", ":", "DigitCharacter"}]}], "\[RuleDelayed]", 
         RowBox[{"a", "<>", "\"\< , \>\"", "<>", "b"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"ToExpression", "/@", 
       RowBox[{"StringTrim", "/@", "temp"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Appending", " ", "zero", " ", "element", " ", "if", " ", "needed"}], 
      " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"l", "=", 
      RowBox[{"Length", "@", 
       RowBox[{"RandomChoice", "@", "temp"}]}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"zero", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", "0.00", ",", "0.00", ",", "0"}], 
       "}"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"zero", "=", 
      RowBox[{"zero", "[", 
       RowBox[{"[", 
        RowBox[{";;", "l"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{"need0", ",", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"temp", ",", "zero"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t", "temp"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, 3.668106086235696*^9, {3.6681847250202436`*^9, 
   3.668184763578227*^9}, {3.668184859415769*^9, 3.6681848958952827`*^9}, {
   3.6681849656538982`*^9, 3.668184966557592*^9}, {3.668186746700986*^9, 
   3.668186748499941*^9}, {3.668186887833519*^9, 3.668186915465481*^9}, 
   3.668187179635866*^9, {3.6681873567029552`*^9, 3.668187367461336*^9}, {
   3.6681874297574987`*^9, 3.668187481442852*^9}, {3.6681875159231033`*^9, 
   3.66818751647386*^9}, {3.668187676247175*^9, 3.66818768715088*^9}, {
   3.668187807957081*^9, 3.668187810156796*^9}, 3.6681878677945766`*^9, {
   3.668192637722664*^9, 3.6681926384504833`*^9}, {3.668192682042522*^9, 
   3.668192705296905*^9}, {3.68166924518751*^9, 3.681669257401746*^9}, 
   3.681706490571958*^9, {3.681706560665007*^9, 3.681706560808091*^9}, {
   3.681706701190172*^9, 3.6817067089323483`*^9}, {3.681706888369705*^9, 
   3.68170694343121*^9}, {3.681707009919237*^9, 3.681707054877233*^9}, 
   3.681707094253208*^9, {3.681707298537107*^9, 3.681707301151917*^9}, {
   3.681710383837879*^9, 3.681710517243684*^9}, {3.681710549236743*^9, 
   3.681710591906762*^9}, 3.68171076139857*^9, 3.681710814623724*^9, {
   3.6817109067478313`*^9, 3.6817110010439167`*^9}, {3.681711080522023*^9, 
   3.6817111039844112`*^9}, 3.681711207870273*^9, {3.6817112607821617`*^9, 
   3.681711305188384*^9}, {3.681711445370324*^9, 3.681711513296112*^9}, {
   3.6817115774404993`*^9, 3.681711650636854*^9}, {3.68171500692944*^9, 
   3.681715026767819*^9}, {3.681715181501337*^9, 3.681715181739588*^9}, {
   3.681715678282447*^9, 3.6817156946895933`*^9}, {3.681715923758252*^9, 
   3.6817159597723722`*^9}, {3.68171782238949*^9, 3.681717946865253*^9}, {
   3.681718348825375*^9, 3.681718349067914*^9}, {3.681718672178816*^9, 
   3.68171869694698*^9}, {3.681718727898713*^9, 3.681718795793612*^9}, {
   3.681719297392269*^9, 3.681719364987854*^9}, {3.681719424875423*^9, 
   3.681719476273019*^9}, {3.681719564217062*^9, 3.6817195753909283`*^9}, {
   3.681719696949328*^9, 3.681719703508996*^9}, {3.681720146779862*^9, 
   3.681720188282736*^9}, {3.681720357048739*^9, 3.681720404007724*^9}, {
   3.681720538565111*^9, 3.68172054257139*^9}, {3.681720713993903*^9, 
   3.681720714144103*^9}, {3.6817209858918037`*^9, 3.681721182870202*^9}, {
   3.681721229493627*^9, 3.6817212759562902`*^9}, {3.681721318685071*^9, 
   3.681721337315277*^9}, {3.681721411035223*^9, 3.681721483737514*^9}, {
   3.6817215519766006`*^9, 3.6817216024457273`*^9}, {3.681721640646819*^9, 
   3.681721648839014*^9}, {3.681721731125741*^9, 3.681721732668375*^9}, {
   3.681721789833881*^9, 3.681721806418096*^9}, {3.6817219185830507`*^9, 
   3.6817219344066553`*^9}, {3.681722442266707*^9, 3.6817224444361963`*^9}, {
   3.6817227023431807`*^9, 3.681722723774548*^9}, {3.6817228369801702`*^9, 
   3.681722870587195*^9}, 3.6817229070837173`*^9, {3.681723229228771*^9, 
   3.681723316371806*^9}, 3.681723352394136*^9, {3.681723491110834*^9, 
   3.6817234976219*^9}, {3.681723533046878*^9, 3.681723549182931*^9}, {
   3.681723690723069*^9, 3.681723710538261*^9}, {3.681723746168332*^9, 
   3.681723764431592*^9}, {3.6817239634608393`*^9, 3.681724024526379*^9}, {
   3.681724085449534*^9, 3.6817242176903954`*^9}, {3.6817242696057167`*^9, 
   3.681724295774458*^9}, 3.681724327237109*^9, {3.681724474011566*^9, 
   3.681724476993256*^9}, 3.681724828780448*^9, {3.6818125091048193`*^9, 
   3.6818125114155693`*^9}, {3.6818368257106333`*^9, 3.68183686908536*^9}, {
   3.681836932372287*^9, 3.6818369624101877`*^9}, 3.681837110530672*^9, {
   3.681837208341257*^9, 3.681837224397664*^9}, {3.6818373595787363`*^9, 
   3.6818374537754908`*^9}, {3.681837562221323*^9, 3.6818375769428663`*^9}, {
   3.681910108411652*^9, 3.681910109523672*^9}, {3.681914019772044*^9, 
   3.6819140660350637`*^9}, {3.681914192192573*^9, 3.681914197016157*^9}, {
   3.6819143018703423`*^9, 3.6819143025663137`*^9}, {3.681915201163806*^9, 
   3.681915204987383*^9}, {3.681915310962316*^9, 3.681915331517808*^9}, {
   3.681915405175632*^9, 3.6819154062625723`*^9}, {3.681915499756755*^9, 
   3.681915499981236*^9}, {3.682073936912169*^9, 3.6820739483816547`*^9}, {
   3.6820743306881447`*^9, 3.682074335621664*^9}, {3.682074407370736*^9, 
   3.682074414704529*^9}, {3.6820745276580267`*^9, 3.6820745282934628`*^9}, {
   3.6820746925334578`*^9, 3.682074694860141*^9}, {3.682074732983082*^9, 
   3.682074765426908*^9}, {3.6820749940801067`*^9, 3.682075014622149*^9}, {
   3.682075051439227*^9, 3.6820750769809523`*^9}, {3.682080559474235*^9, 
   3.682080571064229*^9}, {3.682081192052569*^9, 3.682081198850922*^9}, {
   3.6820825372652617`*^9, 3.682082587828931*^9}, {3.682083882451795*^9, 
   3.682083906361766*^9}, {3.682084834510179*^9, 3.682084909148551*^9}, {
   3.682085355867062*^9, 3.6820853570730352`*^9}, {3.682085387352064*^9, 
   3.682085468590469*^9}, {3.6820954917674417`*^9, 3.682095491933237*^9}, {
   3.6820955359818773`*^9, 3.6820955368911743`*^9}, {3.6820955810166683`*^9, 
   3.682095702639804*^9}, {3.6820958051670427`*^9, 3.682095833859441*^9}, {
   3.6820959556190987`*^9, 3.682095960147934*^9}, {3.682096089911231*^9, 
   3.682096098702631*^9}, {3.6820961601906853`*^9, 3.682096164437451*^9}, {
   3.6820962600043573`*^9, 3.682096261183568*^9}, 3.6820964289853363`*^9, {
   3.682101172972685*^9, 3.682101186499799*^9}, {3.682102756494223*^9, 
   3.6821027720587893`*^9}, {3.682102815514278*^9, 3.682102843539885*^9}, {
   3.682102913889373*^9, 3.6821029181999683`*^9}, {3.682134119475279*^9, 
   3.68213414049387*^9}, {3.682134230034416*^9, 3.682134358353902*^9}, {
   3.682134389202623*^9, 3.682134415753475*^9}, {3.68213471223449*^9, 
   3.682134738680016*^9}, {3.682135167917287*^9, 3.6821351692739058`*^9}, {
   3.6821406292666683`*^9, 3.682140654094082*^9}, {3.6821406991343613`*^9, 
   3.6821407036714487`*^9}, {3.6821407535813293`*^9, 3.682140776232851*^9}, {
   3.682141280640764*^9, 3.6821413140749407`*^9}, {3.682215668637539*^9, 
   3.6822158020038137`*^9}, {3.682215858234087*^9, 3.682216069916401*^9}, {
   3.682216114700245*^9, 3.682216117967658*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"9f0223cb-811d-407b-b958-395d3f8efdee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"2a0bcbec-4d89-416a-99af-ae0164582584"]
}, Closed]],

Cell[CellGroupData[{

Cell["IntensityTable", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, 
   3.667817961099627*^9},ExpressionUUID->"3b753f0e-2dc0-498e-9a94-\
d94051e92fc9"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"5b5fd046-b540-43d4-a0b6-f9e95cedd799"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "@", "IntensityTable"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{"\"\<Sort\>\"", "\[Rule]", 
     RowBox[{"-", "2"}]}], "\[IndentingNewLine]", "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.713621199125605*^9, 3.7136212458990927`*^9}, {
  3.7136216692573566`*^9, 
  3.713621683264825*^9}},ExpressionUUID->"5e4d63a7-a7ab-4687-890b-\
9360d007f30a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"b8ed105a-8270-42d1-bea6-f17597842c9d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"IntensityTable", "[", 
   RowBox[{"group_String", ",", 
    RowBox[{"file_", "?", "FileExistsQ"}], ",", 
    RowBox[{"OptionsPattern", "@", "IntensityTable"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "import", ",", "sgHM", ",", "hkl", ",", "data", ",", 
      "\[IndentingNewLine]", "gathered", ",", "wmean", ",", 
      "\[IndentingNewLine]", "tally", ",", "minmax", ",", "min", ",", "max", 
      ",", "range", ",", "span", ",", "\[IndentingNewLine]", "values", ",", 
      "sort", ",", "table", ",", "\[IndentingNewLine]", "temp"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"--", "-"}], "*", " ", "Importing", " ", "data", " ", "and", 
      " ", "reorganising", " ", "*", 
      RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{"import", "=", 
      RowBox[{"Flatten", "@", 
       RowBox[{"Check", "[", 
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"file", ",", "\"\<CSV\>\""}], "]"}], ",", 
         RowBox[{"Abort", "[", "]"}]}], "]"}]}]}], ";", "\[IndentingNewLine]",
      "\t", 
     RowBox[{"sgHM", "=", 
      RowBox[{"SymmetryData", "[", 
       RowBox[{"group", ",", "\"\<HermannMauguinFull\>\""}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Removing", " ", "the", " ", "metadata", " ", "appended", " ", "in", 
       " ", "newer", " ", "versions"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t\t", 
     RowBox[{"temp", "=", 
      RowBox[{"Position", "[", 
       RowBox[{"import", ",", "\"\<   0   0   0    0.00    0.00   0\>\""}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"temp", "\[NotEqual]", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"import", "=", 
        RowBox[{"import", "[", 
         RowBox[{"[", 
          RowBox[{";;", 
           RowBox[{
            RowBox[{"temp", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", "1"}]}], "]"}], 
         "]"}]}]}], "]"}], ";", "\t\t", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Fixing", " ", "squeezed", " ", "entries"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"import", "=", 
      RowBox[{"StringReplace", "[", 
       RowBox[{"import", ",", "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"\"\<  \>\"", "~~", 
          RowBox[{"p", ":", 
           RowBox[{"{", 
            RowBox[{"\"\<-\>\"", ",", "\"\<\>\""}], "}"}]}], "~~", 
          RowBox[{"a", ":", 
           RowBox[{"DigitCharacter", ".."}]}], "~~", "\"\<-\>\"", "~~", 
          RowBox[{"b", ":", "DigitCharacter"}]}], "\[RuleDelayed]", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{
         "\"\<  \>\"", "~~", "p", "~~", "a", "~~", "\"\< -\>\"", "~~", 
          "b"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"import", "=", 
      RowBox[{"ToExpression", "@", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"import", ",", "Whitespace"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Reorganising", " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"data", "=", 
      RowBox[{"import", "/.", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "h_", ",", "k_", ",", "l_", ",", "F2_", ",", "\[Sigma]2_", ",", 
          "batch_"}], "}"}], "\[RuleDelayed]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"h", ",", "k", ",", "l"}], "}"}], ",", "F2", ",", 
          "\[Sigma]2"}], "}"}]}]}]}], ";", "\[IndentingNewLine]", "\t", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Deleting", " ", "extinct", " ", "reflections"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"hkl", "=", 
      RowBox[{"data", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]",
      "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"SystematicAbsentQ", "[", 
       RowBox[{"sgHM", ",", "hkl"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"data", "=", 
      RowBox[{"Pick", "[", 
       RowBox[{"data", ",", "temp", ",", "False"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Gathering", " ", "data", " ", "by", 
       " ", "Laue", " ", "class", " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Gather", " ", "by", " ", "symmetry", " ", "equivalence"}], " ",
       "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"gathered", "=", 
      RowBox[{"GatherBy", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"Sort", "@", 
          RowBox[{"SymmetryEquivalentReflections", "[", "\[IndentingNewLine]", 
           RowBox[{"sgHM", ",", 
            RowBox[{"First", "@", "#"}]}], "]"}]}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Calculating", " ", "a", " ", "weighted", " ", "mean", " ", "for", " ", 
       "each", " ", "type"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"gathered", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "All", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3"}], "}"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"wmean", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"WeightedMean", "@", "#"}], ")"}], "[", 
         RowBox[{"[", 
          RowBox[{"{", 
           RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "&"}], "/@", 
       "temp"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Extracting", " ", "useful", " ", 
       "information", " ", "for", " ", "each", " ", "group", " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"tally", "=", 
      RowBox[{"Length", "/@", "gathered"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"minmax", "=", 
      RowBox[{"Reap", "[", "\[IndentingNewLine]", "\t", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"Sow", "[", "\[IndentingNewLine]", "\t", 
          RowBox[{
           RowBox[{"temp", "=", 
            RowBox[{"f", "/@", 
             RowBox[{"gathered", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{
            RowBox[{
             RowBox[{"NumberForm", "[", 
              RowBox[{"#", ",", 
               RowBox[{"{", 
                RowBox[{"6", ",", "0"}], "}"}], ",", "\[IndentingNewLine]", 
               "\t", 
               RowBox[{"DigitBlock", "\[Rule]", "3"}], ",", 
               "\[IndentingNewLine]", "\t", 
               RowBox[{"NumberSeparator", "\[Rule]", "\"\<,\>\""}], ",", 
               "\[IndentingNewLine]", "\t", 
               RowBox[{"NumberPoint", "\[Rule]", "\"\<\>\""}]}], "]"}], "&"}],
             "/@", "temp"}]}], "]"}], ",", "\[IndentingNewLine]", "\t", 
         RowBox[{"{", 
          RowBox[{"f", ",", 
           RowBox[{"{", 
            RowBox[{"Min", ",", "Max"}], "}"}]}], "}"}]}], "]"}], 
       "\[IndentingNewLine]", "\t", "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"min", ",", "max"}], "}"}], "=", 
      RowBox[{"minmax", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\t", "\[IndentingNewLine]", "\t", 
     RowBox[{"range", "=", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"\"\<(\>\"", "<>", 
          RowBox[{"ToString", "[", "#1", "]"}], "<>", "\"\<; \>\"", "<>", 
          RowBox[{"ToString", "[", "#2", "]"}], "<>", "\"\<)\>\""}], "&"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"min", ",", "max"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"span", "=", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"#1", "-", "#2"}], ")"}], "/", 
           RowBox[{"(", 
            RowBox[{"2", "*", "#3"}], ")"}]}], "*", "100.0"}], "&"}], ",", 
        RowBox[{"Map", "[", 
         RowBox[{"First", ",", 
          RowBox[{"{", 
           RowBox[{"max", ",", "min", ",", "wmean"}], "}"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Assigning", " ", "a", " ", "representative", " ", "for", " ", "each", 
       " ", "type", " ", "of", " ", "equivalent", " ", "reflections"}], " ", 
      "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"ToStandardSetting", "[", 
         RowBox[{"sgHM", ",", "#"}], "]"}], "&"}], "/@", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"(", 
        RowBox[{"First", "/@", 
         RowBox[{"First", "/@", "gathered"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"hkl", "=", 
      RowBox[{"ToMiller", "/@", "temp"}]}], ";", "\[IndentingNewLine]", "\t", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Merging", " ", "the", " ", "representatives", " ", "with", " ", "the", 
       " ", "corresponding", " ", "values"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"values", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", "\[IndentingNewLine]", "\t", 
        RowBox[{"hkl", ",", 
         RowBox[{"wmean", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"wmean", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{"Length", "/@", "gathered"}], ",", "range", ",", "span"}], 
        "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\t\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Optional", ":", " ", 
       RowBox[{"Sorting", " ", "option"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"sort", "=", 
      RowBox[{"OptionValue", "[", "\"\<Sort\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"(*", " ", 
      RowBox[{"No", " ", "preferance"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"Range", "@", 
           RowBox[{"Last", "@", 
            RowBox[{"Dimensions", "@", "values"}]}]}], ",", 
          RowBox[{"Abs", "@", "sort"}]}], "]"}]}], ",", 
       RowBox[{"Goto", "[", "\"\<SortingDone\>\"", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Sorting", " ", "by", " ", "a", " ", "specific", " ", "column"}], " ", 
      "*)"}], "\t\t\t", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"values", "=", 
      RowBox[{"Sort", "[", 
       RowBox[{"values", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"#1", "[", 
           RowBox[{"[", 
            RowBox[{"Abs", "@", "sort"}], "]"}], "]"}], "<", 
          RowBox[{"#2", "[", 
           RowBox[{"[", 
            RowBox[{"Abs", "@", "sort"}], "]"}], "]"}]}], "&"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Reversing", " ", "if", " ", "negative"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"sort", "<", "0"}], ",", 
       RowBox[{"values", "=", 
        RowBox[{"Reverse", "@", "values"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Rounding", " ", "off", " ", "numbers", 
       " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"Label", "[", "\"\<SortingDone\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"NumberForm", "[", 
         RowBox[{"#", ",", 
          RowBox[{"{", 
           RowBox[{"6", ",", "0"}], "}"}], ",", "\[IndentingNewLine]", "\t", 
          RowBox[{"DigitBlock", "\[Rule]", "3"}], ",", "\[IndentingNewLine]", 
          "\t", 
          RowBox[{"NumberSeparator", "\[Rule]", "\"\<,\>\""}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"NumberPoint", "\[Rule]", "\"\<\>\""}]}], "]"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{"Flatten", "@", "values"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"values", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{"temp", ",", 
        RowBox[{"Last", "@", 
         RowBox[{"Dimensions", "@", "values"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Inserting", " ", "percentage", " ", "signs", " ", "to", " ", 
       RowBox[{"the", " ", "'"}], "relative", " ", 
       RowBox[{"span", "'"}]}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"values", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "6"}], "]"}], "]"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<%\>\""}], "&"}], "/@", 
       RowBox[{"values", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "6"}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Table", " ", "construction", " ", "*", 
       
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"table", "=", 
      RowBox[{"PrependTo", "[", 
       RowBox[{"values", ",", "\[IndentingNewLine]", "\t", 
        RowBox[{"{", 
         RowBox[{
         "\"\<(hkl)\>\"", ",", "\"\<[counts]\>\"", ",", "\"\<[counts]\>\"", 
          ",", "Null", ",", "\"\<(min; max)\>\"", ",", 
          "\"\<from middle\>\""}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"table", "=", 
      RowBox[{"PrependTo", "[", 
       RowBox[{"table", ",", "\[IndentingNewLine]", "\t", 
        RowBox[{"{", 
         RowBox[{
         "Null", ",", "\"\<Intensity\>\"", ",", "\"\<Uncertainty\>\"", ",", 
          "\"\<Tally\>\"", ",", "\"\<Range\>\"", ",", 
          "\"\<Relative span\>\""}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"Grid", "[", 
      RowBox[{"table", ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"Dividers", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"None", ",", 
            RowBox[{"{", "True", "}"}], ",", "None"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"None", ",", "None", ",", "True"}], "}"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"Background", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "None", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"None", ",", 
            RowBox[{"{", 
             RowBox[{"None", ",", 
              RowBox[{"GrayLevel", "[", "0.90", "]"}]}], "}"}]}], "}"}]}], 
         "}"}]}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"Alignment", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Center", ",", "Center"}], "}"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"Spacings", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"1.5", ",", 
          RowBox[{"2", "\[Rule]", "0.25"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"ItemStyle", "\[Rule]", "\[IndentingNewLine]", "\t", 
        RowBox[{"{", 
         RowBox[{
         "Automatic", ",", "\[IndentingNewLine]", "\t", "Automatic", ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"{", "\[IndentingNewLine]", "\t", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "1"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"Last", "@", 
                  RowBox[{"Dimensions", "@", "values"}]}]}], "}"}]}], "}"}], 
             "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
               ",", 
               RowBox[{"FontSize", "\[Rule]", "15"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", "\t", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"2", ",", "2"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"Last", "@", 
                  RowBox[{"Dimensions", "@", "values"}]}]}], "}"}]}], "}"}], 
             "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"FontFamily", "\[Rule]", "\"\<Times New Roman\>\""}], 
               ",", 
               RowBox[{"FontSize", "\[Rule]", "13"}], ",", "Gray"}], "}"}]}], 
            ",", "\[IndentingNewLine]", "\t", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"3", ",", 
                 RowBox[{"Length", "@", "table"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "6"}], "}"}]}], "}"}], "\[Rule]", 
             RowBox[{"FontFamily", "\[Rule]", "\"\<Courier\>\""}]}]}], 
           "\[IndentingNewLine]", "\t", "}"}]}], "\[IndentingNewLine]", "\t", 
         "}"}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, 3.6678179776799517`*^9, {3.668180041909956*^9, 
   3.66818006829044*^9}, 3.668244081243107*^9, {3.6747521337060423`*^9, 
   3.6747521381469088`*^9}, 3.6747544474543667`*^9, {3.6747547341025133`*^9, 
   3.674754736781383*^9}, {3.6747547840013933`*^9, 3.674754796748868*^9}, {
   3.6747548706832523`*^9, 3.6747549227776203`*^9}, {3.674755158711894*^9, 
   3.67475518337843*^9}, 3.67475523506689*^9, {3.6747625583682632`*^9, 
   3.674762560438879*^9}, {3.674762668534231*^9, 3.674762724258876*^9}, {
   3.674762776690702*^9, 3.6747627893869343`*^9}, {3.67476289932897*^9, 
   3.674762916711329*^9}, {3.674762976838047*^9, 3.674762978933086*^9}, {
   3.681669128273329*^9, 3.6816691313995447`*^9}, {3.713515882282662*^9, 
   3.713515903417301*^9}, {3.7135159519153023`*^9, 3.713515955161378*^9}, {
   3.713516709287328*^9, 3.71351673845008*^9}, {3.713516933028019*^9, 
   3.7135169660016108`*^9}, {3.713517017669434*^9, 3.713517018982033*^9}, {
   3.713517263386682*^9, 3.71351726667832*^9}, {3.7135173002826567`*^9, 
   3.71351738309219*^9}, {3.713517437385408*^9, 3.713517448431707*^9}, 
   3.71351751120065*^9, {3.713519165139821*^9, 3.71351916784344*^9}, {
   3.713586548928996*^9, 3.7135866361444187`*^9}, 3.713586704798615*^9, {
   3.713586788881996*^9, 3.713586820426944*^9}, {3.713587867817526*^9, 
   3.713587888031878*^9}, 3.7135879275442047`*^9, {3.71358837140742*^9, 
   3.713588406943164*^9}, {3.71358911226116*^9, 3.713589138698991*^9}, {
   3.7135892493929453`*^9, 3.713589255479849*^9}, {3.713589419908753*^9, 
   3.7135894361407757`*^9}, {3.713591206266412*^9, 3.713591262265044*^9}, {
   3.713591311703704*^9, 3.713591312355399*^9}, {3.713613028472899*^9, 
   3.713613169102304*^9}, {3.713613243701432*^9, 3.713613259482008*^9}, {
   3.7136134658455133`*^9, 3.71361347101232*^9}, {3.713613506269532*^9, 
   3.7136135334279203`*^9}, {3.713613827277714*^9, 3.713613866139351*^9}, {
   3.713614136073141*^9, 3.713614177159155*^9}, {3.713614258661078*^9, 
   3.713614274994151*^9}, {3.713614316339431*^9, 3.713614326119635*^9}, {
   3.71361439324091*^9, 3.7136144643350143`*^9}, {3.7136145003750763`*^9, 
   3.713614503798221*^9}, {3.7136147414828243`*^9, 3.713614745759801*^9}, {
   3.713614995996611*^9, 3.713615019234371*^9}, {3.713615083913261*^9, 
   3.7136151064954023`*^9}, {3.7136153341477337`*^9, 
   3.7136153765300913`*^9}, {3.713615519671282*^9, 3.713615523343231*^9}, {
   3.7136155809755487`*^9, 3.713615584269882*^9}, {3.713615772226592*^9, 
   3.713615842588029*^9}, {3.7136158828091288`*^9, 3.7136159083334837`*^9}, {
   3.713615957094849*^9, 3.7136161148888617`*^9}, {3.713616180915184*^9, 
   3.71361619492793*^9}, {3.713616680016246*^9, 3.713616685772635*^9}, {
   3.713617209482376*^9, 3.7136172119303007`*^9}, {3.71361728481925*^9, 
   3.713617298053862*^9}, {3.7136178702702703`*^9, 3.7136180045372763`*^9}, {
   3.713618113832099*^9, 3.7136181174282923`*^9}, {3.713618212238364*^9, 
   3.713618213691772*^9}, {3.71361828705192*^9, 3.71361829257969*^9}, {
   3.7136201073484993`*^9, 3.7136203811004467`*^9}, {3.713620413388191*^9, 
   3.7136204702096043`*^9}, {3.71362050162772*^9, 3.713620526449724*^9}, {
   3.7136205606735992`*^9, 3.713620607502698*^9}, {3.7136206499531107`*^9, 
   3.7136206591678457`*^9}, {3.7136207070545177`*^9, 3.713620723219816*^9}, {
   3.7136207891556263`*^9, 3.713620813532362*^9}, {3.7136208515620737`*^9, 
   3.713620855544623*^9}, {3.713620902347073*^9, 3.713620974977251*^9}, {
   3.7136211597710648`*^9, 3.713621161459248*^9}, 3.713621207851184*^9, {
   3.713621339095902*^9, 3.713621372532834*^9}, {3.713621417981744*^9, 
   3.7136216461331244`*^9}, {3.713621695791157*^9, 3.713621709511959*^9}, {
   3.713621812094284*^9, 3.713621920223949*^9}, {3.713621957249928*^9, 
   3.713621961446721*^9}, {3.713622007048894*^9, 3.713622011159752*^9}, {
   3.713757819753793*^9, 3.7137578215678596`*^9}, {3.7137578864948807`*^9, 
   3.7137579084856043`*^9}, {3.7177408971545553`*^9, 3.717740915557084*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"638d2a72-b58f-4a7d-9b57-119c87ec7011"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"075394b5-4d49-4717-b6fd-d16f1b704e2c"]
}, Closed]],

Cell[CellGroupData[{

Cell["MergeLogs", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, 3.667818770448368*^9, {3.685944630313244*^9, 
   3.6859446311620817`*^9}},ExpressionUUID->"9d33350d-47b1-461d-8fba-\
ccef7867b6be"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"6745aaca-2a5c-4789-8e86-334e4fe504b2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MergeLogs", "::", "failed"}], "=", 
   "\"\<Failed to interpret input. No log files with the prefix \
\[LeftGuillemet]crysalispro_red\[RightGuillemet] were found in \
\[LeftGuillemet]`1`\[RightGuillemet].\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MergeLogs", "::", "files"}], "=", 
   "\"\<One or more log files were missing.\>\""}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.667811591227736*^9, 3.667818785593197*^9, 3.66792282527605*^9, {
   3.685944764419455*^9, 3.685944765279242*^9}, {3.712639959020924*^9, 
   3.712639959289299*^9}, {3.71264125203446*^9, 3.712641257472536*^9}, {
   3.7126413551997232`*^9, 3.7126413952217503`*^9}, {3.7126426295378447`*^9, 
   3.7126426428572206`*^9}, {3.7126461213488073`*^9, 3.712646124859322*^9}, {
   3.71264627163409*^9, 3.712646273688037*^9}, {3.71264732284953*^9, 
   3.712647338615885*^9}},ExpressionUUID->"927be788-9173-4973-8d48-\
731dcb8fee5f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"0ea00e5f-03c5-41c4-b110-bc29f235d719"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MergeLogs", "[", 
   RowBox[{
    RowBox[{"input_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"StringQ", "[", "#", "]"}], "||", 
        RowBox[{"AllTrue", "[", 
         RowBox[{"#", ",", "StringQ"}], "]"}]}], "&"}], ")"}]}], ",", 
    RowBox[{"out_:", "\"\< \>\""}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "logs", ",", "sorted", ",", "imported", ",", "joined", ",", "output", 
      ",", "name", ",", "file"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"--", "-"}], "*", " ", "Processing", " ", "input", " ", "*", 
      RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"A", ".", " ", "Already"}], " ", "merged", " ", "log", " ", 
      "given"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Quiet", "@", 
      RowBox[{"If", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"StringTake", "[", 
          RowBox[{"input", ",", "27"}], "]"}], "\[Equal]", 
         "\"\<Your current setup file is:\>\""}], ",", "\[IndentingNewLine]", 
        
        RowBox[{"Return", "@", "input"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"B", ".", " ", "Project"}], " ", "or", " ", "log", " ", 
       "directory", " ", "given"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Quiet", "@", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"DirectoryQ", "@", "input"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"logs", "=", 
          RowBox[{"FileNames", "[", 
           RowBox[{"\"\<crysalispro_red*\>\"", ",", "input", ",", "3"}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Goto", "[", "\"\<InputCheck\>\"", "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"C", ".", " ", "Single"}], " ", "log", " ", "file", " ", 
       "given"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"TrueQ", "[", 
        RowBox[{
         RowBox[{"FileFormat", "[", "input", "]"}], "\[Equal]", 
         "\"\<Text\>\""}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Return", "@", 
        RowBox[{"Import", "[", 
         RowBox[{"input", ",", "\"\<String\>\""}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"D", ".", " ", "Log"}], " ", "files", " ", "given", " ", "as", 
       " ", "a", " ", "list", " ", "of", " ", "paths"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ListQ", "@", "input"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Check", " ", "file", " ", "existence"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"AllTrue", "[", 
            RowBox[{"input", ",", "FileExistsQ"}], "]"}]}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{"MergeLogs", "::", "files"}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"logs", "=", "input"}]}]}], "]"}], ";", "\[IndentingNewLine]",
      "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Check", " ", "input"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"Label", "[", "\"\<InputCheck\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"logs", "\[Equal]", 
         RowBox[{"{", "}"}]}], "||", 
        RowBox[{"!", 
         RowBox[{"ValueQ", "@", "logs"}]}]}], ",", "\[IndentingNewLine]", 
       "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"MergeLogs", "::", "failed"}], ",", "input"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Special", " ", 
       RowBox[{"case", ":", " ", 
        RowBox[{
        "Only", " ", "one", " ", "matching", " ", "log", " ", "file"}]}]}], 
      " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "logs", "]"}], "\[Equal]", "1"}], ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"joined", "=", 
         RowBox[{"Import", "[", 
          RowBox[{
           RowBox[{"First", "@", "logs"}], ",", "\"\<Data\>\""}], "]"}]}], 
        ";", "\[IndentingNewLine]", "\t\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Depth", "[", "joined", "]"}], ">", "2"}], ",", 
          RowBox[{"joined", "=", 
           RowBox[{"Flatten", "@", "joined"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"Goto", "[", "\"\<MergingDone\>\"", "]"}]}]}], 
      "\[IndentingNewLine]", "\t", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Sorting", " ", "chronologically", " ", 
       "and", " ", "merging", " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"sorted", "=", 
      RowBox[{"SortBy", "[", 
       RowBox[{"logs", ",", 
        RowBox[{
         RowBox[{"UnixTime", "@", 
          RowBox[{"FileDate", "[", "#", "]"}]}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"imported", "=", 
      RowBox[{"Map", "[", 
       RowBox[{"Flatten", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Import", "[", 
           RowBox[{"#", ",", "\"\<Data\>\""}], "]"}], "&"}], "/@", 
         "sorted"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"joined", "=", 
      RowBox[{"imported", "/.", 
       RowBox[{
        RowBox[{"x_", "/;", 
         RowBox[{
          RowBox[{"Depth", "[", "x", "]"}], ">", "2"}]}], "\[RuleDelayed]", 
        RowBox[{"Flatten", "[", "x", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Returning", " ", "merged", " ", "log", 
       " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"Label", "[", "\"\<MergingDone\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"A", ".", " ", "Exporting"}], " ", "to", " ", "output", " ", 
        "directory"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"Quiet", "@", 
        RowBox[{"AllTrue", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"input", ",", 
            RowBox[{"ToString", "@", "out"}]}], "}"}], ",", "DirectoryQ"}], 
         "]"}]}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"name", "=", 
         RowBox[{
          RowBox[{"FileNameTake", "[", 
           RowBox[{"input", ",", 
            RowBox[{"{", 
             RowBox[{"-", "2"}], "}"}]}], "]"}], "<>", "\"\<_log.txt\>\""}]}],
         ";", "\[IndentingNewLine]", "\t\t", 
        RowBox[{"Export", "[", 
         RowBox[{
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{"out", ",", "name"}], "}"}], "]"}], ",", "joined"}], 
         "]"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"B", ".", " ", "Returning"}], " ", "merged", " ", "log"}], 
        " ", "*)"}], "\[IndentingNewLine]", "\t", "True", ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"output", "=", 
         RowBox[{"ToString", "/@", "joined"}]}], ";", "\[IndentingNewLine]", 
        "\t\t", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Export", " ", "and", " ", "import", " ", "for", " ", "correct", " ",
           "formatting"}], " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
        RowBox[{"file", "=", 
         RowBox[{"FileNameJoin", "[", 
          RowBox[{"{", 
           RowBox[{"$TemporaryDirectory", ",", "\"\<temp.txt\>\""}], "}"}], 
          "]"}]}], ";", "\[IndentingNewLine]", "\t\t", 
        RowBox[{"Export", "[", 
         RowBox[{"file", ",", "output"}], "]"}], ";", "\[IndentingNewLine]", 
        "\t\t", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", "\"\<String\>\""}], "]"}]}]}], 
      "\[IndentingNewLine]", "\t", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, 3.6678187804252996`*^9, {3.667914236945704*^9, 
   3.6679143285922613`*^9}, {3.6679225871709967`*^9, 3.667922617944098*^9}, {
   3.667922762030367*^9, 3.667922832155384*^9}, {3.667924619580389*^9, 
   3.667924621540043*^9}, {3.669556409378379*^9, 3.669556409721177*^9}, {
   3.674595330792635*^9, 3.674595335064242*^9}, {3.674596922722081*^9, 
   3.6745969236420517`*^9}, 3.674597782774687*^9, 3.674597913131309*^9, {
   3.674597951393291*^9, 3.674597980002778*^9}, {3.674598016648612*^9, 
   3.6745980930859833`*^9}, 3.67459817130089*^9, {3.6745982016044073`*^9, 
   3.674598228594613*^9}, {3.685876198759145*^9, 3.6858761989090347`*^9}, {
   3.6859447352677507`*^9, 3.685944738860939*^9}, {3.685945047525332*^9, 
   3.6859450602222958`*^9}, {3.685945151707117*^9, 3.685945239776497*^9}, {
   3.685945309792897*^9, 3.685945314249278*^9}, {3.6859453950851307`*^9, 
   3.685945409800962*^9}, {3.685945459892754*^9, 3.685945526695649*^9}, {
   3.6859455887011213`*^9, 3.6859455888440037`*^9}, {3.685945620191126*^9, 
   3.685945639869965*^9}, {3.6859457670160522`*^9, 3.68594581333556*^9}, {
   3.685945844409431*^9, 3.685945848541841*^9}, {3.7126397763097067`*^9, 
   3.712639798874113*^9}, {3.712639923831069*^9, 3.7126399271352243`*^9}, {
   3.712639995517703*^9, 3.712639995741643*^9}, {3.712640079300881*^9, 
   3.7126400795076113`*^9}, {3.7126407836697598`*^9, 3.712640798220117*^9}, {
   3.71264083565385*^9, 3.712640850213189*^9}, {3.712641040712243*^9, 
   3.71264104467061*^9}, {3.712641085983047*^9, 3.712641163652363*^9}, {
   3.712641213220591*^9, 3.712641233715104*^9}, {3.712641399480689*^9, 
   3.71264141728011*^9}, {3.712641588724821*^9, 3.712641700761346*^9}, {
   3.712642620557871*^9, 3.712642653003079*^9}, {3.712642872407312*^9, 
   3.7126428912536917`*^9}, {3.712643935918606*^9, 3.712643950237338*^9}, {
   3.712644043213313*^9, 3.7126440438155622`*^9}, {3.712644078219646*^9, 
   3.712644086363275*^9}, {3.712644373477325*^9, 3.712644418956834*^9}, {
   3.712644471538918*^9, 3.712644681597015*^9}, {3.712645316568478*^9, 
   3.712645318670971*^9}, {3.712646033976853*^9, 3.712646038015174*^9}, {
   3.7126461326298037`*^9, 3.712646133996862*^9}, {3.712646292059218*^9, 
   3.712646304737474*^9}, {3.712646348811199*^9, 3.712646352225185*^9}, {
   3.7126467051384773`*^9, 3.712646706815776*^9}, {3.712646753016305*^9, 
   3.712646755061678*^9}, {3.712646791368539*^9, 3.712646799877905*^9}, 
   3.712646864350336*^9, {3.712646937692761*^9, 3.712647128616267*^9}, {
   3.712647176223422*^9, 3.712647179981093*^9}, {3.7126472179747667`*^9, 
   3.7126473172420263`*^9}, {3.712647357370229*^9, 3.712647387144503*^9}, {
   3.712647494095216*^9, 3.712647494245845*^9}, {3.712647537247559*^9, 
   3.7126475430373697`*^9}, {3.712647574029471*^9, 3.712647613755066*^9}, {
   3.712647649868638*^9, 3.71264767056256*^9}, 3.71264793780542*^9, {
   3.7126480083793507`*^9, 3.712648009835347*^9}, {3.712648797563335*^9, 
   3.712648814184557*^9}, {3.712648854880533*^9, 3.7126488595191097`*^9}, {
   3.712649076532634*^9, 3.712649076731003*^9}, {3.713687341011962*^9, 
   3.713687391108676*^9}, {3.7136874988963633`*^9, 3.713687675011414*^9}, {
   3.713687802017467*^9, 3.7136878467191687`*^9}, {3.7136879550375357`*^9, 
   3.7136880624685*^9}, {3.71368812284603*^9, 3.713688132840229*^9}, 
   3.713688185793482*^9, {3.713688281799802*^9, 3.713688308786852*^9}, {
   3.713688600664522*^9, 3.713688821361224*^9}, {3.713688854281848*^9, 
   3.713688892111027*^9}, {3.713688933910858*^9, 3.7136890250904827`*^9}, {
   3.718432663381671*^9, 3.718432665671525*^9}, {3.7184327201814632`*^9, 
   3.71843274251434*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"cc51c18b-a55f-4500-ad28-b5397e609971"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"753b6640-683f-4d8b-b37e-29314f731568"]
}, Closed]],

Cell[CellGroupData[{

Cell["MonitorIni", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, 
   3.6678184015847597`*^9},ExpressionUUID->"b94621d0-6abe-4017-88a4-\
e922b74f41c2"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"c4ac8ec7-b29a-47a0-a116-51e935419fc9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MonitorIni", "::", "InvInput"}], "=", 
   "\"\<The length og the custom input does not match that of the \
\!\(\*StyleBox[\".\", \"Program\"]\)\!\(\*StyleBox[\"ini\", \"Program\"]\) \
file (or invalid range).\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MonitorIni", "::", "InvFlux"}], "=", 
   "\"\<The flux file does not match the (length) of data.\>\""}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.667811591227736*^9, 
  3.667818408776988*^9},ExpressionUUID->"23863b24-6390-47ab-8f7a-\
d06e0ff5d71e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"efc7281b-ee92-4798-9e85-ece211e89c35"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MonitorIni", "[", 
   RowBox[{
    RowBox[{"file_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"FileExtension", "[", "#", "]"}], "\[Equal]", "\"\<ini\>\""}],
        "&"}], ")"}]}], ",", "input_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "flux", ",", "Flux", ",", "linFrom", ",", "linTo", ",", "method", ",", 
      "import", ",", "end", ",", "prefix", ",", "L", ",", "seq", ",", 
      "newvalues", ",", "i", ",", "newdata", ",", "filename"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Basic", " ", "operations"}], " ", "*)"}], "\[IndentingNewLine]",
     "\t", 
    RowBox[{
     RowBox[{"import", "=", 
      RowBox[{"Check", "[", 
       RowBox[{
        RowBox[{"Import", "@", "file"}], ",", 
        RowBox[{"Abort", "[", "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"end", "=", 
      RowBox[{"StringExtract", "[", 
       RowBox[{
        RowBox[{"import", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"\"\<_\>\"", "\[Rule]", 
         RowBox[{"-", "1"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"prefix", "=", 
      RowBox[{"StringTrim", "[", 
       RowBox[{
        RowBox[{"import", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", "end"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"L", "=", 
      RowBox[{
       RowBox[{"Length", "@", "import"}], "-", "1"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"seq", "=", 
      RowBox[{"ToString", "/@", 
       RowBox[{"Range", "@", "L"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Checking", " ", "if", " ", "input", " ", "is", " ", "a", " ", "flux", 
       " ", "file"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ToString", "@", 
         RowBox[{"Head", "[", "input", "]"}]}], "\[Equal]", 
        "\"\<String\>\""}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"flux", "=", 
         RowBox[{"Check", "[", 
          RowBox[{
           RowBox[{"Import", "[", 
            RowBox[{"input", ",", "\"\<Data\>\""}], "]"}], ",", 
           RowBox[{"Abort", "[", "]"}]}], "]"}]}], ";", "\[IndentingNewLine]",
         "\t\t", 
        RowBox[{"Flux", "=", 
         RowBox[{"Rest", "@", "flux"}]}], ";", "\[IndentingNewLine]", "\t\t", 
        
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"First", "[", "flux", "]"}], "\[Equal]", 
           RowBox[{"{", "\"\<Flux\>\"", "}"}]}], ",", "\[IndentingNewLine]", 
          "\t\t", 
          RowBox[{
           RowBox[{"newvalues", "=", 
            RowBox[{"ToString", "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Flatten", "[", "Flux", "]"}], "/", 
               RowBox[{"N", "[", 
                RowBox[{"Max", "[", "Flux", "]"}], "]"}]}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", "\t\t", 
           RowBox[{"(*", " ", 
            RowBox[{
            "Checking", " ", "if", " ", "the", " ", "flux", " ", "file", " ", 
             "is", " ", "correct"}], " ", "*)"}], "\[IndentingNewLine]", 
           "\t\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", "newvalues"}], "\[NotEqual]", "L"}], ",", 
             RowBox[{
              RowBox[{"Message", "[", 
               RowBox[{"MonitorIni", "::", "InvFlux"}], "]"}], ";", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Goto", "[", "\"\<ToNewData\>\"", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "\t\t", "]"}]}]}], "\[IndentingNewLine]", 
      "\t", "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Checking", " ", "input", " ", "for", " ", "method"}], " ", 
      "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"method", "=", "\"\<LinearDecay\>\""}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", 
         RowBox[{"Flatten", "@", "input"}]}], "\[Equal]", "2"}], ",", 
       RowBox[{
        RowBox[{"linFrom", "=", 
         RowBox[{"input", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", 
        RowBox[{"linTo", "=", 
         RowBox[{"input", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       "\t", 
       RowBox[{"method", "=", "\"\<CustomInput\>\""}]}], 
      "\[IndentingNewLine]", "\t", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Writing", " ", "new", " ", "data"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"method", "\[Equal]", "\"\<CustomInput\>\""}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"newvalues", "=", 
         RowBox[{"ToString", "/@", "input"}]}], ";", "\[IndentingNewLine]", 
        "\t\t", 
        RowBox[{"(*", " ", 
         RowBox[{"Checking", " ", "the", " ", "custom", " ", "input"}], " ", 
         "*)"}], "\[IndentingNewLine]", "\t\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "@", "newvalues"}], "\[NotEqual]", "L"}], ",", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{"MonitorIni", "::", "InvInput"}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"newvalues", "=", 
        RowBox[{"ToString", "/@", 
         RowBox[{"Reverse", "@", 
          RowBox[{"Check", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{"i", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "linTo", ",", "linFrom", ",", 
                RowBox[{"N", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"linFrom", "-", "linTo"}], ")"}], "/", 
                  RowBox[{"(", 
                   RowBox[{"L", "-", "1"}], ")"}]}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"Abort", "[", "]"}]}], "]"}]}]}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t", "\[IndentingNewLine]", "\t", 
     RowBox[{"Label", "[", "\"\<ToNewData\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"newdata", "=", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"prefix", "<>", "#1", "<>", "\"\<.img=\>\"", "<>", "#2"}], 
         "&"}], ",", 
        RowBox[{"{", 
         RowBox[{"seq", ",", "newvalues"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"PrependTo", "[", 
      RowBox[{"newdata", ",", "\"\<[Monitor]\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Writing", " ", "new", " ", "file"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"filename", "=", 
      RowBox[{"StringDrop", "[", 
       RowBox[{"file", ",", 
        RowBox[{"-", "4"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"filename", "<>", "\"\<_new\>\"", "<>", "\"\<.ini\>\""}], ",", 
       "newdata", ",", "\"\<Table\>\""}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, 3.667818417586022*^9, {3.713776593189336*^9, 
   3.71377659553338*^9}, {3.713776860849901*^9, 3.7137768669605627`*^9}, {
   3.713776904401009*^9, 3.713776914127028*^9}, {3.7137769733727493`*^9, 
   3.713776996197693*^9}, {3.713777056188547*^9, 3.713777085817994*^9}, {
   3.713777148209811*^9, 3.713777150296506*^9}, {3.7137786545976257`*^9, 
   3.713778662947815*^9}, {3.713779115098048*^9, 3.71377914280836*^9}, {
   3.713779308534072*^9, 3.713779311801156*^9}, {3.713779374108143*^9, 
   3.713779381044965*^9}, {3.7137806625823307`*^9, 3.713780666756604*^9}, {
   3.713780727077208*^9, 3.713780727605567*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"886b4b1e-4367-460b-94fc-7c0b5d8f9797"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"6e25b713-5087-4f31-80a3-aae947207983"]
}, Closed]],

Cell[CellGroupData[{

Cell["NonlinearLeastSquares", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, 3.667900125753806*^9, {3.684646660758275*^9, 
   3.684646660811885*^9}, {3.684679409191053*^9, 3.684679411222722*^9}, {
   3.6846811176191063`*^9, 3.684681119497213*^9}, {3.6846813101581917`*^9, 
   3.6846813119644547`*^9}, 
   3.687761445243544*^9},ExpressionUUID->"40a83651-223f-4c00-8dba-\
5817bf6e2b8d"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"cacd8f66-e512-47e5-bbad-6cc1a1da1a2a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"NonlinearLeastSquares", "::", "check"}], "=", 
   "\"\<\[LeftGuillemet]`1`\[RightGuillemet] is not a recognised check \
method.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"NonlinearLeastSquares", "::", "stop"}], "=", 
    "\"\<Procedure stopped at iteration `1`.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "@", "NonlinearLeastSquares"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<ConvergenceCheck\>\"", "\[Rule]", "\"\<Shift\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<ConvergenceLimit\>\"", "\[Rule]", "0.0001"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<IterationStop\>\"", "\[Rule]", "10"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Iterations\>\"", "\[Rule]", "False"}]}], 
    "\[IndentingNewLine]", "}"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.684681427747033*^9, 3.68468144428977*^9}, {
   3.684681710622183*^9, 3.6846817431468554`*^9}, {3.687761446820731*^9, 
   3.687761502760914*^9}, 3.687761926389079*^9, {3.68776236079217*^9, 
   3.687762389067876*^9}, {3.687762697699806*^9, 3.687762706247756*^9}, {
   3.687762756949634*^9, 3.687762809748589*^9}, {3.687762960159795*^9, 
   3.687762975932385*^9}, 3.687766642526452*^9, {3.687775566640523*^9, 
   3.687775587435358*^9}, {3.6877756191282797`*^9, 3.687775619322447*^9}},
 Background->GrayLevel[
  0.85],ExpressionUUID->"31cb6be3-296d-4b79-85af-33ae5e622e0f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"189e71a9-a784-427e-81aa-3fb2ebfa6d87"],

Cell[BoxData[
 RowBox[{
  RowBox[{"NonlinearLeastSquares", "[", 
   RowBox[{"f_Symbol", ",", "data_List", ",", "\[Beta]_List", ",", 
    RowBox[{"OptionsPattern", "@", "NonlinearLeastSquares"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "X", ",", "m", ",", "v", ",", "n", ",", "\[IndentingNewLine]", "dummyV", 
      ",", "dummy\[Beta]", ",", "\[IndentingNewLine]", "p", ",", "i", ",", 
      "\[CapitalDelta]", ",", "R", ",", "\[IndentingNewLine]", "c", ",", "l", 
      ",", "stop", ",", "test", ",", "\[IndentingNewLine]", "j", ",", 
      "subst\[Beta]", ",", "substV", ",", "J", ",", "\[IndentingNewLine]", 
      "S", ",", "S0"}], "}"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"Number", " ", "of", " ", "data", " ", "variables"}], ",", " ", 
      
      RowBox[{
      "unknown", " ", "parameters", " ", "and", " ", "data", " ", 
       "points"}]}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"X", "=", 
      RowBox[{"Transpose", "@", "data"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"m", "=", 
      RowBox[{"Length", "@", "data"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"v", "=", 
      RowBox[{"Length", "@", "X"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n", "=", 
      RowBox[{"Length", "@", "\[Beta]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Dummy", " ", "variables"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"dummyV", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Unique", "[", "\"\<dummyV\>\"", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "v"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dummy\[Beta]", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Unique", "[", "\"\<dummy\[Beta]\>\"", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Initial", " ", "setting", " ", "of", " ", "parameters", " ", "and", 
       " ", "partial", " ", "derivatives"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"p", "=", "\[Beta]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"R", "=", 
      RowBox[{"{", "0", "}"}]}], ";", 
     RowBox[{"S", "=", "1000"}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{"Initial", " ", "sum", " ", "of", " ", "squares"}], " ", "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"\[CapitalDelta]", "=", "1000"}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{"Inital", " ", "shift", " ", "in", " ", "parameters"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"i", "=", "0"}], ";", 
     RowBox[{"(*", " ", 
      RowBox[{"Iteration", " ", "count"}], " ", "*)"}], "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Convergence", " ", "check", " ", "method", " ", "and", " ", "limit"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"c", "=", 
      RowBox[{"OptionValue", "[", "\"\<ConvergenceCheck\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"l", "=", 
      RowBox[{"OptionValue", "[", "\"\<ConvergenceLimit\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"stop", "=", 
      RowBox[{"OptionValue", "[", "\"\<IterationStop\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"c", "\[Equal]", "\"\<Shift\>\""}], ",", 
       RowBox[{"test", ":=", "\[CapitalDelta]"}], ",", "\[IndentingNewLine]", 
       
       RowBox[{"c", "\[Equal]", "\"\<Squares\>\""}], ",", 
       RowBox[{"test", ":=", "S"}], ",", "\[IndentingNewLine]", "True", ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"NonlinearLeastSquares", "::", "check"}], ",", "c"}], "]"}],
         ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"*", " ", "Iteration", " ", "start"}], " ", "**)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{"test", ">", "l"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"i", "++"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"j", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"D", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"f", "[", 
              RowBox[{"dummyV", ",", 
               RowBox[{"dummy\[Beta]", "/.", 
                RowBox[{"List", "\[Rule]", "Sequence"}]}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"dummy\[Beta]", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Substituting", " ", "in", " ", "parameter", " ", "values"}],
          " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"subst\[Beta]", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"dummy\[Beta]", "\[Rule]", "p"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"j", "=", 
         RowBox[{"j", "/.", "subst\[Beta]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Preparing", " ", "list", " ", "of", " ", "data", " ", "points"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"substV", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{"dummyV", "\[Rule]", 
             RowBox[{"X", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "i"}], "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "m"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "Jacobian", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"J", "=", 
         RowBox[{"N", "@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"j", "/.", 
             RowBox[{"substV", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "m"}], "}"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Sum", " ", "of", " ", "squares", " ", 
          RowBox[{"(", 
           RowBox[{
           "and", " ", "difference", " ", "from", " ", "last", " ", 
            "iteration"}], ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"S0", "=", 
         RowBox[{"Total", "[", 
          RowBox[{"R", "^", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"R", "=", 
         RowBox[{"N", "@", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"f", "[", 
             RowBox[{
              RowBox[{"X", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "i"}], "]"}], "]"}], ",", 
              RowBox[{"p", "/.", 
               RowBox[{"List", "\[Rule]", "Sequence"}]}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"i", ",", "m"}], "}"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"S", "=", 
         RowBox[{"Total", "[", 
          RowBox[{"R", "^", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"New", " ", "parameters"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"p", "=", 
         RowBox[{"p", "-", 
          RowBox[{
           RowBox[{"Inverse", "[", 
            RowBox[{
             RowBox[{"Transpose", "[", "J", "]"}], ".", "J"}], "]"}], ".", 
           RowBox[{"Transpose", "[", "J", "]"}], ".", "R"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"\[CapitalDelta]", "=", 
         RowBox[{"Abs", "[", 
          RowBox[{"S0", "-", "S"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Stop", "?"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"i", "\[Equal]", "stop"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"NonlinearLeastSquares", "::", "stop"}], ",", "i"}], 
            "]"}], ";", 
           RowBox[{"Break", "[", "]"}]}]}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<Iterations\>\"", "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"i", ",", "p"}], "}"}], ",", "p"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6877299705538063`*^9, 3.68773000320055*^9}, {
   3.6877300916315937`*^9, 3.6877300993355083`*^9}, {3.687730218420662*^9, 
   3.687730223475299*^9}, {3.687730302882559*^9, 3.687730342280218*^9}, {
   3.6877304230864973`*^9, 3.6877304594219503`*^9}, {3.687730576666823*^9, 
   3.687730592179576*^9}, 3.687730653305067*^9, {3.687730693897223*^9, 
   3.687730716311364*^9}, {3.687730835564534*^9, 3.6877308417323713`*^9}, {
   3.687731150484981*^9, 3.6877311872758827`*^9}, {3.687731262593848*^9, 
   3.687731269569866*^9}, 3.687754560721229*^9, {3.687754625245038*^9, 
   3.687754647436564*^9}, {3.687754830597731*^9, 3.6877549272317953`*^9}, {
   3.68775499009557*^9, 3.687754995460417*^9}, {3.687755050034011*^9, 
   3.687755075347661*^9}, {3.687755222867353*^9, 3.687755225420813*^9}, {
   3.6877553105338163`*^9, 3.687755332408998*^9}, {3.6877554031616383`*^9, 
   3.687755466785995*^9}, {3.6877556396342697`*^9, 3.687755668011639*^9}, {
   3.68775596856956*^9, 3.687756064446072*^9}, {3.687756140913396*^9, 
   3.68775615753561*^9}, {3.6877562842374487`*^9, 3.6877564113833857`*^9}, {
   3.687756450288632*^9, 3.687756458484619*^9}, {3.6877565303968782`*^9, 
   3.6877566353257427`*^9}, {3.687756670496087*^9, 3.68775667093337*^9}, {
   3.6877567210139*^9, 3.687756728991193*^9}, {3.687757043067391*^9, 
   3.687757172182516*^9}, {3.687757329481772*^9, 3.687757351653824*^9}, {
   3.687757472895069*^9, 3.687757477167718*^9}, {3.6877575241306963`*^9, 
   3.6877575656192703`*^9}, {3.687757624760798*^9, 3.6877576250208693`*^9}, {
   3.687757747169722*^9, 3.6877577945248537`*^9}, {3.687757824607378*^9, 
   3.687757906406055*^9}, {3.687757937222622*^9, 3.687758118086667*^9}, {
   3.687758185236473*^9, 3.687758186733927*^9}, {3.687758260018261*^9, 
   3.6877583185397987`*^9}, {3.6877585630545607`*^9, 3.687758564521287*^9}, {
   3.687758658977665*^9, 3.687758763158144*^9}, {3.687758800067567*^9, 
   3.68775880072235*^9}, {3.6877588346832857`*^9, 3.687759351187215*^9}, {
   3.687759390213161*^9, 3.6877595793632298`*^9}, {3.6877596354426126`*^9, 
   3.687759916271471*^9}, {3.6877600283114023`*^9, 3.687760049295339*^9}, {
   3.687760091029286*^9, 3.687760101209504*^9}, {3.687760147058825*^9, 
   3.687760170046665*^9}, {3.6877605607419577`*^9, 3.687760582960415*^9}, {
   3.6877606515704927`*^9, 3.687760666066464*^9}, {3.687760710144994*^9, 
   3.687760714886258*^9}, {3.687760746917014*^9, 3.687760792598665*^9}, {
   3.687760824887515*^9, 3.6877608616672907`*^9}, {3.6877609090005627`*^9, 
   3.6877609119436073`*^9}, {3.687760967227778*^9, 3.687760968780664*^9}, {
   3.687761170147029*^9, 3.687761183820777*^9}, {3.6877612175926313`*^9, 
   3.687761252846713*^9}, {3.687761320243919*^9, 3.687761412149925*^9}, {
   3.6877617343564587`*^9, 3.687761788403249*^9}, {3.687761823319521*^9, 
   3.687761923520043*^9}, {3.687761966723089*^9, 3.6877620367012463`*^9}, {
   3.687762073500799*^9, 3.687762080504332*^9}, {3.687762127722169*^9, 
   3.687762133043429*^9}, {3.687762197962512*^9, 3.6877622470184917`*^9}, {
   3.687762311936281*^9, 3.6877623443704243`*^9}, {3.687762397409442*^9, 
   3.687762410261115*^9}, {3.687762474086087*^9, 3.687762500787753*^9}, {
   3.687762611880907*^9, 3.687762662679175*^9}, {3.687762721076819*^9, 
   3.687762751345072*^9}, {3.6877628219456*^9, 3.6877628607798643`*^9}, {
   3.6877629829550543`*^9, 3.687762998000442*^9}, {3.6877681413368196`*^9, 
   3.687768152347498*^9}, {3.687768192649106*^9, 3.687768233921425*^9}, {
   3.687768264159709*^9, 3.687768536873348*^9}, {3.6877707864574013`*^9, 
   3.687771039267853*^9}, {3.687771069812886*^9, 3.687771197409918*^9}, {
   3.6877713175346127`*^9, 3.687771345093755*^9}, {3.687771542202924*^9, 
   3.687771551308329*^9}, 3.687771581473814*^9, {3.687771777800501*^9, 
   3.687771794268906*^9}, {3.6877718335278883`*^9, 3.6877718356566*^9}, {
   3.687771871528183*^9, 3.6877718835116*^9}, {3.687771931984746*^9, 
   3.6877719823496017`*^9}, {3.6877751977629337`*^9, 3.687775374753765*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"d22aa2e1-6f53-4d31-aeeb-8a976dd994d0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"1c351972-761d-478d-ae2a-8da7c68ef326"]
}, Closed]],

Cell[CellGroupData[{

Cell["LeastSquaresFit", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, 3.667900125753806*^9, {3.684646660758275*^9, 
   3.684646660811885*^9}, {3.684679409191053*^9, 3.684679411222722*^9}, {
   3.6846811176191063`*^9, 3.684681119497213*^9}, {3.6846813101581917`*^9, 
   3.6846813119644547`*^9}, {3.6846922186695633`*^9, 3.68469222103603*^9}, 
   3.6847357008667507`*^9},ExpressionUUID->"c080b693-1415-4e12-ad21-\
98ca6f310069"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"ee3d08c0-9367-4d02-a509-224629541f83"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"LeastSquaresFit", "::", "numeric"}], "=", 
   "\"\<Numeric input only.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LeastSquaresFit", "::", "invalid"}], "=", 
   "\"\<Invalid input form.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LeastSquaresFit", "::", "data"}], "=", 
   "\"\<More data required.\>\""}], ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"6c6d91fb-134f-478a-b97e-1ee4ef8c17dc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"07ae68d6-d917-491a-88fc-8f9453463699"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LeastSquaresFit", "[", "data_List", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "n", ",", "x", ",", "y", ",", "X", ",", "Y", ",", "\[IndentingNewLine]", 
      "sumx2", ",", "sumy2", ",", "sumxy", ",", "s2y", ",", 
      "\[IndentingNewLine]", "a", ",", "b", ",", "\[Delta]a", ",", 
      "\[Delta]b", ",", "r", ",", "\[IndentingNewLine]", "\[Delta]y", ",", 
      "\[CapitalDelta]", ",", "w", ",", "sumx", ",", "sumy", ",", "sumw", ",",
       "wsumx2", ",", "wsumy2", ",", "wsumxy"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"--", "-"}], "*", " ", "Check", " ", "input", " ", "*", 
      RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"AllTrue", "[", 
         RowBox[{
          RowBox[{"Flatten", "@", "data"}], ",", "NumericQ"}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"LeastSquaresFit", "::", "numeric"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"MatchQ", "[", 
        RowBox[{
         RowBox[{"Dimensions", "[", "data", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"_", ",", "2"}], "}"}]}], "]"}], ",", 
       RowBox[{"Goto", "[", "\"\<WithoutWeights\>\"", "]"}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"MatchQ", "[", 
        RowBox[{
         RowBox[{"Dimensions", "[", "data", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"_", ",", "3"}], "}"}]}], "]"}], ",", 
       RowBox[{"Goto", "[", "\"\<WithWeights\>\"", "]"}], ",", 
       "\[IndentingNewLine]", "\t", "True", ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"LeastSquaresFit", "::", "invalid"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", "data"}], "<", "3"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"LeastSquaresFit", "::", "data"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Data", " ", "without", " ", "weights", 
       " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"Label", "[", "\"\<WithoutWeights\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Useful", " ", "variables"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"n", "=", 
      RowBox[{"Length", "@", "data"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "y"}], "}"}], "=", 
      RowBox[{"Transpose", "@", "data"}]}], ";", "\[IndentingNewLine]", "\t", 
     
     RowBox[{
      RowBox[{"{", 
       RowBox[{"X", ",", "Y"}], "}"}], "=", 
      RowBox[{"Mean", "/@", 
       RowBox[{"{", 
        RowBox[{"x", ",", "y"}], "}"}]}]}], ";", "\[IndentingNewLine]", "\t", 
     
     RowBox[{"sumx2", "=", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"x", "-", "X"}], ")"}], "^", "2"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"sumy2", "=", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"y", "-", "Y"}], ")"}], "^", "2"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"sumxy", "=", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"x", "-", "X"}], ")"}], "*", 
        RowBox[{"(", 
         RowBox[{"y", "-", "Y"}], ")"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"s2y", "=", 
      RowBox[{
       RowBox[{"1", "/", 
        RowBox[{"(", 
         RowBox[{"n", "-", "2"}], ")"}]}], "*", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"sumx2", "*", "sumy2"}], "-", 
          RowBox[{"sumxy", "^", "2"}]}], ")"}], "/", "sumx2"}]}]}], ";", "\t",
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Coefficients", " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"b", "=", 
      RowBox[{"sumxy", "/", "sumx2"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"a", "=", 
      RowBox[{"Y", "-", 
       RowBox[{"b", "*", "X"}]}]}], ";", "\t", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Uncertainties", " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"\[Delta]a", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"s2y", "*", 
        RowBox[{
         RowBox[{"Total", "[", 
          RowBox[{"x", "^", "2"}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"n", "*", "sumx2"}], ")"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"\[Delta]b", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"s2y", "/", "sumx2"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Correlation", " ", "coefficient"}], " ", "*)"}], "\t", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"sumx2", "\[Equal]", "0"}], "||", 
        RowBox[{"sumy2", "\[Equal]", "0"}]}], ",", "\[IndentingNewLine]", 
       "\t", 
       RowBox[{"r", "=", "1"}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"r", "=", 
        RowBox[{"sumxy", "/", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"sumx2", "*", "sumy2"}], "]"}]}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"a", ",", "\[Delta]a"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"b", ",", "\[Delta]b"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"r", ",", "s2y"}], "}"}]}], "}"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Data", " ", "with", " ", "weights", 
       " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"Label", "[", "\"\<WithWeights\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Useful", " ", "variables"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"n", "=", 
      RowBox[{"Length", "@", "data"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "y", ",", "\[Delta]y"}], "}"}], "=", 
      RowBox[{"N", "@", 
       RowBox[{"Transpose", "@", "data"}]}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"w", "=", 
      RowBox[{"1", "/", 
       RowBox[{"\[Delta]y", "^", "2"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Sum", " ", "of", " ", "weighted", " ", "lists", " ", "and", " ", 
       "weighted", " ", "means"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"sumx", ",", "sumy", ",", "sumw"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"w", ".", "x"}], ",", 
        RowBox[{"w", ".", "y"}], ",", 
        RowBox[{"Total", "[", "w", "]"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"X", ",", "Y"}], "}"}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sumx", ",", "sumy"}], "}"}], "/", "sumw"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"sumx2", ",", "sumy2", ",", "sumxy"}], "}"}], "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"w", ".", 
         RowBox[{"x", "^", "2"}]}], ",", 
        RowBox[{"w", ".", 
         RowBox[{"y", "^", "2"}]}], ",", 
        RowBox[{"Total", "[", 
         RowBox[{"w", "*", "x", "*", "y"}], "]"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"\[CapitalDelta]", "=", 
      RowBox[{
       RowBox[{"sumw", "*", "sumx2"}], "-", 
       RowBox[{"sumx", "^", "2"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Coefficients", " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"a", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"sumx2", "*", "sumy"}], "-", 
         RowBox[{"sumx", "*", "sumxy"}]}], ")"}], "/", "\[CapitalDelta]"}]}], 
     ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"b", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"sumw", "*", "sumxy"}], "-", 
         RowBox[{"sumx", "*", "sumy"}]}], ")"}], "/", "\[CapitalDelta]"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Uncertainties", " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"wsumx2", "=", 
      RowBox[{"Total", "[", 
       RowBox[{"w", "*", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"x", "-", "X"}], ")"}], "^", "2"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"wsumy2", "=", 
      RowBox[{"Total", "[", 
       RowBox[{"w", "*", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"y", "-", "Y"}], ")"}], "^", "2"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"wsumxy", "=", 
      RowBox[{"Total", "[", 
       RowBox[{"w", "*", 
        RowBox[{"(", 
         RowBox[{"x", "-", "X"}], ")"}], "*", 
        RowBox[{"(", 
         RowBox[{"y", "-", "Y"}], ")"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"\[Delta]a", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"sumx2", "/", "\[CapitalDelta]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"\[Delta]b", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"sumw", "/", "\[CapitalDelta]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Correclation", " ", "coefficient"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"wsumx2", "\[Equal]", "0"}], "||", 
        RowBox[{"wsumy2", "\[Equal]", "0"}]}], ",", "\[IndentingNewLine]", 
       "\t", 
       RowBox[{"r", "=", "1"}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"r", "=", 
        RowBox[{"wsumxy", "/", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"wsumx2", "*", "wsumy2"}], "]"}]}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"a", ",", "\[Delta]a"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"b", ",", "\[Delta]b"}], "}"}], ",", 
        RowBox[{"{", "r", "}"}]}], "}"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, {3.684681126098569*^9, 3.68468113261707*^9}, {
   3.684681314799778*^9, 3.684681395619067*^9}, {3.684681505457395*^9, 
   3.684681556063126*^9}, {3.6846815878074408`*^9, 3.6846818093068333`*^9}, {
   3.684685030178719*^9, 3.684685100167528*^9}, {3.68468520231924*^9, 
   3.684685234012491*^9}, {3.684685281091477*^9, 3.684685439768339*^9}, {
   3.684685587884272*^9, 3.684685671506892*^9}, {3.684685805889974*^9, 
   3.684685908701192*^9}, {3.684685949581909*^9, 3.6846861238240957`*^9}, {
   3.684688760297517*^9, 3.684688760975606*^9}, {3.6846888319429092`*^9, 
   3.684688868964966*^9}, {3.684688936172331*^9, 3.6846889580267563`*^9}, {
   3.684689140823488*^9, 3.6846892517314787`*^9}, {3.6846893353940983`*^9, 
   3.684689347937306*^9}, {3.684689397904675*^9, 3.684689398176662*^9}, {
   3.6846894450874567`*^9, 3.6846895630529423`*^9}, {3.68468959606793*^9, 
   3.684689652778881*^9}, {3.684689724177442*^9, 3.684689740865003*^9}, 
   3.684689840439896*^9, 3.6846898903814*^9, {3.684690123408786*^9, 
   3.684690167350737*^9}, {3.684690205488257*^9, 3.6846902865736523`*^9}, {
   3.684690376428082*^9, 3.684690409930132*^9}, {3.684690573246892*^9, 
   3.6846905870395203`*^9}, {3.6846906279888163`*^9, 3.684690811367805*^9}, {
   3.684690904830155*^9, 3.6846909228530283`*^9}, {3.684691045330447*^9, 
   3.684691055954417*^9}, {3.6846910934271107`*^9, 3.6846911148174763`*^9}, {
   3.6846911666652813`*^9, 3.68469121004055*^9}, {3.684692475113056*^9, 
   3.684692487392627*^9}, {3.684692532685972*^9, 3.6846925396928*^9}, {
   3.684692602549025*^9, 3.6846926751139097`*^9}, {3.6846929982919903`*^9, 
   3.6846929987940893`*^9}, {3.6846930883602467`*^9, 3.68469311500976*^9}, {
   3.684729227741404*^9, 3.684729290329463*^9}, {3.684729359290189*^9, 
   3.6847294931064453`*^9}, {3.684729524042018*^9, 3.6847296383060007`*^9}, {
   3.6847300522980328`*^9, 3.684730074275227*^9}, {3.684730181500654*^9, 
   3.684730194809558*^9}, {3.684730716661162*^9, 3.684730724551757*^9}, {
   3.684731104330513*^9, 3.684731135721141*^9}, {3.6847313994066067`*^9, 
   3.6847315632974157`*^9}, {3.684731657154348*^9, 3.684731798358251*^9}, {
   3.684731970877541*^9, 3.684731993265665*^9}, {3.684732121078611*^9, 
   3.684732341492091*^9}, {3.684732413466104*^9, 3.684732452653655*^9}, {
   3.684732484165422*^9, 3.684732564028389*^9}, {3.684732646728675*^9, 
   3.6847326935623713`*^9}, {3.6847327484471827`*^9, 3.684732758900649*^9}, {
   3.6847329430709887`*^9, 3.684732946284733*^9}, {3.6847329941232853`*^9, 
   3.684733078517181*^9}, {3.684733192030521*^9, 3.684733237889316*^9}, {
   3.6847332775117807`*^9, 3.6847333140931797`*^9}, {3.684733406559223*^9, 
   3.684733409955249*^9}, {3.684733443614902*^9, 3.6847336646864023`*^9}, {
   3.684734398369718*^9, 3.684734400340604*^9}, {3.684735164347459*^9, 
   3.684735165245298*^9}, {3.684735733875525*^9, 3.6847357425609694`*^9}, {
   3.6847587424609003`*^9, 3.684758794330977*^9}, {3.716787954100358*^9, 
   3.716787973034396*^9}, {3.7167880197632627`*^9, 3.716788023977055*^9}, {
   3.716788300434854*^9, 3.716788430174656*^9}, {3.716788473965499*^9, 
   3.716788490325077*^9}, {3.716788525149611*^9, 3.716788626624771*^9}, {
   3.7167887156638727`*^9, 3.716788831459537*^9}, {3.716788862410268*^9, 
   3.716788935265624*^9}, {3.716788972593706*^9, 3.716788974881309*^9}, {
   3.716789005345083*^9, 3.716789047997787*^9}, {3.716789206874614*^9, 
   3.716789216321507*^9}, {3.716789248928537*^9, 3.716789332446575*^9}, {
   3.716789421390912*^9, 3.716789509523237*^9}, {3.7167895576519527`*^9, 
   3.716789559587049*^9}, {3.716789615562746*^9, 3.7167896256720543`*^9}, {
   3.71678978709198*^9, 3.7167897884045362`*^9}, {3.716789838812006*^9, 
   3.716789919082262*^9}, {3.7167900233453197`*^9, 3.71679004812057*^9}, {
   3.716790103198382*^9, 3.716790108663022*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"d09b283c-745c-4550-935c-17d2414fa3a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"a66a5896-63cc-496e-96fa-25efeb768265"]
}, Closed]],

Cell[CellGroupData[{

Cell["PeakTableInspection", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, {3.6678183871702337`*^9, 3.667818392882043*^9}, 
   3.679727589299858*^9, {3.713761079342855*^9, 
   3.713761081117041*^9}},ExpressionUUID->"a5381ce5-59b6-4b1c-86ed-\
5916e748fa74"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"fe565d70-3102-4bc2-ab05-790cf46f56cc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PeakTableInspection", "::", "cutoff"}], "=", 
   "\"\<The cutoff intensity is relative to the maximum intensity and must be \
a number between 0 and 1.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PeakTableInspection", "::", "width"}], "=", 
   "\"\<The group width must be a positive number.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PeakTableInspection", "::", "goniometer"}], "=", 
   "\"\<Invalid goniometer data in \
\[LeftGuillemet]`1`\[RightGuillemet].\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeakTableInspection", "::", "tab"}], "=", 
    "\"\<\[LeftGuillemet]`1`\[RightGuillemet] is an invalid \
\!\(\*StyleBox[\".\", \"Program\"]\)\!\(\*StyleBox[\"tab\", \"Program\"]\) \
file.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "@", "PeakTableInspection"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<Cutoff\>\"", "\[Rule]", "0.85"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<GroupWidth\>\"", "\[Rule]", "5"}]}], "\[IndentingNewLine]", 
    "}"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7137616795929832`*^9, 
  3.713761725888838*^9}},ExpressionUUID->"8ed0a971-3df3-4780-a433-\
b9020972b800"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PeakTableInspection", "[", 
   RowBox[{"set_", ",", 
    RowBox[{"OptionsPattern", "@", "PeakTableInspection"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "cutoff", ",", "width", ",", "\[IndentingNewLine]", "lim", ",", "top", 
      ",", "groups", ",", "newset", ",", "sort", ",", "\[Phi]max", ",", 
      "\[Phi]", ",", "j", ",", "keep"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Input", " ", "check"}], " ", "*)"}], "\[IndentingNewLine]", 
    "\t", 
    RowBox[{
     RowBox[{"cutoff", "=", 
      RowBox[{"OptionValue", "[", "\"\<Cutoff\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"0", "\[LessEqual]", "cutoff", "\[LessEqual]", "1"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"PeakTableInspection", "::", "cutoff"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\t", "\[IndentingNewLine]", "\t", 
     RowBox[{"width", "=", 
      RowBox[{"OptionValue", "[", "\"\<GroupWidth\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"!", 
         RowBox[{"NumericQ", "[", "width", "]"}]}], "||", 
        RowBox[{"Negative", "[", "width", "]"}]}], ",", "\[IndentingNewLine]",
        "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"PeakTableInspection", "::", "width"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Keeping", " ", "the", " ", "top", " ", "part", " ", "of", " ", "the", 
       " ", "registrations"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"lim", "=", 
      RowBox[{"Ceiling", "[", 
       RowBox[{"cutoff", "*", 
        RowBox[{"Max", "@", 
         RowBox[{"set", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "6"}], "]"}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"top", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{"set", ",", 
        RowBox[{"i_", "/;", 
         RowBox[{
          RowBox[{"i", "[", 
           RowBox[{"[", "6", "]"}], "]"}], "<", "lim"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Groping", " ", "registrated", " ", "reflections"}], " ", 
      "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"groups", "=", 
      RowBox[{"{", "}"}]}], ";", 
     RowBox[{"newset", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"top", "\[NotEqual]", 
          RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", "\t", 
         RowBox[{"(*", " ", 
          RowBox[{
          "Finding", " ", "the", " ", "value", " ", "of", " ", "\[Phi]", " ", 
           "at", " ", "maximum"}], " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
         RowBox[{
          RowBox[{"sort", "=", 
           RowBox[{"Sort", "[", 
            RowBox[{"top", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"#1", "[", 
                RowBox[{"[", "6", "]"}], "]"}], ">", 
               RowBox[{"#2", "[", 
                RowBox[{"[", "6", "]"}], "]"}]}], "&"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{"\[Phi]max", "=", 
           RowBox[{"sort", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "5"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Group", " ", "reflections", " ", "that", " ", "are", " ", 
            "within", " ", "5", "\[Degree]", " ", "of", " ", "\[Phi]max"}], 
           " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", "\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{"\[Phi]", "=", 
              RowBox[{"top", "[", 
               RowBox[{"[", 
                RowBox[{"j", ",", "5"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\t\t", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
               "IntervalMemberQ", "[", "\[IndentingNewLine]", "\t\t", 
                RowBox[{
                 RowBox[{"Interval", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\[Phi]max", "-", "#"}], ",", 
                    RowBox[{"\[Phi]max", "+", "#"}]}], "}"}], "&"}], "[", 
                   "width", "]"}], "]"}], ",", "\[Phi]"}], "]"}], ",", 
               "\[IndentingNewLine]", "\t\t", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"groups", ",", 
                 RowBox[{"top", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], "]"}]}], ",", 
            "\[IndentingNewLine]", "\t\t", 
            RowBox[{"{", 
             RowBox[{"j", ",", 
              RowBox[{"Length", "@", "top"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Clear", " ", "group", " ", "from", " ", "the", " ", "set", " ", 
            "and", " ", "repeat"}], " ", "*)"}], "\[IndentingNewLine]", 
          "\t\t", 
          RowBox[{"top", "=", 
           RowBox[{"Complement", "[", 
            RowBox[{"top", ",", "groups"}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"newset", ",", 
            RowBox[{"{", "groups", "}"}]}], "]"}], ";", "\[IndentingNewLine]",
           "\t\t", 
          RowBox[{"groups", "=", 
           RowBox[{"{", "}"}]}]}]}], "\[IndentingNewLine]", "\t", "]"}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"{", 
        RowBox[{"j", ",", 
         RowBox[{"Length", "@", "top"}]}], "}"}]}], "\[IndentingNewLine]", 
      "\t", "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Keeping", " ", "only", " ", "the", " ", "peak", " ", "from", " ", 
       "each", " ", "group"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"keep", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"TakeLargestBy", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"First", "@", 
             RowBox[{"Transpose", "@", "newset"}]}], ")"}], "[", 
           RowBox[{"[", "#", "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "6", "]"}], "]"}], "&"}], ",", "1"}], "]"}], "&"}], "/@", 
       RowBox[{"(", 
        RowBox[{"Range", "@", 
         RowBox[{"Length", "@", "newset"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"First", "@", 
        RowBox[{"Transpose", "@", "keep"}]}], ")"}], "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, 3.667818307063534*^9, {3.68690525820405*^9, 
   3.686905318950204*^9}, {3.6869053506805887`*^9, 3.6869053694385233`*^9}, {
   3.686908049556444*^9, 3.686908058799263*^9}, {3.686908139095263*^9, 
   3.686908217077656*^9}, {3.686908256966238*^9, 3.686908273989725*^9}, {
   3.6869083173044653`*^9, 3.686908363614129*^9}, {3.686908417831101*^9, 
   3.6869084240299263`*^9}, {3.713761726930049*^9, 3.7137617630415697`*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"977a2afe-c0ab-4804-9ddc-ed0525deb087"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PeakTableInspection", "[", 
   RowBox[{"goniometerfile_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"FileExtension", "[", "#", "]"}], "\[Equal]", "\"\<dat\>\""}], 
      "&"}], ")"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "import", ",", "data", ",", "gathered", ",", "multi", ",", 
      "\[IndentingNewLine]", "inspected", ",", "keepsingles", ",", "keep", 
      ",", "in", ",", "delete"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Check", " ", "input"}], " ", "*)"}], "\[IndentingNewLine]", 
    "\t", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"FileExistsQ", "@", "goniometerfile"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"PeakTableInspection", "::", "goniometer"}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"FileNameTake", "@", "goniometerfile"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Extracting", " ", "the", " ", "necessary", " ", "data"}], " ", 
      "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"import", "=", 
      RowBox[{"Check", "[", 
       RowBox[{
        RowBox[{"Import", "[", 
         RowBox[{"goniometerfile", ",", "\"\<Data\>\""}], "]"}], ",", 
        RowBox[{"Abort", "[", "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"data", "=", 
      RowBox[{"import", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2", ",", "3", ",", "4", ",", "8", ",", "10"}], 
          "}"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Gather", " ", 
       RowBox[{"by", " ", "'"}], 
       RowBox[{"hkl", "'"}], " ", "values"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"gathered", "=", 
      RowBox[{"GatherBy", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;", "4"}], "]"}], "]"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Delete", " ", "cases", " ", "with", " ", "only", " ", "one", " ", 
       "registration"}], " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
     RowBox[{"multi", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{"gathered", ",", 
        RowBox[{"L_", "/;", 
         RowBox[{
          RowBox[{"Length", "[", "L", "]"}], "\[Equal]", "1"}]}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Finding", " ", "which", " ", "registrations", " ", "to", " ", 
       "delete"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Analysed", " ", "*)"}], "\[IndentingNewLine]", "\t", 
     
     RowBox[{"inspected", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"PeakTableInspection", "/@", "multi"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Single", " ", "reflections"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"keepsingles", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{"gathered", ",", 
        RowBox[{"L_", "/;", 
         RowBox[{
          RowBox[{"Length", "[", "L", "]"}], "\[NotEqual]", "1"}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"keepsingles", "=", 
      RowBox[{"keepsingles", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1", ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"keep", "=", 
      RowBox[{"Union", "[", 
       RowBox[{"inspected", ",", "keepsingles"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"in", "=", 
      RowBox[{"import", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\t", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"delete", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{"in", ",", "keep"}], "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, {3.6678183135113707`*^9, 3.667818329825341*^9}, {
   3.669556336027816*^9, 3.6695563362909193`*^9}, {3.669556547302552*^9, 
   3.669556547661715*^9}, {3.679727638715199*^9, 3.679727644033752*^9}, {
   3.685954947969742*^9, 3.685954951348892*^9}, {3.685955052382823*^9, 
   3.685955058708202*^9}, {3.6859551586373863`*^9, 3.685955182685789*^9}, {
   3.685955337364159*^9, 3.6859553395915194`*^9}, {3.685955373559456*^9, 
   3.685955395197534*^9}, {3.685955435278266*^9, 3.685955463183543*^9}, {
   3.6859555017997847`*^9, 3.685955534198433*^9}, {3.685955754283692*^9, 
   3.685955945184227*^9}, {3.685956006601611*^9, 3.685956120501299*^9}, {
   3.6859561621151867`*^9, 3.685956299372038*^9}, {3.685956331624157*^9, 
   3.6859563372484617`*^9}, {3.6859564070034513`*^9, 3.685956422259562*^9}, {
   3.6859565195128193`*^9, 3.685956584100934*^9}, {3.685956640412599*^9, 
   3.685956739171651*^9}, {3.6859567967753353`*^9, 3.685956876382988*^9}, {
   3.685956986053584*^9, 3.6859570506992493`*^9}, {3.685957088001089*^9, 
   3.685957167440658*^9}, {3.685957248057948*^9, 3.685957341863412*^9}, {
   3.685957621141923*^9, 3.685957732777804*^9}, {3.6859582610006027`*^9, 
   3.685958429271571*^9}, {3.6859585516862*^9, 3.6859585567485228`*^9}, {
   3.685958622906004*^9, 3.685958855291971*^9}, {3.685958894244762*^9, 
   3.685958988081737*^9}, {3.6859590225090647`*^9, 3.685959079799382*^9}, {
   3.685959332425132*^9, 3.685959343273937*^9}, {3.685959718739786*^9, 
   3.685959734190813*^9}, {3.686299618056726*^9, 3.686299618635071*^9}, {
   3.71376015215895*^9, 3.713760168867214*^9}, {3.713761769480782*^9, 
   3.713761780560401*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"e87295ad-15e5-46d5-bad5-5402c709f3b9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "Pending", " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"PeakTableInspection", "[", 
    RowBox[{
     RowBox[{"goniometerfile_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"FileExtension", "[", "#", "]"}], "\[Equal]", 
         "\"\<dat\>\""}], "&"}], ")"}]}], ",", 
     RowBox[{"tabfile_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"FileExtension", "[", "#", "]"}], "\[Equal]", 
         "\"\<tab\>\""}], "&"}], ")"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "delete", ",", "tab", ",", "head", ",", "n", ",", "nn", ",", 
       "newfile"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Check", " ", "input"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"FileExistsQ", "@", "goniometerfile"}]}], ",", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"PeakTableInspection", "::", "goniometer"}], ",", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"FileNameTake", "@", "goniometerfile"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"FileExistsQ", "@", "tabfile"}]}], ",", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"PeakTableInspection", "::", "tab"}], ",", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"FileNameTake", "@", "tabfile"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Finding", " ", "which", " ", "registrations", " ", "to", " ", 
        "delete"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
      RowBox[{"delete", "=", 
       RowBox[{"PeakTableInspection", "[", "goniometerfile", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Loading", " ", ".", "tab"}], " ", "file"}], " ", "*)"}], 
      "\t", "\[IndentingNewLine]", "\t", 
      RowBox[{"tab", "=", 
       RowBox[{"Import", "[", 
        RowBox[{"tabfile", ",", "\"\<TSV\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
      RowBox[{"(*", " ", 
       RowBox[{"New", " ", "header"}], " ", "*)"}], "\[IndentingNewLine]", 
      "\t", 
      RowBox[{"head", "=", 
       RowBox[{"tab", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\t", 
      RowBox[{"n", "=", 
       RowBox[{"First", "@", 
        RowBox[{"StringSplit", "@", "head"}]}]}], ";", "\[IndentingNewLine]", 
      "\t", 
      RowBox[{"nn", "=", 
       RowBox[{
        RowBox[{"ToExpression", "[", "n", "]"}], "-", 
        RowBox[{"Length", "@", "delete"}]}]}], ";", "\[IndentingNewLine]", 
      "\t", 
      RowBox[{
       RowBox[{"tab", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], "=", 
       RowBox[{"StringReplace", "[", 
        RowBox[{"head", ",", 
         RowBox[{"n", "\[Rule]", 
          RowBox[{"ToString", "[", "nn", "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
      RowBox[{"(*", " ", 
       RowBox[{"Delete", " ", "entries"}], " ", "*)"}], "\[IndentingNewLine]",
       "\t", 
      RowBox[{"tab", "=", 
       RowBox[{"Delete", "[", 
        RowBox[{"tab", ",", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", "#", "}"}], "&"}], ",", "delete"}], "]"}]}], "]"}]}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
      RowBox[{"(*", " ", 
       RowBox[{"Export", " ", 
        RowBox[{"modiefied", " ", ".", "tab"}], " ", "file"}], " ", "*)"}], 
      "\[IndentingNewLine]", "\t", 
      RowBox[{"newfile", "=", 
       RowBox[{"StringInsert", "[", 
        RowBox[{"tabfile", ",", "\"\<_modified\>\"", ",", 
         RowBox[{"-", "5"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
      RowBox[{"Export", "[", 
       RowBox[{"newfile", ",", "tab", ",", "\"\<Table\>\""}], "]"}]}]}], "\t",
     "\[IndentingNewLine]", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, {3.6678183135113707`*^9, 3.667818329825341*^9}, {
   3.669556336027816*^9, 3.6695563362909193`*^9}, {3.669556547302552*^9, 
   3.669556547661715*^9}, {3.679727638715199*^9, 3.679727644033752*^9}, {
   3.685954947969742*^9, 3.685954951348892*^9}, {3.685955052382823*^9, 
   3.685955058708202*^9}, {3.6859551586373863`*^9, 3.685955182685789*^9}, {
   3.685955337364159*^9, 3.6859553395915194`*^9}, {3.685955373559456*^9, 
   3.685955395197534*^9}, {3.685955435278266*^9, 3.685955463183543*^9}, {
   3.6859555017997847`*^9, 3.685955534198433*^9}, {3.685955754283692*^9, 
   3.685955945184227*^9}, {3.685956006601611*^9, 3.685956120501299*^9}, {
   3.6859561621151867`*^9, 3.685956299372038*^9}, {3.685956331624157*^9, 
   3.6859563372484617`*^9}, {3.6859564070034513`*^9, 3.685956422259562*^9}, {
   3.6859565195128193`*^9, 3.685956584100934*^9}, {3.685956640412599*^9, 
   3.685956739171651*^9}, {3.6859567967753353`*^9, 3.685956876382988*^9}, {
   3.685956986053584*^9, 3.6859570506992493`*^9}, {3.685957088001089*^9, 
   3.685957167440658*^9}, {3.685957248057948*^9, 3.685957341863412*^9}, {
   3.685957621141923*^9, 3.685957732777804*^9}, {3.6859582610006027`*^9, 
   3.685958429271571*^9}, {3.6859585516862*^9, 3.6859585567485228`*^9}, {
   3.685958622906004*^9, 3.685958855291971*^9}, {3.685958894244762*^9, 
   3.685958988081737*^9}, {3.6859590225090647`*^9, 3.685959079799382*^9}, {
   3.685959332425132*^9, 3.685959343273937*^9}, {3.685959760425982*^9, 
   3.6859597830652943`*^9}, {3.686299629097064*^9, 3.686299642460539*^9}, {
   3.713760198005303*^9, 3.713760204250717*^9}, {3.7137617952397423`*^9, 
   3.713761813631722*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"f607695a-756f-4986-8172-219fec5dcd19"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"6d3f9cc6-94d7-4dee-8de0-dd80efba362c"]
}, Closed]],

Cell[CellGroupData[{

Cell["ReciprocalImageCheck", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, {3.6678188399987793`*^9, 3.667818878319042*^9}, {
   3.667818936985889*^9, 3.667818938625092*^9}, 3.667819218919221*^9, {
   3.668104207926056*^9, 3.668104209242962*^9}, 3.687243315679677*^9, 
   3.6878672655456343`*^9, {3.7138707345449533`*^9, 3.713870750699418*^9}, 
   3.715852050034526*^9},ExpressionUUID->"1c036039-a160-4350-b735-\
abc7d969c17f"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"febd1b70-c713-432f-81ad-83ce64bf630d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ReciprocalImageCheck", "::", "file"}], "=", 
   "\"\<Input file was not found.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReciprocalImageCheck", "::", "method"}], "=", 
   "\"\<The method \[LeftGuillemet]`1`\[RightGuillemet] was not recognised.\>\
\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReciprocalImageCheck", "::", "system"}], "=", 
   "\"\<\[LeftGuillemet]`1`\[RightGuillemet] is not a valid lattice system.\>\
\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReciprocalImageCheck", "::", "angles"}], "=", 
   "\"\<Invalid angle input for the given system.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReciprocalImageCheck", "::", "load"}], "=", 
   "\"\<\[LeftGuillemet]`1`\[RightGuillemet] cannot be loaded.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReciprocalImageCheck", "::", "form"}], "=", 
   "\"\<The file does not appear to be on the correct Association \
form.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReciprocalImageCheck", "::", "asn"}], "=", 
   "\"\<\[LeftGuillemet]$PixelData\[RightGuillemet] does not appear to be an \
Association.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReciprocalImageCheck", "::", "threshold"}], "=", 
   "\"\<`1` reflection`2` outside the threshold for integer \
determination.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReciprocalImageCheck", "::", "all"}], "=", 
   "\"\<All reflections were inside the threshold for integer \
determination.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReciprocalImageCheck", "::", "ambiguous"}], "=", 
   "\"\<Ambiguous image orientation. Use different correspondence \
points.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReciprocalImageCheck", "::", "data"}], "=", 
   "\"\<At least two data points are required.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ReciprocalImageCheck", "::", "grid"}], "=", 
    "\"\<The option \[LeftGuillemet]ShowLattice\[RightGuillemet] must either \
be set to \[LeftGuillemet]True\[RightGuillemet] or a non-negative \
integer.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "@", "ReciprocalImageCheck"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"FindPixelClusters", " ", "options"}], " ", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<ClearStatus\>\"", "\[Rule]", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<ClusterRange\>\"", "\[Rule]", "3"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Method", "\[Rule]", "\"\<Auto\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<ReturnBinaryImage\>\"", "\[Rule]", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"ReciprocalImageCheck", " ", "options"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Threshold\>\"", "\[Rule]", "0.15"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<RoundPixels\>\"", "\[Rule]", "True"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<LoadPixelData\>\"", "\[Rule]", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<RetrieveData\>\"", "\[Rule]", "True"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<CountNonInteger\>\"", "\[Rule]", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<StoreData\>\"", "\[Rule]", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<ShowLattice\>\"", "\[Rule]", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Colours\>\"", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ColorData", "[", 
         RowBox[{"97", ",", "2"}], "]"}], ",", 
        RowBox[{"ColorData", "[", 
         RowBox[{"97", ",", "1"}], "]"}], ",", "LightGray"}], "}"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<TooltipStyle\>\"", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"FontFamily", "\[Rule]", "\"\<Inconsolata\>\""}], ",", 
        RowBox[{"FontSize", "\[Rule]", "14"}]}], "}"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Plot", " ", "options"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Frame", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
     RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", "\[IndentingNewLine]", 
     RowBox[{"PlotRange", "\[Rule]", "\"\<ImageDimension\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"PointSize", "\[Rule]", "Large"}]}], "\[IndentingNewLine]", 
    "}"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.667811591227736*^9, {3.6678192645731707`*^9, 3.667819270555752*^9}, {
   3.6679268272189693`*^9, 3.667926827530929*^9}, {3.667926865314499*^9, 
   3.667926879234667*^9}, {3.667932793543994*^9, 3.6679327970955763`*^9}, 
   3.667932835740869*^9, {3.667932872004774*^9, 3.667932872923719*^9}, {
   3.667933478854928*^9, 3.6679334921815147`*^9}, {3.667937136249467*^9, 
   3.66793713683991*^9}, {3.667938254326214*^9, 3.667938259486877*^9}, {
   3.667939157392975*^9, 3.6679391759273643`*^9}, {3.6679395892626457`*^9, 
   3.6679396251018553`*^9}, {3.6679396662931337`*^9, 3.66793967041187*^9}, {
   3.667969062724923*^9, 3.6679690866593513`*^9}, {3.667971558545974*^9, 
   3.667971570791375*^9}, {3.66797175965112*^9, 3.667971761018065*^9}, 
   3.667973400059704*^9, 3.667980455575898*^9, 3.667990364351841*^9, 
   3.6679914744706078`*^9, {3.667995091765997*^9, 3.6679950981728687`*^9}, {
   3.667995848573064*^9, 3.667995849419979*^9}, {3.6680190786132174`*^9, 
   3.668019095188184*^9}, {3.668020053716372*^9, 3.668020060218075*^9}, {
   3.6680201410335283`*^9, 3.668020151647107*^9}, {3.668057763273326*^9, 
   3.668057801302511*^9}, {3.668058628257262*^9, 3.6680586519993153`*^9}, 
   3.6680586831987753`*^9, {3.668059310968914*^9, 3.668059345638503*^9}, {
   3.6680593969584103`*^9, 3.66805941238801*^9}, {3.668059512633687*^9, 
   3.6680595196012506`*^9}, {3.6680596063927727`*^9, 3.668059614803205*^9}, {
   3.6680982548367653`*^9, 3.668098258731867*^9}, 3.6681034770498257`*^9, 
   3.6681434966601543`*^9, {3.6695197388121567`*^9, 3.669519739484033*^9}, 
   3.6695198100421457`*^9, {3.6703497772124653`*^9, 3.6703497791230783`*^9}, {
   3.670349812772047*^9, 3.670349826517558*^9}, {3.671389215213585*^9, 
   3.671389249836089*^9}, {3.671389297045927*^9, 3.671389306618927*^9}, {
   3.6719110883031588`*^9, 3.6719110885974483`*^9}, {3.687165575358741*^9, 
   3.687165638515873*^9}, {3.687507491201261*^9, 3.6875075124540987`*^9}, {
   3.687507570577013*^9, 3.68750761179244*^9}, {3.687512071516636*^9, 
   3.687512097815074*^9}, {3.687514871153606*^9, 3.687514874756731*^9}, {
   3.687514973533998*^9, 3.687515013595488*^9}, {3.687520393077942*^9, 
   3.687520407914579*^9}, {3.687521238012498*^9, 3.687521257345623*^9}, {
   3.687865768052176*^9, 3.687865768352976*^9}, {3.6878659560830936`*^9, 
   3.687865975589882*^9}, 3.687866368125998*^9, {3.688100200710231*^9, 
   3.6881002081876507`*^9}, {3.688100604833289*^9, 3.6881006099071083`*^9}, {
   3.688107997969265*^9, 3.6881080214126472`*^9}, {3.688108400184894*^9, 
   3.6881084154348392`*^9}, {3.6881280727953053`*^9, 
   3.6881281273768167`*^9}, {3.688128294183939*^9, 3.688128294543211*^9}, {
   3.688191590995892*^9, 3.688191597523514*^9}, {3.6881975513508463`*^9, 
   3.688197562958654*^9}, 3.688284217856106*^9, {3.688889672275766*^9, 
   3.688889672421276*^9}, {3.714201028367544*^9, 3.714201029342231*^9}, {
   3.7142020649596653`*^9, 3.71420209340727*^9}, {3.714202883384715*^9, 
   3.7142029121766233`*^9}, {3.715336114709093*^9, 3.7153361213929033`*^9}, {
   3.715852050070547*^9, 
   3.715852050154768*^9}},ExpressionUUID->"2512389a-7af0-4566-bf47-\
49fe0908ee7f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"220ccaa5-f6dc-4a1f-8aa2-afc3c7c23238"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReciprocalImageCheck", "[", "\[IndentingNewLine]", 
   RowBox[{
   "input_String", ",", "\[IndentingNewLine]", "system_", ",", 
    "\[IndentingNewLine]", "data_List", ",", "\[IndentingNewLine]", 
    RowBox[{"Optional", "[", 
     RowBox[{"pattern_Condition", ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x1_", ",", "x2_", ",", "x3_"}], "}"}], "/;", "False"}]}], 
     "]"}], ",", 
    RowBox[{"OptionsPattern", "@", "ReciprocalImageCheck"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "systems", ",", "sys", ",", "\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]", 
      ",", "\[IndentingNewLine]", "image", ",", "imgdim", ",", "adjust", ",", 
      "tx", ",", "ty", ",", "load", ",", "hash", ",", "pixlist", ",", 
      "\[IndentingNewLine]", "hkls", ",", "sub", ",", "s", ",", "sel", ",", 
      "normhkl", ",", "normorder", ",", "L", ",", "X", ",", "P", ",", "Pinv", 
      ",", "method", ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "Lattice", " ", "*)"}], "\[IndentingNewLine]", "L1x",
       ",", "L2x", ",", "L1y", ",", "L2y", ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"Conversion", " ", "functions"}], " ", "*)"}], 
      "\[IndentingNewLine]", "\[CapitalLambda]", ",", "\[CapitalGamma]", ",", 
      "\[Xi]", ",", "convert", ",", "residue", ",", "threshold", ",", 
      "result", ",", "i", ",", "\[Chi]", ",", "\[IndentingNewLine]", 
      "meddist", ",", "xy", ",", "rest", ",", "neighbour", ",", "distance", 
      ",", "median", ",", "\[IndentingNewLine]", "selection", ",", "range", 
      ",", "nearest", ",", "\[IndentingNewLine]", "clusters", ",", "off", ",",
       "groupfix", ",", "tooltip", ",", "\[IndentingNewLine]", "nodes", ",", 
      "l", ",", "hkl", ",", "count", ",", "selection2D", ",", "pos", ",", 
      "matching", ",", "pr", ",", "colourmatch", ",", "colourrest", ",", 
      "colouroff", ",", "\[IndentingNewLine]", "temp", ",", "temp1", ",", 
      "temp2", ",", "temp3", ",", "temp4", ",", "temp5", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"Overalying", " ", "grid"}], " ", "*)"}], 
      "\[IndentingNewLine]", "colours", ",", "V", ",", "c", ",", "L1", ",", 
      "L2", ",", "t", ",", "tt", ",", "\[IndentingNewLine]", "gz", ",", 
      "showgrid", ",", "del", ",", "grid", ",", "u", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "Other", " ", "*)"}], "\[IndentingNewLine]", "test", 
      ",", "r", ",", "\[Lambda]1", ",", "\[Lambda]2", ",", "data2D", ",", 
      "\[IndentingNewLine]", "plot", ",", "plotdata", ",", "plotoptions", ",",
       "\[IndentingNewLine]", "SD", ",", "grids"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"*", " ", "Input", " ", "check"}], " ", "**)"}], 
    "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"FileExistsQ", "@", "input"}]}], ",", "\[IndentingNewLine]", 
       "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"ReciprocalImageCheck", "::", "file"}], "]"}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"systems", "=", 
      RowBox[{"{", "\[IndentingNewLine]", "\t", 
       RowBox[{
       "\"\<Triclinic\>\"", ",", "\"\<Monoclinic\>\"", ",", 
        "\"\<Orthorhombic\>\"", ",", "\"\<Tetragonal\>\"", ",", 
        "\[IndentingNewLine]", "\t", "\"\<Rhombohedral\>\"", ",", 
        "\"\<Hexagonal\>\"", ",", "\"\<Cubic\>\""}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"sys", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ListQ", "@", "system"}], ",", 
        RowBox[{"First", "@", "system"}], ",", "system"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Check", " ", "if", " ", "valid", " ", "lattice", " ", "system"}], " ", 
      "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"systems", ",", "sys"}], "]"}]}], ",", "\[IndentingNewLine]",
        "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"ReciprocalImageCheck", "::", "system"}], ",", "system"}], 
         "]"}], ";", "\[IndentingNewLine]", "\t", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Check", " ", "if", " ", "angles", " ", "are", " ", "required"}], " ", 
      "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"StringQ", "@", "system"}], ",", "\t", "\[IndentingNewLine]", 
       "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "\"\<Triclinic\>\"", ",", "\"\<Monoclinic\>\"", ",", 
             "\"\<Rhombohedral\>\""}], "}"}], ",", "sys"}], "]"}], ",", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"ReciprocalImageCheck", "::", "angles"}], "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
      "\t", "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"If", " ", "angles", " ", "given"}], ",", " ", 
       RowBox[{"check", " ", "if", " ", "form", " ", "is", " ", "valid"}]}], 
      " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ListQ", "@", "system"}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"Which", "[", "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"sys", "\[Equal]", "\"\<Triclinic\>\""}], ",", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MatchQ", "[", 
            RowBox[{
             RowBox[{"Rest", "@", "system"}], ",", "\[IndentingNewLine]", 
             "\t", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"_", "?", "NumericQ"}], ",", 
               RowBox[{"_", "?", "NumericQ"}], ",", 
               RowBox[{"_", "?", "NumericQ"}]}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\[Alpha]", ",", "\[Beta]", ",", "\[Gamma]"}], "}"}], 
            "=", 
            RowBox[{
             RowBox[{"Rest", "@", "system"}], "*", "Degree"}]}], ",", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{
            RowBox[{"Message", "[", 
             RowBox[{"ReciprocalImageCheck", "::", "angles"}], "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
         RowBox[{"sys", "\[Equal]", "\"\<Monoclinic\>\""}], ",", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MatchQ", "[", 
            RowBox[{
             RowBox[{"Rest", "@", "system"}], ",", "\[IndentingNewLine]", 
             "\t", 
             RowBox[{"{", 
              RowBox[{"_", "?", "NumericQ"}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{
            RowBox[{"{", "\[Beta]", "}"}], "=", 
            RowBox[{
             RowBox[{"Rest", "@", "system"}], "*", "Degree"}]}], ",", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{
            RowBox[{"Message", "[", 
             RowBox[{"ReciprocalImageCheck", "::", "angles"}], "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
         RowBox[{"sys", "\[Equal]", "\"\<Rhombohedral\>\""}], ",", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MatchQ", "[", 
            RowBox[{
             RowBox[{"Rest", "@", "system"}], ",", "\[IndentingNewLine]", 
             "\t", 
             RowBox[{"{", 
              RowBox[{"_", "?", "NumericQ"}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{
            RowBox[{"{", "\[Alpha]", "}"}], "=", 
            RowBox[{
             RowBox[{"Rest", "@", "system"}], "*", "Degree"}]}], ",", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{
            RowBox[{"Message", "[", 
             RowBox[{"ReciprocalImageCheck", "::", "angles"}], "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
        "\t", "]"}]}], "\[IndentingNewLine]", "\t", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Check", " ", "for", " ", "sufficient", " ", "data"}], " ", 
      "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", "data"}], "<", "2"}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"ReciprocalImageCheck", "::", "data"}], "]"}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Check", " ", 
       RowBox[{"for", " ", "'"}], 
       RowBox[{"ShowLattice", "'"}], " ", 
       RowBox[{"and", " ", "'"}], 
       RowBox[{"StoreData", "'"}], " ", "option"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"SD", "=", 
      RowBox[{"OptionValue", "[", "\"\<StoreData\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"gz", "=", 
      RowBox[{"OptionValue", "[", "\"\<ShowLattice\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{"SD", ",", 
       RowBox[{"gz", "=", "0"}]}], "]"}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"gz", "\[Equal]", "True"}], "||", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"IntegerQ", "[", "gz", "]"}], "&&", 
          RowBox[{"NonNegative", "[", "gz", "]"}]}], ")"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"showgrid", "=", "True"}], ",", 
       RowBox[{"showgrid", "=", "False"}], ",", 
       RowBox[{"showgrid", "=", "False"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"gz", "\[Equal]", "True"}], ",", 
       RowBox[{"gz", "=", "0"}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "*", " ", "Preparations", " ", "for", " ", "extracting", " ", "two", 
       " ", "dimensions", " ", 
       RowBox[{"(", 
        RowBox[{"image", " ", "plane"}], ")"}]}], " ", "**)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"hkls", "=", 
      RowBox[{"data", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4", ",", "5"}], "}"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Test", ":", " ", 
       RowBox[{
       "Check", " ", "for", " ", "any", " ", "column", " ", "with", " ", 
        "the", " ", "same", " ", "element"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"temp", "=", 
      RowBox[{"DeleteDuplicates", "/@", 
       RowBox[{"Transpose", "@", "hkls"}]}]}], ";", "\[IndentingNewLine]", 
     "\t\t", 
     RowBox[{"test", "=", 
      RowBox[{"Boole", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "#", "]"}], "\[NotEqual]", "1"}], "&"}], "/@",
         "temp"}], "]"}]}], ";", "\[IndentingNewLine]", "\t\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Count", "[", 
         RowBox[{"test", ",", "0"}], "]"}], "\[NotEqual]", "1"}], ",", 
       "\[IndentingNewLine]", "\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"ReciprocalImageCheck", "::", "ambiguous"}], "]"}], ";", 
        "\[IndentingNewLine]", "\t\t\t", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Values", " ", "describing", " ", "the", " ", "plane"}], " ", 
      "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"normorder", "=", 
      RowBox[{"First", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Position", "[", 
         RowBox[{"test", ",", "0"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"normhkl", "=", 
      RowBox[{"data", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", 
         RowBox[{"normorder", "+", "2"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"sel", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", "normorder"}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Planar", " ", "data"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"data2D", "=", 
      RowBox[{"Transpose", "@", 
       RowBox[{"Drop", "[", 
        RowBox[{
         RowBox[{"Transpose", "@", "data"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", "+", "normorder"}], "}"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "*", " ", "Check", " ", "if", " ", "image", " ", "is", " ", "known"}], 
      " ", "**)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"image", "=", 
      RowBox[{"Check", "[", 
       RowBox[{
        RowBox[{"Import", "@", "input"}], ",", 
        RowBox[{"Abort", "[", "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"imgdim", "=", 
      RowBox[{"ImageDimensions", "@", "image"}]}], ";", "\[IndentingNewLine]",
      "\t", 
     RowBox[{"adjust", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tx", ",", "ty"}], "}"}], "=", 
       RowBox[{"imgdim", "/", "2"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<ReturnBinaryImage\>\"", "]"}], ",", 
       RowBox[{"Goto", "[", "\"\<FindPixelClusters\>\"", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Optional", ":", " ", 
       RowBox[{
       "Load", " ", "file", " ", "containing", " ", "pixel", " ", "data"}]}], 
      " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"load", "=", 
      RowBox[{"OptionValue", "[", "\"\<LoadPixelData\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"StringQ", "@", "load"}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FileExistsQ", "@", "load"}], ",", "\[IndentingNewLine]", 
         "\t", 
         RowBox[{"$PixelData", "=", "\[IndentingNewLine]", "\t", 
          RowBox[{"Check", "[", 
           RowBox[{
            RowBox[{"ToExpression", "@", 
             RowBox[{"Import", "[", 
              RowBox[{"load", ",", "\"\<String\>\""}], "]"}]}], ",", 
            "\[IndentingNewLine]", "\t", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"ReciprocalImageCheck", "::", "form"}], "]"}], ";", 
             RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"ReciprocalImageCheck", "::", "load"}], ",", "load"}], 
           "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", "\t", 
        "]"}]}], "]"}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"AssociationQ", "@", "$PixelData"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"ReciprocalImageCheck", "::", "asn"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Hash", " ", "procedure"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"hash", "=", 
      RowBox[{"IntegerString", "[", 
       RowBox[{
        RowBox[{"FileHash", "[", 
         RowBox[{"input", ",", "\"\<MD5\>\""}], "]"}], ",", "16", ",", "32"}],
        "]"}]}], ";", "\t", "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"KeyExistsQ", "[", 
         RowBox[{"$PixelData", ",", "hash"}], "]"}], "\[IndentingNewLine]", 
        "\t", "&&", 
        RowBox[{"OptionValue", "[", "\"\<RetrieveData\>\"", "]"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"pixlist", "=", 
         RowBox[{"$PixelData", "[", "hash", "]"}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"Goto", "[", "\"\<PixelDone\>\"", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Converting", " ", "image", " ", "to", " ", "a", " ", "list", " ", "of",
        " ", "pixels"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"Label", "[", "\"\<FindPixelClusters\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"pixlist", "=", 
      RowBox[{"FindPixelClusters", "[", 
       RowBox[{"image", ",", "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "\[Rule]", 
           RowBox[{"OptionValue", "[", "#", "]"}]}], "&"}], "/@", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
          "\"\<ReturnBinaryImage\>\"", ",", "Method", ",", 
           "\"\<ClusterRange\>\"", ",", "\"\<ClearStatus\>\""}], "}"}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Option", " ", "for", " ", "returning", " ", "binarised", " ", 
       "image"}], " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<ReturnBinaryImage\>\"", "]"}], ",", 
       RowBox[{"Return", "@", "pixlist"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Storing", " ", "image", " ", "hash", " ", "along", " ", "with", " ", 
       "pixel", " ", "data"}], " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"$PixelData", ",", 
       RowBox[{"hash", "\[Rule]", "pixlist"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"*", " ", "Setting", " ", "up", " ", "lattice"}], " ", "**)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Label", "[", "\"\<PixelDone\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Determining", " ", "reciprocal", " ", "lattice", " ", "used", " ", 
       "in", " ", "CrysAlis"}], " ", "*)"}], "\t", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"sys", "\[Equal]", "\"\<Triclinic\>\""}], ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"L", "=", 
        RowBox[{"N", "[", 
         RowBox[{"{", "\[IndentingNewLine]", "\t", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "\[IndentingNewLine]", "\t", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"Cot", "[", "\[Gamma]", "]"}]}], "/", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"Cot", "[", "\[Gamma]", "]"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"Csc", "[", "\[Gamma]", "]"}], "2"]}], "]"}]}], ",", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Csc", "[", "\[Gamma]", "]"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Cos", "[", "\[Alpha]", "]"}], " ", 
                   RowBox[{"Cot", "[", "\[Gamma]", "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"Cos", "[", "\[Beta]", "]"}], " ", 
                   RowBox[{"Csc", "[", "\[Gamma]", "]"}]}]}], ")"}]}], ")"}], 
              "/", 
              RowBox[{"(", 
               RowBox[{"\[Sqrt]", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Alpha]", "]"}], "2"], "+", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Beta]", "]"}], "2"]}], ")"}], " ", 
                    
                    SuperscriptBox[
                    RowBox[{"Cot", "[", "\[Gamma]", "]"}], "2"], " ", 
                    SuperscriptBox[
                    RowBox[{"Csc", "[", "\[Gamma]", "]"}], "2"]}], "-", 
                    RowBox[{"4", " ", 
                    RowBox[{"Cos", "[", "\[Alpha]", "]"}], " ", 
                    RowBox[{"Cos", "[", "\[Beta]", "]"}], " ", 
                    RowBox[{"Cot", "[", "\[Gamma]", "]"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Csc", "[", "\[Gamma]", "]"}], "3"]}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Alpha]", "]"}], "2"], "+", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Beta]", "]"}], "2"]}], ")"}], " ", 
                    
                    SuperscriptBox[
                    RowBox[{"Csc", "[", "\[Gamma]", "]"}], "4"]}]}], ")"}], 
                  " ", 
                  RowBox[{"Sign", "[", 
                   RowBox[{"1", "+", 
                    RowBox[{"2", " ", 
                    RowBox[{"Cos", "[", "\[Alpha]", "]"}], " ", 
                    RowBox[{"Cos", "[", "\[Beta]", "]"}], " ", 
                    RowBox[{"Cot", "[", "\[Gamma]", "]"}], " ", 
                    RowBox[{"Csc", "[", "\[Gamma]", "]"}]}], "-", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Alpha]", "]"}], "2"], "+", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Beta]", "]"}], "2"]}], ")"}], " ", 
                    
                    SuperscriptBox[
                    RowBox[{"Csc", "[", "\[Gamma]", "]"}], "2"]}]}], "]"}]}], 
                 ")"}]}], ")"}]}]}], "}"}], ",", "\[IndentingNewLine]", "\t", 
           
           RowBox[{"{", 
            RowBox[{"0", ",", "\[IndentingNewLine]", "\t", 
             RowBox[{
              RowBox[{"Csc", "[", "\[Gamma]", "]"}], "/", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"Cot", "[", "\[Gamma]", "]"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"Csc", "[", "\[Gamma]", "]"}], "2"]}], "]"}]}], ",", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Csc", "[", "\[Gamma]", "]"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Cos", "[", "\[Beta]", "]"}], " ", 
                   RowBox[{"Cot", "[", "\[Gamma]", "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"Cos", "[", "\[Alpha]", "]"}], " ", 
                   RowBox[{"Csc", "[", "\[Gamma]", "]"}]}]}], ")"}]}], ")"}], 
              "/", 
              RowBox[{"(", 
               RowBox[{"\[Sqrt]", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Alpha]", "]"}], "2"], "+", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Beta]", "]"}], "2"]}], ")"}], " ", 
                    
                    SuperscriptBox[
                    RowBox[{"Cot", "[", "\[Gamma]", "]"}], "2"], " ", 
                    SuperscriptBox[
                    RowBox[{"Csc", "[", "\[Gamma]", "]"}], "2"]}], "-", 
                    RowBox[{"4", " ", 
                    RowBox[{"Cos", "[", "\[Alpha]", "]"}], " ", 
                    RowBox[{"Cos", "[", "\[Beta]", "]"}], " ", 
                    RowBox[{"Cot", "[", "\[Gamma]", "]"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Csc", "[", "\[Gamma]", "]"}], "3"]}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Alpha]", "]"}], "2"], "+", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Beta]", "]"}], "2"]}], ")"}], " ", 
                    
                    SuperscriptBox[
                    RowBox[{"Csc", "[", "\[Gamma]", "]"}], "4"]}]}], ")"}], 
                  " ", 
                  RowBox[{"Sign", "[", 
                   RowBox[{"1", "+", 
                    RowBox[{"2", " ", 
                    RowBox[{"Cos", "[", "\[Alpha]", "]"}], " ", 
                    RowBox[{"Cos", "[", "\[Beta]", "]"}], " ", 
                    RowBox[{"Cot", "[", "\[Gamma]", "]"}], " ", 
                    RowBox[{"Csc", "[", "\[Gamma]", "]"}]}], "-", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Alpha]", "]"}], "2"], "+", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Beta]", "]"}], "2"]}], ")"}], " ", 
                    
                    SuperscriptBox[
                    RowBox[{"Csc", "[", "\[Gamma]", "]"}], "2"]}]}], "]"}]}], 
                 ")"}]}], ")"}]}]}], "}"}], ",", "\[IndentingNewLine]", "\t", 
           
           RowBox[{"{", 
            RowBox[{
            "0", ",", "\[IndentingNewLine]", "\t", "0", ",", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{"1", "/", 
              RowBox[{"Sqrt", "[", "\[IndentingNewLine]", "\t", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "+", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Alpha]", "]"}], "2"], "+", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Beta]", "]"}], "2"]}], ")"}], " ", 
                   
                   SuperscriptBox[
                    RowBox[{"Cot", "[", "\[Gamma]", "]"}], "2"], " ", 
                   SuperscriptBox[
                    RowBox[{"Csc", "[", "\[Gamma]", "]"}], "2"]}], "-", 
                  RowBox[{"4", " ", 
                   RowBox[{"Cos", "[", "\[Alpha]", "]"}], " ", 
                   RowBox[{"Cos", "[", "\[Beta]", "]"}], " ", 
                   RowBox[{"Cot", "[", "\[Gamma]", "]"}], " ", 
                   SuperscriptBox[
                    RowBox[{"Csc", "[", "\[Gamma]", "]"}], "3"]}], "+", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Alpha]", "]"}], "2"], "+", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Beta]", "]"}], "2"]}], ")"}], " ", 
                   
                   SuperscriptBox[
                    RowBox[{"Csc", "[", "\[Gamma]", "]"}], "4"]}]}], ")"}], 
                " ", 
                RowBox[{"Sign", "[", 
                 RowBox[{"1", "+", 
                  RowBox[{"2", " ", 
                   RowBox[{"Cos", "[", "\[Alpha]", "]"}], " ", 
                   RowBox[{"Cos", "[", "\[Beta]", "]"}], " ", 
                   RowBox[{"Cot", "[", "\[Gamma]", "]"}], " ", 
                   RowBox[{"Csc", "[", "\[Gamma]", "]"}]}], "-", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Alpha]", "]"}], "2"], "+", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "\[Beta]", "]"}], "2"]}], ")"}], " ", 
                   
                   SuperscriptBox[
                    RowBox[{"Csc", "[", "\[Gamma]", "]"}], "2"]}]}], "]"}]}], 
               "]"}]}]}], "\[IndentingNewLine]", "\t", "}"}]}], "}"}], 
         "]"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
       RowBox[{"sys", "\[Equal]", "\"\<Monoclinic\>\""}], ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"L", "=", 
        RowBox[{"N", "[", 
         RowBox[{"{", "\[IndentingNewLine]", "\t", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"Cos", "[", "\[Beta]", "]"}]}], "/", 
              RowBox[{"Sqrt", "[", 
               RowBox[{"1", "+", 
                SuperscriptBox[
                 RowBox[{"Cos", "[", "\[Beta]", "]"}], "2"]}], "]"}]}]}], 
            "}"}], ",", "\[IndentingNewLine]", "\t", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"1", "/", 
              RowBox[{"Sqrt", "[", 
               RowBox[{"1", "+", 
                SuperscriptBox[
                 RowBox[{"Cos", "[", "\[Beta]", "]"}], "2"]}], "]"}]}]}], 
            "}"}]}], "}"}], "]"}]}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"sys", "\[Equal]", "\"\<Hexagonal\>\""}], ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"L", "=", 
        RowBox[{"N", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"1", "/", "2"}], ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"Sqrt", "[", "3", "]"}], "/", "2"}], ",", "0"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", "True", ",", 
       RowBox[{"L", "=", 
        RowBox[{"IdentityMatrix", "[", "3", "]"}]}]}], "\[IndentingNewLine]", 
      "\t", "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Extracting", " ", "two", " ", "dimensions", " ", 
       RowBox[{"(", 
        RowBox[{"image", " ", "plane"}], ")"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"L", "=", 
      RowBox[{"L", "[", 
       RowBox[{"[", 
        RowBox[{"sel", ",", "sel"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Lattice", " ", "components"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"L1x", ",", "L2x"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"L1y", ",", "L2y"}], "}"}]}], "}"}], "=", "L"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Function", " ", "for", " ", "calculating", " ", "residue"}], 
      " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"r", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x_", ",", "y_", ",", "h1_", ",", "h2_"}], "}"}], ",", 
        "\[Lambda]1_", ",", "\[Lambda]2_"}], "]"}], ":=", 
      RowBox[{"N", "[", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Sqrt", "[", 
         RowBox[{
          SuperscriptBox["x", "2"], "+", 
          SuperscriptBox["y", "2"]}], "]"}], "-", "\[IndentingNewLine]", "\t", 
        RowBox[{"Sqrt", "[", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"tx", "+", 
             RowBox[{"h1", "*", "L1x", "*", "\[Lambda]1"}], "+", 
             RowBox[{"h2", "*", "L2x", "*", "\[Lambda]2"}]}], ")"}], "2"], 
          "+", "\[IndentingNewLine]", "\t", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"ty", "+", 
             RowBox[{"h1", "*", "L1y", "*", "\[Lambda]1"}], "+", 
             RowBox[{"h2", "*", "L2y", "*", "\[Lambda]2"}]}], ")"}], "2"]}], 
         "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Determining", " ", "scaling", " ", "factors", " ", "by", " ", 
       "iteration"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Lambda]1", ",", "\[Lambda]2"}], "}"}], "=", 
      RowBox[{"NonlinearLeastSquares", "[", "\[IndentingNewLine]", "\t", 
       RowBox[{"r", ",", "data2D", ",", 
        RowBox[{"{", 
         RowBox[{"50", ",", "50"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Scaled", " ", "lattice"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"\[CapitalLambda]", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"Transpose", "[", "L", "]"}], "*", 
        RowBox[{"{", 
         RowBox[{"\[Lambda]1", ",", "\[Lambda]2"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"\[CapitalGamma]", "=", 
      RowBox[{"Inverse", "[", "\[CapitalLambda]", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Conversion", " ", "functions"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"\[Xi]", "[", 
       RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
      RowBox[{"\[CapitalGamma]", ".", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"x", "-", "tx"}], ",", 
         RowBox[{"y", "-", "ty"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{
      RowBox[{"\[Chi]", "[", 
       RowBox[{"h_", ",", "k_"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"\[CapitalLambda]", ".", 
        RowBox[{"{", 
         RowBox[{"h", ",", "k"}], "}"}]}], "+", 
       RowBox[{"{", 
        RowBox[{"tx", ",", "ty"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"*", " ", "Conversion", " ", "functions"}], " ", "**)"}], 
     "\[IndentingNewLine]", "\t", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Pixel", " ", "to", " ", "node"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"\[Xi]", "[", 
       RowBox[{"{", 
        RowBox[{"x_", ",", "y_"}], "}"}], "]"}], ":=", 
      RowBox[{"(", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"Calculation", " ", "and", " ", "discrepancy", " ", "check"}],
         " ", "*)"}], "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"convert", "=", 
         RowBox[{"\[CapitalGamma]", ".", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x", "-", "tx"}], ",", 
            RowBox[{"y", "-", "ty"}]}], "}"}]}]}], ";", "\[IndentingNewLine]",
         "\t", 
        RowBox[{"residue", "=", 
         RowBox[{"Abs", "/@", 
          RowBox[{"FractionalPart", "/@", 
           RowBox[{"N", "[", "convert", "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Decide", " ", "whether", " ", "to", " ", "round", " ", "to", " ", 
          "integer"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
        RowBox[{"threshold", "=", 
         RowBox[{"OptionValue", "[", "\"\<Threshold\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"result", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", "\t", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"Which", "[", "\[IndentingNewLine]", "\t", 
           RowBox[{
            RowBox[{
             RowBox[{"residue", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "\[LessEqual]", "threshold"}], 
            ",", "\[IndentingNewLine]", "\t\t", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"result", ",", 
              RowBox[{"Round", "@", 
               RowBox[{"convert", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}], ",", 
            "\[IndentingNewLine]", "\t", 
            RowBox[{
             RowBox[{"1", "-", 
              RowBox[{"residue", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "\[LessEqual]", 
             "threshold"}], ",", "\[IndentingNewLine]", "\t\t", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"result", ",", 
              RowBox[{"Round", "@", 
               RowBox[{"convert", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}], ",", 
            "\[IndentingNewLine]", "\t", "True", ",", "\[IndentingNewLine]", 
            "\t\t", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"result", ",", 
              RowBox[{"N", "@", 
               RowBox[{"convert", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}]}], 
           "\[IndentingNewLine]", "\t", "]"}], ",", "\[IndentingNewLine]", 
          "\t", 
          RowBox[{"{", 
           RowBox[{"i", ",", "2"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", "result"}], 
       ")"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Node", " ", "to", " ", "pixel"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"\[Chi]", "[", 
       RowBox[{"H_", ",", 
        RowBox[{"round_:", 
         RowBox[{"OptionValue", "[", "\"\<RoundPixels\>\"", "]"}]}]}], "]"}], 
      ":=", 
      RowBox[{"(", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", "Calculation", " ", "*)"}], "\[IndentingNewLine]", 
       "\t", 
       RowBox[{
        RowBox[{"convert", "=", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", ".", "H"}], "+", "adjust"}]}], ";", 
        "\[IndentingNewLine]", "\t", "\[IndentingNewLine]", "\t", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Decide", " ", "whether", " ", "to", " ", "round", " ", "to", " ", 
          "integer"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
        RowBox[{"If", "[", 
         RowBox[{"round", ",", 
          RowBox[{"Round", "@", "convert"}], ",", "convert"}], "]"}]}], 
       ")"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"*", " ", 
       RowBox[{"Optional", ":", " ", 
        RowBox[{"Overlaying", " ", 
         RowBox[{"grid", "/", "lattice"}]}]}]}], " ", "**)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", "showgrid"}], ",", 
       RowBox[{"Goto", "[", "\"\<LatticeDone\>\"", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Preparations", " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"colours", "=", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"1", "\[Rule]", "Red"}], ",", 
        RowBox[{"2", "\[Rule]", "Green"}], ",", 
        RowBox[{"3", "\[Rule]", "Blue"}]}], "|>"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"c", "=", 
      RowBox[{"Values", "@", 
       RowBox[{"colours", "[", 
        RowBox[{"[", "sel", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"L1", ",", "L2"}], "}"}], "=", 
      RowBox[{"Transpose", "[", "\[CapitalLambda]", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Lattice", " ", "setup"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{
      RowBox[{"V", "[", 
       RowBox[{"x0_", ",", "y0_"}], "]"}], ":=", 
      RowBox[{"(", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"t", "=", 
         RowBox[{
          RowBox[{"\[CapitalLambda]", ".", 
           RowBox[{"{", 
            RowBox[{"x0", ",", "y0"}], "}"}]}], "+", "adjust"}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"tt", "=", 
         RowBox[{"{", 
          RowBox[{"t", ",", "t"}], "}"}]}], ";", "\[IndentingNewLine]", "\t", 
        
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"x0", "\[Equal]", "y0", "\[Equal]", "0"}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"(*", " ", 
           RowBox[{"Origin", " ", "arrows"}], " ", "*)"}], 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"{", "\[IndentingNewLine]", "\t", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{"adjust", ",", 
                 RowBox[{"adjust", "+", "L1"}]}], "}"}], "]"}]}], "}"}], ",", 
            "\[IndentingNewLine]", "\t", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"Arrow", "[", 
               RowBox[{"{", 
                RowBox[{"adjust", ",", 
                 RowBox[{"adjust", "+", "L2"}]}], "}"}], "]"}]}], "}"}]}], 
           "\[IndentingNewLine]", "\t", "}"}], ",", "\[IndentingNewLine]", 
          "\t", 
          RowBox[{"(*", " ", 
           RowBox[{"Translated", " ", "arrows"}], " ", "*)"}], 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"{", "\[IndentingNewLine]", "\t", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "Dashed", ",", 
              RowBox[{"Line", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", "L1"}], "}"}], "+", 
                "tt"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", "\t", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", "Dashed", ",", 
              RowBox[{"Line", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", "L2"}], "}"}], "+", 
                "tt"}], "]"}]}], "}"}]}], "\[IndentingNewLine]", "\t", 
           "}"}]}], "]"}]}], "\[IndentingNewLine]", "\t", ")"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Lattice", " ", "generation"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"grids", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", "\t", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Label", "[", "\"\<StartGrid\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"V", "[", 
         RowBox[{"i", ",", "j"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"-", "gz"}], ",", 
          RowBox[{"Max", "[", 
           RowBox[{"1", ",", "gz"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"-", "gz"}], ",", 
          RowBox[{"Max", "[", 
           RowBox[{"1", ",", "gz"}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"temp", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"gz", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"temp", "=", 
         RowBox[{"Delete", "[", 
          RowBox[{"temp", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", "3", "}"}], ",", 
             RowBox[{"{", "4", "}"}], ",", 
             RowBox[{"{", "5", "}"}], ",", 
             RowBox[{"{", "6", "}"}], ",", 
             RowBox[{"{", "7", "}"}], ",", 
             RowBox[{"{", "8", "}"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"Goto", "[", "\"\<One\>\"", "]"}]}]}], "\[IndentingNewLine]", 
      "\t", "]"}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"temp2", "=", 
      RowBox[{
       RowBox[{"4", "gz"}], "+", "2"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"u", "=", 
      RowBox[{"2", "*", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", "gz"}], "+", "1"}], ")"}], "2"]}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"x1", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"i", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "temp2", ",", "u", ",", "temp2"}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"x1", "=", 
      RowBox[{"Replace", "[", 
       RowBox[{"x1", ",", 
        RowBox[{"x_", "\[RuleDelayed]", 
         RowBox[{"{", "x", "}"}]}], ",", 
        RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     
     RowBox[{"x2", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"j", ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"u", "-", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"4", "gz"}], "+", "1"}], ")"}]}], ",", 
          RowBox[{"u", "-", "1"}], ",", "2"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"x2", "=", 
      RowBox[{"Replace", "[", 
       RowBox[{"x2", ",", 
        RowBox[{"x_", "\[RuleDelayed]", 
         RowBox[{"{", "x", "}"}]}], ",", 
        RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     
     RowBox[{"del", "=", 
      RowBox[{"DeleteDuplicates", "@", 
       RowBox[{"Join", "[", 
        RowBox[{"x1", ",", "x2"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"Delete", "[", 
       RowBox[{"temp", ",", "del"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"Label", "[", "\"\<One\>\"", "]"}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"PrependTo", "[", 
      RowBox[{"temp", ",", 
       RowBox[{"Arrowheads", "[", "Medium", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"grid", "=", 
      RowBox[{"Graphics", "[", 
       RowBox[{"temp", ",", "\[IndentingNewLine]", "\t", 
        RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", "\[IndentingNewLine]",
         "\t", 
        RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"Axes", "\[Rule]", "False"}]}], "\[IndentingNewLine]", "\t", 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Optional", ":", " ", 
       RowBox[{"Generate", " ", "several", " ", "grids"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"SD", "&&", 
        RowBox[{"gz", "<", "8"}]}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"grids", ",", "grid"}], "]"}], ";", 
        RowBox[{"gz", "++"}], ";", 
        RowBox[{"Goto", "[", "\"\<StartGrid\>\"", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"Label", "[", "\"\<LatticeDone\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\t", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Consider", " ", "relfections", " ", "outside", " ", "threshold", " ", 
       "to", " ", "be", " ", 
       RowBox[{"wrong", "/", "off"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"off", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"pixlist", ",", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"AllTrue", "[", 
           RowBox[{
            RowBox[{"\[Xi]", "[", "#", "]"}], ",", "IntegerQ"}], "]"}]}], 
         "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "*", " ", "Selecting", " ", "nodes", " ", "that", " ", "match", " ", 
       "the", " ", "pattern"}], " ", "**)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Setup", " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"nodes", "=", 
      RowBox[{"\[Xi]", "/@", "pixlist"}]}], ";", "\[IndentingNewLine]", "\t", 
     
     RowBox[{"hkl", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Riffle", "[", "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"Flatten", "@", "nodes"}], ",", "normhkl", ",", 
          RowBox[{"{", 
           RowBox[{"normorder", ",", 
            RowBox[{"-", "1"}], ",", "3"}], "}"}]}], "]"}], ",", "3"}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\t", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Check", " ", "for", " ", "non"}], "-", 
       RowBox[{"integer", " ", "cases"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<CountNonInteger\>\"", "]"}], ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"hkl", ",", "_Real"}], "]"}]}], ",", "\[IndentingNewLine]",
          "\t\t", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"ReciprocalImageCheck", "::", "threshold"}], ",", 
           "\[IndentingNewLine]", "\t\t", 
           RowBox[{"count", "=", 
            RowBox[{"Count", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"FreeQ", "[", 
                 RowBox[{"#", ",", "_Real"}], "]"}], "&"}], "/@", "hkl"}], 
              ",", "False"}], "]"}]}], ",", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"count", ">", "1"}], ",", "\"\<s were\>\"", ",", 
             "\"\< was\>\""}], "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
         "\t\t", 
         RowBox[{"Message", "[", 
          RowBox[{"ReciprocalImageCheck", "::", "all"}], "]"}]}], 
        "\[IndentingNewLine]", "\t\t", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"selection", "=", 
      RowBox[{"Quiet", "@", 
       RowBox[{"Cases", "[", 
        RowBox[{"hkl", ",", "pattern"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Backtracking", " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"selection2D", "=", 
      RowBox[{"selection", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "sel"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"pos", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"nodes", ",", "#"}], "]"}], "&"}], "/@", "selection2D"}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"matching", "=", 
      RowBox[{"Part", "[", 
       RowBox[{"pixlist", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Selection", " ", "managment"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"matching", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{"matching", ",", "off"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"rest", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{"pixlist", ",", "matching", ",", "off"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Tooltip", " ", "styling", " ", "and", " ", "managment"}], " ", 
      "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"groupfix", "[", "x_", "]"}], ":=", 
      RowBox[{"Quiet", "[", 
       RowBox[{"{", 
        RowBox[{"x", ",", 
         RowBox[{"ToMiller", "@", "\[IndentingNewLine]", "\t", 
          RowBox[{"Insert", "[", 
           RowBox[{
            RowBox[{"\[Xi]", "[", "x", "]"}], ",", "normhkl", ",", 
            RowBox[{"{", "normorder", "}"}]}], "]"}]}]}], "}"}], "]"}]}], ";",
      "\[IndentingNewLine]", "\t", 
     RowBox[{"tooltip", "=", 
      RowBox[{
       RowBox[{"Tooltip", "[", 
        RowBox[{"#1", ",", "#2", ",", 
         RowBox[{"TooltipStyle", "\[Rule]", "\[IndentingNewLine]", "\t", 
          RowBox[{"OptionValue", "[", "\"\<TooltipStyle\>\"", "]"}]}]}], 
        "]"}], "&"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\t\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Special", " ", 
       RowBox[{"case", ":", " ", 
        RowBox[{"Empty", " ", "selections"}]}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"off", "\[Equal]", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"off", "=", 
        RowBox[{"{", 
         RowBox[{"Null", ",", "Null"}], "}"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"rest", "\[Equal]", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"rest", "=", 
        RowBox[{"{", 
         RowBox[{"Null", ",", "Null"}], "}"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"matching", "\[Equal]", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{
        RowBox[{"matching", "=", 
         RowBox[{"{", 
          RowBox[{"Null", ",", "Null"}], "}"}]}], ";", "\[IndentingNewLine]", 
        "\t\t", 
        RowBox[{"Goto", "[", "\"\<SkipMatching\>\"", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Adding", " ", "tooltip"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"matching", "=", 
      RowBox[{"MapThread", "[", 
       RowBox[{"tooltip", ",", "\[IndentingNewLine]", "\t", 
        RowBox[{"Transpose", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", "\[IndentingNewLine]", "\t", 
            RowBox[{
             RowBox[{"pixlist", "[", 
              RowBox[{"[", "#", "]"}], "]"}], ",", "\[IndentingNewLine]", 
             "\t", 
             RowBox[{"ToMiller", "@", 
              RowBox[{"hkl", "[", 
               RowBox[{"[", "#", "]"}], "]"}]}]}], "\[IndentingNewLine]", 
            "\t", "}"}], "&"}], "/@", "pos"}], "]"}]}], "\[IndentingNewLine]",
        "\t", "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"Label", "[", "\"\<SkipMatching\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"rest", "=", 
      RowBox[{"MapThread", "[", 
       RowBox[{"tooltip", ",", 
        RowBox[{"Transpose", "[", 
         RowBox[{"groupfix", "/@", "rest"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"off", "=", 
      RowBox[{"MapThread", "[", 
       RowBox[{"tooltip", ",", 
        RowBox[{"Transpose", "[", 
         RowBox[{"groupfix", "/@", "off"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"*", " ", "Plot"}], " ", "**)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Option", ":", " ", 
       RowBox[{"Custom", " ", "PlotRange"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"pr", "=", 
      RowBox[{"OptionValue", "[", "\"\<PlotRange\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"MatchQ", "[", 
         RowBox[{"pr", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"#", ",", "#"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"#", ",", "#"}], "}"}]}], "}"}], "&"}], "[", 
           "_Integer", "]"}]}], "]"}]}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"pr", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "#"}], "}"}], "&"}], "/@", "imgdim"}]}]}], "]"}],
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"colourmatch", ",", "colourrest", ",", "colouroff"}], "}"}], 
      "=", 
      RowBox[{"OptionValue", "[", "\"\<Colours\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"plotoptions", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Frame", "\[Rule]", 
         RowBox[{"OptionValue", "[", "Frame", "]"}]}], ",", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"ImageSize", "\[Rule]", 
         RowBox[{"OptionValue", "[", "ImageSize", "]"}]}], ",", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"PlotRange", "\[Rule]", "pr"}], ",", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"AspectRatio", "\[Rule]", 
         RowBox[{"1", "/", 
          RowBox[{"Divide", "@@", "imgdim"}]}]}], ",", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"Axes", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"PlotStyle", "\[Rule]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"PointSize", "\[Rule]", 
              RowBox[{"OptionValue", "[", "PointSize", "]"}]}], ",", 
             "Automatic", ",", "colouroff"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"PointSize", "\[Rule]", 
              RowBox[{"OptionValue", "[", "PointSize", "]"}]}], ",", 
             "Automatic", ",", "colourrest"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"PointSize", "\[Rule]", 
              RowBox[{"OptionValue", "[", "PointSize", "]"}]}], ",", 
             "Automatic", ",", "colourmatch"}], "}"}]}], "}"}]}]}], 
       "\[IndentingNewLine]", "\t", "}"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"plotdata", "=", 
      RowBox[{"{", 
       RowBox[{"off", ",", "rest", ",", "matching"}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"plot", "=", 
      RowBox[{"ListPlot", "[", 
       RowBox[{"plotdata", ",", "plotoptions"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"*", " ", "End"}], " ", "**)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Optional", ":", " ", 
       RowBox[{"Store", " ", "data"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<StoreData\>\"", "]"}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"Return", "[", 
        RowBox[{"<|", "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"\"\<Image\>\"", "\[Rule]", "image"}], ",", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{"\"\<ImageGrayscale\>\"", "\[Rule]", 
           RowBox[{"ColorConvert", "[", 
            RowBox[{"image", ",", "\"\<Grayscale\>\""}], "]"}]}], ",", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{"\"\<ImageNegative\>\"", "\[Rule]", 
           RowBox[{"ColorNegate", "[", "image", "]"}]}], ",", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{
          "\"\<ImageGrayscaleNegative\>\"", "\[Rule]", "\[IndentingNewLine]", 
           "\t\t", 
           RowBox[{"ColorConvert", "[", 
            RowBox[{
             RowBox[{"ColorNegate", "[", "image", "]"}], ",", 
             "\"\<Grayscale\>\""}], "]"}]}], ",", "\[IndentingNewLine]", 
          "\t\t", 
          RowBox[{"\"\<ImageBinarised\>\"", "\[Rule]", 
           RowBox[{"Binarize", "[", "image", "]"}]}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<Lattice\>\"", "\[Rule]", "\[CapitalLambda]"}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<LatticeBasic\>\"", "\[Rule]", "L"}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<Adjust\>\"", "\[Rule]", "adjust"}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<Plotdata\>\"", "\[Rule]", "rest"}], ",", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{"\"\<PlotdataMatch\>\"", "\[Rule]", "matching"}], ",", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{"\"\<PlotdataWrong\>\"", "\[Rule]", "off"}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<Grids\>\"", "\[Rule]", "grids"}]}], 
         "\[IndentingNewLine]", "\t", "|>"}], "\[IndentingNewLine]", "\t", 
        "]"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"(*", " ", "Plot", " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{"showgrid", ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"Show", "[", 
        RowBox[{"grid", ",", "plot", ",", "plotoptions"}], "]"}], ",", 
       "\[IndentingNewLine]", "\t", "plot"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, 3.66781928258258*^9, {3.667927651314351*^9, 
   3.667927654536632*^9}, {3.667929095288192*^9, 3.6679291258239803`*^9}, {
   3.667929267909597*^9, 3.6679293218335447`*^9}, {3.667929372921582*^9, 
   3.667929415065257*^9}, {3.667929450855839*^9, 3.667929465310821*^9}, {
   3.667929674490491*^9, 3.667929695296151*^9}, {3.667932801543818*^9, 
   3.667932831774096*^9}, {3.667932972267625*^9, 3.667933072145303*^9}, {
   3.6679331209365664`*^9, 3.6679331662069387`*^9}, {3.667933209078788*^9, 
   3.667933227509615*^9}, {3.6679332584155407`*^9, 3.6679334381219397`*^9}, {
   3.667933545119546*^9, 3.667933638124634*^9}, {3.667933670396723*^9, 
   3.6679337557378597`*^9}, {3.667933854434494*^9, 3.6679339195341597`*^9}, {
   3.6679341282991962`*^9, 3.667934134873889*^9}, {3.6679341782737226`*^9, 
   3.6679341840020323`*^9}, {3.6679362918882227`*^9, 3.66793629955867*^9}, 
   3.6679368778672867`*^9, {3.6679369198504763`*^9, 3.667936939064159*^9}, {
   3.6679369707445602`*^9, 3.667937040468952*^9}, {3.667937292923864*^9, 
   3.667937348973225*^9}, {3.6679374182060013`*^9, 3.667937480746695*^9}, {
   3.667937526410141*^9, 3.667937526969555*^9}, {3.667937583425147*^9, 
   3.667937674742606*^9}, {3.6679377238633833`*^9, 3.667937724894253*^9}, {
   3.667937808371294*^9, 3.6679378269471397`*^9}, {3.6679378802105713`*^9, 
   3.6679379711123447`*^9}, {3.667938005718261*^9, 3.6679380215741*^9}, {
   3.6679380570319643`*^9, 3.667938083541068*^9}, 3.6679381599247704`*^9, {
   3.66793820112397*^9, 3.66793823159343*^9}, {3.6679382956572037`*^9, 
   3.667938323449614*^9}, {3.667938366874012*^9, 3.667938389394507*^9}, {
   3.667938438128626*^9, 3.667938482933886*^9}, {3.6679385245828333`*^9, 
   3.667938637513776*^9}, {3.667938678441284*^9, 3.6679386932649508`*^9}, {
   3.667938766302857*^9, 3.667938772390689*^9}, {3.6679388267453012`*^9, 
   3.66793883006816*^9}, {3.667938882518243*^9, 3.6679389128181973`*^9}, {
   3.667938969803068*^9, 3.667939039336431*^9}, {3.667939320219082*^9, 
   3.667939341625779*^9}, 3.6679393770581408`*^9, {3.667939469232902*^9, 
   3.667939497964835*^9}, {3.667939532149186*^9, 3.6679395720840807`*^9}, 
   3.667939642501049*^9, 3.667939694842989*^9, {3.667939989576542*^9, 
   3.6679399917123747`*^9}, {3.6679401365541153`*^9, 
   3.6679401648221617`*^9}, {3.6679692529322023`*^9, 
   3.6679692701706533`*^9}, {3.667969341866721*^9, 3.667969376607637*^9}, {
   3.667970147145928*^9, 3.667970151592761*^9}, {3.667970216297092*^9, 
   3.6679702636391077`*^9}, {3.667970383427594*^9, 3.667970398444811*^9}, {
   3.667970463193151*^9, 3.667970504208695*^9}, {3.667971051562167*^9, 
   3.667971074354063*^9}, {3.667971771279505*^9, 3.667971780398533*^9}, {
   3.667973403161166*^9, 3.667973405361252*^9}, 3.667990367536018*^9, 
   3.6679914757391148`*^9, 3.667992175946229*^9, {3.667995104529952*^9, 
   3.667995106057413*^9}, {3.667995855313924*^9, 3.6679958569938917`*^9}, {
   3.668019108513597*^9, 3.668019128352426*^9}, {3.668019279072505*^9, 
   3.668019279848213*^9}, {3.668021278816801*^9, 3.668021282112631*^9}, {
   3.668021313401822*^9, 3.668021390441625*^9}, {3.6680214213580303`*^9, 
   3.668021451698588*^9}, {3.668021555880783*^9, 3.6680215849273357`*^9}, 
   3.668057813132045*^9, {3.668058136762526*^9, 3.668058164915876*^9}, {
   3.668058379699932*^9, 3.668058399154965*^9}, {3.6680584419942427`*^9, 
   3.668058535166953*^9}, {3.6680585771843357`*^9, 3.668058585352005*^9}, {
   3.668058667869895*^9, 3.668058671764526*^9}, {3.668059350708185*^9, 
   3.668059390641903*^9}, {3.668059561240314*^9, 3.668059570492672*^9}, {
   3.66805963935712*^9, 3.668059696425672*^9}, {3.668098237468328*^9, 
   3.668098249995756*^9}, {3.6681000141884813`*^9, 3.66810004431769*^9}, {
   3.668102295375621*^9, 3.668102328261784*^9}, {3.668143501205806*^9, 
   3.66814352368707*^9}, {3.668149871172584*^9, 3.668149875216461*^9}, {
   3.669519749593667*^9, 3.669519751591695*^9}, {3.6695563106568947`*^9, 
   3.669556316832087*^9}, {3.669556375703582*^9, 3.669556375942615*^9}, {
   3.669556527484511*^9, 3.6695565277148*^9}, {3.671344373430882*^9, 
   3.6713443736693897`*^9}, {3.6713446182723618`*^9, 3.671344618519547*^9}, {
   3.671344657281046*^9, 3.671344657415612*^9}, {3.671346974817726*^9, 
   3.671347016688924*^9}, {3.671347556830886*^9, 3.671347635440847*^9}, {
   3.6713476776843443`*^9, 3.671347679288475*^9}, {3.671347719383917*^9, 
   3.671347795245021*^9}, {3.671347853822792*^9, 3.6713478877165747`*^9}, {
   3.671348259934767*^9, 3.671348271084628*^9}, {3.671348314653845*^9, 
   3.6713483159313307`*^9}, {3.671351806693378*^9, 3.671351808371985*^9}, {
   3.671351925105709*^9, 3.6713519328813066`*^9}, {3.671352042856463*^9, 
   3.6713520444954348`*^9}, {3.671352141564987*^9, 3.6713521418921757`*^9}, {
   3.67135433001543*^9, 3.671354354775991*^9}, {3.6713543903521852`*^9, 
   3.671354407759055*^9}, {3.671354507228725*^9, 3.671354510406054*^9}, {
   3.671354581932342*^9, 3.67135461566549*^9}, {3.671354653643035*^9, 
   3.671354653697824*^9}, {3.6713547964307623`*^9, 3.6713547984468317`*^9}, {
   3.671354832134036*^9, 3.671354833102087*^9}, {3.67135529549364*^9, 
   3.671355302546892*^9}, {3.671355573087512*^9, 3.671355582974106*^9}, {
   3.671356555785466*^9, 3.6713565631134987`*^9}, {3.671356796908342*^9, 
   3.671356807093913*^9}, {3.671356934530822*^9, 3.671356940432358*^9}, {
   3.671356982272311*^9, 3.671357013320292*^9}, {3.6713574599357767`*^9, 
   3.6713574887658043`*^9}, 3.671357559702499*^9, {3.671358859881794*^9, 
   3.6713588975738163`*^9}, {3.6713589308612833`*^9, 3.671358950341908*^9}, 
   3.671359851957679*^9, {3.671360146383136*^9, 3.671360211557448*^9}, {
   3.671361450673636*^9, 3.671361450855844*^9}, {3.671361547079302*^9, 
   3.6713615655118837`*^9}, {3.6713722035701437`*^9, 3.671372204879589*^9}, 
   3.6713885646487226`*^9, {3.6713886420824947`*^9, 3.671388651920701*^9}, {
   3.6713887667366743`*^9, 3.671388767616539*^9}, {3.671389203847748*^9, 
   3.6713892089594584`*^9}, {3.67138931525079*^9, 3.6713893249230957`*^9}, {
   3.671389403263423*^9, 3.671389448584199*^9}, {3.671389482721499*^9, 
   3.671389552266603*^9}, {3.6713895972521553`*^9, 3.671389638503859*^9}, {
   3.671389675267129*^9, 3.6713896774792337`*^9}, 3.6713897131154537`*^9, {
   3.671806709661995*^9, 3.671806728097248*^9}, 3.6718073146802807`*^9, {
   3.671911114402894*^9, 3.671911120386015*^9}, {3.67195946711077*^9, 
   3.671959474991378*^9}, {3.6719595218231688`*^9, 3.67195952199016*^9}, {
   3.674582941255888*^9, 3.674582961526577*^9}, {3.674583042374473*^9, 
   3.674583044373474*^9}, {3.674583075638014*^9, 3.674583124381897*^9}, {
   3.6745831719336767`*^9, 3.674583173804262*^9}, 3.67458324742804*^9, {
   3.687156775422434*^9, 3.687156781933877*^9}, 3.687164508774666*^9, {
   3.6871645394569683`*^9, 3.687164718554234*^9}, {3.687165246225195*^9, 
   3.687165390883108*^9}, {3.687165450522169*^9, 3.6871655616493053`*^9}, {
   3.687165646846031*^9, 3.687165664977735*^9}, {3.687165710844844*^9, 
   3.687165717857222*^9}, {3.6871657857219877`*^9, 3.6871657877356358`*^9}, {
   3.6871658493381023`*^9, 3.687165871669606*^9}, {3.687165904197296*^9, 
   3.687165996079699*^9}, {3.6871660295334883`*^9, 3.687166153093152*^9}, {
   3.687166192079156*^9, 3.687166246078738*^9}, {3.6871668605632353`*^9, 
   3.6871669433889227`*^9}, 3.687166977069869*^9, {3.687167109987769*^9, 
   3.687167208870311*^9}, {3.687167238984859*^9, 3.6871677862844477`*^9}, 
   3.687167881607252*^9, {3.6871679214931793`*^9, 3.687168147685855*^9}, {
   3.6871682126935883`*^9, 3.687168275207411*^9}, {3.687168432381917*^9, 
   3.687168586540969*^9}, 3.687168628404684*^9, {3.687168658442284*^9, 
   3.687168663527091*^9}, 3.687169005717609*^9, 3.687169293454012*^9, {
   3.68750633090869*^9, 3.68750633648623*^9}, {3.6875071841161757`*^9, 
   3.687507184303252*^9}, {3.687507329340541*^9, 3.68750734744081*^9}, {
   3.687507400920726*^9, 3.687507423975339*^9}, {3.6875076419535522`*^9, 
   3.687507642224166*^9}, {3.687507713412353*^9, 3.6875077551581697`*^9}, {
   3.6875078576324587`*^9, 3.6875078877691603`*^9}, {3.687509544613727*^9, 
   3.6875095534866037`*^9}, {3.687509706784939*^9, 3.6875097103088217`*^9}, {
   3.687509833577773*^9, 3.68750989972786*^9}, {3.687509935327718*^9, 
   3.687509937855692*^9}, {3.687510167577135*^9, 3.6875101802065897`*^9}, {
   3.687510280296921*^9, 3.6875103742068367`*^9}, {3.687510514864278*^9, 
   3.687510517693245*^9}, {3.687510833967678*^9, 3.687510836634856*^9}, {
   3.687511073932612*^9, 3.687511074191729*^9}, {3.687512065559246*^9, 
   3.6875120662299633`*^9}, {3.68751234598036*^9, 3.687512347377809*^9}, {
   3.687514748805332*^9, 3.687514762556086*^9}, {3.6875147988089447`*^9, 
   3.687514862911953*^9}, {3.6875150221086493`*^9, 3.687515113015212*^9}, {
   3.687515242879355*^9, 3.6875152576859617`*^9}, {3.6875153755411043`*^9, 
   3.6875153761781673`*^9}, {3.687516002196384*^9, 3.687516030150734*^9}, {
   3.6875165012670918`*^9, 3.6875165247399*^9}, {3.6875165694845133`*^9, 
   3.687516572040914*^9}, {3.687516612818783*^9, 3.687516645184465*^9}, {
   3.687516683884563*^9, 3.687516724914262*^9}, {3.687516944466934*^9, 
   3.687516945219212*^9}, {3.687517002357984*^9, 3.687517023874254*^9}, 
   3.6875171351822653`*^9, {3.6875183237381067`*^9, 3.687518324957768*^9}, {
   3.687518398182641*^9, 3.68751841327169*^9}, {3.6875185644568996`*^9, 
   3.687518565549593*^9}, {3.68751886454458*^9, 3.687518891383182*^9}, {
   3.687519022393402*^9, 3.687519061776618*^9}, {3.6875190956572533`*^9, 
   3.687519182765481*^9}, {3.687519279346684*^9, 3.687519413303564*^9}, {
   3.6875194796623383`*^9, 3.687519523955543*^9}, 3.687519663585091*^9, {
   3.687519806348749*^9, 3.6875199887548847`*^9}, {3.6875200763660994`*^9, 
   3.687520141546947*^9}, {3.687520178418494*^9, 3.687520343242195*^9}, {
   3.687520527435096*^9, 3.6875205422137814`*^9}, {3.687520703883664*^9, 
   3.687520714415331*^9}, {3.687520748045477*^9, 3.6875207525783157`*^9}, {
   3.687521196110949*^9, 3.687521217133346*^9}, {3.6875212614386787`*^9, 
   3.6875212689137173`*^9}, {3.687521699605805*^9, 3.687521728841394*^9}, {
   3.6875217702469683`*^9, 3.687521790955085*^9}, {3.687521965231024*^9, 
   3.68752196773971*^9}, {3.6875220762878723`*^9, 3.68752207955971*^9}, 
   3.6875221341628*^9, {3.687522181579337*^9, 3.6875221857643147`*^9}, {
   3.687522225843388*^9, 3.6875223170336237`*^9}, {3.68752234812294*^9, 
   3.6875223735999107`*^9}, {3.6876686273963747`*^9, 3.687668651273189*^9}, {
   3.687669052317815*^9, 3.687669072963629*^9}, {3.687669221852079*^9, 
   3.687669231600322*^9}, 3.687669412928665*^9, {3.6876694739967422`*^9, 
   3.6876695144406843`*^9}, {3.6876708510183077`*^9, 3.687670879758339*^9}, {
   3.6876719237499723`*^9, 3.687671956628632*^9}, {3.6876719935829067`*^9, 
   3.687672018688109*^9}, {3.687672049692421*^9, 3.687672059143203*^9}, {
   3.687678052571329*^9, 3.687678061479775*^9}, {3.6876815475701523`*^9, 
   3.687681601640286*^9}, {3.687691708586556*^9, 3.6876917119783363`*^9}, {
   3.6876920372162*^9, 3.687692037367296*^9}, {3.687861711022195*^9, 
   3.687861735186718*^9}, {3.6878617699180517`*^9, 3.687861821841461*^9}, {
   3.687861855943221*^9, 3.687861900257381*^9}, 3.6878631121381683`*^9, {
   3.687863166001348*^9, 3.6878632357037086`*^9}, {3.687863297125453*^9, 
   3.6878633093477488`*^9}, {3.6878634144485273`*^9, 3.687863440543641*^9}, {
   3.6878635134405622`*^9, 3.6878635475897827`*^9}, {3.687863656295929*^9, 
   3.687863717150881*^9}, {3.687863768602734*^9, 3.687863813012793*^9}, {
   3.687863891791483*^9, 3.687863892735425*^9}, {3.68786392314459*^9, 
   3.687863938361341*^9}, {3.687864241126114*^9, 3.687864381110055*^9}, {
   3.68786442924084*^9, 3.687864552200337*^9}, {3.687864599173511*^9, 
   3.687864618328858*^9}, {3.687864667932199*^9, 3.687864692086171*^9}, {
   3.687864753006353*^9, 3.687864894596149*^9}, {3.687865192458065*^9, 
   3.687865227041898*^9}, {3.687865400024457*^9, 3.687865406423842*^9}, {
   3.6878659096425047`*^9, 3.687865947266676*^9}, {3.687865981660466*^9, 
   3.687865989851564*^9}, {3.6881267638468*^9, 3.688126781856586*^9}, {
   3.688126813279327*^9, 3.6881271692244463`*^9}, {3.688127225652492*^9, 
   3.688127281666382*^9}, {3.688127439709325*^9, 3.688127480871084*^9}, 
   3.688127512373879*^9, {3.688127553320573*^9, 3.68812755398044*^9}, {
   3.688127650793001*^9, 3.6881278726644087`*^9}, {3.688127919436009*^9, 
   3.688128024792449*^9}, {3.688128064984997*^9, 3.688128065652214*^9}, {
   3.688128133919053*^9, 3.688128219141905*^9}, {3.688128331504766*^9, 
   3.688128348212882*^9}, {3.68812842135893*^9, 3.688128501203792*^9}, {
   3.688128578509428*^9, 3.688128601410139*^9}, {3.688128690322328*^9, 
   3.688128735595336*^9}, {3.688128822364902*^9, 3.688128861848989*^9}, {
   3.688128921153905*^9, 3.6881289463480663`*^9}, {3.688128990765437*^9, 
   3.688129029272183*^9}, {3.688129089255213*^9, 3.688129094279276*^9}, {
   3.688129134305854*^9, 3.6881292730710773`*^9}, {3.6881465195183*^9, 
   3.688146524995182*^9}, {3.68814655619547*^9, 3.688146641081154*^9}, {
   3.688146684212517*^9, 3.688146807271761*^9}, {3.688146962193809*^9, 
   3.688146962567013*^9}, {3.688147017668222*^9, 3.688147052517234*^9}, {
   3.6881471414269114`*^9, 3.688147177803094*^9}, {3.688147247579743*^9, 
   3.688147297679015*^9}, {3.688147346935234*^9, 3.688147354976241*^9}, {
   3.688147391222777*^9, 3.688147395894573*^9}, {3.688147444480929*^9, 
   3.688147499317027*^9}, {3.6881475781337633`*^9, 3.688147610577223*^9}, {
   3.6881476745811653`*^9, 3.6881477683213873`*^9}, {3.688186721038027*^9, 
   3.6881867215562563`*^9}, {3.688186966939413*^9, 3.688186967535561*^9}, {
   3.68819148816154*^9, 3.6881915822168627`*^9}, {3.688191679333376*^9, 
   3.688191715244688*^9}, {3.6881917649517107`*^9, 3.688191766155924*^9}, {
   3.688192180136743*^9, 3.688192192228733*^9}, {3.688192366353334*^9, 
   3.688192439675796*^9}, {3.688192601562984*^9, 3.68819261857239*^9}, {
   3.688192693418126*^9, 3.6881927823590183`*^9}, {3.688192835817779*^9, 
   3.688192837581232*^9}, {3.688192876509275*^9, 3.688192885736589*^9}, {
   3.688192933504092*^9, 3.688192962975136*^9}, {3.688193016864141*^9, 
   3.688193147605221*^9}, {3.688193226631628*^9, 3.688193250588456*^9}, 
   3.6881932871489553`*^9, {3.6881934369086227`*^9, 3.6881934377091017`*^9}, 
   3.688193888436359*^9, {3.68827870320015*^9, 3.688278745786932*^9}, {
   3.688279867027066*^9, 3.688279873328266*^9}, {3.688281310768528*^9, 
   3.6882813540220747`*^9}, {3.688281401439827*^9, 3.688281443632139*^9}, {
   3.688281489159092*^9, 3.688281522219717*^9}, 3.688281585283691*^9, {
   3.688281629377688*^9, 3.6882816382592497`*^9}, {3.688281827595358*^9, 
   3.688281837415002*^9}, {3.688281895131445*^9, 3.688281986560493*^9}, {
   3.6882840199216003`*^9, 3.688284062897357*^9}, 3.688284096387642*^9, {
   3.688284218942671*^9, 3.688284275867519*^9}, {3.688284394168859*^9, 
   3.6882844495841*^9}, {3.688285129326865*^9, 3.6882851308678083`*^9}, {
   3.688288327231152*^9, 3.688288384783165*^9}, {3.688293063190908*^9, 
   3.6882930641267643`*^9}, {3.688297537916748*^9, 3.6882975833392277`*^9}, {
   3.68829801661409*^9, 3.6882980731607018`*^9}, {3.688299551066402*^9, 
   3.688299562144874*^9}, {3.688300900482009*^9, 3.688300910395095*^9}, {
   3.688360492469249*^9, 3.688360511436487*^9}, {3.688360624931951*^9, 
   3.688360627463565*^9}, {3.688880504257531*^9, 3.6888805253276567`*^9}, {
   3.688891789432199*^9, 3.6888917903726683`*^9}, {3.688894187838941*^9, 
   3.688894207337967*^9}, {3.6889003583112717`*^9, 3.688900368289029*^9}, {
   3.688937564965316*^9, 3.688937567425077*^9}, {3.6889376607109337`*^9, 
   3.688937678117669*^9}, {3.68893774692369*^9, 3.688937755983369*^9}, {
   3.6889377924952507`*^9, 3.6889378358089857`*^9}, {3.6889378986873407`*^9, 
   3.688937999505767*^9}, {3.688938099054064*^9, 3.688938168750766*^9}, {
   3.688938233749807*^9, 3.68893824083641*^9}, {3.688938308543055*^9, 
   3.6889383454914627`*^9}, {3.688938390207061*^9, 3.688938390924144*^9}, {
   3.713874107520574*^9, 3.7138741424861526`*^9}, {3.714129943250423*^9, 
   3.714129954600395*^9}, {3.71412999923943*^9, 3.714130005919458*^9}, {
   3.714199796296146*^9, 3.714199797509729*^9}, {3.714201044679081*^9, 
   3.714201053314817*^9}, {3.7142024150579453`*^9, 3.7142024269417686`*^9}, {
   3.715333526187746*^9, 3.715333552478838*^9}, {3.715333596840613*^9, 
   3.7153336189267*^9}, 3.7153347036928*^9, {3.7153347801787357`*^9, 
   3.715334822889534*^9}, {3.715335703580905*^9, 3.715335733109145*^9}, {
   3.715336054049705*^9, 3.7153360541917477`*^9}, {3.715336155641518*^9, 
   3.715336265520912*^9}, {3.715336320107382*^9, 3.715336330751687*^9}, {
   3.715336448177416*^9, 3.7153364577322807`*^9}, {3.7153364956595173`*^9, 
   3.715336495804838*^9}, 3.715336550828467*^9, 3.715336642896287*^9, {
   3.715852050263661*^9, 3.715852050597019*^9}, {3.7177408404502277`*^9, 
   3.717740856188644*^9}, {3.717740897228889*^9, 3.717740915600151*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"3b83ef0b-0c8c-4ac7-9196-92cf80e66ed5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$PixelData", "=", 
   RowBox[{"<|", "|>"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667991880825115*^9, 3.667991885921834*^9}, {
  3.688359763770588*^9, 3.6883597639539633`*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"e3f2376a-5d15-4f48-a826-31ba13fc4867"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"1b3f4c1b-87f9-4af0-bdf7-c3f161486632"]
}, Closed]],

Cell[CellGroupData[{

Cell["ReciprocalSpaceTool", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, 3.667900125753806*^9, {3.6846465171332808`*^9, 
   3.684646521502282*^9}, {3.688187362458959*^9, 
   3.68818736898453*^9}},ExpressionUUID->"9bd7a065-171d-467a-b863-\
5ea43593a2ec"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"007b628d-f354-4796-a22a-fa75e414fec7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "@", "ReciprocalSpaceTool"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{"\"\<TooltipStyle\>\"", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"FontFamily", "\[Rule]", "\"\<Inconsolata\>\""}], ",", 
       RowBox[{"FontSize", "\[Rule]", "14"}]}], "}"}]}], 
    "\[IndentingNewLine]", "}"}]}], ";"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"eb758cc0-e57a-4769-b494-8d15ad3f0765"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"521364a0-76d2-411d-bea3-66fb350aefde"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReciprocalSpaceTool", "[", "\[IndentingNewLine]", 
   RowBox[{
   "input_String", ",", "\[IndentingNewLine]", "system_", ",", 
    "\[IndentingNewLine]", "data_List", ",", "\[IndentingNewLine]", 
    RowBox[{"Optional", "[", 
     RowBox[{"pattern_Condition", ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x1_", ",", "x2_", ",", "x3_"}], "}"}], "/;", "False"}]}], 
     "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"OptionsPattern", "@", "ReciprocalSpaceTool"}]}], 
   "\[IndentingNewLine]", "]"}], ":=", 
  RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
       "xraytemp", ",", "lastinput", ",", "\[IndentingNewLine]", "adjust", 
        ",", "\[IndentingNewLine]", "img", ",", "imgN", ",", "imgG", ",", 
        "imgNG", ",", "imgB", ",", "\[IndentingNewLine]", "L", ",", "pd", ",",
         "pdMatch", ",", "pdOff", ",", "grids", ",", "\[IndentingNewLine]", 
        "sim1", ",", "tooltip", ",", "SIM1", ",", "data2D", ",", 
        "\[IndentingNewLine]", "\[CapitalLambda]", ",", "\[CapitalGamma]", 
        ",", "\[Xi]", ",", "\[Chi]", ",", "r", ",", "\[CapitalLambda]1x", ",",
         "\[CapitalLambda]1y", ",", "\[CapitalLambda]2x", ",", 
        "\[CapitalLambda]2y", ",", "p", ",", "\[Lambda]1", ",", "\[Lambda]2", 
        ",", "tx", ",", "ty", ",", "h1h2", ",", "xy", ",", 
        "\[IndentingNewLine]", "\[Sigma]", ",", "\[Tau]x", ",", "\[Tau]y", 
        ",", "xysim1", ",", "hksim1", ",", "sim1data", ",", 
        "\[IndentingNewLine]", "plots", ",", "\[IndentingNewLine]", 
        "plotbackground", ",", "\[IndentingNewLine]", "N1", ",", "N2", ",", 
        "N3", ",", "plotoptions", ",", "plotaxes", ",", "plotgrid"}], "}"}], 
      ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"*", " ", "Input", " ", "check"}], " ", "**)"}], 
      "\[IndentingNewLine]", "\t", 
      RowBox[{"(*", " ", 
       RowBox[{"Check", " ", "temporary", " ", "variables"}], " ", "*)"}], 
      "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"Label", "[", "\"\<CollectData\>\"", "]"}], ";", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"xraytemp", "=", "$XrayTemp"}], ";", "\[IndentingNewLine]", 
       "\t", 
       RowBox[{"lastinput", "=", "$XrayTempLast"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{"update", ",", 
         RowBox[{
          RowBox[{"lastinput", "=", "\"\<False\>\""}], ";", 
          RowBox[{"update", "=", "False"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"lastinput", "===", "input"}], "&&", 
          RowBox[{"AssociationQ", "@", "$XrayTemp"}]}], ",", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{"(*", " ", 
          RowBox[{"Use", " ", "stored", " ", "data"}], " ", "*)"}], 
         "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "img", ",", "imgN", ",", "imgG", ",", "imgNG", ",", "imgB", ",", 
            "\[IndentingNewLine]", "\t", "\[CapitalLambda]", ",", "L", ",", 
            "adjust", ",", "\[IndentingNewLine]", "\t", "pd", ",", "pdMatch", 
            ",", "pdOff", ",", "\[IndentingNewLine]", "\t", "grids"}], "}"}], 
          "=", "\[IndentingNewLine]", "\t", 
          RowBox[{"Values", "@", 
           RowBox[{"xraytemp", "[", 
            RowBox[{"[", 
             RowBox[{"{", "\[IndentingNewLine]", "\t", 
              RowBox[{
              "\"\<Image\>\"", ",", "\"\<ImageNegative\>\"", ",", 
               "\"\<ImageGrayscale\>\"", ",", "\[IndentingNewLine]", "\t", 
               "\"\<ImageGrayscaleNegative\>\"", ",", 
               "\"\<ImageBinarised\>\"", ",", "\[IndentingNewLine]", "\t", 
               "\"\<Lattice\>\"", ",", "\"\<LatticeBasic\>\"", ",", 
               "\"\<Adjust\>\"", ",", "\[IndentingNewLine]", "\t", 
               "\"\<Plotdata\>\"", ",", "\"\<PlotdataMatch\>\"", ",", 
               "\"\<PlotdataWrong\>\"", ",", "\[IndentingNewLine]", "\t", 
               "\"\<Grids\>\""}], "\[IndentingNewLine]", "\t", "}"}], "]"}], 
            "]"}]}]}], ",", "\[IndentingNewLine]", "\t", 
         RowBox[{"(*", " ", 
          RowBox[{"Collect", " ", "new", " ", "data"}], " ", "*)"}], 
         "\[IndentingNewLine]", "\t\t", 
         RowBox[{"(*", " ", 
          RowBox[{"Update", " ", "temporary", " ", "variables"}], " ", "*)"}],
          "\[IndentingNewLine]", "\t\t", 
         RowBox[{
          RowBox[{"$XrayTemp", "=", 
           RowBox[{"ReciprocalImageCheck", "[", "\[IndentingNewLine]", "\t\t", 
            RowBox[{
            "input", ",", "system", ",", "data", ",", "pattern", ",", 
             "\[IndentingNewLine]", "\t\t", 
             RowBox[{"\"\<StoreData\>\"", "\[Rule]", "True"}]}], "]"}]}], ";",
           "\[IndentingNewLine]", "\t\t", 
          RowBox[{"(*", " ", "Update", "  ", "*)"}], "\[IndentingNewLine]", 
          "\t\t", 
          RowBox[{"$XrayTempLast", "=", "input"}], ";", "\[IndentingNewLine]",
           "\t\t", 
          RowBox[{"(*", " ", 
           RowBox[{"Go", " ", "back", " ", "and", " ", "load", " ", "data"}], 
           " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
          RowBox[{"Goto", "[", "\"\<CollectData\>\"", "]"}]}]}], 
        "\[IndentingNewLine]", "\t", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"*", " ", "Plot", " ", "layers"}], " ", "**)"}], 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"plots", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"Background", " ", "image", " ", "processing"}], " ", "*)"}], 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"plotbackground", "=", 
        RowBox[{"Which", "[", "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"LAimage", "\[Equal]", "\"\<Original\>\""}], ",", "img", 
          ",", "\[IndentingNewLine]", "\t", 
          RowBox[{"LAimage", "\[Equal]", "\"\<Negative\>\""}], ",", "imgN", 
          ",", "\[IndentingNewLine]", "\t", 
          RowBox[{"LAimage", "\[Equal]", "\"\<Grayscale\>\""}], ",", "imgG", 
          ",", "\[IndentingNewLine]", "\t", 
          RowBox[{"LAimage", "\[Equal]", "\"\<Negative + Grayscale\>\""}], 
          ",", "imgNG", ",", "\[IndentingNewLine]", "\t", 
          RowBox[{"LAimage", "\[Equal]", "\"\<Binarised\>\""}], ",", "imgB", 
          ",", "\[IndentingNewLine]", "\t", "True", ",", "False"}], 
         "\[IndentingNewLine]", "\t", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ImageQ", "@", "plotbackground"}], ",", 
         "\[IndentingNewLine]", "\t", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", "plotbackground"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", "Grid", " ", "*)"}], "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"IntegerQ", "@", "LAsize"}], ",", "\[IndentingNewLine]", 
         "\t", 
         RowBox[{
          RowBox[{"plotgrid", "=", 
           RowBox[{"grids", "[", 
            RowBox[{"[", "LAsize", "]"}], "]"}]}], ";", "\[IndentingNewLine]",
           "\t", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", "plotgrid"}], "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"Extracted", " ", "nodes"}], " ", "*)"}], 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"pd", "\[NotEqual]", 
          RowBox[{"{", 
           RowBox[{"Null", ",", "Null"}], "}"}]}], ",", "\[IndentingNewLine]",
          "\t", 
         RowBox[{"N1enable", "=", "True"}], ",", "\[IndentingNewLine]", "\t", 
         
         RowBox[{"N1enable", "=", "False"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"N1", "=", 
        RowBox[{"ListPlot", "[", 
         RowBox[{"pd", ",", 
          RowBox[{"Axes", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
          "\t", 
          RowBox[{"PlotStyle", "\[Rule]", 
           RowBox[{"{", "\[IndentingNewLine]", "\t", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"PointSize", "\[Rule]", "Large"}], ",", 
              "\[IndentingNewLine]", "\t", "Automatic", ",", 
              "\[IndentingNewLine]", "\t", "N1colour", ",", 
              "\[IndentingNewLine]", "\t", 
              RowBox[{"Opacity", "[", "N1opacity", "]"}]}], "}"}], "}"}]}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{"N1show", ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", "N1"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"Nodes", " ", "matching", " ", "condition"}], " ", "*)"}], 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"pdMatch", "\[NotEqual]", 
          RowBox[{"{", 
           RowBox[{"Null", ",", "Null"}], "}"}]}], ",", "\[IndentingNewLine]",
          "\t", 
         RowBox[{"N2enable", "=", "True"}], ",", "\[IndentingNewLine]", "\t", 
         
         RowBox[{"N2enable", "=", "False"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"N2", "=", 
        RowBox[{"ListPlot", "[", 
         RowBox[{"pdMatch", ",", 
          RowBox[{"Axes", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
          "\t", 
          RowBox[{"PlotStyle", "\[Rule]", 
           RowBox[{"{", "\[IndentingNewLine]", "\t", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"PointSize", "\[Rule]", "Large"}], ",", 
              "\[IndentingNewLine]", "\t", "Automatic", ",", 
              "\[IndentingNewLine]", "\t", "N2colour", ",", 
              "\[IndentingNewLine]", "\t", 
              RowBox[{"Opacity", "[", "N2opacity", "]"}]}], "}"}], "}"}]}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{"N2show", ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", "N2"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"Wrong", " ", "nodes"}], " ", "*)"}], "\[IndentingNewLine]", 
       "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"pdOff", "\[NotEqual]", 
          RowBox[{"{", 
           RowBox[{"Null", ",", "Null"}], "}"}]}], ",", "\[IndentingNewLine]",
          "\t", 
         RowBox[{"N3enable", "=", "True"}], ",", "\[IndentingNewLine]", "\t", 
         
         RowBox[{"N3enable", "=", "False"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"N3", "=", 
        RowBox[{"ListPlot", "[", 
         RowBox[{"pdOff", ",", 
          RowBox[{"Axes", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
          "\t", 
          RowBox[{"PlotStyle", "\[Rule]", 
           RowBox[{"{", "\[IndentingNewLine]", "\t", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"PointSize", "\[Rule]", "Large"}], ",", 
              "\[IndentingNewLine]", "\t", "Automatic", ",", 
              "\[IndentingNewLine]", "\t", "N3colour", ",", 
              "\[IndentingNewLine]", "\t", 
              RowBox[{"Opacity", "[", "N3opacity", "]"}]}], "}"}], "}"}]}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{"N3show", ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", "N3"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"*", " ", "Simulated", " ", "nodes"}], " ", "**)"}], 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{"SIM1calc", ",", "\[IndentingNewLine]", "\t", 
         RowBox[{"(*", " ", 
          RowBox[{"Generate", " ", "simulated", " ", "nodes"}], " ", "*)"}], 
         "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"sim1", "=", 
           RowBox[{
           "ReciprocalSpaceSimulation", "[", "\[IndentingNewLine]", "\t", 
            RowBox[{
            "SIM1name", ",", "SIM1plane", ",", "\[IndentingNewLine]", "\t", 
             RowBox[{
              RowBox[{
               RowBox[{"Total", "[", "SIM1plane", "]"}], "-", "1"}], "/.", 
              RowBox[{
               RowBox[{"-", "1"}], "\[Rule]", "SIM1level"}]}], ",", 
             "\[IndentingNewLine]", "\t", "SIM1res", ",", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{"\"\<ReturnData\>\"", "\[Rule]", "True"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
          RowBox[{"(*", " ", 
           RowBox[{"Lattice", " ", "components", " ", "and", " ", "misc"}], 
           " ", "*)"}], "\[IndentingNewLine]", "\t", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[CapitalLambda]1x", ",", "\[CapitalLambda]2x"}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"\[CapitalLambda]1y", ",", "\[CapitalLambda]2y"}], 
              "}"}]}], "}"}], "=", "\[CapitalLambda]"}], ";", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"tx", ",", "ty"}], "}"}], "=", "adjust"}], ";", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"p", "=", 
           RowBox[{"First", "@", 
            RowBox[{"Flatten", "@", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{"Total", "[", "SIM1plane", "]"}], ",", "0"}], 
              "]"}]}]}]}], ";", "\[IndentingNewLine]", "\t", 
          RowBox[{"sim1", "=", 
           RowBox[{"Delete", "[", 
            RowBox[{"sim1", ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"i", ",", "2", ",", "p"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"Length", "@", "sim1"}]}], "}"}]}], "]"}]}], "]"}]}],
           ";", "\[IndentingNewLine]", "\t", 
          RowBox[{"data2D", "=", 
           RowBox[{"Partition", "[", 
            RowBox[{
             RowBox[{"Flatten", "@", "sim1"}], ",", "4"}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Function", " ", "for", " ", "calculating", " ", "residue"}], " ", 
           "*)"}], "\[IndentingNewLine]", "\t", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"x_", ",", "y_", ",", "h1_", ",", "h2_"}], "}"}], ",", 
             "\[Sigma]_", ",", "\[Tau]x_", ",", "\[Tau]y_"}], "]"}], ":=", 
           RowBox[{"N", "[", "\[IndentingNewLine]", "\t", 
            RowBox[{
             RowBox[{"Sqrt", "[", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"\[Sigma]", "*", "x"}], "+", "\[Tau]x"}], ")"}], 
                "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"\[Sigma]", "*", "y"}], "+", "\[Tau]y"}], ")"}], 
                "2"]}], "]"}], "-", "\[IndentingNewLine]", "\t", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"tx", "+", 
                  RowBox[{"h1", "*", "\[CapitalLambda]1x"}], "+", 
                  RowBox[{"h2", "*", "\[CapitalLambda]2x"}]}], ")"}], "2"], 
               "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"ty", "+", 
                  RowBox[{"h1", "*", "\[CapitalLambda]1y"}], "+", 
                  RowBox[{"h2", "*", "\[CapitalLambda]2y"}]}], ")"}], "2"]}], 
              "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Determining", " ", "scaling", " ", "factors", " ", "by", " ", 
            "iteration"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[Sigma]", ",", "\[Tau]x", ",", "\[Tau]y"}], "}"}], "=", 
           
           RowBox[{
           "NonlinearLeastSquares", "[", "\[IndentingNewLine]", "\t", 
            RowBox[{"r", ",", "data2D", ",", 
             RowBox[{"{", 
              RowBox[{"1000", ",", "tx", ",", "ty"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\t", "\[IndentingNewLine]", "\t", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Scaling", " ", "and", " ", "preparing", " ", "simulated", " ", 
            "nodes"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
          RowBox[{"xysim1", "=", 
           RowBox[{"data2D", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{"xysim1", "=", 
           RowBox[{"Round", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"\[Tau]x", ",", "\[Tau]y"}], "}"}], "+", "#"}], "&"}],
              "/@", 
             RowBox[{"(", 
              RowBox[{"\[Sigma]", "*", "xysim1"}], ")"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"hksim1", "=", 
           RowBox[{"data2D", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", 
              RowBox[{"{", 
               RowBox[{"3", ",", "4"}], "}"}]}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{"hksim1", "=", 
           RowBox[{"Map", "[", 
            RowBox[{"ToMiller", ",", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"Insert", "[", 
                RowBox[{"#", ",", "SIM1level", ",", 
                 RowBox[{"{", "3", "}"}]}], "]"}], "&"}], "/@", "hksim1"}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
          
          RowBox[{"(*", " ", 
           RowBox[{
           "Add", " ", "tooltip", " ", "and", " ", "prepare", " ", "plot"}], 
           " ", "*)"}], "\[IndentingNewLine]", "\t", 
          RowBox[{"sim1data", "=", 
           RowBox[{"MapThread", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Tooltip", "[", 
               RowBox[{"#1", ",", "#2", ",", "\[IndentingNewLine]", "\t", 
                RowBox[{"TooltipStyle", "\[Rule]", 
                 RowBox[{
                 "OptionValue", "[", "\"\<TooltipStyle\>\"", "]"}]}]}], "]"}],
               "&"}], ",", 
             RowBox[{"{", 
              RowBox[{"xysim1", ",", "hksim1"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\t", "\[IndentingNewLine]", "\t", 
          RowBox[{"SIM1", "=", 
           RowBox[{"ListPlot", "[", "\[IndentingNewLine]", "\t", 
            RowBox[{"sim1data", ",", "\[IndentingNewLine]", "\t", 
             RowBox[{"Axes", "\[Rule]", "False"}], ",", "\[IndentingNewLine]",
              "\t", 
             RowBox[{"PlotStyle", "\[Rule]", 
              RowBox[{"{", "\[IndentingNewLine]", "\t", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"PointSize", "\[Rule]", "Large"}], ",", 
                 "\[IndentingNewLine]", "\t", "Automatic", ",", 
                 "\[IndentingNewLine]", "\t", "SIM1colour", ",", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"Opacity", "[", "SIM1opacity", "]"}]}], "}"}], 
               "}"}]}]}], "]"}]}]}]}], "\[IndentingNewLine]", "\t", "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{"SIM1add", ",", "\[IndentingNewLine]", "\t", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"plots", ",", "SIM1"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"*", " ", "Plot"}], " ", "**)"}], "\[IndentingNewLine]", "\t", 
       RowBox[{"plotoptions", "=", 
        RowBox[{"{", "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"ImageSize", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"OUTx", ",", 
             RowBox[{"Floor", "[", 
              RowBox[{
               RowBox[{"1475", "/", "1679"}], "*", "OUTx"}], "]"}]}], "}"}]}],
           ",", "\[IndentingNewLine]", "\t", 
          RowBox[{"PlotRange", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "1679"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "1475"}], "}"}]}], "}"}]}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"AspectRatio", "\[Rule]", 
           RowBox[{"1475", "/", "1679"}]}], ",", "\[IndentingNewLine]", "\t", 
          
          RowBox[{"ToExpression", "@", "OUTframe"}]}], "\[IndentingNewLine]", 
         "\t", "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\t", 
       RowBox[{"plotaxes", "=", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", "plotoptions"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"PrependTo", "[", 
        RowBox[{"plots", ",", "plotaxes"}], "]"}], ";", "\[IndentingNewLine]",
        "\t", 
       RowBox[{"output", "=", 
        RowBox[{"Show", "[", 
         RowBox[{"plots", ",", "plotoptions"}], "]"}]}]}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"*", " ", "Manipulation", " ", "controls"}], " ", "**)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
    RowBox[{"(*", " ", 
     RowBox[{"Misc", " ", "initial", " ", "parameters"}], " ", "*)"}], 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"update", ",", "False", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"OUTx", ",", "520", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"OUTframe", ",", 
      RowBox[{"{", "\"\<Frame->True\>\"", "}"}], ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"LAswitch", ",", "False", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"LAsize", ",", "\"\<Off\>\"", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"LAimage", ",", "\"\<Off\>\"", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N1enable", ",", "False", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N1switch", ",", "False", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N1show", ",", "True", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N1colour", ",", 
      RowBox[{"ColorData", "[", 
       RowBox[{"97", ",", "1"}], "]"}], ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N1opacity", ",", "1", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N2enable", ",", "False", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N2switch", ",", "False", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N2show", ",", "True", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N2colour", ",", 
      RowBox[{"ColorData", "[", 
       RowBox[{"97", ",", "2"}], "]"}], ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N2opacity", ",", "1", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N3enable", ",", "False", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N3switch", ",", "False", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N3show", ",", "True", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N3colour", ",", "LightGray", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"N3opacity", ",", "1", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"SIM1switch", ",", "False", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"SIM1colour", ",", 
      RowBox[{"ColorData", "[", 
       RowBox[{"97", ",", "3"}], "]"}], ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"SIM1opacity", ",", "1", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"SIM1name", ",", "\"\<\>\"", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"SIM1plane", ",", "\"\<None\>\"", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"SIM1level", ",", "0", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"SIM1res", ",", "0.8", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"SIM1calc", ",", "False", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"SIM1add", ",", "False", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"POswitch", ",", "False", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"EPswitch", ",", "False", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"EPformat", ",", "\"\<pdf\>\"", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"EPname", ",", "\"\<\>\"", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"{", 
     RowBox[{"output", ",", "True", ",", 
      RowBox[{"ControlType", "\[Rule]", "None"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
    RowBox[{"(*", " ", 
     RowBox[{"Extracted", " ", "data"}], " ", "*)"}], "\[IndentingNewLine]", 
    "\t", 
    RowBox[{"Row", "[", 
     RowBox[{"{", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"Style", "[", 
        RowBox[{
        "\"\<Extracted data\>\"", ",", "Bold", ",", "Medium", ",", "16"}], 
        "]"}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"Spacer", "[", "160", "]"}], ",", "\[IndentingNewLine]", "\t", 
       
       RowBox[{"Button", "[", 
        RowBox[{"\"\<Update\>\"", ",", 
         RowBox[{"update", "=", "True"}], ",", 
         RowBox[{"ImageSize", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"65", ",", "Automatic"}], "}"}]}]}], "]"}]}], 
      "\[IndentingNewLine]", "\t", "}"}], "]"}], ",", "\[IndentingNewLine]", 
    "\t", "Delimiter", ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    "\t\t", 
    RowBox[{"(*", " ", 
     RowBox[{"Lattice", " ", "and", " ", "background"}], " ", "*)"}], 
    "\[IndentingNewLine]", "\t\t", 
    RowBox[{"Row", "[", 
     RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
      RowBox[{
       RowBox[{"Toggler", "[", 
        RowBox[{
         RowBox[{"Dynamic", "@", "LAswitch"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"True", "\[Rule]", "#"}], ",", 
             RowBox[{"False", "\[Rule]", "#"}]}], "}"}], "&"}], 
          "\[IndentingNewLine]", "\t\t", "@", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<Lattice and background\>\"", ",", "14"}], "]"}]}]}], 
        "]"}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", "\t\t", 
       
       RowBox[{"Opener", "@", 
        RowBox[{"Dynamic", "@", "LAswitch"}]}]}], "\[IndentingNewLine]", 
      "\t\t", "}"}], "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]",
     "\t\t", 
    RowBox[{"Dynamic", "@", 
     RowBox[{"If", "[", 
      RowBox[{"LAswitch", ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Panel", "@", 
        RowBox[{"Column", "[", 
         RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Lattice\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "50", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"SetterBar", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "LAsize"}], ",", 
                RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
                 RowBox[{
                  RowBox[{"\"\<Off\>\"", "\[Rule]", "\"\<Off\>\""}], ",", 
                  "\[IndentingNewLine]", "\t\t", 
                  RowBox[{"1", "\[Rule]", "\"\<Unit vectors\>\""}], ",", 
                  "\[IndentingNewLine]", "\t\t", 
                  RowBox[{"2", "\[Rule]", "\"\<1\>\""}], ",", 
                  RowBox[{"3", "\[Rule]", "\"\<2\>\""}], ",", 
                  RowBox[{"4", "\[Rule]", "\"\<3\>\""}], ",", 
                  RowBox[{"5", "\[Rule]", "\"\<4\>\""}], ",", 
                  RowBox[{"6", "\[Rule]", "\"\<5\>\""}], ",", 
                  RowBox[{"7", "\[Rule]", "\"\<6\>\""}]}], "}"}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Background\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "25", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"PopupMenu", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "LAimage"}], ",", 
                RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
                 RowBox[{
                 "\"\<Off\>\"", ",", "\"\<Original\>\"", ",", 
                  "\"\<Negative\>\"", ",", "\"\<Grayscale\>\"", ",", 
                  "\[IndentingNewLine]", "\t\t", 
                  "\"\<Negative + Grayscale\>\"", ",", "\"\<Binarised\>\""}], 
                 "}"}]}], "]"}]}], "\[IndentingNewLine]", "\t\t", "}"}], 
            "]"}]}], "\[IndentingNewLine]", "\t\t", "\[IndentingNewLine]", 
          "\t\t", "}"}], "]"}]}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Row", "[", 
        RowBox[{"{", "}"}], "]"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}], 
    ",", "\[IndentingNewLine]", "\t", "Delimiter", ",", "\[IndentingNewLine]",
     "\[IndentingNewLine]", "\t\t", 
    RowBox[{"(*", " ", 
     RowBox[{"Extracted", " ", "nodes"}], " ", "*)"}], "\[IndentingNewLine]", 
    "\t\t", 
    RowBox[{"Dynamic", "@", 
     RowBox[{"If", "[", 
      RowBox[{"N1enable", ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Row", "[", 
        RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
         RowBox[{
          RowBox[{"Toggler", "[", 
           RowBox[{
            RowBox[{"Dynamic", "@", "N1switch"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"True", "\[Rule]", "#"}], ",", 
                RowBox[{"False", "\[Rule]", "#"}]}], "}"}], "&"}], 
             "\[IndentingNewLine]", "\t\t", "@", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<Extracted nodes\>\"", ",", "14"}], "]"}]}]}], 
           "]"}], ",", "\[IndentingNewLine]", "\t\t", 
          RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", 
          "\t\t", 
          RowBox[{"Opener", "@", 
           RowBox[{"Dynamic", "@", "N1switch"}]}]}], "\[IndentingNewLine]", 
         "\t\t", "}"}], "]"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Style", "[", 
        RowBox[{"\"\<Extracted nodes\>\"", ",", "14", ",", "Gray"}], "]"}]}], 
      "\[IndentingNewLine]", "\t\t", "]"}]}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\t\t", 
    RowBox[{"Dynamic", "@", 
     RowBox[{"If", "[", 
      RowBox[{"N1switch", ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Panel", "@", 
        RowBox[{"Column", "[", 
         RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Show\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "77", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"Checkbox", "@", 
               RowBox[{"Dynamic", "@", "N1show"}]}]}], "\[IndentingNewLine]", 
             "\t\t", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Node colour\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "50", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"ColorSlider", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "N1colour"}], ",", 
                RowBox[{"ImageSize", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"190", ",", "30"}], "}"}]}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Opacity of nodes\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "28", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"Slider", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "N1opacity"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "1"}], "}"}], ",", "\[IndentingNewLine]", 
                "\t\t", 
                RowBox[{"ImageSize", "\[Rule]", "190"}], ",", 
                "\[IndentingNewLine]", "\t\t", 
                RowBox[{"Appearance", "\[Rule]", "Medium"}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Spacer", "[", "150", "]"}], ",", "\[IndentingNewLine]",
               "\t\t", 
              RowBox[{"Button", "[", 
               RowBox[{
               "\"\<Reset colour\>\"", ",", "\[IndentingNewLine]", "\t\t", 
                RowBox[{
                 RowBox[{"N1colour", "=", 
                  RowBox[{"ColorData", "[", 
                   RowBox[{"97", ",", "1"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t\t", 
                 RowBox[{"N1opacity", "=", "1"}]}], ",", 
                "\[IndentingNewLine]", "\t\t", 
                RowBox[{"ImageSize", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"100", ",", "Automatic"}], "}"}]}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}]}], 
          "\[IndentingNewLine]", "\t\t", "\[IndentingNewLine]", "\t\t", "}"}],
          "]"}]}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Row", "[", 
        RowBox[{"{", "}"}], "]"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}], 
    ",", "\[IndentingNewLine]", "\t", "Delimiter", ",", "\[IndentingNewLine]",
     "\[IndentingNewLine]", "\t\t", 
    RowBox[{"(*", " ", 
     RowBox[{"Conditional", " ", "selection"}], " ", "*)"}], 
    "\[IndentingNewLine]", "\t\t", 
    RowBox[{"Dynamic", "@", 
     RowBox[{"If", "[", 
      RowBox[{"N2enable", ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Row", "[", 
        RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
         RowBox[{
          RowBox[{"Toggler", "[", 
           RowBox[{
            RowBox[{"Dynamic", "@", "N2switch"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"True", "\[Rule]", "#"}], ",", 
                RowBox[{"False", "\[Rule]", "#"}]}], "}"}], "&"}], 
             "\[IndentingNewLine]", "\t\t", "@", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<Conditional selection\>\"", ",", "14"}], "]"}]}]}],
            "]"}], ",", "\[IndentingNewLine]", "\t\t", 
          RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", 
          "\t\t", 
          RowBox[{"Opener", "@", 
           RowBox[{"Dynamic", "@", "N2switch"}]}]}], "\[IndentingNewLine]", 
         "\t\t", "}"}], "]"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Style", "[", 
        RowBox[{"\"\<Conditional selection\>\"", ",", "14", ",", "Gray"}], 
        "]"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
    RowBox[{"Dynamic", "@", 
     RowBox[{"If", "[", 
      RowBox[{"N2switch", ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Panel", "@", 
        RowBox[{"Column", "[", 
         RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Show\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "77", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"Checkbox", "@", 
               RowBox[{"Dynamic", "@", "N2show"}]}]}], "\[IndentingNewLine]", 
             "\t\t", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Node colour\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "50", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"ColorSlider", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "N2colour"}], ",", 
                RowBox[{"ImageSize", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"190", ",", "30"}], "}"}]}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Opacity of nodes\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "28", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"Slider", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "N2opacity"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "1"}], "}"}], ",", "\[IndentingNewLine]", 
                "\t\t", 
                RowBox[{"ImageSize", "\[Rule]", "190"}], ",", 
                "\[IndentingNewLine]", "\t\t", 
                RowBox[{"Appearance", "\[Rule]", "Medium"}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Spacer", "[", "150", "]"}], ",", "\[IndentingNewLine]",
               "\t\t", 
              RowBox[{"Button", "[", 
               RowBox[{
               "\"\<Reset colour\>\"", ",", "\[IndentingNewLine]", "\t\t", 
                RowBox[{
                 RowBox[{"N2colour", "=", 
                  RowBox[{"ColorData", "[", 
                   RowBox[{"97", ",", "2"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t\t", 
                 RowBox[{"N2opacity", "=", "1"}]}], ",", 
                "\[IndentingNewLine]", "\t\t", 
                RowBox[{"ImageSize", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"100", ",", "Automatic"}], "}"}]}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}]}], 
          "\[IndentingNewLine]", "\t\t", "\[IndentingNewLine]", "\t\t", "}"}],
          "]"}]}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Row", "[", 
        RowBox[{"{", "}"}], "]"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}], 
    ",", "\[IndentingNewLine]", "\t", "Delimiter", ",", "\[IndentingNewLine]",
     "\[IndentingNewLine]", "\t\t", 
    RowBox[{"(*", " ", 
     RowBox[{"Wrong", " ", "nodes"}], " ", "*)"}], "\t\t", 
    "\[IndentingNewLine]", "\t\t", 
    RowBox[{"Dynamic", "@", 
     RowBox[{"If", "[", 
      RowBox[{"N3enable", ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Row", "[", 
        RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
         RowBox[{
          RowBox[{"Toggler", "[", 
           RowBox[{
            RowBox[{"Dynamic", "@", "N3switch"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"True", "\[Rule]", "#"}], ",", 
                RowBox[{"False", "\[Rule]", "#"}]}], "}"}], "&"}], 
             "\[IndentingNewLine]", "\t\t", "@", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<Wrong nodes\>\"", ",", "14"}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", "\t\t", 
          RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", 
          "\t\t", 
          RowBox[{"Opener", "@", 
           RowBox[{"Dynamic", "@", "N3switch"}]}]}], "\[IndentingNewLine]", 
         "\t\t", "}"}], "]"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Style", "[", 
        RowBox[{"\"\<Wrong nodes\>\"", ",", "14", ",", "Gray"}], "]"}]}], 
      "\[IndentingNewLine]", "\t\t", "]"}]}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\t\t", 
    RowBox[{"Dynamic", "@", 
     RowBox[{"If", "[", 
      RowBox[{"N3switch", ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Panel", "@", 
        RowBox[{"Column", "[", 
         RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Show\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "77", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"Checkbox", "@", 
               RowBox[{"Dynamic", "@", "N3show"}]}]}], "\[IndentingNewLine]", 
             "\t\t", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Node colour\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "50", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"ColorSlider", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "N3colour"}], ",", 
                RowBox[{"ImageSize", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"190", ",", "30"}], "}"}]}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Opacity of nodes\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "28", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"Slider", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "N3opacity"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "1"}], "}"}], ",", "\[IndentingNewLine]", 
                "\t\t", 
                RowBox[{"ImageSize", "\[Rule]", "190"}], ",", 
                "\[IndentingNewLine]", "\t\t", 
                RowBox[{"Appearance", "\[Rule]", "Medium"}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Spacer", "[", "150", "]"}], ",", "\[IndentingNewLine]",
               "\t\t", 
              RowBox[{"Button", "[", 
               RowBox[{
               "\"\<Reset colour\>\"", ",", "\[IndentingNewLine]", "\t\t", 
                RowBox[{
                 RowBox[{"N3colour", "=", "LightGray"}], ";", 
                 "\[IndentingNewLine]", "\t\t", 
                 RowBox[{"N3opacity", "=", "1"}]}], ",", 
                "\[IndentingNewLine]", "\t\t", 
                RowBox[{"ImageSize", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"100", ",", "Automatic"}], "}"}]}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}]}], 
          "\[IndentingNewLine]", "\t\t", "\[IndentingNewLine]", "\t\t", "}"}],
          "]"}]}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Row", "[", 
        RowBox[{"{", "}"}], "]"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}], 
    ",", "\[IndentingNewLine]", "\t", "Delimiter", ",", "\[IndentingNewLine]",
     "\[IndentingNewLine]", 
    RowBox[{"Spacer", "[", 
     RowBox[{"{", 
      RowBox[{"15", ",", "15"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
    RowBox[{"(*", " ", 
     RowBox[{"Simulated", " ", "data"}], " ", "*)"}], "\t", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"Style", "[", 
     RowBox[{
     "\"\<Simulated data\>\"", ",", "Bold", ",", "Medium", ",", "16"}], "]"}],
     ",", "\[IndentingNewLine]", "\t", "Delimiter", ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
    RowBox[{"(*", " ", 
     RowBox[{"Simulation", " ", "input", " ", "1"}], " ", "*)"}], 
    "\[IndentingNewLine]", "\t\t", 
    RowBox[{"Row", "[", 
     RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
      RowBox[{
       RowBox[{"Toggler", "[", 
        RowBox[{
         RowBox[{"Dynamic", "@", "SIM1switch"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"True", "\[Rule]", "#"}], ",", 
             RowBox[{"False", "\[Rule]", "#"}]}], "}"}], "&"}], 
          "\[IndentingNewLine]", "\t\t", "@", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<Simulation input\>\"", ",", "14"}], "]"}]}]}], "]"}], 
       ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", "\t\t", 
       
       RowBox[{"Opener", "@", 
        RowBox[{"Dynamic", "@", "SIM1switch"}]}]}], "\[IndentingNewLine]", 
      "\t\t", "}"}], "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]",
     "\t\t", 
    RowBox[{"Dynamic", "@", 
     RowBox[{"If", "[", 
      RowBox[{"SIM1switch", ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Panel", "@", 
        RowBox[{"Column", "[", 
         RowBox[{"{", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Input data\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "7", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"InputField", "[", "\[IndentingNewLine]", "\t\t", 
               RowBox[{
                RowBox[{"Dynamic", "[", "SIM1name", "]"}], ",", 
                "\[IndentingNewLine]", "\t\t", "String", ",", 
                "\[IndentingNewLine]", "\t\t", 
                RowBox[{"FieldHint", "\[Rule]", "\"\<Crystal name\>\""}], ",",
                 "\[IndentingNewLine]", "\t\t", 
                RowBox[{"FieldSize", "\[Rule]", "14"}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\t\t", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Image plane normal\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "3", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"SetterBar", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "SIM1plane"}], ",", 
                RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}], 
                   "\[Rule]", 
                   "\"\<\!\(\*SuperscriptBox[\(a\), \(*\)]\)\>\""}], ",", 
                  "\[IndentingNewLine]", "\t\t", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}], 
                   "\[Rule]", 
                   "\"\<\!\(\*SuperscriptBox[\(b\), \(*\)]\)\>\""}], ",", 
                  "\[IndentingNewLine]", "\t\t", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], 
                   "\[Rule]", 
                   "\"\<\!\(\*SuperscriptBox[\(c\), \(*\)]\)\>\""}]}], 
                 "\[IndentingNewLine]", "\t\t", "}"}]}], "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"Text", "[", "\"\<intersecting the plane at\>\"", "]"}],
               ",", "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"PopupMenu", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "SIM1level"}], ",", 
                RowBox[{"Reverse", "@", 
                 RowBox[{"Range", "[", 
                  RowBox[{
                   RowBox[{"-", "5"}], ",", "5"}], "]"}]}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Resolution\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"Slider", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "SIM1res"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0.1", ",", "5.0", ",", "0.05"}], "}"}]}], "]"}], 
              ",", "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"Dynamic", "[", 
               RowBox[{"Row", "[", 
                RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
                 RowBox[{
                  RowBox[{"NumberForm", "[", 
                   RowBox[{"SIM1res", ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", "2"}], "}"}]}], "]"}], ",", 
                  "\[IndentingNewLine]", "\t\t", 
                  "\"\< \!\(\*SuperscriptBox[\(\[CapitalARing]\), \(-1\)]\)\>\
\""}], "}"}], "]"}], "]"}]}], "\[IndentingNewLine]", "\t\t", "}"}], "]"}], 
           ",", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Node colour\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "60", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"ColorSlider", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "SIM1colour"}], ",", 
                RowBox[{"ImageSize", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"192", ",", "31"}], "}"}]}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Opacity of nodes\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"Slider", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "SIM1opacity"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "1"}], "}"}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Button", "[", 
               RowBox[{"\"\<Add\>\"", ",", 
                RowBox[{"SIM1calc", "=", 
                 RowBox[{"SIM1add", "=", "True"}]}], ",", 
                "\[IndentingNewLine]", "\t\t", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"SIM1plane", "===", "\"\<None\>\""}], "||", 
                   RowBox[{"SIM1name", "===", "\"\<\>\""}]}], ",", 
                  "\[IndentingNewLine]", "\t\t", 
                  RowBox[{"Enabled", "\[Rule]", "False"}], ",", 
                  RowBox[{"Enabled", "\[Rule]", "True"}]}], "]"}]}], "]"}], 
              ",", "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"Button", "[", 
               RowBox[{"\"\<Remove\>\"", ",", 
                RowBox[{"SIM1calc", "=", 
                 RowBox[{"SIM1add", "=", "False"}]}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}]}], 
          "\[IndentingNewLine]", "\t\t", "}"}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\t\t", "\[IndentingNewLine]", "\t\t\t", 
       RowBox[{"Row", "[", 
        RowBox[{"{", "}"}], "]"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}], 
    ",", "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    
    RowBox[{"Spacer", "[", 
     RowBox[{"{", 
      RowBox[{"15", ",", "15"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
    RowBox[{"(*", " ", 
     RowBox[{"Image", " ", "controls"}], " ", "*)"}], "\[IndentingNewLine]", 
    "\t", 
    RowBox[{"Style", "[", 
     RowBox[{
     "\"\<Image controls\>\"", ",", "Bold", ",", "Medium", ",", "16"}], "]"}],
     ",", "\[IndentingNewLine]", "\t", "Delimiter", ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
    RowBox[{"(*", " ", 
     RowBox[{"Plot", " ", "options"}], " ", "*)"}], "\[IndentingNewLine]", 
    "\t\t", 
    RowBox[{"Row", "[", 
     RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
      RowBox[{
       RowBox[{"Toggler", "[", 
        RowBox[{
         RowBox[{"Dynamic", "@", "POswitch"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"True", "\[Rule]", "#"}], ",", 
             RowBox[{"False", "\[Rule]", "#"}]}], "}"}], "&"}], 
          "\[IndentingNewLine]", "\t\t", "@", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<Plot options\>\"", ",", "14"}], "]"}]}]}], "]"}], ",",
        "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", "\t\t", 
       
       RowBox[{"Opener", "@", 
        RowBox[{"Dynamic", "@", "POswitch"}]}]}], "\[IndentingNewLine]", 
      "\t\t", "}"}], "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]",
     "\t\t", 
    RowBox[{"Dynamic", "@", 
     RowBox[{"If", "[", 
      RowBox[{"POswitch", ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Panel", "@", 
        RowBox[{"Column", "[", 
         RowBox[{"{", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Plot size\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "10", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"Slider", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "OUTx"}], ",", 
                RowBox[{"{", 
                 RowBox[{"320", ",", "1024", ",", "1"}], "}"}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Pixel dimensions\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "10", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"InputField", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "OUTx"}], ",", "Number", ",", 
                "\[IndentingNewLine]", "\t\t", 
                RowBox[{"ImageSize", "\[Rule]", "30"}]}], "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", "\"\< \[Times] \>\"", ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Dynamic", "@", 
               RowBox[{"Floor", "[", 
                RowBox[{
                 RowBox[{"1475", "/", "1679"}], "*", "OUTx"}], "]"}]}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Plot frame\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "10", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"SetterBar", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "OUTframe"}], ",", 
                RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", "\"\<Frame->True\>\"", "}"}], "\[Rule]", 
                   "\"\<Frame\>\""}], ",", "\[IndentingNewLine]", "\t\t", 
                  RowBox[{
                   RowBox[{"{", "\"\<Axes->True\>\"", "}"}], "\[Rule]", 
                   "\"\<Axes\>\""}], ",", "\[IndentingNewLine]", "\t\t", 
                  RowBox[{
                   RowBox[{"{", "\"\<Axes->False\>\"", "}"}], "\[Rule]", 
                   "\"\<None\>\""}]}], "}"}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}]}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", "}"}], "]"}]}], 
       ",", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Row", "[", 
        RowBox[{"{", "}"}], "]"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}], 
    ",", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
    RowBox[{"(*", " ", 
     RowBox[{"Export", " ", "plot"}], " ", "*)"}], "\[IndentingNewLine]", 
    "\t\t", 
    RowBox[{"Row", "[", 
     RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
      RowBox[{
       RowBox[{"Toggler", "[", 
        RowBox[{
         RowBox[{"Dynamic", "@", "EPswitch"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"True", "\[Rule]", "#"}], ",", 
             RowBox[{"False", "\[Rule]", "#"}]}], "}"}], "&"}], 
          "\[IndentingNewLine]", "\t\t", "@", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<Export plot\>\"", ",", "14"}], "]"}]}]}], "]"}], ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", "\t\t", 
       
       RowBox[{"Opener", "@", 
        RowBox[{"Dynamic", "@", "EPswitch"}]}]}], "\[IndentingNewLine]", 
      "\t\t", "}"}], "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]",
     "\t\t", 
    RowBox[{"Dynamic", "@", 
     RowBox[{"If", "[", 
      RowBox[{"EPswitch", ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Panel", "@", 
        RowBox[{"Column", "[", 
         RowBox[{"{", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
          RowBox[{
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Filename\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "10", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"InputField", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "EPname"}], ",", "String", ",", 
                RowBox[{"FieldHint", "\[Rule]", "\"\<Name\>\""}]}], "]"}]}], 
             "\[IndentingNewLine]", "\t\t", "}"}], "]"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<File format\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "10", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"SetterBar", "[", 
               RowBox[{
                RowBox[{"Dynamic", "@", "EPformat"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                 "\"\<jpg\>\"", ",", "\"\<png\>\"", ",", "\"\<pdf\>\""}], 
                 "}"}]}], "]"}]}], "\[IndentingNewLine]", "\t\t", "}"}], 
            "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
           
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
             RowBox[{
              RowBox[{"Text", "[", "\"\<Output directory\>\"", "]"}], ",", 
              "\[IndentingNewLine]", "\t\t", 
              RowBox[{"Spacer", "[", "10", "]"}], ",", "\[IndentingNewLine]", 
              "\t\t", 
              RowBox[{"Button", "[", 
               RowBox[{
               "\"\<Desktop\>\"", ",", "\[IndentingNewLine]", "\t\t", 
                RowBox[{"Export", "[", 
                 RowBox[{
                  RowBox[{"FileNameJoin", "[", 
                   RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
                    RowBox[{
                    "$HomeDirectory", ",", "\"\<Desktop\>\"", ",", 
                    "\[IndentingNewLine]", "\t\t", 
                    RowBox[{"EPname", "<>", "\"\<.\>\"", "<>", "EPformat"}]}],
                     "}"}], "]"}], ",", "\[IndentingNewLine]", "\t\t", 
                  "output"}], "]"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}],
              "\[IndentingNewLine]", "\t\t", "}"}], "]"}]}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", "}"}], "]"}]}], 
       ",", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Row", "[", 
        RowBox[{"{", "}"}], "]"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}], 
    ",", "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"ControlPlacement", "\[Rule]", "Left"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Paneled", "\[Rule]", "False"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, {3.684745337599188*^9, 3.68474537980447*^9}, {
   3.684745683328042*^9, 3.6847456907977457`*^9}, {3.6847457891850033`*^9, 
   3.684746061305086*^9}, {3.684746141124728*^9, 3.684746199596496*^9}, {
   3.684746239968897*^9, 3.684746476906747*^9}, 3.684746516183593*^9, {
   3.684746565602297*^9, 3.684746701504117*^9}, {3.684747704997624*^9, 
   3.684747714320107*^9}, {3.6847478257793713`*^9, 3.684747830808964*^9}, {
   3.684747904590282*^9, 3.684747909027731*^9}, {3.684747987584041*^9, 
   3.6847479901077967`*^9}, {3.6847480366430817`*^9, 3.684748399057756*^9}, {
   3.684749405159607*^9, 3.684749488355398*^9}, {3.684749543943878*^9, 
   3.6847496737773943`*^9}, {3.684749730279647*^9, 3.684749913917756*^9}, {
   3.684749985476234*^9, 3.684750039391656*^9}, {3.6847500890619307`*^9, 
   3.68475009107802*^9}, {3.6847503748919067`*^9, 3.684750422744948*^9}, {
   3.6847506849349947`*^9, 3.684750753350258*^9}, {3.684750809214427*^9, 
   3.684750839528977*^9}, {3.684750911740037*^9, 3.684751027853921*^9}, {
   3.6847510958058243`*^9, 3.684751169395117*^9}, {3.684751226987747*^9, 
   3.684751247567849*^9}, {3.684751383586632*^9, 3.684751386819116*^9}, {
   3.68475158838805*^9, 3.684751675188871*^9}, {3.684754099955616*^9, 
   3.684754130897352*^9}, {3.685093713849648*^9, 3.685093714753817*^9}, {
   3.6852517446001863`*^9, 3.6852517477297363`*^9}, {3.685767547708188*^9, 
   3.685767548831842*^9}, {3.687001964745152*^9, 3.6870019744028*^9}, {
   3.688107597786675*^9, 3.688107665612611*^9}, 3.688187393541828*^9, {
   3.688187432108532*^9, 3.688187457895165*^9}, 3.688191356512495*^9, {
   3.688191921835215*^9, 3.688191921962541*^9}, {3.6881920541770973`*^9, 
   3.688192062988988*^9}, {3.688192096561056*^9, 3.688192173391622*^9}, {
   3.6881922192278013`*^9, 3.688192223740445*^9}, {3.6881922546583033`*^9, 
   3.688192272545162*^9}, {3.688192449333951*^9, 3.688192449645548*^9}, {
   3.688193253927661*^9, 3.6881932589695997`*^9}, {3.688193525230608*^9, 
   3.688193572112845*^9}, {3.68819389783714*^9, 3.688193913239666*^9}, {
   3.6881943397030973`*^9, 3.688194384201673*^9}, {3.688194423379434*^9, 
   3.688194433494541*^9}, {3.688194463690721*^9, 3.688194499410877*^9}, {
   3.688195539904729*^9, 3.688195544462328*^9}, {3.688196379115757*^9, 
   3.688196489866213*^9}, {3.688197507676092*^9, 3.688197508387739*^9}, {
   3.68819757718718*^9, 3.688197613861766*^9}, {3.688197743351756*^9, 
   3.688197782298257*^9}, {3.688199036231591*^9, 3.688199109239403*^9}, {
   3.688199224476853*^9, 3.688199248450754*^9}, {3.688199419783801*^9, 
   3.6881994204629602`*^9}, {3.688199463475759*^9, 3.688199469756166*^9}, {
   3.688199632748536*^9, 3.688199639739724*^9}, {3.6881996713166857`*^9, 
   3.688199750196123*^9}, {3.6882058232138147`*^9, 3.6882058233835173`*^9}, {
   3.688205872736877*^9, 3.6882058924219217`*^9}, {3.688206168807418*^9, 
   3.68820618960297*^9}, {3.688206788482258*^9, 3.688206948466836*^9}, {
   3.68820707338017*^9, 3.688207170707225*^9}, {3.688273602742978*^9, 
   3.6882736163735*^9}, {3.688273744814283*^9, 3.688273745561241*^9}, {
   3.688273784880596*^9, 3.688273889650998*^9}, {3.6882765762730618`*^9, 
   3.688276593736793*^9}, {3.688276687498521*^9, 3.68827670781852*^9}, {
   3.688276773303253*^9, 3.6882768054381847`*^9}, {3.6882769622069273`*^9, 
   3.688276962349667*^9}, {3.688277074250326*^9, 3.688277075722179*^9}, {
   3.688277112422038*^9, 3.6882771381764593`*^9}, {3.688277869113379*^9, 
   3.688277869480307*^9}, 3.688278818225094*^9, {3.6882799618078814`*^9, 
   3.688279962925933*^9}, {3.688280175351775*^9, 3.688280181437064*^9}, {
   3.6882806019038773`*^9, 3.688280629461904*^9}, {3.6882806621685762`*^9, 
   3.6882807018923492`*^9}, {3.688281019517407*^9, 3.688281101858042*^9}, {
   3.6882811871688023`*^9, 3.688281189541559*^9}, {3.68828186863706*^9, 
   3.6882818795359*^9}, {3.688282245518786*^9, 3.6882822555295773`*^9}, {
   3.68828249555583*^9, 3.6882825545381527`*^9}, {3.688282680728904*^9, 
   3.688282745627604*^9}, {3.688283937513966*^9, 3.688284002229107*^9}, {
   3.688284145414229*^9, 3.688284189761941*^9}, {3.688284557027494*^9, 
   3.688284569113245*^9}, {3.6882846054743767`*^9, 3.6882846092529*^9}, {
   3.688284645059832*^9, 3.688284671367427*^9}, {3.6882848138060617`*^9, 
   3.688284817788643*^9}, {3.6882849366954117`*^9, 3.6882849369374113`*^9}, {
   3.68828496871418*^9, 3.688285082219194*^9}, 3.688285204568668*^9, {
   3.68828524408731*^9, 3.688285530875725*^9}, {3.688285816920663*^9, 
   3.688285830944255*^9}, {3.688285861228406*^9, 3.688285935906403*^9}, 
   3.68828603152139*^9, 3.688286077391507*^9, {3.688286115173058*^9, 
   3.688286132274939*^9}, {3.688286182565303*^9, 3.688286280543948*^9}, {
   3.688286478297864*^9, 3.688286535988381*^9}, {3.688286863305458*^9, 
   3.688286892368195*^9}, {3.688286976845705*^9, 3.688287061464653*^9}, {
   3.6882871994606113`*^9, 3.688287208084422*^9}, {3.688287506482827*^9, 
   3.688287561949996*^9}, {3.688287611516548*^9, 3.688287685750383*^9}, {
   3.688288433542831*^9, 3.688288488259069*^9}, {3.688297434959114*^9, 
   3.688297441533389*^9}, 3.688297944171204*^9, {3.688297977839176*^9, 
   3.688297990346871*^9}, {3.688298449796404*^9, 3.6882985326835213`*^9}, {
   3.688298836351548*^9, 3.6882988379800053`*^9}, {3.68829897159829*^9, 
   3.6882990426777678`*^9}, {3.6882992854384203`*^9, 
   3.6882992866035023`*^9}, {3.688299421145031*^9, 3.6882994289927893`*^9}, {
   3.6882995706139708`*^9, 3.688299606248048*^9}, {3.6882996611909943`*^9, 
   3.6882996670841007`*^9}, {3.688300057462603*^9, 3.6883000999459743`*^9}, {
   3.6883001325325403`*^9, 3.688300201216641*^9}, {3.6883002464246807`*^9, 
   3.688300487947217*^9}, {3.68836017188616*^9, 3.688360176144965*^9}, 
   3.6883602917604103`*^9, {3.688360328680934*^9, 3.68836033235811*^9}, {
   3.688360373625024*^9, 3.688360374183433*^9}, {3.688360419086863*^9, 
   3.6883604199361467`*^9}, 3.688361548790563*^9, 3.688361979489373*^9, {
   3.6883620809317837`*^9, 3.688362221906539*^9}, 3.6883624298780212`*^9, {
   3.688365046224038*^9, 3.688365065724074*^9}, {3.688365252534709*^9, 
   3.688365290444251*^9}, {3.688365341809264*^9, 3.688365404657743*^9}, {
   3.688365445457045*^9, 3.688365446139779*^9}, {3.688365492971512*^9, 
   3.6883655012740726`*^9}, {3.6883658192783203`*^9, 
   3.6883658215028276`*^9}, {3.688365889899865*^9, 3.6883659575088*^9}, {
   3.6883662953424187`*^9, 3.6883665364528112`*^9}, {3.688366679435656*^9, 
   3.688366728049654*^9}, {3.688367217836081*^9, 3.688367275330727*^9}, {
   3.688367321921103*^9, 3.688367339218223*^9}, {3.688367680272641*^9, 
   3.6883676936696863`*^9}, {3.688367749527986*^9, 3.688367795152219*^9}, {
   3.6883678352248163`*^9, 3.6883681438486357`*^9}, {3.688368175697941*^9, 
   3.688368176459059*^9}, {3.6883682296768417`*^9, 3.688368285593049*^9}, {
   3.688368354930299*^9, 3.68836838142062*^9}, {3.688368414026741*^9, 
   3.688368428958004*^9}, {3.6883685121444693`*^9, 3.688368611938629*^9}, {
   3.6883686427289467`*^9, 3.688368675837186*^9}, {3.688368725662798*^9, 
   3.6883688174874153`*^9}, {3.6883688663555*^9, 3.6883688840646276`*^9}, {
   3.688368939381682*^9, 3.688368944638883*^9}, {3.688368990244741*^9, 
   3.688369058436749*^9}, {3.688369117899687*^9, 3.688369123752055*^9}, {
   3.6883691547959347`*^9, 3.688369166732929*^9}, {3.688369702381153*^9, 
   3.688369791313662*^9}, {3.6883698686468763`*^9, 3.6883698708301077`*^9}, {
   3.688370016922091*^9, 3.688370037748988*^9}, {3.688370655817317*^9, 
   3.688370661796994*^9}, {3.688370731696389*^9, 3.688370812674123*^9}, {
   3.688370900468206*^9, 3.6883709432061853`*^9}, 3.688370981133849*^9, {
   3.688371123248744*^9, 3.6883712729412327`*^9}, {3.6883713711227303`*^9, 
   3.688371390451213*^9}, {3.6883714278458138`*^9, 3.688371436720551*^9}, {
   3.688371483994458*^9, 3.688371538547368*^9}, {3.688371574001493*^9, 
   3.688371600031142*^9}, 3.688371648575631*^9, {3.688371790589094*^9, 
   3.68837180545759*^9}, {3.68837185706915*^9, 3.688371901324605*^9}, 
   3.688371934303348*^9, {3.688371973562417*^9, 3.6883720796165657`*^9}, {
   3.6883722047426662`*^9, 3.6883722084691887`*^9}, {3.6883722949531307`*^9, 
   3.6883722972143383`*^9}, {3.688372370525456*^9, 3.688372371952628*^9}, {
   3.688372433885974*^9, 3.688372435766345*^9}, {3.688372469993311*^9, 
   3.688372506524522*^9}, {3.688373003734763*^9, 3.6883730185185947`*^9}, {
   3.688373070735916*^9, 3.68837314082928*^9}, {3.68837373104961*^9, 
   3.6883737352603083`*^9}, 3.6883737875706778`*^9, {3.688379583481531*^9, 
   3.688379585543952*^9}, {3.688379698974032*^9, 3.688379739360207*^9}, {
   3.688379952712682*^9, 3.688379977652646*^9}, {3.688380642074852*^9, 
   3.688380669536026*^9}, {3.688380741668557*^9, 3.688380819791953*^9}, {
   3.688380851363862*^9, 3.6883809401942863`*^9}, {3.6883809940259123`*^9, 
   3.6883810325941896`*^9}, {3.688381065822733*^9, 3.6883811145661373`*^9}, {
   3.68838116123351*^9, 3.688381162472266*^9}, {3.688381233614677*^9, 
   3.6883812693834047`*^9}, {3.688381323732773*^9, 3.688381342730275*^9}, {
   3.688381397664278*^9, 3.688381399123969*^9}, {3.68838149378391*^9, 
   3.688381496352409*^9}, {3.688381560063979*^9, 3.688381601455184*^9}, {
   3.6883817356522703`*^9, 3.688381752674206*^9}, {3.6883818036698837`*^9, 
   3.688381821016157*^9}, {3.688381869443632*^9, 3.688381953743968*^9}, {
   3.68838207583414*^9, 3.688382078961708*^9}, {3.688382151485796*^9, 
   3.688382176355379*^9}, {3.688382223231316*^9, 3.6883823309354753`*^9}, {
   3.688382370621058*^9, 3.6883823831495953`*^9}, {3.688382413351246*^9, 
   3.68838241354773*^9}, {3.688382483939468*^9, 3.688382508326436*^9}, {
   3.688382748877859*^9, 3.688382763274201*^9}, {3.688382806711913*^9, 
   3.6883828109585133`*^9}, {3.688382931784306*^9, 3.688382934761723*^9}, {
   3.6883830538344707`*^9, 3.688383101651906*^9}, {3.688383148145788*^9, 
   3.6883831547060966`*^9}, {3.688383249311288*^9, 3.688383281209132*^9}, {
   3.688383363577158*^9, 3.688383386614254*^9}, {3.6883834214669733`*^9, 
   3.688383422185629*^9}, {3.6883834775096483`*^9, 3.688383544910502*^9}, {
   3.688383587693899*^9, 3.688383588086437*^9}, {3.688383619924201*^9, 
   3.688383676911875*^9}, {3.688383755008466*^9, 3.688383763647029*^9}, {
   3.688383882146209*^9, 3.688383993939913*^9}, {3.688384041207402*^9, 
   3.68838404301714*^9}, {3.688384112014928*^9, 3.68838411244832*^9}, {
   3.688384511806028*^9, 3.688384541830748*^9}, {3.688384953536529*^9, 
   3.6883849742994556`*^9}, {3.688385007294704*^9, 3.6883850782497377`*^9}, {
   3.688412533466557*^9, 3.688412547321186*^9}, 3.688412587891268*^9, {
   3.688413824339501*^9, 3.688413831737144*^9}, {3.688413897391354*^9, 
   3.6884138978859797`*^9}, {3.6884142668569717`*^9, 3.688414340333947*^9}, {
   3.688415666418586*^9, 3.688415667281588*^9}, {3.6884158237932987`*^9, 
   3.688415832534972*^9}, {3.6884158789663467`*^9, 3.6884158791332684`*^9}, {
   3.6884693076996603`*^9, 3.6884693078306017`*^9}, {3.6884694574889717`*^9, 
   3.688469466757045*^9}, {3.6884695337842417`*^9, 3.688469570645245*^9}, {
   3.688469737887363*^9, 3.688469745878036*^9}, {3.688470193873653*^9, 
   3.688470202660018*^9}, {3.6887106256213093`*^9, 3.6887106316462*^9}, {
   3.688715916574808*^9, 3.688715921602603*^9}, {3.688715975335972*^9, 
   3.688716022682687*^9}, {3.6887171055130653`*^9, 3.688717150046289*^9}, {
   3.688717194795334*^9, 3.688717196838621*^9}, {3.6887173257188873`*^9, 
   3.688717423430872*^9}, {3.688717455568035*^9, 3.688717475153871*^9}, {
   3.688717562792963*^9, 3.688717564325161*^9}, {3.688717889885922*^9, 
   3.688717922956546*^9}, {3.688718046379628*^9, 3.6887180751994257`*^9}, {
   3.688718208905373*^9, 3.688718213272984*^9}, {3.688718376981533*^9, 
   3.688718381139826*^9}, {3.688719247648033*^9, 3.688719439080305*^9}, {
   3.68871957366168*^9, 3.6887196484565573`*^9}, {3.688720272145569*^9, 
   3.688720274180472*^9}, {3.688720520658091*^9, 3.688720701818386*^9}, {
   3.688720810168166*^9, 3.6887208340197906`*^9}, {3.6887208653379517`*^9, 
   3.68872086653406*^9}, {3.688720939339168*^9, 3.688720940618023*^9}, {
   3.688721164886326*^9, 3.688721206525474*^9}, {3.6887216356658278`*^9, 
   3.688721714701789*^9}, {3.688721761860014*^9, 3.688721888258545*^9}, {
   3.688721923562722*^9, 3.688721951184944*^9}, {3.688722012480411*^9, 
   3.6887220253345423`*^9}, {3.688722120264771*^9, 3.6887221675702553`*^9}, {
   3.6887223904703627`*^9, 3.688722399743865*^9}, {3.6887226553448277`*^9, 
   3.6887226684889174`*^9}, {3.688722863654044*^9, 3.6887228864406977`*^9}, {
   3.688722935475724*^9, 3.6887229445481243`*^9}, {3.688723000657322*^9, 
   3.688723120662717*^9}, {3.688723207014954*^9, 3.68872321946358*^9}, {
   3.688723258752293*^9, 3.6887232824239187`*^9}, {3.68872331999594*^9, 
   3.688723368523353*^9}, {3.6887234169040747`*^9, 3.688723498142845*^9}, {
   3.688723565576768*^9, 3.6887235815397243`*^9}, {3.688723634057341*^9, 
   3.688723651891625*^9}, {3.688723687951017*^9, 3.6887236968841963`*^9}, {
   3.688723779519454*^9, 3.688723788848905*^9}, {3.688723826110693*^9, 
   3.688723827711746*^9}, {3.688723870023592*^9, 3.6887239943519487`*^9}, {
   3.688724028536162*^9, 3.688724091464603*^9}, {3.6887241291553183`*^9, 
   3.688724140160657*^9}, {3.688724235802826*^9, 3.688724313607534*^9}, {
   3.688724362911943*^9, 3.6887248716910048`*^9}, {3.68872491176723*^9, 
   3.688724912100616*^9}, {3.688724944098531*^9, 3.68872497345995*^9}, {
   3.6887250042530413`*^9, 3.688725022564766*^9}, {3.68872527341259*^9, 
   3.688725295994483*^9}, {3.688725340615555*^9, 3.68872536644137*^9}, {
   3.688725398645979*^9, 3.688725407093004*^9}, {3.6887255066982594`*^9, 
   3.688725534188752*^9}, {3.6887258689572773`*^9, 3.688725926342456*^9}, {
   3.688725971594397*^9, 3.68872607015725*^9}, {3.688726108303121*^9, 
   3.688726127039158*^9}, {3.688726180744391*^9, 3.688726234602315*^9}, {
   3.6887262683509607`*^9, 3.688726298049622*^9}, {3.688726333052865*^9, 
   3.688726473317025*^9}, {3.688726535302548*^9, 3.688726549614936*^9}, {
   3.6887266076717243`*^9, 3.688726753896302*^9}, {3.688726789157321*^9, 
   3.688726794344153*^9}, {3.688726825433799*^9, 3.688726855958111*^9}, {
   3.68872689842799*^9, 3.688726904804707*^9}, {3.688727278771668*^9, 
   3.6887273031688757`*^9}, {3.68872743244801*^9, 3.688727444223064*^9}, {
   3.688727508627112*^9, 3.688727581810495*^9}, {3.688728319381282*^9, 
   3.688728333221733*^9}, {3.6887286669852743`*^9, 3.688728678803669*^9}, {
   3.688728876661017*^9, 3.6887288768237886`*^9}, {3.688728963915854*^9, 
   3.6887289715068274`*^9}, {3.6887290465867977`*^9, 3.688729098568931*^9}, {
   3.688729218272547*^9, 3.688729407938739*^9}, {3.688729439397183*^9, 
   3.6887295020890903`*^9}, {3.68872954860353*^9, 3.688729560643612*^9}, {
   3.68872993001188*^9, 3.6887299483714457`*^9}, {3.6887300393662453`*^9, 
   3.688730040076292*^9}, {3.6887301020438557`*^9, 3.6887302397582617`*^9}, {
   3.688730300473332*^9, 3.688730307124331*^9}, {3.688730462423807*^9, 
   3.688730464455422*^9}, {3.6887305391015387`*^9, 3.688730617773288*^9}, {
   3.688730652999529*^9, 3.688730747167839*^9}, {3.6887307968726797`*^9, 
   3.688730802352521*^9}, {3.6887308519531927`*^9, 3.6887308898490143`*^9}, {
   3.688730923421349*^9, 3.6887309855724487`*^9}, {3.688731027416718*^9, 
   3.688731068248067*^9}, {3.68873112188993*^9, 3.688731253857031*^9}, {
   3.688731298436944*^9, 3.688731433966876*^9}, {3.688731488677355*^9, 
   3.688731519803687*^9}, {3.688731602205064*^9, 3.688731745998415*^9}, {
   3.688731786349728*^9, 3.68873181885561*^9}, {3.688731875076459*^9, 
   3.688732103887988*^9}, {3.688820722829179*^9, 3.6888207559189653`*^9}, {
   3.6888214548103323`*^9, 3.688821563032465*^9}, {3.6888216111211863`*^9, 
   3.688821658645171*^9}, {3.688880561507181*^9, 3.6888806166152697`*^9}, {
   3.6888807426962337`*^9, 3.688880766921464*^9}, {3.688881515416383*^9, 
   3.688881574958947*^9}, {3.688881605023391*^9, 3.688881849333637*^9}, {
   3.688881943452387*^9, 3.6888819576679163`*^9}, {3.688881995113439*^9, 
   3.68888200597932*^9}, {3.688882076632834*^9, 3.6888820849785852`*^9}, {
   3.6888822174013157`*^9, 3.688882218029351*^9}, {3.688882254943294*^9, 
   3.6888822591282673`*^9}, {3.6888825179566507`*^9, 3.688882561373372*^9}, {
   3.688883148891746*^9, 3.688883149530191*^9}, {3.688883542695879*^9, 
   3.688883603137027*^9}, {3.6888837027125807`*^9, 3.688883718852215*^9}, {
   3.68888375660098*^9, 3.688883769436098*^9}, {3.6888838754742937`*^9, 
   3.688883875881736*^9}, {3.688883932596631*^9, 3.688883984112029*^9}, {
   3.688884016119833*^9, 3.688884033920843*^9}, {3.688884066443245*^9, 
   3.688884299913093*^9}, {3.688884333258216*^9, 3.688884411346899*^9}, {
   3.6888845740392637`*^9, 3.688884671646585*^9}, {3.688885301977813*^9, 
   3.688885327193623*^9}, {3.6888853712649717`*^9, 3.688885381261702*^9}, {
   3.688885415095223*^9, 3.688885419146516*^9}, {3.688885480125342*^9, 
   3.6888854963809137`*^9}, {3.688885564679582*^9, 3.688885671127782*^9}, {
   3.68888574983959*^9, 3.688885867522853*^9}, {3.6888859814800797`*^9, 
   3.6888859895556307`*^9}, {3.688886075206634*^9, 3.688886103803995*^9}, {
   3.688886142033185*^9, 3.688886362460281*^9}, {3.6888864046482887`*^9, 
   3.688886405190534*^9}, 3.688886440416807*^9, {3.688886496647683*^9, 
   3.688886614255052*^9}, {3.6888866470167503`*^9, 3.6888866787360477`*^9}, {
   3.6888869307196503`*^9, 3.688886931304778*^9}, {3.68888714380344*^9, 
   3.6888871932967787`*^9}, {3.688887277732609*^9, 3.688887334649456*^9}, {
   3.688887403098558*^9, 3.6888874128714943`*^9}, {3.688887445702457*^9, 
   3.688887475126939*^9}, {3.688887527895865*^9, 3.688887551378882*^9}, {
   3.688887622170032*^9, 3.688887622576388*^9}, {3.688887683401148*^9, 
   3.6888877219974813`*^9}, {3.688887808549309*^9, 3.6888878602559013`*^9}, {
   3.6888878957803717`*^9, 3.68888798137081*^9}, {3.688888046426093*^9, 
   3.688888120363359*^9}, {3.68888817542372*^9, 3.6888882853086567`*^9}, {
   3.688888425463152*^9, 3.6888884683965187`*^9}, {3.688888797958138*^9, 
   3.688888799132504*^9}, {3.688888855654704*^9, 3.688888880379723*^9}, {
   3.688889195485331*^9, 3.688889234428309*^9}, {3.688889267605335*^9, 
   3.688889286908716*^9}, 3.688889360992034*^9, 3.688889449720807*^9, {
   3.6888897328086357`*^9, 3.688889778102206*^9}, 3.688889830502931*^9, {
   3.688889892143968*^9, 3.6888898927465878`*^9}, {3.688889949680038*^9, 
   3.688889953497878*^9}, {3.688889995583117*^9, 3.688890054046508*^9}, {
   3.6888904921261883`*^9, 3.688890493858288*^9}, {3.688890572759881*^9, 
   3.688890573027338*^9}, {3.688890609801099*^9, 3.688890681164501*^9}, {
   3.688891044417325*^9, 3.68889107888306*^9}, {3.688891313710175*^9, 
   3.688891324293086*^9}, {3.6888918068734617`*^9, 3.6888918105346413`*^9}, {
   3.68889185613771*^9, 3.688891896427363*^9}, {3.6888932268807707`*^9, 
   3.688893370801464*^9}, {3.688893437661771*^9, 3.688893450758202*^9}, {
   3.6888935042501907`*^9, 3.68889350529464*^9}, {3.688893606888598*^9, 
   3.6888936366294127`*^9}, {3.688893803447845*^9, 3.688893805129158*^9}, {
   3.688894561781907*^9, 3.688894562391205*^9}, {3.688894604702033*^9, 
   3.688894605800231*^9}, {3.688894692685596*^9, 3.688894694921898*^9}, {
   3.6888947949720297`*^9, 3.6888948234590693`*^9}, {3.688894950473453*^9, 
   3.688894962022049*^9}, {3.688895009927999*^9, 3.6888950174731407`*^9}, {
   3.688895094046125*^9, 3.688895115604026*^9}, {3.688895418364194*^9, 
   3.688895453567012*^9}, {3.688895497612961*^9, 3.6888955005904427`*^9}, {
   3.688896246782501*^9, 3.68889628069715*^9}, {3.6888963538356657`*^9, 
   3.68889638432589*^9}, {3.688896530135466*^9, 3.688896647139607*^9}, 
   3.6888971485470963`*^9, 3.688897285964571*^9, {3.688897635952179*^9, 
   3.6888976533745813`*^9}, {3.688897829164626*^9, 3.688897829470894*^9}, {
   3.6888981793529577`*^9, 3.688898180195538*^9}, {3.688898403393675*^9, 
   3.6888984051464167`*^9}, {3.6888984421174393`*^9, 
   3.6888984428881063`*^9}, {3.688898610293371*^9, 3.688898655119364*^9}, {
   3.688898685288208*^9, 3.688898695284464*^9}, {3.688898740577579*^9, 
   3.688898749581698*^9}, {3.688898795480421*^9, 3.688898797509375*^9}, {
   3.688898848492169*^9, 3.688898849795124*^9}, {3.688898974348111*^9, 
   3.688898976921692*^9}, {3.688899382589696*^9, 3.688899384051035*^9}, {
   3.688899417749552*^9, 3.688899421167286*^9}, {3.688899453830834*^9, 
   3.688899455459816*^9}, {3.688900214186232*^9, 3.688900219075275*^9}, {
   3.688900268813326*^9, 3.688900272288824*^9}, {3.688900391896223*^9, 
   3.688900409605085*^9}, {3.6889004925667152`*^9, 3.688900500749811*^9}, 
   3.688937508095537*^9, {3.689617960041312*^9, 3.689617971180437*^9}, {
   3.689618340063038*^9, 3.689618416988483*^9}, {3.689618474058797*^9, 
   3.689618496842525*^9}, 3.6896185678073587`*^9, 3.689618639354116*^9, {
   3.689618747261505*^9, 3.689618774157618*^9}, {3.6896202591110773`*^9, 
   3.689620321213889*^9}, {3.689620370508799*^9, 3.68962037146173*^9}, 
   3.689620439851973*^9, {3.68962054524196*^9, 3.689620546233873*^9}, 
   3.689620905964918*^9, {3.689620954793437*^9, 3.689620955312237*^9}, {
   3.689621843318009*^9, 3.6896218583898087`*^9}, 3.6896221251389627`*^9, 
   3.689679439483789*^9, {3.689680208930934*^9, 3.689680235279633*^9}, {
   3.689702772769565*^9, 3.689702776362083*^9}, {3.689702955042224*^9, 
   3.689703071072604*^9}, {3.689703102160236*^9, 3.689703125615221*^9}, {
   3.6897033532712927`*^9, 3.6897033821981564`*^9}, {3.689703416356786*^9, 
   3.689703418467318*^9}, {3.689703501422708*^9, 3.689703544595126*^9}, {
   3.689703576621763*^9, 3.6897035797695913`*^9}, {3.689703689396224*^9, 
   3.689703725401431*^9}, {3.689703767051588*^9, 3.689703793040707*^9}, {
   3.689703889983645*^9, 3.689703897134975*^9}, {3.689704232826089*^9, 
   3.689704243866418*^9}, {3.6897042960100527`*^9, 3.689704316635892*^9}, {
   3.689704609790207*^9, 3.689704632274337*^9}, {3.6897046662680187`*^9, 
   3.689704682913583*^9}, {3.6897047380750093`*^9, 3.689704820487657*^9}, {
   3.6897049853711863`*^9, 3.689705014396738*^9}, {3.68970504664723*^9, 
   3.689705056267849*^9}, 3.689705092279093*^9, {3.689705173235333*^9, 
   3.689705175011661*^9}, 3.6897052259624243`*^9, {3.6897052709693832`*^9, 
   3.6897053273291883`*^9}, {3.689705365385768*^9, 3.689705368801379*^9}, {
   3.6897054158897467`*^9, 3.6897054441336203`*^9}, {3.689705494904895*^9, 
   3.689705498750948*^9}, {3.68970573131789*^9, 3.689705887393858*^9}, 
   3.7158522267987623`*^9, 3.71585514053936*^9, {3.716040418737607*^9, 
   3.716040422257596*^9}, 3.717740863076173*^9, {3.717740897310025*^9, 
   3.717740915407414*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"8b8f800f-b36e-4d1b-b4eb-afd5f8ee2586"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"b4eec69b-5757-4449-be71-eb4a852bd7a3"]
}, Closed]],

Cell[CellGroupData[{

Cell["RefinedValues", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
  3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
  3.667811516189644*^9}, {3.667818136663406*^9, 
  3.667818153735055*^9}},ExpressionUUID->"7fa89887-046d-465b-ac16-\
eabca80de3bc"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"d423cfce-0ac6-4310-9ac3-3516c3f47f8e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"RefinedValues", "::", "label"}], "=", 
   "\"\<\[LeftGuillemet]`1`\[RightGuillemet] is not a recognised \
label.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RefinedValues", "::", "log"}], "=", 
   "\"\<Search for log files has failed.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RefinedValues", "::", "residue"}], "=", 
   "\"\<No residue value found.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RefinedValues", "::", "matrix"}], "=", 
   "\"\<No `1` matrix was found.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RefinedValues", "::", "mosaicity"}], "=", 
   "\"\<No mosaicity values found in \
\[LeftGuillemet]`1`\[RightGuillemet].\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RefinedValues", "::", "wavelength"}], "=", 
    "\"\<No wavelength found in \[LeftGuillemet]`1`\[RightGuillemet].\>\""}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "RefinedValues", "]"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<ConstrainedCell\>\"", "\[Rule]", "True"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Uncertainties\>\"", "\[Rule]", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Units\>\"", "\[Rule]", "False"}]}], "}"}]}], 
  ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"0b7ef6d9-16d7-4c78-b8de-39a0750838da"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"62bd9d9f-872c-477f-b794-9a552e5f8dff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RefinedValues", "[", 
   RowBox[{"input_String", ",", "label_String", ",", 
    RowBox[{"OptionsPattern", "@", "RefinedValues"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "Setup", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
     "files", ",", "import", ",", "\[IndentingNewLine]", "constrained", ",", 
      "uncertainties", ",", "units", ",", "\[IndentingNewLine]", "allvalues", 
      ",", "take", ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"'", 
        RowBox[{"Refinement", "'"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      "n0", ",", "n", ",", "r", ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"'", 
        RowBox[{"Wavelength", "'"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      "\[Lambda]", ",", "c", ",", "cInverse", ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"'", 
        RowBox[{"InstrumentModel", "'"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", "lattice", ",", "latticeU", ",", "X", ",", "x", 
      ",", "\[Delta]", ",", "\[IndentingNewLine]", "goniometer", ",", 
      "detector", ",", "rotation", ",", "instrument", ",", "parameters", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"'", 
         RowBox[{"UB", "'"}]}], ",", " ", 
        RowBox[{"'", 
         RowBox[{"U", "'"}], " ", 
         RowBox[{"and", " ", "'"}], 
         RowBox[{"B", "'"}]}]}], " ", "*)"}], "\[IndentingNewLine]", "UB", 
      ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"'", 
        RowBox[{"Angles", "'"}]}], " ", "*)"}], "\[IndentingNewLine]", "num", 
      ",", "angles", ",", "\[Alpha]\[Beta]", ",", "\[Omega]", ",", "\[Theta]",
       ",", "\[Kappa]", ",", "\[Phi]", ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"'", 
        RowBox[{"CorrelationMatrix", "'"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", "m", ",", "tags", ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "Miscellaneous", " ", "*)"}], "\[IndentingNewLine]", 
      "temp"}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"--", "-"}], "*", " ", "Setup", " ", "*", 
      RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
    RowBox[{"(*", " ", 
     RowBox[{"Label", " ", "check"}], " ", "*)"}], "\[IndentingNewLine]", 
    "\t", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"{", "\[IndentingNewLine]", "\t", 
           RowBox[{
           "\"\<Refinement\>\"", ",", "\"\<UnitCell\>\"", ",", 
            "\"\<Wavelength\>\"", ",", "\[IndentingNewLine]", "\t", 
            "\"\<InstrumentModel\>\"", ",", "\"\<UB\>\"", ",", "\"\<U\>\"", 
            ",", "\"\<B\>\"", ",", "\"\<Mosaicity\>\"", ",", 
            "\[IndentingNewLine]", "\t", "\"\<Angles\>\"", ",", 
            "\"\<CorrelationMatrix\>\""}], "}"}], ",", "label"}], "]"}]}], 
       ",", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"RefinedValues", "::", "label"}], ",", "label"}], "]"}], 
        ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Input", " ", "check"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t\t", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Scenario", " ", "1"}], ":", " ", 
       RowBox[{"Log", " ", "information", " ", "given", " ", "directly"}]}], 
      " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
     RowBox[{"Quiet", "@", 
      RowBox[{"If", "[", "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"StringTake", "[", 
          RowBox[{"input", ",", "27"}], "]"}], "\[Equal]", 
         "\"\<Your current setup file is:\>\""}], ",", "\[IndentingNewLine]", 
        "\t\t", 
        RowBox[{
         RowBox[{"import", "=", "input"}], ";", "\[IndentingNewLine]", "\t\t", 
         RowBox[{"Goto", "[", "\"\<ImportDone\>\"", "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Scenario", " ", "2"}], ":", " ", 
       RowBox[{"Single", " ", "log", " ", "file", " ", "given"}]}], " ", 
      "*)"}], "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"FileExistsQ", "[", "input", "]"}], "&&", 
        RowBox[{
         RowBox[{"StringTake", "[", 
          RowBox[{"input", ",", 
           RowBox[{"-", "3"}]}], "]"}], "\[Equal]", "\"\<txt\>\""}]}], ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"import", "=", 
         RowBox[{"Import", "[", 
          RowBox[{"input", ",", "\"\<String\>\""}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"Goto", "[", "\"\<ImportDone\>\"", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Scenario", " ", "3"}], ":", " ", 
       RowBox[{"Log", "-", " ", 
        RowBox[{"or", " ", "project", " ", "directory", " ", "given"}]}]}], 
      " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
     RowBox[{"files", "=", 
      RowBox[{"FileNames", "[", 
       RowBox[{"\"\<*.txt\>\"", ",", 
        RowBox[{"{", "input", "}"}], ",", "3"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"DirectoryQ", "[", "input", "]"}], "&&", 
        RowBox[{"files", "\[NotEqual]", 
         RowBox[{"{", "}"}]}]}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"import", "=", 
         RowBox[{"MergeLogs", "[", "input", "]"}]}], ";", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"Goto", "[", "\"\<ImportDone\>\"", "]"}]}]}], "]"}], ";", 
     "\t\t", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Finding", " ", "log", " ", "failed"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t\t\t", 
     RowBox[{"Message", "[", 
      RowBox[{"RefinedValues", "::", "log"}], "]"}], ";", 
     "\[IndentingNewLine]", "\t\t\t", 
     RowBox[{"Goto", "[", "\"\<End\>\"", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Preparations", " ", "common", " ", "for", " ", "all", " ", "tasks"}], 
      " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"Label", "[", "\"\<ImportDone\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"(*", " ", "Options", " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
     RowBox[{"constrained", "=", 
      RowBox[{"OptionValue", "[", "\"\<ConstrainedCell\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"uncertainties", "=", 
      RowBox[{"OptionValue", "[", "\"\<Uncertainties\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"units", "=", 
      RowBox[{"OptionValue", "[", "\"\<Units\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Making", " ", "a", " ", "list", " ", "to", " ", "store", " ", "all", 
       " ", "the", " ", "values", " ", "in"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"allvalues", "=", 
      RowBox[{"<|", "|>"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Goto", "[", "label", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "'", 
       RowBox[{"Refinement", "'"}], " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Label", "[", "\"\<Refinement\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "Extracting", " ", "the", " ", "number", " ", "of", " ", 
        "reflections"}], ",", " ", 
       RowBox[{"initially", " ", "and", " ", "finally"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"n0", "=", 
      RowBox[{"First", "@", 
       RowBox[{"StringCases", "[", 
        RowBox[{"import", ",", "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"Shortest", "[", 
           RowBox[{
           "\"\<UB fit with \>\"", "~~", "__", "~~", "\"\<out of \>\"", "~~", 
            
            RowBox[{"n0", ":", 
             RowBox[{"DigitCharacter", ".."}]}], "~~", "\"\< \>\""}], "]"}], 
          "\[RuleDelayed]", "n0"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"n", "=", 
      RowBox[{"Last", "@", 
       RowBox[{"StringCases", "[", 
        RowBox[{"import", ",", "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"Shortest", "[", 
           RowBox[{"\"\<UB fit with \>\"", "~~", 
            RowBox[{"n", ":", 
             RowBox[{"DigitCharacter", ".."}]}], "~~", "\"\< \>\""}], "]"}], 
          "\[RuleDelayed]", "n"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n0", ",", "n"}], "}"}], "=", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"{", 
        RowBox[{"n0", ",", "n"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"allvalues", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<ReflectionsInitial\>\"", "\[Rule]", "n0"}], ",", 
         RowBox[{"\"\<ReflectionsFinal\>\"", "\[Rule]", "n"}]}], "}"}]}], 
      "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Extracting", " ", "the", " ", "latest", " ", "residue", " ", 
       "parameter"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"r", "=", 
      RowBox[{"StringCases", "[", 
       RowBox[{"import", ",", "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"\"\<Resid:\>\"", "~~", 
          RowBox[{"\"\< \>\"", ".."}], "~~", 
          RowBox[{"r", ":", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"DigitCharacter", ",", "\"\<-\>\"", ",", "\"\<.\>\""}], 
             "}"}], ".."}]}]}], "\[RuleDelayed]", "r"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"r", "\[Equal]", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"RefinedValues", "::", "residue"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"r", "=", 
      RowBox[{"ToExpression", "@", 
       RowBox[{"Last", "@", "r"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Optional", ":", " ", "Units"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{"units", ",", 
       RowBox[{
        RowBox[{"r", "=", 
         RowBox[{"100", "*", "r"}]}], ";", 
        RowBox[{"r", "=", 
         RowBox[{"Quantity", "[", 
          RowBox[{"r", ",", "\"\<Percent\>\""}], "]"}]}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"allvalues", ",", 
       RowBox[{"\"\<Rint\>\"", "\[Rule]", "r"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Return", "@", "allvalues"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "'", 
       RowBox[{"UnitCell", "'"}], " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Label", "[", "\"\<UnitCell\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Finding", " ", "and", " ", "extracting", " ", "the", " ", "lattice", 
       " ", "parameters"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"Quiet", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"lattice", "=", 
        RowBox[{"StringCases", "[", 
         RowBox[{"import", ",", "\[IndentingNewLine]", "\t", 
          RowBox[{"Shortest", "[", 
           RowBox[{
           "\"\<unit cell:\>\"", "~~", "__", "~~", "\"\<V\>\"", "~~", "__", "~~",
             "EndOfLine"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"Constrained", " ", "or", " ", "non"}], "-", 
         RowBox[{"constrained", " ", "cell"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"If", "[", 
        RowBox[{"constrained", ",", 
         RowBox[{"take", "=", 
          RowBox[{"-", "1"}]}], ",", 
         RowBox[{"take", "=", 
          RowBox[{"-", "2"}]}]}], "]"}], ";", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"lattice", "=", 
        RowBox[{
         RowBox[{"StringCases", "[", 
          RowBox[{
           RowBox[{"lattice", "[", 
            RowBox[{"[", "take", "]"}], "]"}], ",", "\[IndentingNewLine]", 
           "\t\t", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
             "DigitCharacter", ",", "\"\<-\>\"", ",", "\"\<.\>\"", ",", 
              "\"\<(\>\"", ",", "\"\<)\>\""}], "}"}], ".."}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{";;", "6"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"latticeU", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"X", "=", 
           RowBox[{"StringCases", "[", 
            RowBox[{
             RowBox[{"lattice", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"DigitCharacter", ",", "\"\<-\>\"", ",", "\"\<.\>\""}],
                "}"}], ".."}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t\t", 
          
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "X", "]"}], "\[Equal]", "2"}], ",", 
            "\[IndentingNewLine]", "\t\t\t", 
            RowBox[{"(*", " ", 
             RowBox[{"Uncertainty", " ", "given"}], " ", "*)"}], 
            "\[IndentingNewLine]", "\t\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{"X", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             "\t\t\t", 
             RowBox[{"\[Delta]", "=", 
              RowBox[{"ToExpression", "@", 
               RowBox[{"X", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", "\t\t\t", 
             RowBox[{"temp", "=", 
              RowBox[{"StringLength", "@", 
               RowBox[{"First", "@", "\[IndentingNewLine]", "\t\t\t", 
                RowBox[{"StringCases", "[", 
                 RowBox[{"x", ",", 
                  RowBox[{
                   RowBox[{"\"\<.\>\"", "~~", 
                    RowBox[{"n", ":", 
                    RowBox[{"(", 
                    RowBox[{"DigitCharacter", ".."}], ")"}]}]}], 
                   "\[RuleDelayed]", "n"}]}], "]"}]}]}]}], ";", 
             "\[IndentingNewLine]", "\t\t\t", 
             RowBox[{"X", "=", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"N", "[", 
                 RowBox[{"\[Delta]", "*", 
                  RowBox[{"10", "^", 
                   RowBox[{"(", 
                    RowBox[{"-", "temp"}], ")"}]}]}], "]"}]}], "}"}]}]}], ",",
             "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t\t", 
            RowBox[{"(*", " ", 
             RowBox[{"No", " ", "uncertainty"}], " ", "*)"}], 
            "\[IndentingNewLine]", "\t\t\t", 
            RowBox[{"X", "=", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"X", ",", "0."}], "}"}], "]"}]}]}], 
           "\[IndentingNewLine]", "\t\t\t", "]"}], ";", "\[IndentingNewLine]",
           "\t\t", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"latticeU", ",", "X"}], "]"}]}], ",", 
         "\[IndentingNewLine]", "\t\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "lattice"}]}], "}"}]}], 
        "\[IndentingNewLine]", "\t\t", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"Optional", ":", " ", "Units"}], " ", "*)"}], 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"temp", "=", 
        RowBox[{"<|", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "\"\<a\>\"", ",", "\"\<b\>\"", ",", "\"\<c\>\"", ",", 
             "\"\<\[Alpha]\>\"", ",", "\"\<\[Beta]\>\"", ",", 
             "\"\<\[Gamma]\>\""}], "}"}], "\[Rule]", "latticeU"}], "]"}], 
         "|>"}]}], ";", "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{"units", ",", "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"lattice", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"Quantity", "[", 
              RowBox[{"#", ",", "\"\<Angstroms\>\""}], "]"}], "&"}], "/@", 
            RowBox[{"temp", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"\"\<a\>\"", ",", "\"\<b\>\"", ",", "\"\<c\>\""}], 
               "}"}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", "\t", 
          RowBox[{"angles", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"Quantity", "[", 
              RowBox[{"#", ",", "\"\<Degrees\>\""}], "]"}], "&"}], "/@", 
            RowBox[{"temp", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{
               "\"\<\[Alpha]\>\"", ",", "\"\<\[Beta]\>\"", ",", 
                "\"\<\[Gamma]\>\""}], "}"}], "]"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"temp", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"lattice", ",", "angles"}], "]"}]}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"Optional", ":", " ", "Uncertainties"}], " ", "*)"}], 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", "uncertainties"}], ",", 
         RowBox[{"temp", "=", 
          RowBox[{"temp", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "]"}], ";", "\t", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "@", "temp"}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "'", 
       RowBox[{"Wavelength", "'"}], " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Label", "[", "\"\<Wavelength\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"StringCases", "[", 
       RowBox[{"import", ",", "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"\"\<wavelength: \>\"", "~~", 
          RowBox[{"\[Lambda]", ":", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"DigitCharacter", ",", "\"\<.\>\""}], "}"}], ".."}]}]}], 
         "\[RuleDelayed]", "\[Lambda]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{"temp", ",", 
        RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Check", " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"temp", "\[Equal]", 
        RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Exploit", " ", "that", " ", "UB", " ", "is", " ", "scaled", " ", 
         "by", " ", "wavelength"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
       
       RowBox[{
        RowBox[{"UB", "=", 
         RowBox[{"RefinedValues", "[", 
          RowBox[{"input", ",", "\"\<UB\>\""}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"cInverse", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"QRDecomposition", "@", "UB"}], ")"}], "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"-", "1"}], ",", 
            RowBox[{"-", "1"}], ",", 
            RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"c", "=", 
         RowBox[{"ToExpression", "@", 
          RowBox[{
           RowBox[{"RefinedValues", "[", 
            RowBox[{"input", ",", "\"\<UnitCell\>\""}], "]"}], "[", 
           "\"\<c\>\"", "]"}]}]}], ";", "\[IndentingNewLine]", "\t", 
        RowBox[{"\[Lambda]", "=", 
         RowBox[{"Abs", "[", 
          RowBox[{"c", "*", "cInverse"}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"Extract", " ", "directly"}], " ", "*)"}], 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"\[Lambda]", "=", 
        RowBox[{"ToExpression", "@", 
         RowBox[{"First", "@", 
          RowBox[{"Flatten", "@", "temp"}]}]}]}]}], "\[IndentingNewLine]", 
      "\t", "]"}], ";", "\t", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Optional", ":", " ", "Units"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{"units", ",", 
       RowBox[{"\[Lambda]", "=", 
        RowBox[{"Quantity", "[", 
         RowBox[{"\[Lambda]", ",", "\"\<Angstroms\>\""}], "]"}]}]}], "]"}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Return", "@", "\[Lambda]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "'", 
       RowBox[{"InstrumentModel", "'"}], " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Label", "[", "\"\<InstrumentModel\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Finding", " ", "and", " ", "extracting", " ", "goniometer", " ", "and",
        " ", "detector", " ", "data"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t\t", 
     RowBox[{"rotation", "=", 
      RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
       RowBox[{
       "\"\<Cryst. Rot. X\>\"", ",", "\"\<Cryst. Rot. Y\>\"", ",", 
        "\"\<Cryst. Rot. Z\>\"", ",", "\[IndentingNewLine]", "\t\t", 
        "\"\<Cryst. Dance X\>\"", ",", "\"\<Cryst. Dance Y\>\"", ",", 
        "\"\<Cryst. Dance Z\>\""}], "}"}]}], ";", "\[IndentingNewLine]", 
     "\t\t", 
     RowBox[{"goniometer", "=", 
      RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
       RowBox[{
       "\"\<Beam. Rot. Y\>\"", ",", "\"\<Beam. Rot. Z\>\"", ",", 
        "\[IndentingNewLine]", "\t\t", "\"\<Alpha Value\>\"", ",", 
        "\"\<Beta Value\>\"", ",", "\[IndentingNewLine]", "\t\t", 
        "\"\<Omega Offset\>\"", ",", "\"\<Theta Offset\>\"", ",", 
        "\"\<Kappa Offset\>\"", ",", "\"\<Phi Offset\>\""}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"detector", "=", 
      RowBox[{"{", "\[IndentingNewLine]", "\t\t", 
       RowBox[{
       "\"\<Det. Rot. X\>\"", ",", "\"\<Det. Rot. Y\>\"", ",", 
        "\"\<Det. Rot. Z\>\"", ",", "\[IndentingNewLine]", "\t\t", 
        "\"\<Det. Offset X\>\"", ",", "\"\<Det. Offset Y\>\"", ",", 
        "\"\<Det. D. Scale\>\""}], "}"}]}], ";", "\[IndentingNewLine]", 
     "\t\t", 
     RowBox[{"instrument", "=", 
      RowBox[{"{", 
       RowBox[{"rotation", ",", "goniometer", ",", "detector"}], "}"}]}], ";",
      "\[IndentingNewLine]", "\t", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"Quiet", "[", "\[IndentingNewLine]", "\t\t", 
      RowBox[{
       RowBox[{"parameters", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Last", "@", 
             RowBox[{"DeleteCases", "[", 
              RowBox[{
               RowBox[{"StringCases", "[", 
                RowBox[{"import", ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"#", "~~", 
                   RowBox[{"\"\< \>\"", ".."}], "~~", "\[IndentingNewLine]", 
                   RowBox[{"v1", ":", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "DigitCharacter", ",", "\"\<-\>\"", ",", "\"\<.\>\""}], 
                    "}"}], ".."}]}], "~~", 
                   RowBox[{"\"\< \>\"", ".."}], "~~", "\[IndentingNewLine]", 
                   RowBox[{"v2", ":", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "DigitCharacter", ",", "\"\<-\>\"", ",", "\"\<.\>\""}], 
                    "}"}], ".."}]}]}], "\[RuleDelayed]", "v2"}]}], "]"}], ",",
                "\[IndentingNewLine]", "\t", 
               RowBox[{"x_", "/;", 
                RowBox[{
                 RowBox[{"StringLength", "[", "x", "]"}], "\[LessEqual]", 
                 "5"}]}]}], "]"}]}], "&"}], "/@", "#"}], "&"}], "/@", 
         "instrument"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\t\t", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"allvalues", ",", "\[IndentingNewLine]", "\t\t", 
         RowBox[{"\"\<Rotation\>\"", "\[Rule]", 
          RowBox[{"Association", "@", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
              "\"\<r1\>\"", ",", "\"\<r2\>\"", ",", "\"\<r3\>\"", ",", 
               "\"\<w1\>\"", ",", "\"\<w2\>\"", ",", "\"\<w3\>\""}], "}"}], 
             "\[Rule]", "\[IndentingNewLine]", "\t\t", 
             RowBox[{"parameters", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "\[IndentingNewLine]", "\t", 
            "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"allvalues", ",", "\[IndentingNewLine]", "\t\t", 
         RowBox[{"\"\<Goniometer\>\"", "\[Rule]", 
          RowBox[{"Association", "@", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
              "\"\<b2\>\"", ",", "\"\<b3\>\"", ",", "\"\<al\>\"", ",", 
               "\"\<be\>\"", ",", "\"\<o0\>\"", ",", "\"\<t0\>\"", ",", 
               "\"\<k0\>\"", ",", "\"\<p0\>\""}], "}"}], "\[Rule]", 
             "\[IndentingNewLine]", "\t\t", 
             RowBox[{"parameters", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "\[IndentingNewLine]", "\t", 
            "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"allvalues", ",", "\[IndentingNewLine]", "\t\t", 
         RowBox[{"\"\<Detector\>\"", "\[Rule]", 
          RowBox[{"Association", "@", "\[IndentingNewLine]", "\t\t", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
              "\"\<d1\>\"", ",", "\"\<d2\>\"", ",", "\"\<d3\>\"", ",", 
               "\"\<x0\>\"", ",", "\"\<y0\>\"", ",", "\"\<dd\>\""}], "}"}], 
             "\[Rule]", "\[IndentingNewLine]", "\t\t", 
             RowBox[{"parameters", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], "\[IndentingNewLine]", "\t", 
            "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "@", 
        RowBox[{"ToExpression", "@", "allvalues"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "'", 
       RowBox[{"UB", "'"}], " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Label", "[", "\"\<UB\>\"", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Extracting", " ", "the", " ", "UB", " ", "matrix"}], " ", 
      "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"StringContainsQ", "[", 
        RowBox[{"import", ",", 
         RowBox[{"\"\<UM S \>\"", "~~", 
          RowBox[{"{", 
           RowBox[{"\"\<-\>\"", ",", "DigitCharacter"}], "}"}]}]}], "]"}], 
       ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"Preferred", " ", "pattern"}], " ", "*)"}], 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"UB", "=", 
        RowBox[{"AlignUB", "@", 
         RowBox[{"Last", "@", "\[IndentingNewLine]", "\t", 
          RowBox[{"StringCases", "[", 
           RowBox[{"import", ",", 
            RowBox[{"Shortest", "[", "\[IndentingNewLine]", "\t", 
             RowBox[{"\"\<UM S \>\"", "~~", 
              RowBox[{"{", 
               RowBox[{"\"\<-\>\"", ",", "DigitCharacter"}], "}"}], "~~", 
              "__", "~~", "EndOfLine"}], "]"}]}], "]"}]}]}]}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"Other", " ", "method"}], " ", "*)"}], "\[IndentingNewLine]", 
       "\t\t", 
       RowBox[{"(*", " ", "Check", " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"StringContainsQ", "[", 
            RowBox[{"import", ",", "\"\<UB - matrix:\>\""}], "]"}]}], ",", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"RefinedValues", "::", "matrix"}], ",", "\"\<UB\>\""}], 
            "]"}], ";", 
           RowBox[{"Goto", "[", "\"\<End\>\"", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
        RowBox[{"UB", "=", 
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"StringCases", "[", 
             RowBox[{
              RowBox[{"Last", "@", "\[IndentingNewLine]", "\t", 
               RowBox[{"StringCases", "[", 
                RowBox[{"import", ",", 
                 RowBox[{
                  RowBox[{"Shortest", "[", 
                   RowBox[{
                   "\"\<UB - matrix:\>\"", "~~", "\[IndentingNewLine]", 
                    RowBox[{"m", ":", 
                    RowBox[{"(", 
                    RowBox[{"__", "~~", 
                    RowBox[{"Repeated", "[", 
                    RowBox[{
                    RowBox[{"EndOfLine", "~~", "__"}], ",", 
                    RowBox[{"{", "3", "}"}]}], "]"}]}], ")"}]}]}], "]"}], 
                  "\[RuleDelayed]", "m"}]}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "DigitCharacter", ",", "\"\<.\>\"", ",", "\"\<-\>\""}], "}"}],
                ".."}]}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{
              "1", ",", "2", ",", "3", ",", "7", ",", "8", ",", "9", ",", 
               "13", ",", "14", ",", "15"}], "}"}], "]"}], "]"}], ",", "3"}], 
          "]"}]}]}]}], "\[IndentingNewLine]", "\t", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Return", "@", 
      RowBox[{"ToExpression", "@", 
       RowBox[{"Chop", "[", 
        RowBox[{
         RowBox[{"ToExpression", "@", "UB"}], ",", 
         SuperscriptBox["10", 
          RowBox[{"-", "5"}]]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "'", 
       RowBox[{"U", "'"}], " ", 
       RowBox[{"or", " ", "'"}], 
       RowBox[{"B", "'"}], " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Label", "[", "\"\<U\>\"", "]"}], ";", 
     RowBox[{"Label", "[", "\"\<B\>\"", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"x", "=", "label"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Check", " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"StringContainsQ", "[", 
         RowBox[{"import", ",", 
          RowBox[{"\"\< \>\"", "~~", "x", "~~", "\"\< - matrix\>\""}]}], 
         "]"}]}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"RefinedValues", "::", "matrix"}], ",", "x"}], "]"}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"Goto", "[", "\"\<End\>\"", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Extracting", " ", "the", " ", "matrix"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"StringCases", "[", 
       RowBox[{"import", ",", "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"Shortest", "[", 
          RowBox[{
          "\"\< \>\"", "~~", "x", "~~", "\"\< - matrix:\>\"", "~~", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"m", ":", 
            RowBox[{"(", 
             RowBox[{"__", "~~", 
              RowBox[{"Repeated", "[", 
               RowBox[{
                RowBox[{"EndOfLine", "~~", "__"}], ",", 
                RowBox[{"{", "4", "}"}]}], "]"}]}], ")"}]}]}], "]"}], 
         "\[RuleDelayed]", "m"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"StringCases", "[", 
       RowBox[{
        RowBox[{"Last", "@", "temp"}], ",", "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"DigitCharacter", ",", "\"\<.\>\"", ",", "\"\<-\>\""}], 
          "}"}], ".."}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"ToExpression", "@", 
       RowBox[{"Partition", "[", 
        RowBox[{"temp", ",", "3"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"Chop", "[", 
       RowBox[{"temp", ",", 
        SuperscriptBox["10", 
         RowBox[{"-", "5"}]]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "@", "temp"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "'", 
       RowBox[{"Mosaicity", "'"}], " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Label", "[", "\"\<Mosaicity\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Extracting", " ", "the", " ", "mosaicities"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"(*", " ", "Check", " ", "*)"}], "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"StringContainsQ", "[", 
         RowBox[{"import", ",", "\"\<Profile size analysis\>\""}], "]"}]}], 
       ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"RefinedValues", "::", "mosaicity"}], ",", 
          RowBox[{"FileNameTake", "@", "input"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"Goto", "[", "\"\<End\>\"", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t", "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"Last", "@", 
       RowBox[{"StringCases", "[", 
        RowBox[{"import", ",", "\[IndentingNewLine]", "\t", 
         RowBox[{"Shortest", "[", 
          RowBox[{
          "\"\<Profile size analysis\>\"", "~~", "__", "~~", 
           "\"\<|\\n\\n\>\""}], "]"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"StringExtract", "[", 
       RowBox[{"temp", ",", 
        RowBox[{
         RowBox[{"-", "13"}], ";;"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"StringCases", "[", 
       RowBox[{"temp", ",", "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"DigitCharacter", ".."}], "~~", "\"\<.\>\"", "~~", 
         RowBox[{"DigitCharacter", ".."}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"ToExpression", "@", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"Flatten", "@", "temp"}], ",", "2"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Optional", ":", " ", "Units"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"Quantity", "[", 
       RowBox[{"temp", ",", "\"\<Degrees\>\""}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"Association", "@", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<e1\>\"", ",", "\"\<e2\>\"", ",", "\"\<e3\>\""}], "}"}],
          "\[Rule]", "temp"}], "]"}]}]}], ";", "\[IndentingNewLine]", "\t", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Optional", ":", " ", "Uncertainties"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"OptionValue", "[", "\"\<Uncertainties\>\"", "]"}]}], ",", 
       RowBox[{"temp", "=", 
        RowBox[{"temp", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Return", "@", "temp"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "'", 
       RowBox[{"Angles", "'"}], " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Label", "[", "\"\<Angles\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Extracting", " ", "the", " ", "diffractometer", " ", "angles"}], " ", 
      "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"ToExpression", "@", 
         RowBox[{"Last", "@", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"StringCases", "[", 
             RowBox[{"import", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"#", "~~", 
                RowBox[{"\"\< \>\"", ".."}], "~~", "\[IndentingNewLine]", 
                RowBox[{"v1", ":", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                   "DigitCharacter", ",", "\"\<-\>\"", ",", "\"\<.\>\""}], 
                   "}"}], ".."}]}], "~~", 
                RowBox[{"\"\< \>\"", ".."}], "~~", "\[IndentingNewLine]", 
                RowBox[{"v2", ":", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                   "DigitCharacter", ",", "\"\<-\>\"", ",", "\"\<.\>\""}], 
                   "}"}], ".."}]}]}], "\[RuleDelayed]", "v2"}]}], "]"}], ",", 
            "\[IndentingNewLine]", "\t", 
            RowBox[{"x_", "/;", 
             RowBox[{
              RowBox[{"StringLength", "[", "x", "]"}], "\[LessEqual]", 
              "5"}]}]}], "]"}]}]}], "&"}], "/@", "\[IndentingNewLine]", "\t", 
       
       RowBox[{"{", 
        RowBox[{"\"\<Alpha Value\>\"", ",", "\"\<Beta Value\>\""}], "}"}]}]}],
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Extracting", " ", "the", " ", "goniometer", " ", "angles"}], 
      " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"num", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"DigitCharacter", ",", "\"\<.\>\"", ",", "\"\<-\>\""}], "}"}],
        ".."}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"temp", ",", 
       RowBox[{"ToExpression", "@", 
        RowBox[{"First", "@", 
         RowBox[{"StringCases", "[", 
          RowBox[{"import", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\"\<om=\>\"", "~~", "Whitespace", "~~", 
             RowBox[{"\[Omega]", ":", "num"}], "~~", 
             RowBox[{"WhitespaceCharacter", "..."}], "\[IndentingNewLine]", 
             "~~", "\"\<th=\>\"", "~~", "Whitespace", "~~", 
             RowBox[{"\[Theta]", ":", "num"}], "~~", 
             RowBox[{"WhitespaceCharacter", "..."}], "\[IndentingNewLine]", 
             "~~", "\"\<ka=\>\"", "~~", "Whitespace", "~~", 
             RowBox[{"\[Kappa]", ":", "num"}], "~~", 
             RowBox[{"WhitespaceCharacter", "..."}], "\[IndentingNewLine]", 
             "~~", "\"\<ph=\>\"", "~~", "Whitespace", "~~", 
             RowBox[{"\[Phi]", ":", "num"}], "~~", 
             RowBox[{"WhitespaceCharacter", "..."}]}], "\[IndentingNewLine]", 
            "\[RuleDelayed]", 
            RowBox[{"{", 
             RowBox[{
             "\[Omega]", ",", "\[Theta]", ",", "\[Kappa]", ",", "\[Phi]"}], 
             "}"}]}]}], "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", "\t", 
     
     RowBox[{"temp", "=", 
      RowBox[{"Flatten", "@", "temp"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Optional", ":", " ", "Units"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{"units", ",", 
       RowBox[{"temp", "=", 
        RowBox[{"Quantity", "[", 
         RowBox[{"temp", ",", "\"\<Degrees\>\""}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"Association", "@", "\[IndentingNewLine]", "\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "\"\<\[Alpha]\>\"", ",", "\"\<\[Beta]\>\"", ",", "\"\<\[Omega]\>\"",
            ",", "\"\<\[Theta]\>\"", ",", "\"\<\[Kappa]\>\"", ",", 
           "\"\<\[Phi]\>\""}], "}"}], "\[Rule]", "temp"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Return", "@", "temp"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "'", 
       RowBox[{"CorrelationMatrix", "'"}], " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Label", "[", "\"\<CorrelationMatrix\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"Last", "@", 
       RowBox[{"StringTrim", "@", 
        RowBox[{"StringCases", "[", 
         RowBox[{"import", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Shortest", "[", 
            RowBox[{
            "\"\<Correlation matrix:\>\"", "~~", "x__", "\[IndentingNewLine]",
              "\t", "~~", "\"\<                 \>\""}], "]"}], 
           "\[RuleDelayed]", "x"}]}], "]"}]}]}]}], ";", "\[IndentingNewLine]",
      "\[IndentingNewLine]", "\t", 
     RowBox[{"tags", "=", 
      RowBox[{"StringTrim", "@", 
       RowBox[{"StringCases", "[", 
        RowBox[{"temp", ",", "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"x", ":", 
           RowBox[{"(", 
            RowBox[{"LetterCharacter", "~~", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "LetterCharacter", ",", "\"\< \>\"", ",", "\"\<.\>\"", ",", 
                "\"\<*\>\""}], "}"}], ".."}]}], ")"}]}], "\[RuleDelayed]", 
          "x"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"tags", "=", 
      RowBox[{"StringReplace", "[", 
       RowBox[{"tags", ",", 
        RowBox[{"{", "\[IndentingNewLine]", "\t", 
         RowBox[{
          RowBox[{"\"\<Det. D. Scale\>\"", "\[Rule]", "\"\<dd\>\""}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<Det. Offset X\>\"", "\[Rule]", "\"\<x0\>\""}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<Det. Offset Y\>\"", "\[Rule]", "\"\<y0\>\""}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<Det. Rot. X\>\"", "\[Rule]", "\"\<d1\>\""}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<Det. Rot. Y\>\"", "\[Rule]", "\"\<d2\>\""}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<Det. Rot. Z\>\"", "\[Rule]", "\"\<d3\>\""}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<Beam. Rot. Y\>\"", "\[Rule]", "\"\<b2\>\""}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<Beam. Rot. Z\>\"", "\[Rule]", "\"\<b3\>\""}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<Cryst. Rot. X\>\"", "\[Rule]", "\"\<r1\>\""}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<Cryst. Rot. Y\>\"", "\[Rule]", "\"\<r2\>\""}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"\"\<Cryst. Rot. Z\>\"", "\[Rule]", "\"\<r3\>\""}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{
           RowBox[{"\"\<Rec. latt. \>\"", "~~", "x__"}], "\[RuleDelayed]", 
           "x"}]}], "\[IndentingNewLine]", "\t", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"StringTrim", "@", 
       RowBox[{"StringCases", "[", 
        RowBox[{"temp", ",", 
         RowBox[{"Shortest", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\"\<-\>\"", ",", "DigitCharacter"}], "}"}], "~~", "__", "~~",
            "EndOfLine"}], "]"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"temp", "=", 
      RowBox[{"ToExpression", "/@", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"temp", ",", "Whitespace"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"m", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"PadRight", "[", 
         RowBox[{"temp", ",", 
          RowBox[{"{", 
           RowBox[{"#", ",", "#"}], "}"}]}], "]"}], "&"}], "@", 
       RowBox[{"Length", "@", "tags"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{"tags", ",", "m"}], "}"}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Return", " ", "message", " ", "and", 
       " ", "end", " ", "procedure", " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Label", "[", "\"\<End\>\"", "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, 3.667818182241951*^9, {3.66893915387926*^9, 
   3.6689391568541*^9}, {3.6689535682688227`*^9, 3.6689535723667727`*^9}, {
   3.668953742329031*^9, 3.668953767894533*^9}, {3.66895401343414*^9, 
   3.6689540146890287`*^9}, {3.668954095823165*^9, 3.668954202963657*^9}, {
   3.6689552776424713`*^9, 3.6689553523787317`*^9}, 3.668955402248642*^9, 
   3.668955544228961*^9, {3.668955656487473*^9, 3.6689556761029463`*^9}, 
   3.668955723137313*^9, {3.668955778069186*^9, 3.668955778844039*^9}, 
   3.668955851747817*^9, {3.668956797188327*^9, 3.668956800787648*^9}, {
   3.6689574672553*^9, 3.6689575413131104`*^9}, {3.66895757609718*^9, 
   3.668957606608177*^9}, {3.668958061977138*^9, 3.66895807570816*^9}, 
   3.668958262193424*^9, {3.6689582933769817`*^9, 3.668958298791482*^9}, {
   3.668960962636499*^9, 3.6689609941306477`*^9}, {3.6689610325778503`*^9, 
   3.6689610478971767`*^9}, {3.668961123824533*^9, 3.668961124598974*^9}, {
   3.668970746885648*^9, 3.668970747619759*^9}, {3.668971528258317*^9, 
   3.6689717380390673`*^9}, {3.668971776642324*^9, 3.668971907203095*^9}, {
   3.668972475934484*^9, 3.6689724801936407`*^9}, {3.6689739910823507`*^9, 
   3.668973994345357*^9}, {3.668974051645607*^9, 3.66897406018155*^9}, {
   3.6689752555944033`*^9, 3.668975277664154*^9}, {3.671743456672168*^9, 
   3.671743500621964*^9}, {3.6717435544554853`*^9, 3.671743741213606*^9}, {
   3.6717438164518547`*^9, 3.671743818931262*^9}, 3.671744975164258*^9, {
   3.671800749972239*^9, 3.671800888227201*^9}, {3.6718009403308067`*^9, 
   3.6718009411216173`*^9}, {3.671801053161522*^9, 3.6718010610165443`*^9}, {
   3.6718013962772093`*^9, 3.6718014372909307`*^9}, {3.67180149796432*^9, 
   3.671801674554243*^9}, {3.671801846334334*^9, 3.6718018977575417`*^9}, {
   3.6718019879256887`*^9, 3.671802036020062*^9}, 3.671802185692754*^9, 
   3.671802227794935*^9, {3.6718084447688303`*^9, 3.6718084471602793`*^9}, 
   3.67405750466054*^9, {3.674593413241393*^9, 3.674593416496729*^9}, {
   3.674593474563323*^9, 3.6745934753448687`*^9}, 3.6745935504087753`*^9, {
   3.67459480793622*^9, 3.674594812127016*^9}, 3.674594872575062*^9, {
   3.674596265695709*^9, 3.674596269806322*^9}, 3.674596350707733*^9, {
   3.674596499735421*^9, 3.6745965934923143`*^9}, {3.674596848471828*^9, 
   3.6745968761501703`*^9}, {3.6745969829886503`*^9, 3.674597091041081*^9}, {
   3.6745971405449057`*^9, 3.674597246278439*^9}, {3.674597317331833*^9, 
   3.674597397142655*^9}, {3.674597434336905*^9, 3.674597490642775*^9}, {
   3.674597522191773*^9, 3.6745976311390953`*^9}, {3.67459766362247*^9, 
   3.674597751761195*^9}, {3.674598342217937*^9, 3.674598521735631*^9}, 
   3.674598660276051*^9, {3.6745986921146383`*^9, 3.6745987098819647`*^9}, {
   3.674598939310384*^9, 3.67459894001403*^9}, {3.674599000857811*^9, 
   3.674599027393351*^9}, {3.6746459395369263`*^9, 3.674645972159151*^9}, {
   3.6746483761405983`*^9, 3.674648393010826*^9}, {3.674648603662313*^9, 
   3.67464860668504*^9}, {3.6858743666146803`*^9, 3.6858743722280493`*^9}, {
   3.685874428600627*^9, 3.6858744334758377`*^9}, {3.6858745279175673`*^9, 
   3.685874529249617*^9}, {3.685874957721805*^9, 3.685874985805862*^9}, {
   3.685875047585225*^9, 3.685875047828413*^9}, {3.685875081271357*^9, 
   3.685875085948098*^9}, {3.685875383606337*^9, 3.685875451016281*^9}, {
   3.685875502536851*^9, 3.6858755060995827`*^9}, {3.68587554629079*^9, 
   3.6858756052211933`*^9}, {3.685876084910796*^9, 3.68587609414709*^9}, {
   3.68587616864951*^9, 3.685876169466861*^9}, {3.685876293390209*^9, 
   3.68587644720024*^9}, {3.6858765288939323`*^9, 3.685876691278132*^9}, {
   3.68587685532941*^9, 3.685876949253998*^9}, 3.685877044547105*^9, {
   3.6858770785296183`*^9, 3.685877108295972*^9}, 3.685877160010292*^9, {
   3.68587724859991*^9, 3.685877250023253*^9}, {3.685877285168092*^9, 
   3.685877333578431*^9}, 3.6858774824296*^9, {3.6858775271693974`*^9, 
   3.685877533551222*^9}, {3.6858776393088493`*^9, 3.6858777102253113`*^9}, {
   3.685877745587963*^9, 3.6858777855455914`*^9}, {3.685877971918428*^9, 
   3.685878185208087*^9}, {3.685878234122458*^9, 3.6858783577844963`*^9}, {
   3.685878451235614*^9, 3.685878485134301*^9}, {3.68587853226553*^9, 
   3.685878643699811*^9}, {3.685878724407484*^9, 3.685878740449051*^9}, {
   3.6858787823850946`*^9, 3.685879179751277*^9}, {3.685879216804241*^9, 
   3.6858792988814373`*^9}, {3.685879332381937*^9, 3.685879332524156*^9}, {
   3.685879620701285*^9, 3.685879639371826*^9}, {3.685936754296199*^9, 
   3.685936828757168*^9}, {3.685937075742174*^9, 3.685937159798263*^9}, {
   3.6859372957238913`*^9, 3.6859373955874662`*^9}, {3.685937435555813*^9, 
   3.685937443655529*^9}, {3.685937547359518*^9, 3.6859375768306837`*^9}, {
   3.6859376337854567`*^9, 3.685937661595755*^9}, {3.6859380228224707`*^9, 
   3.685938107909132*^9}, {3.685938379602932*^9, 3.685938598833336*^9}, {
   3.685938752183744*^9, 3.685938882882948*^9}, {3.68593905373965*^9, 
   3.685939228236761*^9}, {3.685939258486649*^9, 3.685939261942576*^9}, {
   3.685939299638932*^9, 3.6859393236380997`*^9}, {3.685939358079637*^9, 
   3.6859393615028687`*^9}, {3.685939400349883*^9, 3.685939402852421*^9}, {
   3.6859394332294483`*^9, 3.685939512437005*^9}, {3.6859395474484863`*^9, 
   3.685939547583454*^9}, {3.685939590112442*^9, 3.685939628303574*^9}, {
   3.685939933557848*^9, 3.685939939326646*^9}, {3.685940737617918*^9, 
   3.6859407442990026`*^9}, {3.685940947399419*^9, 3.685941059629252*^9}, {
   3.685941126276173*^9, 3.685941244162122*^9}, {3.685941310981782*^9, 
   3.685941320878624*^9}, {3.6859415472358227`*^9, 3.6859415595929537`*^9}, {
   3.685941606586334*^9, 3.68594161288922*^9}, {3.685944406636078*^9, 
   3.685944514927621*^9}, {3.685944620536152*^9, 3.6859446233511677`*^9}, {
   3.685960757261829*^9, 3.6859607847351027`*^9}, {3.685960820088621*^9, 
   3.685960835342855*^9}, {3.685961031864623*^9, 3.685961200852539*^9}, {
   3.686022584819982*^9, 3.6860226015515833`*^9}, {3.686022653879841*^9, 
   3.686022675377027*^9}, {3.686022950021223*^9, 3.686023088422502*^9}, {
   3.686023121114601*^9, 3.686023236960445*^9}, {3.686023267319146*^9, 
   3.686023342354105*^9}, 3.6862995624474297`*^9, {3.687253456648411*^9, 
   3.687253490933877*^9}, {3.687253525543254*^9, 3.687253527897431*^9}, {
   3.687253616371193*^9, 3.687253616510745*^9}, {3.687254113534917*^9, 
   3.68725418952225*^9}, {3.687255538651263*^9, 3.687255598562874*^9}, {
   3.687255673176875*^9, 3.6872556737047453`*^9}, {3.6872557973504963`*^9, 
   3.6872558682286177`*^9}, {3.687255902340312*^9, 3.6872559277506437`*^9}, {
   3.687255993656146*^9, 3.687255997004445*^9}, {3.6872560347333393`*^9, 
   3.6872561070286818`*^9}, {3.687257493039791*^9, 3.6872574943823967`*^9}, {
   3.687257613983083*^9, 3.687257656239561*^9}, {3.687257687241078*^9, 
   3.687257776892557*^9}, {3.6872578581076183`*^9, 3.687257859021693*^9}, {
   3.6872578918491287`*^9, 3.687257897955031*^9}, {3.7136699159062*^9, 
   3.713669917769485*^9}, {3.713669948209055*^9, 3.713670001959654*^9}, {
   3.713670060137763*^9, 3.713670071854795*^9}, {3.7136708195594263`*^9, 
   3.7136708249319563`*^9}, {3.713671219478012*^9, 3.713671250299797*^9}, {
   3.713671284068367*^9, 3.713671284226981*^9}, 3.713671352441619*^9, {
   3.713671485269841*^9, 3.713671533138571*^9}, {3.7136715969458733`*^9, 
   3.713671604496458*^9}, 3.713671801662971*^9, {3.713672767407249*^9, 
   3.713672788188427*^9}, {3.713672914010313*^9, 3.713673048094618*^9}, {
   3.7136736665049553`*^9, 3.7136736685836287`*^9}, {3.713673699321306*^9, 
   3.713673711455546*^9}, {3.713673789212812*^9, 3.713673799990601*^9}, {
   3.7136750857001953`*^9, 3.713675183318901*^9}, {3.713675213758539*^9, 
   3.71367528873489*^9}, {3.713675405961273*^9, 3.7136754222796087`*^9}, {
   3.713675456448269*^9, 3.713675498557611*^9}, {3.7136755335921593`*^9, 
   3.713675593700807*^9}, {3.713675625292055*^9, 3.713675633794663*^9}, {
   3.7136757653933887`*^9, 3.713675836686082*^9}, {3.713675944979413*^9, 
   3.713676014780087*^9}, {3.7136760513962727`*^9, 3.7136760645373793`*^9}, {
   3.7136760967694197`*^9, 3.713676123015504*^9}, {3.713676200159346*^9, 
   3.7136762042332773`*^9}, {3.713676242821952*^9, 3.713676264401856*^9}, {
   3.7136765413436413`*^9, 3.71367654398393*^9}, {3.713676804713175*^9, 
   3.713676807553444*^9}, {3.713676995524881*^9, 3.7136769966364107`*^9}, {
   3.713677049646826*^9, 3.713677060386262*^9}, {3.713677096436474*^9, 
   3.713677114146543*^9}, {3.713679419617097*^9, 3.713679429194941*^9}, {
   3.7136795177576933`*^9, 3.713679517877891*^9}, {3.713686706958914*^9, 
   3.713686742658032*^9}, {3.713686804548905*^9, 3.71368682245063*^9}, {
   3.713687185202382*^9, 3.7136871884777317`*^9}, {3.7136872494816017`*^9, 
   3.713687250121623*^9}, {3.713692360194339*^9, 3.713692361400322*^9}, {
   3.713692453819728*^9, 3.713692486995563*^9}, {3.713692529177943*^9, 
   3.713692561778796*^9}, 3.7136926628970833`*^9, {3.713692707668895*^9, 
   3.7136928116204443`*^9}, {3.713692856940464*^9, 3.7136928578012943`*^9}, {
   3.7136933516396103`*^9, 3.713693387334593*^9}, {3.713802216315503*^9, 
   3.713802217726561*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"7c947e04-1605-400b-bf12-4988e7bcc9ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RefinedValues", "[", 
   RowBox[{"input_String", ",", 
    RowBox[{"OptionsPattern", "@", "RefinedValues"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "log", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"log", "=", 
      RowBox[{"MergeLogs", "@", "input"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Association", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Quiet", "[", 
         RowBox[{"#", "\[Rule]", 
          RowBox[{"RefinedValues", "[", 
           RowBox[{"log", ",", "#", ",", "\[IndentingNewLine]", 
            RowBox[{"\"\<ConstrainedCell\>\"", "\[Rule]", 
             RowBox[{"OptionValue", "[", "\"\<ConstrainedCell\>\"", "]"}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"\"\<Uncertainties\>\"", "\[Rule]", 
             RowBox[{"OptionValue", "[", "\"\<Uncertainties\>\"", "]"}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"\"\<Units\>\"", "\[Rule]", 
             RowBox[{"OptionValue", "[", "\"\<Units\>\"", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}]}], "]"}], "&"}], "/@", 
       RowBox[{"{", "\[IndentingNewLine]", "\t", 
        RowBox[{
        "\"\<Refinement\>\"", ",", "\"\<UnitCell\>\"", ",", 
         "\"\<Wavelength\>\"", ",", "\[IndentingNewLine]", "\t", 
         "\"\<InstrumentModel\>\"", ",", "\"\<UB\>\"", ",", "\"\<U\>\"", ",", 
         "\"\<B\>\"", ",", "\"\<Mosaicity\>\"", ",", "\[IndentingNewLine]", 
         "\t", "\"\<Angles\>\"", ",", "\"\<CorrelationMatrix\>\""}], "}"}]}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.713692081880583*^9, 3.713692313891738*^9}, {
   3.713692394746468*^9, 3.7136924149578743`*^9}, 3.713693518720646*^9, {
   3.713693708220636*^9, 3.713693723178986*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"098360e2-ac3e-44bd-ad35-c18e4b0da9f4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"eb80ed6b-f5c8-45cc-ae64-ad2b87bb5f7f"]
}, Closed]],

Cell[CellGroupData[{

Cell["RoundSignificantFigures", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, 3.667900125753806*^9, {3.684646660758275*^9, 
   3.684646660811885*^9}, {3.684679409191053*^9, 3.684679411222722*^9}, {
   3.6846811176191063`*^9, 3.684681119497213*^9}, {3.6846813101581917`*^9, 
   3.6846813119644547`*^9}, {3.684735312111738*^9, 3.684735315961302*^9}, {
   3.68473584376371*^9, 3.6847358475681477`*^9}, 
   3.7616532046980667`*^9},ExpressionUUID->"2dd21067-07a0-4cd8-805e-\
a8c7261b1d64"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"6ccb8904-64b5-41a8-95f7-379f4ba60692"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "@", "RoundSignificantFigures"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{"\"\<Prefix\>\"", "\[Rule]", "True"}], "\[IndentingNewLine]", 
    "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.761653204706108*^9},ExpressionUUID->"09fff4b7-4b95-4f2f-86fd-\
1f3fa694a9d4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"fe7a24ad-184c-4cba-ba1a-7b74a82e2f6d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RoundSignificantFigures", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x_", "?", "NumericQ"}], ",", 
      RowBox[{"\[Delta]x_", "?", "NumericQ"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"OptionsPattern", "@", "RoundSignificantFigures"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "a", ",", "\[Delta]", ",", "\[Delta]1", ",", "\[Delta]2", ",", "p1", ",",
       "p2", ",", "d", ",", "X", ",", "\[Delta]X", ",", "postfix", ",", 
      "output", ",", "temp"}], "}"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Extract", " ", "first", " ", "two", " ", "signigicant", " ", "figures", 
      " ", "of", " ", "uncertainty"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\[Delta]", "=", 
      RowBox[{"SetPrecision", "[", 
       RowBox[{"\[Delta]x", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Delta]1", ",", "\[Delta]2"}], "}"}], "=", 
      RowBox[{"First", "@", 
       RowBox[{"RealDigits", "@", "\[Delta]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Determining", " ", "difference", " ", "in", " ", "order", " ", "of", 
       " ", "magnitude"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"p1", ",", "p2"}], "}"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"RealDigits", "[", "#", "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}], "-", "1"}], ")"}], "&"}], "/@", 
       RowBox[{"{", 
        RowBox[{"x", ",", "\[Delta]x"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"d", "=", 
      RowBox[{"p1", "-", "p2", "+", "1"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Rounding", " ", "to", " ", "one", " ", "digit"}], " ", "+", 
        " ", "zero"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Delta]1", "\[Equal]", "9"}], "&&", 
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"5", ",", "9"}], "]"}], ",", "\[Delta]2"}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"X", "=", 
         RowBox[{"SetPrecision", "[", 
          RowBox[{"x", ",", "d"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
        
        RowBox[{"\[Delta]X", "=", 
         RowBox[{"SetPrecision", "[", 
          RowBox[{
           RowBox[{"Round", "[", 
            RowBox[{"\[Delta]x", ",", 
             RowBox[{"10", "^", "p2"}]}], "]"}], ",", "2"}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Rounding", " ", "to", " ", "two", " ", "digits"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Delta]1", "\[Equal]", "1"}], "&&", 
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", "5"}], "]"}], ",", "\[Delta]2"}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"X", "=", 
         RowBox[{"SetPrecision", "[", 
          RowBox[{"x", ",", 
           RowBox[{"d", "+", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"\[Delta]X", "=", "\[Delta]"}]}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Rounding", " ", "to", " ", "one", " ", "digit"}], " ", 
        "*)"}], "\[IndentingNewLine]", "True", ",", "\[IndentingNewLine]", 
       "\t", 
       RowBox[{
        RowBox[{"X", "=", 
         RowBox[{"SetPrecision", "[", 
          RowBox[{"x", ",", "d"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
        
        RowBox[{"\[Delta]X", "=", 
         RowBox[{"SetPrecision", "[", 
          RowBox[{"\[Delta]x", ",", "1"}], "]"}]}]}]}], "\[IndentingNewLine]",
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Chopping", " ", "result"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"output", "=", 
      RowBox[{"{", 
       RowBox[{"X", ",", "\[Delta]X"}], "}"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Optional", ":", " ", 
       RowBox[{
       "Replace", " ", "powers", " ", "with", " ", "appropriate", " ", "SI", 
        " ", "prefix"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<Prefix\>\"", "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Divisible", "[", 
           RowBox[{"p1", ",", "3"}], "]"}], "&&", 
          RowBox[{"p1", "\[NotEqual]", "0"}], "&&", 
          RowBox[{"d", "\[LessEqual]", "6"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"postfix", "=", 
           RowBox[{"Which", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"p1", "\[Equal]", 
              RowBox[{"-", "12"}]}], ",", "\"\<pico\>\"", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"p1", "\[Equal]", 
              RowBox[{"-", "9"}]}], ",", "\"\<nano\>\"", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"p1", "\[Equal]", 
              RowBox[{"-", "6"}]}], ",", "\"\<mikro\>\"", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"p1", "\[Equal]", 
              RowBox[{"-", "3"}]}], ",", "\"\<milli\>\"", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"p1", "\[Equal]", "3"}], ",", "\"\<kilo\>\"", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"p1", "\[Equal]", "6"}], ",", "\"\<mega\>\"", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"p1", "\[Equal]", "9"}], ",", "\"\<giga\>\"", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"p1", "\[Equal]", "12"}], ",", "\"\<tera\>\""}], 
            "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"X", "=", 
           RowBox[{"X", "/", 
            RowBox[{"10", "^", "p1"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"\[Delta]X", "=", 
           RowBox[{"\[Delta]X", "/", 
            RowBox[{"10", "^", "p1"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"output", "=", 
           RowBox[{"\"\<(\>\"", "<>", 
            RowBox[{"ToString", "@", "X"}], "<>", "\"\< \[PlusMinus] \>\"", "<>", 
            RowBox[{"ToString", "@", "\[Delta]X"}], "<>", "\"\<) \>\"", "<>", 
            "postfix"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "output"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.71309104014808*^9, 3.713091065525038*^9}, {
   3.7130911402925177`*^9, 3.71309135424797*^9}, {3.713091392407091*^9, 
   3.71309179052686*^9}, {3.713092108438493*^9, 3.713092588236218*^9}, {
   3.7130926305244713`*^9, 3.713092630931327*^9}, {3.713092698130988*^9, 
   3.713092701657473*^9}, {3.713092776408547*^9, 3.713092819199215*^9}, {
   3.713092939893323*^9, 3.713093039482225*^9}, {3.713093070385338*^9, 
   3.713093105568389*^9}, {3.713093184647653*^9, 3.7130932217194157`*^9}, {
   3.7130933204608088`*^9, 3.713093324843099*^9}, {3.713093765730145*^9, 
   3.713093767225092*^9}, {3.713093832159378*^9, 3.7130938351915894`*^9}, 
   3.713093871504115*^9, {3.713093939927082*^9, 3.713093953900981*^9}, {
   3.7130944680409*^9, 3.71309449884906*^9}, {3.7130945302798347`*^9, 
   3.7130946157822104`*^9}, {3.713094649246682*^9, 3.713094671291792*^9}, {
   3.713094910879513*^9, 3.713094914542392*^9}, {3.713098887174562*^9, 
   3.713098936492216*^9}, {3.713099022090056*^9, 3.713099123055879*^9}, {
   3.713099236725995*^9, 3.713099254330511*^9}, {3.713099286324902*^9, 
   3.713099290460676*^9}, {3.7130993362035913`*^9, 3.713099350691886*^9}, {
   3.7130994306241293`*^9, 3.71309943751038*^9}, {3.71310129254068*^9, 
   3.713101301553968*^9}, {3.713101481232038*^9, 3.71310151853353*^9}, {
   3.713101741328989*^9, 3.71310178050406*^9}, {3.713101822239067*^9, 
   3.713101864056319*^9}, {3.71310189648588*^9, 3.713101911062029*^9}, {
   3.713101971691717*^9, 3.713101980355644*^9}, {3.713102143504184*^9, 
   3.713102162782456*^9}, {3.7131022895726213`*^9, 3.713102329082534*^9}, {
   3.713102404801784*^9, 3.713102434335906*^9}, {3.713102641052273*^9, 
   3.713102713779704*^9}, {3.7131028686316843`*^9, 3.713102887311252*^9}, {
   3.713103058658811*^9, 3.713103072106525*^9}, {3.713103140520859*^9, 
   3.713103172151176*^9}, {3.713103290549489*^9, 3.7131032906276217`*^9}, {
   3.713103340196616*^9, 3.713103359090212*^9}, {3.761653204712758*^9, 
   3.761653204718582*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"c82810ed-77ca-4a80-a585-19963e5b611a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"00227bdc-9cd6-40f4-ac5b-ed6878758ad9"]
}, Closed]],

Cell[CellGroupData[{

Cell["UnwarpLayerList", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, 
   3.667818641980616*^9},ExpressionUUID->"ce349b9d-6982-4794-8985-\
62d9786c2820"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"58a041f0-e1ed-4a89-8f9d-e9b593b465e7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"UnwarpLayerList", "::", "dir"}], "=", 
   "\"\<The direction vector must be three-dimensional and numeric.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"UnwarpLayerList", "::", "dep"}], "=", 
   "\"\<The layer vectors are not linearly independent.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"UnwarpLayerList", "::", "dim"}], "=", 
   "\"\<One or both of the layer vectors are not three dimensional.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"UnwarpLayerList", "::", "extended"}], "=", 
   "\"\<\[LeftGuillemet]`1`\[RightGuillemet] has been extended.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"UnwarpLayerList", "::", "jobs"}], "=", 
   "\"\<Some unwarping jobs are identical. Try increasing the range or step \
size.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"UnwarpLayerList", "::", "steps"}], "=", 
   "\"\<\!\(\*StyleBox[\"CrysAlis\",FontSlant->\"Italic\"]\) will only queue \
500 jobs at a time.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"UnwarpLayerList", "::", "small"}], "=", 
   "\"\<Some values are smaller than \!\(\*SuperscriptBox[\(10\), \
\(-6\)]\).\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"UnwarpLayerList", "::", "path"}], "=", 
   "\"\<\[LeftGuillemet]`1`\[RightGuillemet] is an invalid path.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"UnwarpLayerList", "::", "notfound"}], "=", 
    "\"\<No existing \!\(\*StyleBox[\".\", \
\"Program\"]\)\!\(\*StyleBox[\"dcunwarp\", \"Program\"]\) file was found in \
the export directory.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "UnwarpLayerList", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<ExportDirectory\>\"", "\[Rule]", 
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"{", 
        RowBox[{"$HomeDirectory", ",", "\"\<Desktop\>\""}], "}"}], "]"}]}], 
     ",", 
     RowBox[{"\"\<AppendToExisting\>\"", "\[Rule]", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<SeparationCommas\>\"", "\[Rule]", "True"}]}], "}"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.667811591227736*^9, 3.667818661555488*^9, {3.678788832925145*^9, 
   3.678788853508518*^9}, {3.679730176345752*^9, 3.6797301899949493`*^9}, {
   3.6797309670395813`*^9, 3.679731002636737*^9}, {3.679733372295627*^9, 
   3.6797334331570044`*^9}, {3.679734006976156*^9, 3.6797340119269238`*^9}, {
   3.679734046104413*^9, 3.6797340490782003`*^9}, {3.6797342428439207`*^9, 
   3.679734243889909*^9}, {3.679736548422727*^9, 3.67973655803654*^9}, 
   3.679736675868291*^9},ExpressionUUID->"ce0dad3f-7924-46f5-aaa9-\
cac6c1cd8b0b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"00c2ae64-08f8-40fc-838a-bab05634ccc4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"UnwarpLayerList", "[", "\[IndentingNewLine]", 
   RowBox[{
   "prefix_String", ",", "L1_List", ",", "L2_List", ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{"dir_List", ",", "start_", ",", "end_", ",", 
      RowBox[{"stepinput_", "?", "NumericQ"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "Res_", ",", 
    RowBox[{"OptionsPattern", "[", "UnwarpLayerList", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "steps", ",", "path", ",", "output", ",", "\[IndentingNewLine]", "len", 
      ",", "replacerule", ",", "\[Delta]", ",", "\[IndentingNewLine]", 
      "MakeValue", ",", "OriginVector", ",", "\[IndentingNewLine]", "const", 
      ",", "MakeName", ",", "\[IndentingNewLine]", "newL1", ",", "newL2", ",",
       "res", ",", "line", ",", "original", ",", "old", ",", "new", ",", "j", 
      ",", "valuestest", ",", "\[IndentingNewLine]", "temp"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Checking", " ", "input", " ", "vectors"}], " ", "*)"}], 
    "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "/@", 
         RowBox[{"Flatten", "/@", 
          RowBox[{"{", 
           RowBox[{"L1", ",", "L2"}], "}"}]}]}], "\[NotEqual]", 
        RowBox[{"{", 
         RowBox[{"3", ",", "3"}], "}"}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"UnwarpLayerList", "::", "dim"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Ascertaining", " ", "steps", " ", "or", " ", "stepsize"}], " ",
       "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"stepinput", ">", "1"}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"steps", "=", "stepinput"}], ",", "\[IndentingNewLine]", "\t", 
       
       RowBox[{"steps", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox[
           RowBox[{"Abs", "[", 
            RowBox[{"end", "-", "start"}], "]"}], "stepinput"], "+", "1"}], 
         "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     
     RowBox[{"(*", " ", 
      RowBox[{
      "Check", " ", "resolution", " ", "of", " ", "the", " ", "range"}], " ", 
      "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"end", "-", "start"}], "]"}], "/", "steps"}], "<", 
        RowBox[{
         SuperscriptBox["10", 
          RowBox[{"-", "6"}]], "-", 
         SuperscriptBox["10", 
          RowBox[{"-", "12"}]]}]}], ",", 
       RowBox[{"Message", "[", 
        RowBox[{"UnwarpLayerList", "::", "jobs"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"steps", ">", "500"}], ",", 
       RowBox[{"Message", "[", 
        RowBox[{"UnwarpLayerList", "::", "steps"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Path", " ", "check", " ", "and", " ", "setup"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"path", "=", 
      RowBox[{"OptionValue", "[", "\"\<ExportDirectory\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"DirectoryQ", "@", "path"}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"UnwarpLayerList", "::", "path"}], ",", "path"}], "]"}], 
        ";", 
        RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"output", "=", 
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"{", 
        RowBox[{"path", ",", 
         RowBox[{"prefix", "<>", "\"\<.dcunwarp\>\""}]}], "}"}], "]"}]}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Useful", " ", "variables"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"len", "=", 
      RowBox[{"StringLength", "@", 
       RowBox[{"ToString", "@", "steps"}]}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"replacerule", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<,\>\"", "\[Rule]", "\"\<  \>\""}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<{\>\"", ",", "\"\<}\>\""}], "}"}], "\[Rule]", 
         "\"\<\>\""}]}], "}"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"\[Delta]", "=", 
      RowBox[{"Min", "[", 
       RowBox[{"6", ",", 
        RowBox[{
         RowBox[{"StringLength", "@", 
          RowBox[{"ToString", "@", 
           RowBox[{"N", "[", 
            FractionBox[
             RowBox[{"end", "-", "start"}], 
             RowBox[{"steps", "-", "1"}]], "]"}]}]}], "-", "2"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Check", " ", "if", " ", "vectors", " ", "are", " ", "linearly", " ", 
       "independent"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Det", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"L1", ".", "L1"}], ",", 
             RowBox[{"L1", ".", "L2"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"L2", ".", "L1"}], ",", 
             RowBox[{"L2", ".", "L2"}]}], "}"}]}], "}"}], "]"}], "\[Equal]", 
        "0"}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"UnwarpLayerList", "::", "dep"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Making", " ", "the", " ", "origin", 
       " ", "vectors", " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Check", " ", "input", " ", "form"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"MatchQ", "[", 
         RowBox[{"dir", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"_", "?", "NumericQ"}], ",", 
            RowBox[{"_", "?", "NumericQ"}], ",", 
            RowBox[{"_", "?", "NumericQ"}]}], "}"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"UnwarpLayerList", "::", "dir"}], "]"}], 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"MakeValue", "[", "i_", "]"}], ":=", 
      RowBox[{"start", "+", 
       RowBox[{
        FractionBox[
         RowBox[{"end", "-", "start"}], 
         RowBox[{"steps", "-", "1"}]], "*", 
        RowBox[{"(", 
         RowBox[{"i", "-", "1"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"OriginVector", "[", "i_", "]"}], ":=", 
      RowBox[{"(", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"temp", "=", 
         RowBox[{"dir", "*", 
          RowBox[{"MakeValue", "[", "i", "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"temp", "=", 
         RowBox[{"AccountingForm", "@", 
          RowBox[{"NumberForm", "[", 
           RowBox[{
            RowBox[{"N", "[", "temp", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"Infinity", ",", "6"}], "}"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"temp", "=", 
         RowBox[{"StringReplace", "[", 
          RowBox[{
           RowBox[{"ToString", "@", "temp"}], ",", "replacerule"}], "]"}]}]}],
        "\[IndentingNewLine]", "\t", ")"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Check", " ", "for", " ", "duplicates", " ", "and", " ", "values", " ", 
       "smaller", " ", "than", " ", 
       SuperscriptBox["10", 
        RowBox[{"-", "6"}]]}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"valuestest", "=", 
      RowBox[{"ToString", "/@", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"MakeValue", "[", "j", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "steps"}], "}"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"DuplicateFreeQ", "@", "valuestest"}]}], ",", 
       RowBox[{"Message", "[", 
        RowBox[{"UnwarpLayerList", "::", "small"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"--", "-"}], "*", " ", "Generating", " ", "names", " ", "*", 
       RowBox[{"--", "-"}]}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Integer", " ", "Miller", " ", "indices"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"const", "=", 
      RowBox[{
       RowBox[{"dir", "+", 
        RowBox[{"{", 
         RowBox[{"\"\<h\>\"", ",", "\"\<k\>\"", ",", "\"\<l\>\""}], "}"}]}], "/.", 
       RowBox[{
        RowBox[{"a_", "+", "b_"}], "\[Rule]", "0"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", "Procedure", " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"MakeName", "[", "i_", "]"}], ":=", 
      RowBox[{"(", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"temp", "=", 
         RowBox[{"ToExpression", "@", 
          RowBox[{"StringSplit", "@", 
           RowBox[{"OriginVector", "[", "i", "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"\[Delta]", "\[Equal]", "0"}], ",", 
          RowBox[{"(*", " ", 
           RowBox[{"Integers", " ", 
            RowBox[{"only", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
          RowBox[{"temp", "=", 
           RowBox[{"Rationalize", "@", "temp"}]}], ",", "\[IndentingNewLine]",
           "\t", 
          RowBox[{"temp", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"NumberForm", "[", "\[IndentingNewLine]", "\t", 
              RowBox[{"#", ",", 
               RowBox[{"{", 
                RowBox[{"Infinity", ",", "\[Delta]"}], "}"}], ",", 
               "\[IndentingNewLine]", "\t", 
               RowBox[{"ExponentFunction", "\[Rule]", 
                RowBox[{"(", 
                 RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "&"}], "/@", 
            "temp"}]}]}], "]"}], ";", "\[IndentingNewLine]", "\t", 
        RowBox[{"temp", "=", 
         RowBox[{
          RowBox[{"const", "+", "temp"}], "/.", 
          RowBox[{
           RowBox[{"x_String", "+", "y_"}], "\[RuleDelayed]", "x"}]}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<SeparationCommas\>\"", "]"}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"(*", " ", 
           RowBox[{"Remove", " ", "separating", " ", 
            RowBox[{"commas", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
          "\t", 
          RowBox[{"temp", "=", 
           RowBox[{"StringRiffle", "[", 
            RowBox[{
             RowBox[{"ToString", "/@", "temp"}], ",", "\"\<,\>\""}], "]"}]}], 
          ",", "\[IndentingNewLine]", "\t", 
          RowBox[{"temp", "=", 
           RowBox[{"ToString", "/@", "temp"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"StringJoin", "[", 
         RowBox[{
         "\"\<\\\"\>\"", ",", "prefix", ",", "\"\<_(\>\"", ",", "temp", ",", 
          "\"\<)\\\"\>\""}], "]"}]}], "\[IndentingNewLine]", "\t", ")"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"The", " ", "L1", " ", "and", " ", "L2", " ", "vectors"}], " ", 
      "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"newL1", "=", 
      RowBox[{"StringReplace", "[", 
       RowBox[{
        RowBox[{"ToString", "@", 
         RowBox[{"NumberForm", "[", 
          RowBox[{"L1", ",", 
           RowBox[{"{", 
            RowBox[{"Infinity", ",", "6"}], "}"}]}], "]"}]}], ",", 
        "replacerule"}], "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"newL2", "=", 
      RowBox[{"StringReplace", "[", 
       RowBox[{
        RowBox[{"ToString", "@", 
         RowBox[{"NumberForm", "[", 
          RowBox[{"L2", ",", 
           RowBox[{"{", 
            RowBox[{"Infinity", ",", "6"}], "}"}]}], "]"}]}], ",", 
        "replacerule"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"The", " ", "resolution"}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"res", "=", 
      RowBox[{"ToString", "@", 
       RowBox[{"NumberForm", "[", 
        RowBox[{"Res", ",", 
         RowBox[{"{", 
          RowBox[{"Infinity", ",", "6"}], "}"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Function", " ", "that", " ", "writes", " ", "a", " ", "single", " ", 
       "line"}], " ", "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"line", "[", "i_", "]"}], ":=", 
      RowBox[{"StringJoin", "[", 
       RowBox[{
        RowBox[{"MakeName", "[", "i", "]"}], ",", "\"\<   \>\"", ",", 
        RowBox[{"OriginVector", "[", "i", "]"}], ",", "\"\<     \>\"", ",", 
        "newL1", ",", "\"\<     \>\"", ",", "newL2", ",", "\"\<        \>\"", 
        ",", "res", ",", "\"\<       \>\"", ",", "\"\<0\>\"", ",", 
        "\"\<       \>\"", ",", "\"\<0\>\""}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Generating", " ", "and", " ", "exporting", " ", "table"}], " ",
       "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<AppendToExisting\>\"", "]"}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"original", "=", 
         RowBox[{"FileNames", "[", 
          RowBox[{
           RowBox[{"OptionValue", "[", "\"\<ExportDirectory\>\"", "]"}], 
           "<>", "\"\</*.dcunwarp\>\""}], "]"}]}], ";", "\[IndentingNewLine]",
         "\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"original", "\[Equal]", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{"UnwarpLayerList", "::", "notfound"}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]",
         "\t", 
        RowBox[{"old", "=", 
         RowBox[{"Import", "[", 
          RowBox[{
           RowBox[{"First", "@", "original"}], ",", "\"\<String\>\""}], 
          "]"}]}], ";", "\[IndentingNewLine]", "\t", 
        RowBox[{"new", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"line", "[", "i", "]"}], "<>", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"i", "<", "steps"}], ",", "\"\<\\n\>\"", ",", 
              "\"\<\>\""}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "steps"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"Export", "[", 
         RowBox[{"original", ",", 
          RowBox[{"old", "<>", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"StringTake", "[", 
               RowBox[{"old", ",", 
                RowBox[{"-", "1"}]}], "]"}], "\[Equal]", "\"\<0\>\""}], ",", 
             "\"\<\\n\>\"", ",", "\"\<\>\""}], "]"}], "<>", "new"}], ",", 
          "\"\<String\>\""}], "]"}], ";", "\[IndentingNewLine]", "\t", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"UnwarpLayerList", "::", "extended"}], ",", 
          RowBox[{"FileNameTake", "@", 
           RowBox[{"First", "@", "original"}]}]}], "]"}]}], ",", "\t", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
       RowBox[{"Export", "[", 
        RowBox[{"output", ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"line", "[", "i", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "steps"}], "}"}]}], "]"}], ",", 
         "\"\<Table\>\""}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, 3.667818655261512*^9, {3.67871002711523*^9, 
   3.678710082589615*^9}, {3.678710121181778*^9, 3.678710167699074*^9}, {
   3.678780241040431*^9, 3.678780276115664*^9}, {3.678788865190544*^9, 
   3.678788977540194*^9}, {3.6794823589229097`*^9, 3.679482378956861*^9}, {
   3.679482449116295*^9, 3.679482484210161*^9}, {3.6795535894308023`*^9, 
   3.679553594985097*^9}, {3.679730372990347*^9, 3.679730423732448*^9}, {
   3.679730469374566*^9, 3.679730566706032*^9}, {3.6797306009613237`*^9, 
   3.679730601472571*^9}, {3.6797316212190742`*^9, 3.679731659793439*^9}, {
   3.679731705602343*^9, 3.679731790317072*^9}, {3.679731847596982*^9, 
   3.6797318936910458`*^9}, {3.679731928852064*^9, 3.67973197783316*^9}, {
   3.679732253608233*^9, 3.679732257891107*^9}, {3.679732364864867*^9, 
   3.679732417504838*^9}, {3.67973299821957*^9, 3.6797330047850933`*^9}, {
   3.679733068591881*^9, 3.679733118223279*^9}, {3.679733347697291*^9, 
   3.679733367746338*^9}, 3.679733469912014*^9, {3.679733528839448*^9, 
   3.679733547949156*^9}, {3.679733685049611*^9, 3.6797336861133947`*^9}, {
   3.6797343002127247`*^9, 3.679734450408527*^9}, {3.6797345134559307`*^9, 
   3.679734558253223*^9}, {3.679734596654254*^9, 3.679734624339402*^9}, {
   3.679734659344974*^9, 3.6797346683065023`*^9}, {3.679734698787793*^9, 
   3.67973470587523*^9}, {3.679734748466054*^9, 3.679734811726412*^9}, 
   3.679734847175488*^9, {3.679734996460588*^9, 3.6797351021860027`*^9}, 
   3.6797351461141567`*^9, {3.6797353083576937`*^9, 3.679735324548381*^9}, {
   3.679735377692288*^9, 3.679735421274282*^9}, {3.679735573991074*^9, 
   3.67973561279739*^9}, {3.6797356502862177`*^9, 3.6797356546767893`*^9}, {
   3.679736345501027*^9, 3.6797363539167967`*^9}, 3.6797412343747263`*^9, {
   3.6797412788750467`*^9, 3.6797412863519373`*^9}, {3.679741724170665*^9, 
   3.6797417422643557`*^9}, {3.679744898512738*^9, 3.679744904462715*^9}, {
   3.7138025803583612`*^9, 3.713802585949602*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"4aceb80c-8dc6-4699-93b5-9c4790b4bb36"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"a3d5f462-bf7c-445c-83cf-7f36cbad8d06"]
}, Closed]],

Cell[CellGroupData[{

Cell["WeightedMean", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, {
   3.6678113884901648`*^9, 3.66781139169668*^9}, {3.667811515797525*^9, 
   3.667811516189644*^9}, 3.667900125753806*^9, {3.684646660758275*^9, 
   3.684646660811885*^9}, {3.684679409191053*^9, 3.684679411222722*^9}, {
   3.6846811176191063`*^9, 3.684681119497213*^9}, {3.6846813101581917`*^9, 
   3.6846813119644547`*^9}},ExpressionUUID->"8b512749-d75e-48ee-bf82-\
dd0f8b315513"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"8843c09c-3373-41fc-9068-0768990a7c6a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"WeightedMean", "::", "numeric"}], "=", 
   "\"\<Numeric input only.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"WeightedMean", "::", "invalid"}], "=", 
   "\"\<Invalid input form.\>\""}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.684681427747033*^9, 3.68468144428977*^9}, {
  3.684681710622183*^9, 3.6846817431468554`*^9}},
 Background->GrayLevel[
  0.85],ExpressionUUID->"34e706a0-ab93-4927-ae91-f8e779d9a5a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"48ecadeb-9d3a-4abd-94fd-aad2a72c50cb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"WeightedMean", "[", "data_List", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "n", ",", "sum", ",", "x", ",", "d", ",", "\[Sigma]", ",", "m", ",", 
      "\[IndentingNewLine]", "w", ",", "sumw", ",", "sumxw", ",", "wx", ",", 
      "sumxn", ",", "\[Sigma]i", ",", "\[Sigma]e"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"*", " ", "Check", " ", "input"}], " ", "**)"}], 
    "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"AllTrue", "[", 
         RowBox[{
          RowBox[{"Flatten", "@", "data"}], ",", "NumericQ"}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"WeightedMean", "::", "numeric"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Depth", "[", "data", "]"}], "\[Equal]", "2"}], ",", 
       RowBox[{"Goto", "[", "\"\<WithoutWeights\>\"", "]"}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"MatchQ", "[", 
        RowBox[{
         RowBox[{"Dimensions", "[", "data", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"_", ",", "2"}], "}"}]}], "]"}], ",", 
       RowBox[{"Goto", "[", "\"\<WithWeights\>\"", "]"}], ",", 
       "\[IndentingNewLine]", "\t", "True", ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"WeightedMean", "::", "invalid"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"*", " ", "Data", " ", "without", " ", "weights"}], " ", 
      "**)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"Label", "[", "\"\<WithoutWeights\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Useful", " ", "variables"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"n", "=", 
      RowBox[{"Length", "@", "data"}]}], ";", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"n", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"First", "@", "data"}], ",", "Indeterminate", ",", 
          "Indeterminate"}], "}"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"sum", "=", 
      RowBox[{"N", "@", 
       RowBox[{"Total", "@", "data"}]}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"x", "=", 
      RowBox[{"sum", "/", "n"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"d", "=", 
      RowBox[{"data", "-", "x"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Standard", " ", "deviations"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"\[Sigma]", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{
        RowBox[{"Total", "[", 
         RowBox[{"d", "^", "2"}], "]"}], "/", 
        RowBox[{"(", 
         RowBox[{"n", "-", "1"}], ")"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"m", "=", 
      RowBox[{"\[Sigma]", "/", 
       RowBox[{"Sqrt", "[", "n", "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{"x", ",", "\[Sigma]", ",", "m"}], "}"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"*", " ", "Data", " ", "with", " ", "weights"}], " ", "**)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Label", "[", "\"\<WithWeights\>\"", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Useful", " ", "variables"}], " ", "*)"}], 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"n", "=", 
      RowBox[{"Length", "@", "data"}]}], ";", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"n", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"data", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", "Indeterminate", ",", 
          
          RowBox[{"data", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "}"}], "]"}]}], "]"}], 
     ";", "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "\[Sigma]"}], "}"}], "=", 
      RowBox[{"N", "@", 
       RowBox[{"Transpose", "@", "data"}]}]}], ";", "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"w", "=", 
      RowBox[{"1", "/", 
       RowBox[{"\[Sigma]", "^", "2"}]}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"sumw", "=", 
      RowBox[{"Total", "[", "w", "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"sumxw", "=", 
      RowBox[{"x", ".", "w"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"wx", "=", 
      RowBox[{"sumxw", "/", "sumw"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Standard", " ", "deviation", " ", 
       RowBox[{"(", "internal", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"\[Sigma]i", "=", 
      RowBox[{"1", "/", 
       RowBox[{"Sqrt", "[", "sumw", "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"Standard", " ", "deviation", " ", 
       RowBox[{"(", "external", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     "\t", 
     RowBox[{"d", "=", 
      RowBox[{"x", "-", "wx"}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"sumxn", "=", 
      RowBox[{"w", ".", 
       RowBox[{"d", "^", "2"}]}]}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"\[Sigma]e", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"sumxn", "/", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"n", "-", "1"}], ")"}], "*", "sumw"}], ")"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{"wx", ",", "\[Sigma]i", ",", "\[Sigma]e"}], "}"}], "]"}], 
     ";"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6678115931321983`*^9, {3.684681126098569*^9, 3.68468113261707*^9}, {
   3.684681314799778*^9, 3.684681395619067*^9}, {3.684681505457395*^9, 
   3.684681556063126*^9}, {3.6846815878074408`*^9, 3.6846818093068333`*^9}, {
   3.684685030178719*^9, 3.684685100167528*^9}, {3.68468520231924*^9, 
   3.684685234012491*^9}, {3.684685281091477*^9, 3.684685439768339*^9}, {
   3.684685587884272*^9, 3.684685671506892*^9}, {3.684685805889974*^9, 
   3.684685908701192*^9}, {3.684685949581909*^9, 3.6846861238240957`*^9}, {
   3.684688760297517*^9, 3.684688760975606*^9}, {3.6846888319429092`*^9, 
   3.684688868964966*^9}, {3.684688936172331*^9, 3.6846889580267563`*^9}, {
   3.684689140823488*^9, 3.6846892517314787`*^9}, {3.6846893353940983`*^9, 
   3.684689347937306*^9}, {3.684689397904675*^9, 3.684689398176662*^9}, {
   3.6846894450874567`*^9, 3.6846895630529423`*^9}, {3.68468959606793*^9, 
   3.684689652778881*^9}, {3.684689724177442*^9, 3.684689740865003*^9}, 
   3.684689840439896*^9, 3.6846898903814*^9, {3.684690123408786*^9, 
   3.684690167350737*^9}, {3.684690205488257*^9, 3.6846902865736523`*^9}, {
   3.684690376428082*^9, 3.684690409930132*^9}, {3.684690573246892*^9, 
   3.6846905870395203`*^9}, {3.6846906279888163`*^9, 3.684690811367805*^9}, {
   3.684690904830155*^9, 3.6846909228530283`*^9}, {3.684691045330447*^9, 
   3.684691055954417*^9}, {3.6846910934271107`*^9, 3.6846911148174763`*^9}, {
   3.6846911666652813`*^9, 3.68469121004055*^9}, {3.684693544799094*^9, 
   3.68469360660434*^9}, 3.6847327226125917`*^9},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"a52fc267-1e1b-4817-8047-b35fef3d6095"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"7c59d3b9-6528-48ae-b568-435b7200446e"]
}, Closed]],

Cell[CellGroupData[{

Cell["$PixelData", "Subchapter",
 CellChangeTimes->{{3.6646242294759808`*^9, 3.664624234339078*^9}, 
   3.679745594530423*^9, {3.6856909140644207`*^9, 3.6856909161285*^9}, {
   3.6856955548132*^9, 3.685695556654903*^9}, {3.6858508531390133`*^9, 
   3.685850855128764*^9}, {3.6858530128919897`*^9, 3.6858530141106453`*^9}, {
   3.687149993990138*^9, 
   3.6871499970147953`*^9}},ExpressionUUID->"dc4ac92b-d8b4-4684-9228-\
15fb3cd26163"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Messages", " ", "and", " ", "options"}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650292046940385*^9, 3.650292055837142*^9}, 
   3.6502927586977587`*^9, {3.6678074330734873`*^9, 3.6678074367696*^9}, {
   3.6678100547077*^9, 3.667810058922462*^9}},
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"5ef4c8cb-daf1-48a8-86bb-6a903de0fa45"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667811042307796*^9, 3.6678110688569927`*^9}, {3.6678110991292048`*^9, 
   3.667811099480304*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"20dfb9e2-f187-48a7-b006-ed2debf09b55"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$PixelData", "=", 
   RowBox[{"Association", "[", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.682241896337058*^9, 3.6822419009563293`*^9}, {
   3.6822421030731297`*^9, 3.682242104796829*^9}, {3.682242247634622*^9, 
   3.682242293608499*^9}, {3.6822423242774973`*^9, 3.6822424939877663`*^9}, {
   3.682242524871819*^9, 3.682242610095582*^9}, {3.6822426631468697`*^9, 
   3.682242849688897*^9}, {3.682242985123843*^9, 3.682243000592795*^9}, {
   3.682243032221999*^9, 3.682243042906146*^9}, {3.682243121993319*^9, 
   3.682243187533738*^9}, {3.6822433171568623`*^9, 3.682243318068676*^9}, {
   3.6822433533711243`*^9, 3.68224345949043*^9}, {3.682243499999116*^9, 
   3.682243500570818*^9}, {3.682243559642397*^9, 3.682243568303032*^9}, {
   3.682243656585619*^9, 3.682243807041559*^9}, {3.682243892622666*^9, 
   3.682243979341007*^9}, {3.682244011749632*^9, 3.682244092729911*^9}, {
   3.6822441869470167`*^9, 3.682244221175058*^9}, {3.68224427065597*^9, 
   3.682244283409008*^9}, {3.6822443160128517`*^9, 3.682244326447394*^9}, {
   3.682244392020493*^9, 3.682244400571671*^9}, {3.682244596208706*^9, 
   3.682244803339835*^9}, {3.682244951115906*^9, 3.6822449654470167`*^9}, {
   3.682247256239483*^9, 3.682247304444981*^9}, {3.682247343926553*^9, 
   3.682247361035624*^9}, {3.682247395780785*^9, 3.6822474984407682`*^9}, {
   3.6822475305652437`*^9, 3.682247636381772*^9}, {3.6822476807262373`*^9, 
   3.682247690229601*^9}, {3.682247723533629*^9, 3.682247825538166*^9}, {
   3.682247866195016*^9, 3.6822478768890457`*^9}, {3.682247927112714*^9, 
   3.682248080675892*^9}, {3.682248357004342*^9, 3.682248375626561*^9}, {
   3.6822486441315317`*^9, 3.682248669634107*^9}, 3.68224956936229*^9, 
   3.682262332986014*^9, {3.6822623719028997`*^9, 3.68226237223594*^9}, {
   3.682312281830681*^9, 3.6823123030407467`*^9}, {3.682323578349629*^9, 
   3.682323592418137*^9}, {3.6823237158461313`*^9, 3.682323721213748*^9}, 
   3.6823275058706827`*^9, {3.682653967735579*^9, 3.682653986558272*^9}, 
   3.68267392867793*^9, {3.682674020022552*^9, 3.6826740225343513`*^9}, {
   3.6826741539192142`*^9, 3.682674156130925*^9}, {3.68274481796653*^9, 
   3.6827448258026237`*^9}, 3.683540074217566*^9, {3.683951936766644*^9, 
   3.683951973478841*^9}, {3.683956166711895*^9, 3.683956184411542*^9}, {
   3.683956417196473*^9, 3.683956418066112*^9}, {3.683961462919252*^9, 
   3.68396154474839*^9}, {3.683961661862376*^9, 3.6839616629603977`*^9}, {
   3.683961724218606*^9, 3.683961724688292*^9}, 3.683962755396636*^9, {
   3.6839629325079536`*^9, 3.683962946272767*^9}, 3.683963808604355*^9, {
   3.6839638719964027`*^9, 3.683963874849616*^9}, {3.683964121228015*^9, 
   3.683964133461834*^9}, {3.68507416316628*^9, 3.6850741636682453`*^9}, {
   3.687150085201305*^9, 3.687150125949913*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"75bd4ecc-d10f-4435-92c6-36c1c30d44d8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655742356838553*^9, 3.655742372060646*^9}, 
   3.6557467627944937`*^9, 3.655788801290646*^9, {3.655788875176199*^9, 
   3.6557888758261757`*^9}, {3.65578919971651*^9, 3.655789200037839*^9}, {
   3.655801038237483*^9, 3.6558010435312433`*^9}, {3.657190485055834*^9, 
   3.657190510152482*^9}, {3.657190761354436*^9, 3.657190764136423*^9}, {
   3.657190864206573*^9, 3.6571908652469587`*^9}, {3.657191249647196*^9, 
   3.657191274140421*^9}, 3.6571913792520313`*^9, {3.657191423745737*^9, 
   3.6571914240092087`*^9}, {3.6571914551444397`*^9, 3.657191456632414*^9}, 
   3.657196777421657*^9, {3.657196859389958*^9, 3.657196883978856*^9}, {
   3.657196988256592*^9, 3.657197001336329*^9}, 3.657200247719434*^9, 
   3.6572007261726093`*^9, {3.657203655191904*^9, 3.657203655319538*^9}, 
   3.657221819331767*^9, {3.658395294791712*^9, 3.658395316637723*^9}, {
   3.667810213479385*^9, 3.667810216902418*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"86996c06-cc03-4b47-ab85-0b6ad3223692"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Finalise", "Chapter",
 CellChangeTimes->{{3.667810135289062*^9, 
  3.667810137240119*^9}},ExpressionUUID->"453287fc-2841-40ce-ba79-\
3d8dffdb5632"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.650291995903159*^9, 3.650291999656385*^9}, {
  3.655794914392253*^9, 3.655794915028521*^9}, {3.6570168680070057`*^9, 
  3.657016910052175*^9}, {3.657182226988536*^9, 3.657182262339521*^9}, {
  3.6571965249075317`*^9, 3.657196529083351*^9}, {3.657222486965454*^9, 
  3.6572224883724937`*^9}, {3.6572225935629787`*^9, 3.657222623281169*^9}, {
  3.667732206857939*^9, 3.667732209689768*^9}, {3.667810145961068*^9, 
  3.66781016027987*^9}},
 Background->GrayLevel[
  0.85],ExpressionUUID->"f870cf15-ca86-459f-be4d-229151d4f00d"]
}, Closed]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowToolbars->"EditBar",
InitializationCellWarning->False,
WindowSize->{720, 737},
WindowMargins->{{Automatic, 0}, {Automatic, 0}},
FrontEndVersion->"11.3 for Mac OS X x86 (32-bit, 64-bit Kernel) (March 5, \
2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 781, 17, 160, "Title",ExpressionUUID->"7833b4d3-d836-4f05-931e-e692c3034217"],
Cell[CellGroupData[{
Cell[1386, 43, 201, 4, 69, "Chapter",ExpressionUUID->"a80d2db1-a19a-4f58-b5af-934bf34d38b3"],
Cell[CellGroupData[{
Cell[1612, 51, 169, 3, 63, "Subchapter",ExpressionUUID->"699430f8-a558-459a-b93a-a9d9aa0ef8b8"],
Cell[CellGroupData[{
Cell[1806, 58, 4863, 116, 707, "Input",ExpressionUUID->"447b0ba7-3aae-41ff-9aad-7f478a73a42b"],
Cell[CellGroupData[{
Cell[6694, 178, 509, 7, 24, "Print",ExpressionUUID->"f5e7f633-f702-4411-88b2-49aad8585388"],
Cell[7206, 187, 724, 15, 40, "Print",ExpressionUUID->"46427cd1-84cd-44d4-a39f-1793136a5bd6"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[7991, 209, 214, 4, 47, "Subchapter",ExpressionUUID->"32227193-03df-4a4b-85c7-dc316a7eec5a"],
Cell[8208, 215, 616, 12, 48, "Input",ExpressionUUID->"64acf6b3-dd9d-44fb-95ca-24cddbfadd0f"],
Cell[CellGroupData[{
Cell[8849, 231, 271, 7, 35, "Input",ExpressionUUID->"55484cff-afb4-41b2-8291-1416d7ff9d78"],
Cell[9123, 240, 378, 6, 24, "Print",ExpressionUUID->"9019ffaf-f258-4806-b474-f0b927fa9690"]
}, Open  ]],
Cell[9516, 249, 730, 13, 48, "Input",ExpressionUUID->"700ab601-d89f-4271-abd0-1931c03daf94"],
Cell[CellGroupData[{
Cell[10271, 266, 448, 7, 32, "Input",ExpressionUUID->"119401f3-e4a6-4425-9e86-bc36eaf9252c"],
Cell[10722, 275, 253, 4, 32, "Output",ExpressionUUID->"6aa1b066-6d8a-44d8-8425-7a410ed863eb"]
}, Open  ]],
Cell[10990, 282, 507, 9, 48, "Input",ExpressionUUID->"882f3f3c-d8c3-44b6-b61e-f4173879dee1"],
Cell[11500, 293, 197, 5, 32, "Input",ExpressionUUID->"403fb481-ef66-47e5-8f08-02b9df619e3a"],
Cell[11700, 300, 873, 15, 51, "Input",ExpressionUUID->"4b6824f9-decc-42c4-a041-234ae1541977",
 InitializationCell->True],
Cell[12576, 317, 471, 9, 48, "Input",ExpressionUUID->"47ffcf2f-1fb3-4028-a526-f0b3e269caea",
 InitializationCell->True],
Cell[13050, 328, 360, 7, 48, "Input",ExpressionUUID->"b1b8a3aa-6a45-48d2-b8fe-ca071f76c209",
 InitializationCell->True]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[13459, 341, 207, 4, 58, "Chapter",ExpressionUUID->"adf79a8e-15dd-4de1-b651-fedf1848d189"],
Cell[CellGroupData[{
Cell[13691, 349, 331, 5, 65, "Subchapter",ExpressionUUID->"a1caeef5-9fed-42bd-93a0-e0ab75b98add"],
Cell[14025, 356, 420, 8, 48, "Input",ExpressionUUID->"8408cda0-4957-419c-9347-2a0e3a1cc75d",
 InitializationCell->True],
Cell[14448, 366, 1606, 42, 259, "Input",ExpressionUUID->"5d16eb0a-beea-45f5-918b-5b26ca6bf27d",
 InitializationCell->True],
Cell[16057, 410, 1194, 19, 48, "Input",ExpressionUUID->"273b815f-12b0-4039-8924-f7ae26ff86c3",
 InitializationCell->True],
Cell[17254, 431, 2187, 55, 280, "Input",ExpressionUUID->"14d0f2a8-58eb-416c-85a4-49b2ed886f44",
 InitializationCell->True],
Cell[19444, 488, 15090, 345, 1960, "Input",ExpressionUUID->"2f80f240-73b1-4762-bcee-5b8b2499c18b",
 InitializationCell->True],
Cell[34537, 835, 1117, 18, 48, "Input",ExpressionUUID->"0a2d65ae-5fb3-4bd8-9ebd-c8ff4c69704c",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[35691, 858, 538, 8, 49, "Subchapter",ExpressionUUID->"b2f7cc32-c8e4-4b2d-8cde-ebd8dcac7cd5"],
Cell[36232, 868, 420, 8, 46, "Input",ExpressionUUID->"69128417-021e-4d23-8763-6029adc8ed61",
 InitializationCell->True],
Cell[36655, 878, 387, 10, 89, "Input",ExpressionUUID->"9460cd00-5df4-48f0-bc51-73c46ee35dc7",
 InitializationCell->True],
Cell[37045, 890, 1194, 19, 46, "Input",ExpressionUUID->"ce813654-42aa-415f-a40d-51ffea14f503",
 InitializationCell->True],
Cell[38242, 911, 4599, 111, 656, "Input",ExpressionUUID->"a7b25da5-07b4-4378-bf30-7a8f3929fbda",
 InitializationCell->True],
Cell[42844, 1024, 1117, 18, 46, "Input",ExpressionUUID->"6c497642-3a44-41ca-8cc5-1c63241fccc2",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[43998, 1047, 637, 9, 49, "Subchapter",ExpressionUUID->"f17bd351-2c38-4cb7-b6a8-689f9b80aec2"],
Cell[44638, 1058, 420, 8, 48, "Input",ExpressionUUID->"fcfa87a2-f589-419b-a19c-9a9b5bf918ae",
 InitializationCell->True],
Cell[45061, 1068, 1537, 26, 91, "Input",ExpressionUUID->"6868daab-8d21-4341-ad52-b145fc9fc377",
 InitializationCell->True],
Cell[46601, 1096, 1194, 19, 48, "Input",ExpressionUUID->"91248770-8752-41e1-89c7-44308304482b",
 InitializationCell->True],
Cell[47798, 1117, 60052, 1234, 12124, "Input",ExpressionUUID->"a2845ce7-71e0-4d6a-a6dc-87d3577e009d",
 InitializationCell->True],
Cell[107853, 2353, 1117, 18, 48, "Input",ExpressionUUID->"8c5c0c83-bc7b-4dfc-ab79-86a1bcf78685",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[109007, 2376, 540, 8, 49, "Subchapter",ExpressionUUID->"0c51ab41-fc34-4902-a0de-0408fceda32b"],
Cell[109550, 2386, 420, 8, 48, "Input",ExpressionUUID->"8108a53c-dfdc-4d3a-89a7-8c21a781684e",
 InitializationCell->True],
Cell[109973, 2396, 1627, 32, 91, "Input",ExpressionUUID->"1bc27315-87d8-4633-a3b6-3c18a1916dce",
 InitializationCell->True],
Cell[111603, 2430, 1194, 19, 48, "Input",ExpressionUUID->"312c650b-6095-4009-969c-f4a73e2c6005",
 InitializationCell->True],
Cell[112800, 2451, 12229, 230, 868, "Input",ExpressionUUID->"48fe546b-6ac5-45ff-8ad0-dac7d2155695",
 InitializationCell->True],
Cell[125032, 2683, 1117, 18, 48, "Input",ExpressionUUID->"34740895-68e3-4d82-b51a-f67934b58b39",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[126186, 2706, 339, 5, 49, "Subchapter",ExpressionUUID->"14bf3578-8d9c-4cb7-b4c3-cebe0abb7317"],
Cell[126528, 2713, 420, 8, 48, "Input",ExpressionUUID->"701f1b16-4878-4a62-af13-9c2b7e66fa44",
 InitializationCell->True],
Cell[126951, 2723, 2978, 59, 238, "Input",ExpressionUUID->"ca60526b-6186-4e3c-aeb5-3bdef76773b7",
 InitializationCell->True],
Cell[129932, 2784, 1194, 19, 48, "Input",ExpressionUUID->"0b6ccb59-b1ec-4444-96c8-1b1f9ddff73c",
 InitializationCell->True],
Cell[131129, 2805, 22861, 459, 2779, "Input",ExpressionUUID->"881eb084-ebad-421e-8706-db485fe279f4",
 InitializationCell->True],
Cell[153993, 3266, 7029, 157, 1078, "Input",ExpressionUUID->"6d5a08ba-f159-42c7-8316-e106aa2f1781",
 InitializationCell->True],
Cell[161025, 3425, 1117, 18, 48, "Input",ExpressionUUID->"41e844d4-8203-469f-a72c-bf026506bbdb",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[162179, 3448, 331, 5, 49, "Subchapter",ExpressionUUID->"2acb6343-d992-441d-871b-f419ef3f6357"],
Cell[162513, 3455, 420, 8, 48, "Input",ExpressionUUID->"ae1046d8-2e52-4402-ae77-d4474b528773",
 InitializationCell->True],
Cell[162936, 3465, 2575, 60, 301, "Input",ExpressionUUID->"7aea4502-3660-4d26-9d7c-94fcde59e7d9",
 InitializationCell->True],
Cell[165514, 3527, 1194, 19, 48, "Input",ExpressionUUID->"414a1848-111c-4586-accb-b5005825f0aa",
 InitializationCell->True],
Cell[166711, 3548, 14458, 333, 1624, "Input",ExpressionUUID->"7cae0bb2-b056-4d96-8f9b-c61777a95838",
 InitializationCell->True],
Cell[181172, 3883, 1117, 18, 60, "Input",ExpressionUUID->"d69a9006-8db9-468b-be40-d6c7883c9970",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[182326, 3906, 490, 7, 49, "Subchapter",ExpressionUUID->"e964329e-9607-409f-b03e-c8db084f23da"],
Cell[182819, 3915, 420, 8, 48, "Input",ExpressionUUID->"8924a8bf-a09f-4b86-9997-4f75e74b2e97",
 InitializationCell->True],
Cell[183242, 3925, 1194, 19, 48, "Input",ExpressionUUID->"7bbfa8ea-ec5e-4b48-b633-9a42cce8327e",
 InitializationCell->True],
Cell[184439, 3946, 10128, 187, 553, "Input",ExpressionUUID->"9f0223cb-811d-407b-b958-395d3f8efdee",
 InitializationCell->True],
Cell[194570, 4135, 1117, 18, 48, "Input",ExpressionUUID->"2a0bcbec-4d89-416a-99af-ae0164582584",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[195724, 4158, 288, 5, 49, "Subchapter",ExpressionUUID->"3b753f0e-2dc0-498e-9a94-d94051e92fc9"],
Cell[196015, 4165, 420, 8, 48, "Input",ExpressionUUID->"5b5fd046-b540-43d4-a0b6-f9e95cedd799",
 InitializationCell->True],
Cell[196438, 4175, 449, 11, 91, "Input",ExpressionUUID->"5e4d63a7-a7ab-4687-890b-9360d007f30a",
 InitializationCell->True],
Cell[196890, 4188, 1194, 19, 48, "Input",ExpressionUUID->"b8ed105a-8270-42d1-bea6-f17597842c9d",
 InitializationCell->True],
Cell[198087, 4209, 22456, 509, 2296, "Input",ExpressionUUID->"638d2a72-b58f-4a7d-9b57-119c87ec7011",
 InitializationCell->True],
Cell[220546, 4720, 1117, 18, 48, "Input",ExpressionUUID->"075394b5-4d49-4717-b6fd-d16f1b704e2c",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[221700, 4743, 331, 5, 49, "Subchapter",ExpressionUUID->"9d33350d-47b1-461d-8fba-ccef7867b6be"],
Cell[222034, 4750, 420, 8, 48, "Input",ExpressionUUID->"6745aaca-2a5c-4789-8e86-334e4fe504b2",
 InitializationCell->True],
Cell[222457, 4760, 1000, 20, 112, "Input",ExpressionUUID->"927be788-9173-4973-8d48-731dcb8fee5f",
 InitializationCell->True],
Cell[223460, 4782, 1194, 19, 48, "Input",ExpressionUUID->"0ea00e5f-03c5-41c4-b110-bc29f235d719",
 InitializationCell->True],
Cell[224657, 4803, 12678, 276, 1246, "Input",ExpressionUUID->"cc51c18b-a55f-4500-ad28-b5397e609971",
 InitializationCell->True],
Cell[237338, 5081, 1117, 18, 48, "Input",ExpressionUUID->"753b6640-683f-4d8b-b37e-29314f731568",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[238492, 5104, 286, 5, 49, "Subchapter",ExpressionUUID->"b94621d0-6abe-4017-88a4-e922b74f41c2"],
Cell[238781, 5111, 420, 8, 48, "Input",ExpressionUUID->"c4ac8ec7-b29a-47a0-a116-51e935419fc9",
 InitializationCell->True],
Cell[239204, 5121, 605, 15, 112, "Input",ExpressionUUID->"23863b24-6390-47ab-8f7a-d06e0ff5d71e",
 InitializationCell->True],
Cell[239812, 5138, 1194, 19, 48, "Input",ExpressionUUID->"efc7281b-ee92-4798-9e85-ece211e89c35",
 InitializationCell->True],
Cell[241009, 5159, 8471, 204, 994, "Input",ExpressionUUID->"886b4b1e-4367-460b-94fc-7c0b5d8f9797",
 InitializationCell->True],
Cell[249483, 5365, 1117, 18, 48, "Input",ExpressionUUID->"6e25b713-5087-4f31-80a3-aae947207983",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[250637, 5388, 519, 8, 49, "Subchapter",ExpressionUUID->"40a83651-223f-4c00-8dba-5817bf6e2b8d"],
Cell[251159, 5398, 420, 8, 48, "Input",ExpressionUUID->"cacd8f66-e512-47e5-bbad-6cc1a1da1a2a",
 InitializationCell->True],
Cell[251582, 5408, 1582, 34, 217, "Input",ExpressionUUID->"31cb6be3-296d-4b79-85af-33ae5e622e0f",
 InitializationCell->True],
Cell[253167, 5444, 1194, 19, 48, "Input",ExpressionUUID->"189e71a9-a784-427e-81aa-3fb2ebfa6d87",
 InitializationCell->True],
Cell[254364, 5465, 13342, 274, 1582, "Input",ExpressionUUID->"d22aa2e1-6f53-4d31-aeeb-8a976dd994d0",
 InitializationCell->True],
Cell[267709, 5741, 1117, 18, 48, "Input",ExpressionUUID->"1c351972-761d-478d-ae2a-8da7c68ef326",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[268863, 5764, 562, 8, 49, "Subchapter",ExpressionUUID->"c080b693-1415-4e12-ad21-98ca6f310069"],
Cell[269428, 5774, 420, 8, 48, "Input",ExpressionUUID->"ee3d08c0-9367-4d02-a509-224629541f83",
 InitializationCell->True],
Cell[269851, 5784, 512, 14, 91, "Input",ExpressionUUID->"6c6d91fb-134f-478a-b97e-1ee4ef8c17dc",
 InitializationCell->True],
Cell[270366, 5800, 1194, 19, 48, "Input",ExpressionUUID->"07ae68d6-d917-491a-88fc-8f9453463699",
 InitializationCell->True],
Cell[271563, 5821, 15289, 350, 1666, "Input",ExpressionUUID->"d09b283c-745c-4550-935c-17d2414fa3a0",
 InitializationCell->True],
Cell[286855, 6173, 1117, 18, 48, "Input",ExpressionUUID->"a66a5896-63cc-496e-96fa-25efeb768265",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[288009, 6196, 391, 6, 49, "Subchapter",ExpressionUUID->"a5381ce5-59b6-4b1c-86ed-5916e748fa74"],
Cell[288403, 6204, 1194, 19, 48, "Input",ExpressionUUID->"fe565d70-3102-4bc2-ab05-790cf46f56cc",
 InitializationCell->True],
Cell[289600, 6225, 1388, 35, 259, "Input",ExpressionUUID->"8ed0a971-3df3-4780-a433-b9020972b800",
 InitializationCell->True],
Cell[290991, 6262, 7953, 190, 973, "Input",ExpressionUUID->"977a2afe-c0ab-4804-9ddc-ed0525deb087",
 InitializationCell->True],
Cell[298947, 6454, 6177, 139, 616, "Input",ExpressionUUID->"e87295ad-15e5-46d5-bad5-5402c709f3b9",
 InitializationCell->True],
Cell[305127, 6595, 6436, 145, 742, "Input",ExpressionUUID->"f607695a-756f-4986-8172-219fec5dcd19",
 InitializationCell->True],
Cell[311566, 6742, 1117, 18, 48, "Input",ExpressionUUID->"6d3f9cc6-94d7-4dee-8de0-dd80efba362c",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[312720, 6765, 562, 8, 49, "Subchapter",ExpressionUUID->"1c036039-a160-4350-b735-abc7d969c17f"],
Cell[313285, 6775, 420, 8, 48, "Input",ExpressionUUID->"febd1b70-c713-432f-81ad-83ce64bf630d",
 InitializationCell->True],
Cell[313708, 6785, 7975, 162, 868, "Input",ExpressionUUID->"2512389a-7af0-4566-bf47-49fe0908ee7f",
 InitializationCell->True],
Cell[321686, 6949, 1194, 19, 48, "Input",ExpressionUUID->"220ccaa5-f6dc-4a1f-8aa2-afc3c7c23238",
 InitializationCell->True],
Cell[322883, 6970, 79884, 1719, 8530, "Input",ExpressionUUID->"3b83ef0b-0c8c-4ac7-9196-92cf80e66ed5",
 InitializationCell->True],
Cell[402770, 8691, 340, 8, 48, "Input",ExpressionUUID->"e3f2376a-5d15-4f48-a826-31ba13fc4867",
 InitializationCell->True],
Cell[403113, 8701, 1117, 18, 48, "Input",ExpressionUUID->"1b3f4c1b-87f9-4af0-bdf7-c3f161486632",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[404267, 8724, 390, 6, 49, "Subchapter",ExpressionUUID->"9bd7a065-171d-467a-b863-5ea43593a2ec"],
Cell[404660, 8732, 420, 8, 48, "Input",ExpressionUUID->"007b628d-f354-4796-a22a-fa75e414fec7",
 InitializationCell->True],
Cell[405083, 8742, 481, 12, 91, "Input",ExpressionUUID->"eb758cc0-e57a-4769-b494-8d15ad3f0765",
 InitializationCell->True],
Cell[405567, 8756, 1194, 19, 48, "Input",ExpressionUUID->"521364a0-76d2-411d-bea3-66fb350aefde",
 InitializationCell->True],
Cell[406764, 8777, 90287, 1773, 12053, "Input",ExpressionUUID->"8b8f800f-b36e-4d1b-b4eb-afd5f8ee2586",
 InitializationCell->True],
Cell[497054, 10552, 1117, 18, 60, "Input",ExpressionUUID->"b4eec69b-5757-4449-be71-eb4a852bd7a3",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[498208, 10575, 308, 5, 49, "Subchapter",ExpressionUUID->"7fa89887-046d-465b-ac16-eabca80de3bc"],
Cell[498519, 10582, 420, 8, 48, "Input",ExpressionUUID->"d423cfce-0ac6-4310-9ac3-3516c3f47f8e",
 InitializationCell->True],
Cell[498942, 10592, 1550, 41, 259, "Input",ExpressionUUID->"0b7ef6d9-16d7-4c78-b8de-39a0750838da",
 InitializationCell->True],
Cell[500495, 10635, 1194, 19, 48, "Input",ExpressionUUID->"62bd9d9f-872c-477f-b794-9a552e5f8dff",
 InitializationCell->True],
Cell[501692, 10656, 56616, 1214, 7092, "Input",ExpressionUUID->"7c947e04-1605-400b-bf12-4988e7bcc9ab",
 InitializationCell->True],
Cell[558311, 11872, 1974, 41, 280, "Input",ExpressionUUID->"098360e2-ac3e-44bd-ad35-c18e4b0da9f4",
 InitializationCell->True],
Cell[560288, 11915, 1117, 18, 48, "Input",ExpressionUUID->"eb80ed6b-f5c8-45cc-ae64-ad2b87bb5f7f",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[561442, 11938, 620, 9, 49, "Subchapter",ExpressionUUID->"2dd21067-07a0-4cd8-805e-a8c7261b1d64"],
Cell[562065, 11949, 420, 8, 46, "Input",ExpressionUUID->"6ccb8904-64b5-41a8-95f7-379f4ba60692",
 InitializationCell->True],
Cell[562488, 11959, 370, 10, 89, "Input",ExpressionUUID->"09fff4b7-4b95-4f2f-86fd-1f3fa694a9d4",
 InitializationCell->True],
Cell[562861, 11971, 1194, 19, 46, "Input",ExpressionUUID->"fe7a24ad-184c-4cba-ba1a-7b74a82e2f6d",
 InitializationCell->True],
Cell[564058, 11992, 9214, 199, 1160, "Input",ExpressionUUID->"c82810ed-77ca-4a80-a585-19963e5b611a",
 InitializationCell->True],
Cell[573275, 12193, 1117, 18, 48, "Input",ExpressionUUID->"00227bdc-9cd6-40f4-ac5b-ed6878758ad9",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[574429, 12216, 289, 5, 49, "Subchapter",ExpressionUUID->"ce349b9d-6982-4794-8985-62d9786c2820"],
Cell[574721, 12223, 420, 8, 48, "Input",ExpressionUUID->"58a041f0-e1ed-4a89-8f9d-e9b593b465e7",
 InitializationCell->True],
Cell[575144, 12233, 2888, 72, 343, "Input",ExpressionUUID->"ce0dad3f-7924-46f5-aaa9-cac6c1cd8b0b",
 InitializationCell->True],
Cell[578035, 12307, 1194, 19, 48, "Input",ExpressionUUID->"00c2ae64-08f8-40fc-838a-bab05634ccc4",
 InitializationCell->True],
Cell[579232, 12328, 18916, 445, 2156, "Input",ExpressionUUID->"4aceb80c-8dc6-4699-93b5-9c4790b4bb36",
 InitializationCell->True],
Cell[598151, 12775, 1117, 18, 60, "Input",ExpressionUUID->"a3d5f462-bf7c-445c-83cf-7f36cbad8d06",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[599305, 12798, 484, 7, 49, "Subchapter",ExpressionUUID->"8b512749-d75e-48ee-bf82-dd0f8b315513"],
Cell[599792, 12807, 420, 8, 48, "Input",ExpressionUUID->"8843c09c-3373-41fc-9068-0768990a7c6a",
 InitializationCell->True],
Cell[600215, 12817, 512, 13, 70, "Input",ExpressionUUID->"34e706a0-ab93-4927-ae91-f8e779d9a5a2",
 InitializationCell->True],
Cell[600730, 12832, 1194, 19, 48, "Input",ExpressionUUID->"48ecadeb-9d3a-4abd-94fd-aad2a72c50cb",
 InitializationCell->True],
Cell[601927, 12853, 8242, 185, 1162, "Input",ExpressionUUID->"a52fc267-1e1b-4817-8047-b35fef3d6095",
 InitializationCell->True],
Cell[610172, 13040, 1117, 18, 60, "Input",ExpressionUUID->"7c59d3b9-6528-48ae-b568-435b7200446e",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[611326, 13063, 435, 7, 49, "Subchapter",ExpressionUUID->"dc4ac92b-d8b4-4684-9228-15fb3cd26163"],
Cell[611764, 13072, 420, 8, 48, "Input",ExpressionUUID->"5ef4c8cb-daf1-48a8-86bb-6a903de0fa45",
 InitializationCell->True],
Cell[612187, 13082, 1194, 19, 48, "Input",ExpressionUUID->"20dfb9e2-f187-48a7-b006-ed2debf09b55",
 InitializationCell->True],
Cell[613384, 13103, 2944, 43, 48, "Input",ExpressionUUID->"75bd4ecc-d10f-4435-92c6-36c1c30d44d8",
 InitializationCell->True],
Cell[616331, 13148, 1117, 18, 48, "Input",ExpressionUUID->"86996c06-cc03-4b47-ab85-0b6ad3223692",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[617497, 13172, 153, 3, 69, "Chapter",ExpressionUUID->"453287fc-2841-40ce-ba79-3d8dffdb5632"],
Cell[617653, 13177, 650, 12, 46, "Input",ExpressionUUID->"f870cf15-ca86-459f-be4d-229151d4f00d",
 InitializationCell->True]
}, Closed]]
}, Open  ]]
}
]
*)

